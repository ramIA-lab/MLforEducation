<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dante Conti, Sergi Ramirez, (c) IDEAI">
<meta name="dcterms.date" content="2025-09-30">

<title>Advance Preprocessing ‚Äì Machine Learning for Data Scientist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../imagenes/ideai_logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-83f5ffed4bb819e1a410337fb71ccdff.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Machine Learning for Data Scientist</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Grau en Estad√≠stica</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src="../..\imagenes/Logo_UPC.svg.png" class="img-fluid"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#descripci√≥n-del-problema" id="toc-descripci√≥n-del-problema" class="nav-link active" data-scroll-target="#descripci√≥n-del-problema"><span class="header-section-number">1</span> Descripci√≥n del problema</a></li>
  <li><a href="#limpieza-de-los-datos" id="toc-limpieza-de-los-datos" class="nav-link" data-scroll-target="#limpieza-de-los-datos"><span class="header-section-number">2</span> Limpieza de los datos</a>
  <ul class="collapse">
  <li><a href="#limpieza-de-los-datos-a-nivel-de-variable" id="toc-limpieza-de-los-datos-a-nivel-de-variable" class="nav-link" data-scroll-target="#limpieza-de-los-datos-a-nivel-de-variable"><span class="header-section-number">2.1</span> Limpieza de los datos a nivel de variable</a></li>
  <li><a href="#eliminaci√≥n-de-observaciones-duplicadas-o-irrelevantes" id="toc-eliminaci√≥n-de-observaciones-duplicadas-o-irrelevantes" class="nav-link" data-scroll-target="#eliminaci√≥n-de-observaciones-duplicadas-o-irrelevantes"><span class="header-section-number">2.2</span> Eliminaci√≥n de observaciones duplicadas o irrelevantes</a></li>
  </ul></li>
  <li><a href="#outliers" id="toc-outliers" class="nav-link" data-scroll-target="#outliers"><span class="header-section-number">3</span> Outliers</a>
  <ul class="collapse">
  <li><a href="#univariate" id="toc-univariate" class="nav-link" data-scroll-target="#univariate"><span class="header-section-number">3.1</span> Univariate</a>
  <ul class="collapse">
  <li><a href="#max-and-min" id="toc-max-and-min" class="nav-link" data-scroll-target="#max-and-min"><span class="header-section-number">3.1.1</span> Max and Min</a></li>
  <li><a href="#iqr" id="toc-iqr" class="nav-link" data-scroll-target="#iqr"><span class="header-section-number">3.1.2</span> IQR</a></li>
  <li><a href="#boxplot" id="toc-boxplot" class="nav-link" data-scroll-target="#boxplot"><span class="header-section-number">3.1.3</span> Boxplot</a></li>
  <li><a href="#z-score" id="toc-z-score" class="nav-link" data-scroll-target="#z-score"><span class="header-section-number">3.1.4</span> Z-Score</a></li>
  <li><a href="#hampel-identifier" id="toc-hampel-identifier" class="nav-link" data-scroll-target="#hampel-identifier"><span class="header-section-number">3.1.5</span> Hampel Identifier</a></li>
  <li><a href="#tests-estad√≠stics" id="toc-tests-estad√≠stics" class="nav-link" data-scroll-target="#tests-estad√≠stics"><span class="header-section-number">3.1.6</span> Tests Estad√≠stics</a></li>
  </ul></li>
  <li><a href="#multivariate" id="toc-multivariate" class="nav-link" data-scroll-target="#multivariate"><span class="header-section-number">3.2</span> Multivariate</a>
  <ul class="collapse">
  <li><a href="#cas-general" id="toc-cas-general" class="nav-link" data-scroll-target="#cas-general"><span class="header-section-number">3.2.1</span> Cas general</a></li>
  <li><a href="#pca" id="toc-pca" class="nav-link" data-scroll-target="#pca"><span class="header-section-number">3.2.2</span> PCA</a></li>
  <li><a href="#distancia-de-mahalanobis" id="toc-distancia-de-mahalanobis" class="nav-link" data-scroll-target="#distancia-de-mahalanobis"><span class="header-section-number">3.2.3</span> Distancia de Mahalanobis</a></li>
  <li><a href="#regresi√≥-lineal-i-residus" id="toc-regresi√≥-lineal-i-residus" class="nav-link" data-scroll-target="#regresi√≥-lineal-i-residus"><span class="header-section-number">3.2.4</span> Regresi√≥ Lineal i residus</a></li>
  <li><a href="#distancia-de-cook" id="toc-distancia-de-cook" class="nav-link" data-scroll-target="#distancia-de-cook"><span class="header-section-number">3.2.5</span> Distancia de Cook</a></li>
  <li><a href="#k-nearest-neighbors-knn-outlier-score" id="toc-k-nearest-neighbors-knn-outlier-score" class="nav-link" data-scroll-target="#k-nearest-neighbors-knn-outlier-score"><span class="header-section-number">3.2.6</span> K-Nearest Neighbors (KNN) Outlier Score</a></li>
  <li><a href="#local-outlier-factor-lof" id="toc-local-outlier-factor-lof" class="nav-link" data-scroll-target="#local-outlier-factor-lof"><span class="header-section-number">3.2.7</span> Local Outlier Factor (LOF)</a></li>
  <li><a href="#isolation-forest" id="toc-isolation-forest" class="nav-link" data-scroll-target="#isolation-forest"><span class="header-section-number">3.2.8</span> Isolation Forest</a></li>
  <li><a href="#tips-detecci√≥n-de-anomal√≠as" id="toc-tips-detecci√≥n-de-anomal√≠as" class="nav-link" data-scroll-target="#tips-detecci√≥n-de-anomal√≠as"><span class="header-section-number">3.2.9</span> TIPS: Detecci√≥n de anomal√≠as</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#missing-values-valores-faltantes" id="toc-missing-values-valores-faltantes" class="nav-link" data-scroll-target="#missing-values-valores-faltantes"><span class="header-section-number">4</span> Missing values (valores faltantes)</a>
  <ul class="collapse">
  <li><a href="#generate-data-with-nas" id="toc-generate-data-with-nas" class="nav-link" data-scroll-target="#generate-data-with-nas"><span class="header-section-number">4.1</span> Generate data with NA‚Äôs</a></li>
  <li><a href="#little-test" id="toc-little-test" class="nav-link" data-scroll-target="#little-test"><span class="header-section-number">4.2</span> Little Test</a></li>
  <li><a href="#patrons-descriptius-de-na-en-una-base-de-dades" id="toc-patrons-descriptius-de-na-en-una-base-de-dades" class="nav-link" data-scroll-target="#patrons-descriptius-de-na-en-una-base-de-dades"><span class="header-section-number">4.3</span> Patrons descriptius de NA en una base de dades</a>
  <ul class="collapse">
  <li><a href="#explorar-les-relacions-de-nas" id="toc-explorar-les-relacions-de-nas" class="nav-link" data-scroll-target="#explorar-les-relacions-de-nas"><span class="header-section-number">4.3.1</span> Explorar les relacions de NA‚Äôs</a></li>
  <li><a href="#visualitzaci√≥-dels-nas-per-variables" id="toc-visualitzaci√≥-dels-nas-per-variables" class="nav-link" data-scroll-target="#visualitzaci√≥-dels-nas-per-variables"><span class="header-section-number">4.3.2</span> Visualitzaci√≥ dels NA‚Äôs per variables</a></li>
  <li><a href="#detecci√≥-de-nas-en-la-base-de-dades" id="toc-detecci√≥-de-nas-en-la-base-de-dades" class="nav-link" data-scroll-target="#detecci√≥-de-nas-en-la-base-de-dades"><span class="header-section-number">4.3.3</span> Detecci√≥ de NA‚Äôs en la base de dades</a></li>
  <li><a href="#extreu-estad√≠stiques-amb-nas-de-la-base-de-dades" id="toc-extreu-estad√≠stiques-amb-nas-de-la-base-de-dades" class="nav-link" data-scroll-target="#extreu-estad√≠stiques-amb-nas-de-la-base-de-dades"><span class="header-section-number">4.3.4</span> Extreu estad√≠stiques amb NAs de la base de dades</a></li>
  </ul></li>
  <li><a href="#imputaci√≥-b√†sica" id="toc-imputaci√≥-b√†sica" class="nav-link" data-scroll-target="#imputaci√≥-b√†sica"><span class="header-section-number">4.4</span> Imputaci√≥ b√†sica</a>
  <ul class="collapse">
  <li><a href="#imputar-con-la-media" id="toc-imputar-con-la-media" class="nav-link" data-scroll-target="#imputar-con-la-media"><span class="header-section-number">4.4.1</span> Imputar con la media</a></li>
  <li><a href="#imputar-con-la-mediana" id="toc-imputar-con-la-mediana" class="nav-link" data-scroll-target="#imputar-con-la-mediana"><span class="header-section-number">4.4.2</span> Imputar con la mediana</a></li>
  <li><a href="#imputar-con-un-valor-aleatorio" id="toc-imputar-con-un-valor-aleatorio" class="nav-link" data-scroll-target="#imputar-con-un-valor-aleatorio"><span class="header-section-number">4.4.3</span> Imputar con un valor aleatorio</a></li>
  <li><a href="#representa-la-distribuci√≥-a-variables-reals-i-dimputaci√≥-a-trav√©s-del-gr√°fico-de-densidad-con-ggplot2" id="toc-representa-la-distribuci√≥-a-variables-reals-i-dimputaci√≥-a-trav√©s-del-gr√°fico-de-densidad-con-ggplot2" class="nav-link" data-scroll-target="#representa-la-distribuci√≥-a-variables-reals-i-dimputaci√≥-a-trav√©s-del-gr√°fico-de-densidad-con-ggplot2"><span class="header-section-number">4.4.4</span> Representa la distribuci√≥ a variables reals i d‚Äôimputaci√≥ a trav√©s del gr√°fico de densidad con ggplot2</a></li>
  </ul></li>
  <li><a href="#multiple-iterative-regression-imputation-mi-method" id="toc-multiple-iterative-regression-imputation-mi-method" class="nav-link" data-scroll-target="#multiple-iterative-regression-imputation-mi-method"><span class="header-section-number">4.5</span> Multiple Iterative Regression Imputation (MI method)</a></li>
  <li><a href="#media-con-una-variable-target" id="toc-media-con-una-variable-target" class="nav-link" data-scroll-target="#media-con-una-variable-target"><span class="header-section-number">4.6</span> Media con una variable target</a></li>
  <li><a href="#multiple-imputation-by-chained-equations-mice" id="toc-multiple-imputation-by-chained-equations-mice" class="nav-link" data-scroll-target="#multiple-imputation-by-chained-equations-mice"><span class="header-section-number">4.7</span> Multiple Imputation by Chained Equations (MICE)</a>
  <ul class="collapse">
  <li><a href="#exercices" id="toc-exercices" class="nav-link" data-scroll-target="#exercices"><span class="header-section-number">4.7.1</span> Exercices:</a></li>
  </ul></li>
  <li><a href="#knn" id="toc-knn" class="nav-link" data-scroll-target="#knn"><span class="header-section-number">4.8</span> KNN</a>
  <ul class="collapse">
  <li><a href="#exercices-1" id="toc-exercices-1" class="nav-link" data-scroll-target="#exercices-1"><span class="header-section-number">4.8.1</span> Exercices:</a></li>
  </ul></li>
  <li><a href="#missforest" id="toc-missforest" class="nav-link" data-scroll-target="#missforest"><span class="header-section-number">4.9</span> missForest</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">4.9.1</span> Exercises:</a></li>
  <li><a href="#extra" id="toc-extra" class="nav-link" data-scroll-target="#extra"><span class="header-section-number">4.9.2</span> Extra</a></li>
  </ul></li>
  <li><a href="#mimmi" id="toc-mimmi" class="nav-link" data-scroll-target="#mimmi"><span class="header-section-number">4.10</span> MIMMI</a></li>
  </ul></li>
  <li><a href="#features-selection" id="toc-features-selection" class="nav-link" data-scroll-target="#features-selection"><span class="header-section-number">5</span> Features Selection</a>
  <ul class="collapse">
  <li><a href="#preselecci√≥n-de-variables" id="toc-preselecci√≥n-de-variables" class="nav-link" data-scroll-target="#preselecci√≥n-de-variables"><span class="header-section-number">5.1</span> Preselecci√≥n de variables</a>
  <ul class="collapse">
  <li><a href="#varianza-nula" id="toc-varianza-nula" class="nav-link" data-scroll-target="#varianza-nula"><span class="header-section-number">5.1.1</span> Varianza nula</a></li>
  <li><a href="#correlaci√≥n-entre-variables" id="toc-correlaci√≥n-entre-variables" class="nav-link" data-scroll-target="#correlaci√≥n-entre-variables"><span class="header-section-number">5.1.2</span> Correlaci√≥n entre variables</a></li>
  <li><a href="#combinaciones-lineales" id="toc-combinaciones-lineales" class="nav-link" data-scroll-target="#combinaciones-lineales"><span class="header-section-number">5.1.3</span> Combinaciones lineales</a></li>
  </ul></li>
  <li><a href="#m√©todos-de-selecci√≥n-de-variables" id="toc-m√©todos-de-selecci√≥n-de-variables" class="nav-link" data-scroll-target="#m√©todos-de-selecci√≥n-de-variables"><span class="header-section-number">5.2</span> M√©todos de selecci√≥n de variables</a>
  <ul class="collapse">
  <li><a href="#filters" id="toc-filters" class="nav-link" data-scroll-target="#filters"><span class="header-section-number">5.2.1</span> <em>Filters</em></a></li>
  <li><a href="#wrappers" id="toc-wrappers" class="nav-link" data-scroll-target="#wrappers"><span class="header-section-number">5.2.2</span> <em>Wrappers</em></a></li>
  <li><a href="#embeddings" id="toc-embeddings" class="nav-link" data-scroll-target="#embeddings"><span class="header-section-number">5.2.3</span> <em>Embeddings</em></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#features-enginineering" id="toc-features-enginineering" class="nav-link" data-scroll-target="#features-enginineering"><span class="header-section-number">6</span> Features Enginineering</a></li>
  <li><a href="#validaci√≥n-y-control-de-calidad" id="toc-validaci√≥n-y-control-de-calidad" class="nav-link" data-scroll-target="#validaci√≥n-y-control-de-calidad"><span class="header-section-number">7</span> Validaci√≥n y control de calidad</a></li>
  <li><a href="#bibliograf√≠a" id="toc-bibliograf√≠a" class="nav-link" data-scroll-target="#bibliograf√≠a"><span class="header-section-number">8</span> Bibliograf√≠a</a>
  <ul class="collapse">
  <li><a href="#outliers-1" id="toc-outliers-1" class="nav-link" data-scroll-target="#outliers-1"><span class="header-section-number">8.1</span> Outliers</a></li>
  <li><a href="#imputaci√≥n" id="toc-imputaci√≥n" class="nav-link" data-scroll-target="#imputaci√≥n"><span class="header-section-number">8.2</span> Imputaci√≥n</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="AdvancedPreprocessing.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Advance Preprocessing</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Herramientas para el preprocesamiento de los datos</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dante Conti, Sergi Ramirez, (c) IDEAI </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 30, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">September 30, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="descripci√≥n-del-problema" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Descripci√≥n del problema</h1>
<p>Para hacer el apartado de preprocessing vamos a utilizar la base de datos <a href="https://www.kaggle.com/datasets/anyasorc/valentine-dataset"><code>valentine_dataset.csv</code></a>.</p>
</section>
<section id="limpieza-de-los-datos" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Limpieza de los datos</h1>
<section id="limpieza-de-los-datos-a-nivel-de-variable" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="limpieza-de-los-datos-a-nivel-de-variable"><span class="header-section-number">2.1</span> Limpieza de los datos a nivel de variable</h2>
<p>Los <strong>errores estructurales</strong> a nivel de variable se centran fundamentalmente en el tipo de dato de las variables. En primer lugar, se visualizan los datos con la funci√≥n <code>diagnose()</code> de <code>dlookr</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dlookr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>dlookr<span class="sc">::</span><span class="fu">diagnose</span>(dades)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="eliminaci√≥n-de-observaciones-duplicadas-o-irrelevantes" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="eliminaci√≥n-de-observaciones-duplicadas-o-irrelevantes"><span class="header-section-number">2.2</span> Eliminaci√≥n de observaciones duplicadas o irrelevantes</h2>
<p>Las <strong>observaciones duplicadas</strong> aparecen frecuentemente durante la recogida de datos e integraci√≥n de las bases de datos, por lo que dichas duplicidades deben ser eliminadas en esta fase de limpieza.</p>
<p>A continuaci√≥n, se usa la funci√≥n <code>overview()</code> del paquete <code>dlookr</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">overview</span>(dades), <span class="at">n =</span> <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="outliers" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Outliers</h1>
<p>Un outlier es un valor extremo que se aleja significativamente del resto de observaciones. Detectarlos es importante porque pueden distorsionar las estad√≠sticas, influir en los modelos y generar conclusiones err√≥neas.</p>
<p>Existen diferentes enfoques: desde an√°lisis univariantes (una variable a la vez) hasta multivariantes (considerando la relaci√≥n entre varias variables).</p>
<p>Para detectar los valores at√≠picos podemos hacer uso de la funci√≥n <code>diagnose_numeric</code> y <code>diagnose_category</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_numeric</span>(dades)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_category</span>(dades)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="univariate" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="univariate"><span class="header-section-number">3.1</span> Univariate</h2>
<p>En este caso analizamos variable por variable.</p>
<section id="max-and-min" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="max-and-min"><span class="header-section-number">3.1.1</span> Max and Min</h3>
<p>La primera estrategia consiste en observar los valores m√≠nimos y m√°ximos de cada variable num√©rica. Esto nos da una primera idea de los rangos de los datos y de si existen valores extra√±os.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapply</span>(<span class="cf">function</span>(x, name) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"var. "</span>, name, <span class="st">": </span><span class="sc">\n\t</span><span class="st"> min: "</span>, <span class="fu">min</span>(x), <span class="st">"</span><span class="sc">\n\t</span><span class="st"> max: "</span>, <span class="fu">max</span>(x), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="cn">NULL</span>)  <span class="co"># Evita la salida de valores NULL</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>}, dades[, varNum], <span class="fu">colnames</span>(dades[, varNum]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="iqr" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="iqr"><span class="header-section-number">3.1.2</span> IQR</h3>
<p>Otra manera de detectar outliers es usando el <strong>rango intercuart√≠lico (IQR)</strong>. Se definen como outliers los puntos que quedan fuera del intervalo:</p>
<p><span class="math display">\[
[Q1 - 1.5xIQR, Q3 + 1.5xIQR]
\]</span></p>
<p>donde <span class="math inline">\(Q1\)</span> es el primer cuartil, <span class="math inline">\(Q3\)</span> el tercer cuartil e <span class="math inline">\(IQR = Q3 - Q1\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EnvStats)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>IQROutlier <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">rmnas =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  IQ <span class="ot">&lt;-</span> <span class="fu">iqr</span>(variable, <span class="at">na.rm =</span> rmnas)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  intInf <span class="ot">&lt;-</span> <span class="fu">quantile</span>(variable, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))[[<span class="dv">1</span>]] <span class="sc">-</span> <span class="fl">1.5</span><span class="sc">*</span>IQ</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  intSup <span class="ot">&lt;-</span> <span class="fu">quantile</span>(variable, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))[[<span class="dv">2</span>]] <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span>IQ</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  posicions <span class="ot">&lt;-</span> <span class="fu">which</span>(variable <span class="sc">&gt;=</span> intSup <span class="sc">|</span> variable <span class="sc">&lt;=</span> intInf)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(posicions) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Existeixen outliers en les posicions:"</span>, <span class="fu">paste0</span>(posicions, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No existeixen outliers"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(posicions)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>üëâ Aqu√≠ veremos cu√°ntos valores son considerados extremos seg√∫n este criterio en cada variable num√©rica.</p>
</blockquote>
</section>
<section id="boxplot" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="boxplot"><span class="header-section-number">3.1.3</span> Boxplot</h3>
<p>Visualitzaci√≥ basada en IQR per detectar outliers.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(dades[, variable])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot.stats</span>(dades[, variable])<span class="sc">$</span>out</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un boxplot</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dades, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">get</span>(variable))) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Boxplot de "</span>, variable)) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="z-score" class="level3" data-number="3.1.4">
<h3 data-number="3.1.4" class="anchored" data-anchor-id="z-score"><span class="header-section-number">3.1.4</span> Z-Score</h3>
<p>Un outlier es un valor amb |z| &gt; 3 deviaci√≥ est√°ndar</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>valorEscalado <span class="ot">&lt;-</span> <span class="fu">scale</span>(dades[, variable])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(valorEscalado)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">valor =</span> valorEscalado), <span class="fu">aes</span>(<span class="at">x =</span> valor)) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="co"># Histograma</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># L√≠neas horizontales</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="hampel-identifier" class="level3" data-number="3.1.5">
<h3 data-number="3.1.5" class="anchored" data-anchor-id="hampel-identifier"><span class="header-section-number">3.1.5</span> Hampel Identifier</h3>
<p>Utilitza la mediana i la desviaci√≥ absoluta mediana (MAD) en lloc de la mitjana</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>lower_bound <span class="ot">&lt;-</span> <span class="fu">median</span>(dades[, variable]) <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">mad</span>(dades[, variable], <span class="at">constant =</span> <span class="dv">1</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>upper_bound <span class="ot">&lt;-</span> <span class="fu">median</span>(dades[, variable]) <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">mad</span>(dades[, variable], <span class="at">constant =</span> <span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>outlier_ind <span class="ot">&lt;-</span> <span class="fu">which</span>((dades[, variable] <span class="sc">&lt;</span> lower_bound) <span class="sc">|</span> (dades[, variable] <span class="sc">&gt;</span> upper_bound))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>outlier_ind</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tests-estad√≠stics" class="level3" data-number="3.1.6">
<h3 data-number="3.1.6" class="anchored" data-anchor-id="tests-estad√≠stics"><span class="header-section-number">3.1.6</span> Tests Estad√≠stics</h3>
<section id="grubbs-test" class="level4" data-number="3.1.6.1">
<h4 data-number="3.1.6.1" class="anchored" data-anchor-id="grubbs-test"><span class="header-section-number">3.1.6.1</span> Grubbs‚Äô Test</h4>
<p>Detecta valors extrems en una distribuci√≥ normal</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(outliers)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> outliers<span class="sc">::</span><span class="fu">grubbs.test</span>(dades[, variable], <span class="at">opposite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># amb el par√†metre opposite controles quina de les dues cues est√°n buscant</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="dixons-test" class="level4" data-number="3.1.6.2">
<h4 data-number="3.1.6.2" class="anchored" data-anchor-id="dixons-test"><span class="header-section-number">3.1.6.2</span> Dixon‚Äôs Test</h4>
<p>Nom√©s utilitzar per a bbdd petites (entre 3 - 30) observacions</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> outliers<span class="sc">::</span><span class="fu">dixon.test</span>(dades[, variable], <span class="at">opposite =</span> <span class="cn">FALSE</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="rosners-test" class="level4" data-number="3.1.6.3">
<h4 data-number="3.1.6.3" class="anchored" data-anchor-id="rosners-test"><span class="header-section-number">3.1.6.3</span> Rosner‚Äôs Test</h4>
<p>La prueba de Rosner para valores at√≠picos tiene las ventajas de que: 1. se utiliza para detectar varios valores at√≠picos a la vez (a diferencia de la prueba de Grubbs y Dixon, que debe realizarse de forma iterativa para detectar m√∫ltiples valores at√≠picos), 2. Est√° dise√±ado para evitar el problema del enmascaramiento, donde un valor at√≠pico cercano en valor a otro valor at√≠pico puede pasar desapercibido.</p>
<p>A diferencia de la prueba de Dixon, tenga en cuenta que la prueba de Rosner es m√°s apropiada cuando el tama√±o de la muestra es grande (n ‚â• 20).</p>
<p>Esta funci√≥n requiere al menos dos argumentos: - los datos - la cantidad de valores at√≠picos sospechosos k (k = 3 como cantidad predeterminada)</p>
<p>Asumeix normalitat de les dades</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EnvStats)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> EnvStats<span class="sc">::</span><span class="fu">rosnerTest</span>(dades[, variable], <span class="at">k =</span> <span class="dv">1</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>test</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>all.stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="multivariate" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="multivariate"><span class="header-section-number">3.2</span> Multivariate</h2>
<p>Hasta ahora hemos visto cada variable por separado. Sin embargo, a veces los outliers aparecen <strong>en combinaci√≥n</strong> de variables.</p>
<p>Para detectarlos se pueden usar m√©todos como la distancia de Mahalanobis o algoritmos m√°s avanzados de detecci√≥n de anomal√≠as.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scatterplot3d)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>dades <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"https://archive.ics.uci.edu/ml/machine-learning-databases/forest-fires/forestfires.csv"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>dades <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot3d</span>(dades[,<span class="st">"DC"</span>], dades[, <span class="st">"temp"</span>],dades[, <span class="st">"RH"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgl)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>rgl<span class="sc">::</span><span class="fu">plot3d</span>(<span class="at">x =</span> dades[, <span class="st">"DC"</span>], <span class="at">y =</span> dades[, <span class="st">"temp"</span>], <span class="at">z =</span> dades[, <span class="st">"RH"</span>], </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="at">col =</span> <span class="st">"black"</span>, <span class="at">type =</span> <span class="st">'p'</span>, <span class="at">radius =</span> .<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>(fig <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(dades, <span class="at">x =</span> <span class="sc">~</span>DC, <span class="at">y =</span> <span class="sc">~</span>temp, <span class="at">z =</span> <span class="sc">~</span>RH, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">add_markers</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="cas-general" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="cas-general"><span class="header-section-number">3.2.1</span> Cas general</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvoutlier)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dades2 <span class="ot">&lt;-</span> dades; Y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dades2)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> <span class="fu">dd.plot</span>(Y,<span class="at">quan=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.025</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(distances<span class="sc">$</span>md.cla)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(distances<span class="sc">$</span>md.rob)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">aq.plot</span>(Y,<span class="at">delta=</span><span class="fu">qchisq</span>(<span class="fl">0.975</span>,<span class="at">df=</span><span class="fu">ncol</span>(Y)),<span class="at">quan=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,<span class="at">alpha=</span><span class="fl">0.05</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(res)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res<span class="sc">$</span>outliers)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(res<span class="sc">$</span>outliers)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#windows()</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MVN)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># mvnoutliers &lt;- mvn(dades, multivariateOutlierMethod = "adj", showOutliers = TRUE, </span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                   showNewData = TRUE)</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>mvnoutliers <span class="ot">&lt;-</span> <span class="fu">mvn</span>(<span class="at">data =</span> dades, <span class="at">mvn_test =</span> <span class="st">"royston"</span>, </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">univariate_test =</span> <span class="st">"AD"</span>, </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">multivariate_outlier_method =</span> <span class="st">"adj"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">show_new_data =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualitzem tots els outliers detectats com a true</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">summary</span>(mvnoutliers, <span class="at">select =</span> <span class="st">"outliers"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualitzem les variables originals quines han donat els que no son outliers</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">summary</span>(mvnoutliers, <span class="at">select =</span> <span class="st">"new_data"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualitzem els resultats del test de normalitat univariant</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">summary</span>(mvnoutliers, <span class="at">select =</span> <span class="st">"mvn"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>i multivariant</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">summary</span>(mvnoutliers, <span class="at">select =</span> <span class="st">"univariate"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="pca" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="pca"><span class="header-section-number">3.2.2</span> PCA</h3>
<p>M√©todes basats en correlacions ens permeten detectar outliers</p>
</section>
<section id="distancia-de-mahalanobis" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="distancia-de-mahalanobis"><span class="header-section-number">3.2.3</span> Distancia de Mahalanobis</h3>
<p>Medeix la distancia de un punt respecte a la mitjana considerant la covarian√ßa</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>distancia_mahalanobis <span class="ot">&lt;-</span> <span class="fu">mahalanobis</span>(dades, <span class="fu">colMeans</span>(dades), <span class="fu">cov</span>(dades))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Grafiquem el plot de la densitat de les distancies</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(distancia_mahalanobis))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Es mostren els valors de la bbdd que queden per sobre de el 99% de la distribuci√≥ chi-cuadrat</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> <span class="fu">qchisq</span>(<span class="at">p =</span> <span class="fl">0.99</span>, <span class="at">df =</span> <span class="fu">ncol</span>(dades))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>dades[distancia_mahalanobis<span class="sc">&gt;</span>cutoff, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Ordenamos de forma decreciente, seg√∫n el score de Mahalanobis</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dades <span class="ot">&lt;-</span> dades[<span class="fu">order</span>(distancia_mahalanobis, <span class="at">decreasing =</span> <span class="cn">TRUE</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualitzem l‚Äôhistograma de les distancies per veure on tallem els outliers</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(distancia_mahalanobis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Descartamos los outliers seg√∫n un umbral</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>umbral <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>dades[, <span class="st">"outlier"</span>] <span class="ot">&lt;-</span> (distancia_mahalanobis <span class="sc">&gt;</span> umbral)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>dades[, <span class="st">"color"</span>] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dades[, <span class="st">"outlier"</span>], <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot3d</span>(dades[, <span class="st">"DC"</span>], dades[, <span class="st">"temp"</span>], dades[, <span class="st">"RH"</span>], </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> dades[, <span class="st">"color"</span>])</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>(fig <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(dades, <span class="at">x =</span> <span class="sc">~</span>DC, <span class="at">y =</span> <span class="sc">~</span>temp, <span class="at">z =</span> <span class="sc">~</span>RH, </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> <span class="sc">~</span>color, <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">'#0C4B8E'</span>, <span class="st">'#BF382A'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">add_markers</span>())</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>(quienes <span class="ot">&lt;-</span> <span class="fu">which</span>(dades[, <span class="st">"outlier"</span>] <span class="sc">==</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="mahalanobis-robusto" class="level4" data-number="3.2.3.1">
<h4 data-number="3.2.3.1" class="anchored" data-anchor-id="mahalanobis-robusto"><span class="header-section-number">3.2.3.1</span> Mahalanobis Robusto</h4>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chemometrics)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>dis <span class="ot">&lt;-</span> chemometrics<span class="sc">::</span><span class="fu">Moutlier</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">quantile =</span> <span class="fl">0.99</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dis<span class="sc">$</span>md, dis<span class="sc">$</span>rd, <span class="at">type =</span> <span class="st">"n"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(dis<span class="sc">$</span>md, dis<span class="sc">$</span>rd, <span class="at">labels =</span> <span class="fu">rownames</span>(dades))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">which</span>(dis<span class="sc">$</span>rd <span class="sc">&gt;</span> <span class="dv">7</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="regresi√≥-lineal-i-residus" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="regresi√≥-lineal-i-residus"><span class="header-section-number">3.2.4</span> Regresi√≥ Lineal i residus</h3>
<p>Un punt amb un residu gran pot considerar-se un outlier</p>
</section>
<section id="distancia-de-cook" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="distancia-de-cook"><span class="header-section-number">3.2.5</span> Distancia de Cook</h3>
<p>Identifica punts amb gran influ√®ncia en la regresi√≥. Un valor de Cook D_i &gt; 1 √©s un outliers.</p>
</section>
<section id="k-nearest-neighbors-knn-outlier-score" class="level3" data-number="3.2.6">
<h3 data-number="3.2.6" class="anchored" data-anchor-id="k-nearest-neighbors-knn-outlier-score"><span class="header-section-number">3.2.6</span> K-Nearest Neighbors (KNN) Outlier Score</h3>
<p>Basats en la densitat local de les dades</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adamethods)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">do_knno</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">k=</span><span class="dv">1</span>, <span class="at">top_n =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="local-outlier-factor-lof" class="level3" data-number="3.2.7">
<h3 data-number="3.2.7" class="anchored" data-anchor-id="local-outlier-factor-lof"><span class="header-section-number">3.2.7</span> Local Outlier Factor (LOF)</h3>
<p>Compara la densidat de un punt amb la densidat dels seus ve√Øns. Un valor LOF alt</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DMwR2)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>outlier.scores <span class="ot">&lt;-</span> <span class="fu">lofactor</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(outlier.scores))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>outlier.scores</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> <span class="fu">order</span>(outlier.scores, <span class="at">decreasing=</span>T)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> <span class="fu">order</span>(outlier.scores, <span class="at">decreasing=</span>T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Aprofitarem el ACP per poder visualizar els outliers</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)]); labels <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n; labels[<span class="sc">-</span>outliers] <span class="ot">&lt;-</span> <span class="st">"."</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(<span class="fu">prcomp</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)]), <span class="at">cex =</span> .<span class="dv">8</span>, <span class="at">xlabs =</span> labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Grafiquem les correlacions per veure els gr√°fics</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pch <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"."</span>, n)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>pch[outliers] <span class="ot">&lt;-</span> <span class="st">"+"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"black"</span>, n)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>col[outliers] <span class="ot">&lt;-</span> <span class="st">"red"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">pch =</span> pch, <span class="at">col =</span> col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Ho visualitzem en 3D</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot3d</span>(dades[, <span class="st">"DC"</span>], dades[, <span class="st">"temp"</span>], dades[, <span class="st">"RH"</span>], <span class="at">type =</span> <span class="st">"s"</span>, <span class="at">col =</span> col, <span class="at">size =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="nueva-versi√≥n-de-lof" class="level4" data-number="3.2.7.1">
<h4 data-number="3.2.7.1" class="anchored" data-anchor-id="nueva-versi√≥n-de-lof"><span class="header-section-number">3.2.7.1</span> Nueva versi√≥n de LOF</h4>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rlof)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>outliers.scores <span class="ot">&lt;-</span> Rlof<span class="sc">::</span><span class="fu">lof</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(outliers.scores))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#outlier.scores &lt;- lof(dades[, c("DC", "temp", "RH")], k=c(5:10))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="isolation-forest" class="level3" data-number="3.2.8">
<h3 data-number="3.2.8" class="anchored" data-anchor-id="isolation-forest"><span class="header-section-number">3.2.8</span> Isolation Forest</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Cargamos las librerias necesarias</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R.matlab)   <span class="co"># Lectura de archivos .mat</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(solitude)   <span class="co"># Modelo isolation forest</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># Preparaci√≥n de datos y gr√°ficos</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLmetrics)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Carreguem les dades</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>cardio_mat  <span class="ot">&lt;-</span> <span class="fu">readMat</span>(<span class="st">"https://www.dropbox.com/s/galg3ihvxklf0qi/cardio.mat?dl=1"</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>df_cardio   <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cardio_mat<span class="sc">$</span>X)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>df_cardio<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">as.character</span>(cardio_mat<span class="sc">$</span>y)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> df_cardio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>isoforest <span class="ot">&lt;-</span> isolationForest<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="fu">as.integer</span>(<span class="fu">nrow</span>(datos)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_trees   =</span> <span class="dv">500</span>, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace     =</span> <span class="cn">TRUE</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed        =</span> <span class="dv">123</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>isoforest<span class="sc">$</span><span class="fu">fit</span>(<span class="at">dataset =</span> datos <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Ara anem a realitzar les prediccions.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>predicciones <span class="ot">&lt;-</span> isoforest<span class="sc">$</span><span class="fu">predict</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datos <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>y)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predicciones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> predicciones, <span class="fu">aes</span>(<span class="at">x =</span> average_depth)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="fu">quantile</span>(predicciones<span class="sc">$</span>average_depth, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color      =</span> <span class="st">"red"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype   =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribuci√≥n de las distancias medias del Isolation Forest"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Cuantiles marcados en rojo"</span>  ) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>cuantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="at">x =</span> predicciones<span class="sc">$</span>average_depth, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>))</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>cuantiles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tips-detecci√≥n-de-anomal√≠as" class="level3" data-number="3.2.9">
<h3 data-number="3.2.9" class="anchored" data-anchor-id="tips-detecci√≥n-de-anomal√≠as"><span class="header-section-number">3.2.9</span> TIPS: Detecci√≥n de anomal√≠as</h3>
<p>Una vez que la distancia de separaci√≥n ha sido calculado, se puede emplear como criterio para identificar anomal√≠as. Asumiendo que las observaciones con valores at√≠picos en una o m√°s de sus variables se separan del resto con mayor facilidad, aquellas observaciones con menor distancia promedio deber√≠an ser las m√°s at√≠picas.</p>
<p>En la pr√°ctica, si se est√° empleando esta estrategia de detecci√≥n es porque no se dispone de datos etiquetados, es decir, no se conoce qu√© observaciones son realmente anomal√≠as. Sin embargo, como en este ejemplo se dispone de la clasificaci√≥n real, se puede verificar si realmente los datos an√≥malos tienen menores distancias.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(predicciones)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datos,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> y, <span class="at">y =</span> average_depth)) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> y), <span class="at">width =</span> <span class="fl">0.03</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">colour =</span> <span class="st">"orangered2"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distancia promedio en el modelo Isolation Forest"</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"clasificaci√≥n (0 = normal, 1 = anomal√≠a)"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Distancia promedio"</span>) <span class="sc">+</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>La distancia promedio en el grupo de las anomal√≠as (1) es claramente inferior. Sin embargo, al existir solapamiento, si se clasifican las n observaciones con menor distancia como anomal√≠as, se incurrir√≠a en errores de falsos positivos.</p>
<p>Acorde a la documentaci√≥n, el set de datos Cardiotocogrpahy contiene 176 anomal√≠as. V√©ase la matriz de confusi√≥n resultante si se clasifican como anomal√≠as las 176 observaciones con menor distancia predicha.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(y, average_depth) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(average_depth) <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clasificacion =</span> <span class="fu">if_else</span>(average_depth <span class="sc">&lt;=</span> <span class="fl">8.5</span>, <span class="st">"1"</span>, <span class="st">"0"</span>))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>mat_confusion <span class="ot">&lt;-</span> MLmetrics<span class="sc">::</span><span class="fu">ConfusionMatrix</span>(</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_pred =</span> resultados<span class="sc">$</span>clasificacion,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_true =</span> resultados<span class="sc">$</span>y)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>mat_confusion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="missing-values-valores-faltantes" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Missing values (valores faltantes)</h1>
<p>Los <strong>valores faltantes</strong> aparecen cuando una observaci√≥n no tiene registrado el valor en cierta variable.</p>
<p>Manejar correctamente los NA es esencial: eliminarlos puede reducir mucho el dataset, mientras que imputarlos incorrectamente puede introducir sesgos.</p>
<p>Existen varias t√©cnicas:</p>
<ul>
<li><strong>Eliminaci√≥n de filas/columnas</strong> con demasiados NA.</li>
<li><strong>Imputaci√≥n simple</strong>, por ejemplo reemplazando con la media o moda.</li>
<li><strong>Imputaci√≥n avanzada</strong>, como KNN o modelos predictivos.</li>
</ul>
<blockquote class="blockquote">
<p>üëâ La elecci√≥n depende de la importancia de la variable, la cantidad de NA y el contexto del problema.</p>
</blockquote>
<section id="generate-data-with-nas" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="generate-data-with-nas"><span class="header-section-number">4.1</span> Generate data with NA‚Äôs</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(iris))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>iris.mis <span class="ot">&lt;-</span> missForest<span class="sc">::</span><span class="fu">prodNA</span>(iris, <span class="at">noNA =</span> <span class="fl">0.1</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>((<span class="fu">is.na</span>(iris.mis)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Otra forma de crear missings en el dataframe</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>iris.mis <span class="ot">&lt;-</span> mi<span class="sc">::</span><span class="fu">create.missing</span>(iris, <span class="at">pct.mis =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="little-test" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="little-test"><span class="header-section-number">4.2</span> Little Test</h2>
<p>Es un test que nos permite detectar con que tipo de NA‚Äôs estamos enfrente:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>naniar<span class="sc">::</span><span class="fu">mcar_test</span>(iris.mis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Si el valor p de la prova √©s inferior a 0 aix√≤ vol dir que les dades amb NAs s‚Äôhan generat aleat√≤riament.</p>
</section>
<section id="patrons-descriptius-de-na-en-una-base-de-dades" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="patrons-descriptius-de-na-en-una-base-de-dades"><span class="header-section-number">4.3</span> Patrons descriptius de NA en una base de dades</h2>
<section id="explorar-les-relacions-de-nas" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="explorar-les-relacions-de-nas"><span class="header-section-number">4.3.1</span> Explorar les relacions de NA‚Äôs</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_dat</span>(airquality);</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_dat</span>(iris.mis)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(airquality);</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(iris.mis)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R,<span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R,  <span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>()</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>() <span class="sc">+</span> </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Month)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>() <span class="sc">+</span> </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Month) <span class="sc">+</span> </span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dark</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualitzaci√≥-dels-nas-per-variables" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="visualitzaci√≥-dels-nas-per-variables"><span class="header-section-number">4.3.2</span> Visualitzaci√≥ dels NA‚Äôs per variables</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(airquality) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Look at all the missing ones"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="detecci√≥-de-nas-en-la-base-de-dades" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="detecci√≥-de-nas-en-la-base-de-dades"><span class="header-section-number">4.3.3</span> Detecci√≥ de NA‚Äôs en la base de dades</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>aq_shadow <span class="ot">&lt;-</span> <span class="fu">bind_shadow</span>(airquality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Imprimeix el gr√†fic amb difer√®ncia a les NA i no a les NA,</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_shadow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Ozone_NA) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="at">.vars =</span> <span class="st">"Solar.R"</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"var"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(aq_shadow,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Temp,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> Ozone_NA)) <span class="sc">+</span> </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="extreu-estad√≠stiques-amb-nas-de-la-base-de-dades" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="extreu-estad√≠stiques-amb-nas-de-la-base-de-dades"><span class="header-section-number">4.3.4</span> Extreu estad√≠stiques amb NAs de la base de dades</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop_miss_case</span>(airquality)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pct_miss_case</span>(airquality)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_case_summary</span>(airquality)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_case_table</span>(airquality)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">prop_miss_var</span>(airquality)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pct_miss_var</span>(airquality)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_summary</span>(airquality)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_table</span>(airquality)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="imputaci√≥-b√†sica" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="imputaci√≥-b√†sica"><span class="header-section-number">4.4</span> Imputaci√≥ b√†sica</h2>
<section id="imputar-con-la-media" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="imputar-con-la-media"><span class="header-section-number">4.4.1</span> Imputar con la media</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>iris.mis[, <span class="st">"imputed_Sepal.Length"</span>] <span class="ot">&lt;-</span> <span class="fu">with</span>(iris.mis, Hmisc<span class="sc">::</span><span class="fu">impute</span>(Sepal.Length, mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="imputar-con-la-mediana" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="imputar-con-la-mediana"><span class="header-section-number">4.4.2</span> Imputar con la mediana</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pre_median <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(dades, <span class="at">method =</span> <span class="st">"medianImpute"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>imputed_median <span class="ot">&lt;-</span> <span class="fu">predict</span>(pre_median, dades)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose</span>(imputed_median)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="imputar-con-un-valor-aleatorio" class="level3" data-number="4.4.3">
<h3 data-number="4.4.3" class="anchored" data-anchor-id="imputar-con-un-valor-aleatorio"><span class="header-section-number">4.4.3</span> Imputar con un valor aleatorio</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>iris.mis[, <span class="st">"imputed_Sepal.Length2"</span>] <span class="ot">&lt;-</span> <span class="fu">with</span>(iris.mis, Hmisc<span class="sc">::</span><span class="fu">impute</span>(Sepal.Length, <span class="st">'random'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>De manera similar podeu utilitzar la mediana min, max, per imputar el valor que manca.</p>
</section>
<section id="representa-la-distribuci√≥-a-variables-reals-i-dimputaci√≥-a-trav√©s-del-gr√°fico-de-densidad-con-ggplot2" class="level3" data-number="4.4.4">
<h3 data-number="4.4.4" class="anchored" data-anchor-id="representa-la-distribuci√≥-a-variables-reals-i-dimputaci√≥-a-trav√©s-del-gr√°fico-de-densidad-con-ggplot2"><span class="header-section-number">4.4.4</span> Representa la distribuci√≥ a variables reals i d‚Äôimputaci√≥ a trav√©s del gr√°fico de densidad con ggplot2</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> iris.mis <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sepal.Length, imputed_Sepal.Length, imputed_Sepal.Length2) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Variable)) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para mejor visualizaci√≥n</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Densidad de las tres variables"</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>))</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>iris.mis[, <span class="fu">c</span>(<span class="st">"imputed_Sepal.Length"</span>, <span class="st">"imputed_Sepal.Length2"</span>)] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Otra forma es usando el paquete <code>argImpute</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>(impute_arg <span class="ot">&lt;-</span> Hmisc<span class="sc">::</span><span class="fu">aregImpute</span>(<span class="sc">~</span> Sepal.Length <span class="sc">+</span> Sepal.Width <span class="sc">+</span> Petal.Length <span class="sc">+</span> Petal.Width <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                           Species, <span class="at">data =</span> iris.mis, <span class="at">n.impute =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Revisamos la variable <code>Sepal.Length</code> con la imputaci√≥n realizada en cada una de las rondas.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>impute_arg<span class="sc">$</span>imputed<span class="sc">$</span>Sepal.Length</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Calculamos la media para las 5 simulaciones.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>imputed_Sepal.Length <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(impute_arg<span class="sc">$</span>imputed<span class="sc">$</span>Sepal.Length)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>new_var_imputed <span class="ot">&lt;-</span> iris<span class="sc">$</span>Sepal.Length</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>new_var_imputed[<span class="fu">as.numeric</span>(<span class="fu">names</span>(imputed_Sepal.Length))] <span class="ot">&lt;-</span> imputed_Sepal.Length</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Revisamos la diferencia entre las dos imputaciones.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>newBD <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">real =</span> iris[, <span class="st">"Sepal.Length"</span>], <span class="at">imputed =</span> new_var_imputed)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> newBD <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Variable)) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para mejor visualizaci√≥n</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Densidad de las tres variables"</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="multiple-iterative-regression-imputation-mi-method" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="multiple-iterative-regression-imputation-mi-method"><span class="header-section-number">4.5</span> Multiple Iterative Regression Imputation (MI method)</h2>
<p>Imputamos los valores NA‚Äôs con mi</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mi_data <span class="ot">&lt;-</span> mi<span class="sc">::</span><span class="fu">mi</span>(iris.mis, <span class="at">seed =</span> <span class="dv">335</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Revisamos la informaci√≥n de las imputaciones.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mi_data)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mi_data)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">ask =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Revisamos las interaciones de la base de datos</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mi_data<span class="sc">@</span>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="media-con-una-variable-target" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="media-con-una-variable-target"><span class="header-section-number">4.6</span> Media con una variable target</h2>
<p>Definimos la variable target</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>target <span class="ot">=</span> <span class="st">"Species"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Definimos la base de datos con NA‚Äôs</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">subset</span>(iris, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="fu">get</span>(target)))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> missForest<span class="sc">::</span><span class="fu">prodNA</span>(data, <span class="at">noNA =</span> <span class="fl">0.1</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Species <span class="ot">&lt;-</span> iris[, target]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Definir variables a imputar (excluyendo la variable target)</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>varImp <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data)[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">colnames</span>(data) <span class="sc">%in%</span> target)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Calcular las medias por grupo</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(data[, varImp], <span class="fu">list</span>(data[, target]), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Imputar valores faltantes</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (c <span class="cf">in</span> varImp) {</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (g <span class="cf">in</span> means[, <span class="st">"Group.1"</span>]) {</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    cond <span class="ot">&lt;-</span> data[, target] <span class="sc">==</span> g  <span class="co"># Condici√≥n booleana en vez de which()</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    na_index <span class="ot">&lt;-</span> <span class="fu">is.na</span>(data[, c]) <span class="sc">&amp;</span> cond  <span class="co"># Seleccionar NA dentro del grupo</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Asignar valores imputados</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    data[na_index, c] <span class="ot">&lt;-</span> means[means[, <span class="st">"Group.1"</span>] <span class="sc">==</span> g, c]</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualizamos la diferencia entre las imputaciones</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>iris[, <span class="st">"Tipo"</span>] <span class="ot">&lt;-</span> <span class="st">"original"</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>data[, <span class="st">"Tipo"</span>] <span class="ot">&lt;-</span> <span class="st">"imputed"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Unimos en un mismo dataframe</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(iris, data)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>cols_numeric <span class="ot">&lt;-</span> <span class="fu">names</span>(data_long)[<span class="fu">sapply</span>(data_long, is.numeric) <span class="sc">&amp;</span> <span class="fu">names</span>(data_long) <span class="sc">!=</span> <span class="st">"Tipo"</span>]</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert a large data</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> data_long <span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(cols_numeric), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Creamos el gr√°fico con ggplot</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Tipo)) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para comparaci√≥n</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Variable, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span>  <span class="co"># Un gr√°fico por variable</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparaci√≥n de Distribuciones: Original vs Imputado"</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Removemos la tipologia de variable</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>iris.mis[, <span class="st">"Tipo"</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="multiple-imputation-by-chained-equations-mice" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="multiple-imputation-by-chained-equations-mice"><span class="header-section-number">4.7</span> Multiple Imputation by Chained Equations (MICE)</h2>
<p>Eliminamos las variables categoricas</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>quiCat <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">lapply</span>(iris.mis, class) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"character"</span>, <span class="st">"factor"</span>))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>categories <span class="ot">&lt;-</span> <span class="fu">names</span>(iris.mis)[quiCat]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>iris.mis2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(iris.mis, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="fu">get</span>(categories)))</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iris.mis2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualizamos los patrones de NA‚Äôs de la base de datos</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>mice<span class="sc">::</span><span class="fu">md.pattern</span>(iris.mis2, <span class="at">rotate.names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Tambi√©n lo podemos visualizar con el paquete VIM</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>mice_plot <span class="ot">&lt;-</span> VIM<span class="sc">::</span><span class="fu">aggr</span>(iris.mis2, <span class="at">col=</span><span class="fu">c</span>(<span class="st">'navyblue'</span>,<span class="st">'yellow'</span>),</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">numbers=</span><span class="cn">TRUE</span>, <span class="at">sortVars=</span><span class="cn">TRUE</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels=</span><span class="fu">names</span>(iris.mis), <span class="at">cex.axis=</span>.<span class="dv">7</span>,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gap=</span><span class="dv">3</span>, <span class="at">ylab=</span><span class="fu">c</span>(<span class="st">"Missing data"</span>,<span class="st">"Pattern"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A continuaci√≥n realizamos la imputaci√≥n de los valores faltanes de manera multivariada</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>imputed_Data <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">mice</span>(iris.mis2, <span class="at">m=</span><span class="dv">5</span>, <span class="at">maxit =</span> <span class="dv">50</span>, <span class="at">method =</span> <span class="st">'pmm'</span>, <span class="at">seed =</span> <span class="dv">500</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(imputed_Data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Inspeccionamos la calidad de las imputaciones</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>mice<span class="sc">::</span><span class="fu">stripplot</span>(imputed_Data, Sepal.Width, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">xlab =</span> <span class="st">"Imputation number"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>imputed_Data<span class="sc">$</span>imp<span class="sc">$</span>Sepal.Width</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Al final seleccionamos una de las iteracciones y la dejamos como imputaci√≥n de los valores faltantes.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>completeData <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">complete</span>(imputed_Data, <span class="at">action =</span> <span class="st">"long"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="exercices" class="level3" data-number="4.7.1">
<h3 data-number="4.7.1" class="anchored" data-anchor-id="exercices"><span class="header-section-number">4.7.1</span> Exercices:</h3>
<ol type="1">
<li>Deploy the multiple plot to compare te imputation and not imputation with all numeric vars in dataframe</li>
</ol>
</section>
</section>
<section id="knn" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="knn"><span class="header-section-number">4.8</span> KNN</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tipos <span class="ot">&lt;-</span> <span class="fu">sapply</span>(iris.mis, class)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>varNum <span class="ot">&lt;-</span> <span class="fu">names</span>(tipos)[<span class="fu">which</span>(tipos <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"numeric"</span>, <span class="st">"integer"</span>))]</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>data_knn_imputation <span class="ot">&lt;-</span> multiUS<span class="sc">::</span><span class="fu">KNNimp</span>(iris.mis[, varNum], <span class="at">k =</span> <span class="dv">1</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_knn_imputation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualizamos la diferencia entre las dos imputaciones.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>newBD <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">real =</span> iris[, <span class="st">"Sepal.Length"</span>], <span class="at">imputed =</span> data_knn_imputation[, <span class="st">"Sepal.Length"</span>])</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> newBD <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Variable)) <span class="sc">+</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para mejor visualizaci√≥n</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Densidad de las tres variables"</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Otra forma de hacerlo en R seria la siguiente:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: graficamos_mi_iteration</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"caret"</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>pre_knn <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(dades, <span class="at">method =</span> <span class="st">"knnImpute"</span>, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>imputed_knn <span class="ot">&lt;-</span> <span class="fu">predict</span>(pre_knn, dades)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose</span>(imputed_knn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="exercices-1" class="level3" data-number="4.8.1">
<h3 data-number="4.8.1" class="anchored" data-anchor-id="exercices-1"><span class="header-section-number">4.8.1</span> Exercices:</h3>
<ol type="1">
<li>Deploy the multiple plot to compare the imputation and not imputation with all numeric vars in dataframe</li>
</ol>
</section>
</section>
<section id="missforest" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="missforest"><span class="header-section-number">4.9</span> missForest</h2>
<p>Imputamos los missings usando todos los parametros con los valores por defectos.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(missForest)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>iris.imp <span class="ot">&lt;-</span> <span class="fu">missForest</span>(iris.mis, <span class="at">variablewise =</span> T, <span class="at">verbose =</span> T) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualizamos los valores imputados</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>iris.imp<span class="sc">$</span>ximp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualizamos el error cometido en las imputaciones.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>iris.imp<span class="sc">$</span>OOBerror</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>NRMSE √©s un error normalitzat mitj√† al quadrat. S‚Äôutilitza per representar l‚Äôerror derivat d‚Äôimputar valors continus. El PFC (proporci√≥ de falsament classificada) s‚Äôutilitza per representar l‚Äôerror derivat d‚Äôimputar valors categ√≤rics.</p>
<p>Comparamos el accuracy actual,</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>(iris.err <span class="ot">&lt;-</span> <span class="fu">mixError</span>(iris.imp<span class="sc">$</span>ximp, iris.mis, iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Miramos la diferencia entre las dos imputaciones</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>newBD <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">real =</span> iris[, <span class="st">"Sepal.Length"</span>], <span class="at">imputed =</span>  iris.imp<span class="sc">$</span>ximp[, <span class="st">"Sepal.Length"</span>])</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> newBD <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Variable)) <span class="sc">+</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para mejor visualizaci√≥n</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Densidad de las tres variables"</span>,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="exercises" class="level3" data-number="4.9.1">
<h3 data-number="4.9.1" class="anchored" data-anchor-id="exercises"><span class="header-section-number">4.9.1</span> Exercises:</h3>
<ol type="1">
<li>Deploy the multiple plot to compare te imputation and not imputation with all numeric vars in dataframe</li>
</ol>
</section>
<section id="extra" class="level3" data-number="4.9.2">
<h3 data-number="4.9.2" class="anchored" data-anchor-id="extra"><span class="header-section-number">4.9.2</span> Extra</h3>
<p>Quan es tracta de valors que manquen, √©s possible que vulgueu reempla√ßar valors per valors que manquen (NA). Aix√≤ √©s √∫til en els casos en qu√® es coneix l‚Äôorigen de les dades i es pot estar segur de quins valors han de faltar. Per exemple, podr√≠eu saber que tots els valors de ¬´N/A¬ª, ¬´N A¬ª i ¬´No disponible¬ª, o -99 o -1 se suposa que falten.</p>
<p>naniar proporciona funcions per treballar espec√≠ficament en aquest tipus de problemes utilitzant la funci√≥ replace.with.na. Aquesta funci√≥ √©s el compliment a tidyr::replace els NA‚Äôs, que reempla√ßa un valor NA per un valor especificat, mentre que naniar::replace,with_na reempla√ßa un valor per un NA:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span>replace_na<span class="sc">:</span> Missing values turns into a <span class="fu">value</span> (<span class="cn">NA</span> ‚Äì<span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>naniar<span class="sc">::</span>replace_with_na<span class="sc">:</span> Value becomes a missing <span class="fu">value</span> (<span class="sc">-</span><span class="dv">99</span> ‚Äì<span class="sc">&gt;</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="mimmi" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="mimmi"><span class="header-section-number">4.10</span> MIMMI</h2>
<p>Puedes descargar el fichero de MIMMI pinchando <a href="03_02_MIMMI.R">aqu√≠</a></p>
</section>
</section>
<section id="features-selection" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Features Selection</h1>
<p>La selecci√≥n de variables involucra un conjunto de t√©cnicas cuyo objetivo es seleccionar el subconjunto de variables predictoras m√°s relevante para las fases de modelizaci√≥n. Esto es importante porque:</p>
<ul>
<li><p>Variables predictoras redundantes pueden distraer o enga√±ar a los algoritmos de aprendizaje, lo que posiblemente se traduzca en un menor rendimiento, no solo predictivo (exactitud y precisi√≥n), sino tambi√©n en t√©rminos de tiempo de computaci√≥n.</p></li>
<li><p>Igualmente, la inclusi√≥n de variables irrelevantes aumenta el coste computacional y dificulta la interpretabilidad.</p></li>
</ul>
<p>Una adecuada selecci√≥n de variables tiene ventajas importantes:</p>
<ol type="1">
<li>Elimina las variables con informaci√≥n redundante</li>
<li>Reduce el grado de complejidad de los modelos</li>
<li>Evita o reduce el sobreajuste</li>
<li>Incrementa de la precisi√≥n de las predicciones</li>
<li>Reduce la carga computacional</li>
</ol>
<p>Debe comprobarse la magnitud de la varianza de las variables candidatas a ser seleccionadas y de sus correlaciones dos a dos, as√≠ como si existen combinaciones lineales entre ellas (multicolinealidad).</p>
<p>Los m√©todos de selecci√≥n de variables se pueden resumir en 2 grandes grupos:</p>
<ol type="1">
<li>Los que utilizan variables objetivo (supervisados)</li>
<li>Los que no (no supervisados)</li>
</ol>
<p>Nos centraremos en los que utilizan variable objetivo (supervisados). Estos se pueden dividir en los siguientes grupos:</p>
<ol type="1">
<li><strong>M√©todos tipo filtro</strong> <em>(Filter)</em>: puntua de mayor a menor cada variable predictora en base a su capacidad predictiva y selecciona un subconjunto de variables dependiendo de dicha puntuaci√≥n.</li>
<li><strong>M√©todos tipo envoltura</strong> <em>(wrapper)</em>: Elige un subconjunto de vaiables que dan como resultado el modelo con mayores prestaciones en cuanto a calidad de resultados y eficiencia.</li>
<li><strong>M√©todos tipo intr√≠nsecos</strong> <em>(embedded)</em>: Seleccionan las variables autom√°ticamente como parte del ajuste del modelo durante el entrenamiento.</li>
</ol>
<section id="preselecci√≥n-de-variables" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="preselecci√≥n-de-variables"><span class="header-section-number">5.1</span> Preselecci√≥n de variables</h2>
<section id="varianza-nula" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="varianza-nula"><span class="header-section-number">5.1.1</span> Varianza nula</h3>
<p>Uno de los aspectos fundamentales en la selecci√≥n de variables es comprobar si su varianza es cero o cercana a cero porque, si es as√≠, sus valores son iguales o similares, respectivamente, y, por tanto, esas variables estar√°n perfectamente o cuasiperfectamente correlacionadas con el t√©rmino independiente del modelo, con lo cual, en el mejor de los casos, solo a√±adir√°n ruido al modelo. Este tipo de efecto acaba afectando en la divisi√≥n de los conjuntos de entrenamiento y validaci√≥n de los datos.</p>
<p>Para visualizarlo en R, podemos hacer lo siguiente:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(idealista18)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>Madrid_Sale <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Madrid_Sale)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Madrid_Sale, is.numeric)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num <span class="ot">&lt;-</span> Madrid_Sale[, numeric_cols]</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>varianza <span class="ot">&lt;-</span> <span class="fu">nearZeroVar</span>(Madrid_Sale_num, <span class="at">saveMetrics =</span> T)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(varianza, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       freqRatio percentUnique zeroVar   nzv
PERIOD  2.019617   0.004218742   FALSE FALSE
PRICE   1.076923   2.911986500   FALSE FALSE</code></pre>
</div>
</div>
</section>
<section id="correlaci√≥n-entre-variables" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="correlaci√≥n-entre-variables"><span class="header-section-number">5.1.2</span> Correlaci√≥n entre variables</h3>
<p>Una de las cuestiones a tener en cuenta en el proceso de selecci√≥n de variables es la magnitud de las <strong>correlaciones entre variables</strong> ya que esto puede afectar a la fiabilidad de las predicciones al tener variables muy correlacionadas. En el caso extreno el modelo tendr√° problemas de colinealidad o multicolinealidad.</p>
<p>Para detectar las variables con muy elevada correlaci√≥n entre ellas, se le pasa la funci√≥n <code>findCorrelation()</code> de <code>caret</code>, con valor 0,9, a la matriz de correlaciones lineales entre las variables susceptibles de ser seleccionadas.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>madrid_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(Madrid_Sale_num[, <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>(alta_corr <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(madrid_cor, <span class="at">cutoff =</span> .<span class="dv">9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
</div>
<p>Para visualizar, podemos ver el <code>corrplot</code>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"corrplot"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>matriz_corr <span class="ot">&lt;-</span> <span class="fu">cor</span>(Madrid_Sale_num[, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(matriz_corr, <span class="at">method =</span> <span class="st">"circle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AdvancedPreprocessing_files/figure-html/grafico_correlaciones-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="combinaciones-lineales" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="combinaciones-lineales"><span class="header-section-number">5.1.3</span> Combinaciones lineales</h3>
<p>En la mayor√≠a de los casos las variables que se utilizan como predictoras no son ortogonales, sino que tienen cierto grado de dependencia lineal entre ellas. Si dicho grado es moderado, las consecuencias de la no ortogonalidad en la predicci√≥n no son graves, pero en los casos de dependencia lineal cuasiperfecta las inferencias resultantes del modelo estimado distan mucho de la realidad. Dichas consecuencias son a√∫n m√°s graves en el caso de que las combinaciones lineales sean perfectas. Por ello, la existencia de colinealidad o combinaciones lineales entre las variables seleccionables tambi√©n es una circunstancia a evitar.</p>
<p>Las principales fuentes de multicolinealidad son:</p>
<ul>
<li>El m√©todo utilizado en la recogida de datos (subespacios)</li>
<li>Restricciones en el modelo o en la poblaci√≥n (existencia de variables correlacionadas)</li>
<li>Especificaci√≥n del modelo (polinomios)</li>
<li>M√°s variables que observaciones</li>
</ul>
<p>Los efectos de la multicolinealidad en los modelos son los siguientes:</p>
<ul>
<li>Los estimadores tendr√°n grandes varianzas y covarianzas</li>
<li>Las estimaciones de los coeficientes del modelo ser√°n demasiado grandes</li>
<li>Los signos de los coeficientes estimados suelen ser distintos a los esperados</li>
<li>Peque√±as variaciones en los datos, o en las especificaciones del modelo, provocar√°n grandes cambios en los coeficientes</li>
</ul>
<p>Utilizando la funci√≥n <code>findLinearCombos()</code> del paquete <code>caret</code> permite encontrar combinaciones lineales de las variables predictoras.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num_na <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(Madrid_Sale_num) <span class="co"># Es necesario eliminar los NA.</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>(combos <span class="ot">&lt;-</span> <span class="fu">findLinearCombos</span>(Madrid_Sale_num_na))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$linearCombos
$linearCombos[[1]]
[1] 12 11

$linearCombos[[2]]
[1] 33


$remove
[1] 12 33</code></pre>
</div>
</div>
<p>En caso de encontrarse con problemas de multicolinealidad se deberia de realizar:</p>
<ul>
<li><p>Eliminaci√≥n de variables predictoras que se encuentren altamente relacionadas con otras que permanecen en el modelo</p></li>
<li><p>Sustituir las variables predictoras por componentes principales</p></li>
<li><p>Incluir informaci√≥n externa a los datos originales. Esta alternativa implica utilizar estimadores contra√≠dos (de Stein o ridge) o bayesianos.</p></li>
</ul>
<p>Si quisieramos eliminar variables que son combinaciones lineales deberiamos de hacer lo siguiente:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Madrid_Sale_num_na[, <span class="sc">-</span>combos<span class="sc">$</span>remove])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  PERIOD   PRICE UNITPRICE CONSTRUCTEDAREA ROOMNUMBER BATHNUMBER HASTERRACE
1 201803  126000  2680.851              47          1          1          0
2 201803  228000  4560.000              50          0          1          0
3 201803  425000  6071.429              70          1          1          0
4 201803 2349000  4333.948             542          1          1          0
5 201803  236000  4720.000              50          2          1          0
6 201803 1131000  5463.768             207          5          3          0
  HASLIFT HASAIRCONDITIONING AMENITYID HASPARKINGSPACE PARKINGSPACEPRICE
1       1                  1         3               0                 1
2       0                  0         3               0                 1
3       1                  0         1               1                 1
4       1                  1         3               0                 1
5       0                  0         3               0                 1
6       1                  0         3               1                 1
  HASNORTHORIENTATION HASSOUTHORIENTATION HASEASTORIENTATION HASWESTORIENTATION
1                   0                   0                  0                  0
2                   0                   0                  0                  0
3                   0                   0                  0                  1
4                   0                   0                  0                  0
5                   0                   0                  1                  0
6                   0                   1                  1                  0
  HASBOXROOM HASWARDROBE HASSWIMMINGPOOL HASDOORMAN HASGARDEN ISDUPLEX ISSTUDIO
1          1           1               1          1         1        0        0
2          0           0               0          0         0        0        1
3          0           0               0          0         0        0        0
4          0           0               0          0         0        0        0
5          0           0               0          0         0        0        0
6          1           0               0          1         0        0        0
  ISINTOPFLOOR CONSTRUCTIONYEAR FLOORCLEAN FLATLOCATIONID CADCONSTRUCTIONYEAR
1            0             2005          1              1                2005
2            0             1930          0              1                1930
3            0             1900          2              1                1900
4            0             1890          1              1                1890
5            0             1900          3              1                1900
6            0             1940          0              1                1940
  CADMAXBUILDINGFLOOR CADDWELLINGCOUNT CADASTRALQUALITYID BUILTTYPEID_2
1                   7              319                  3             1
2                   5               19                  7             0
3                   5               16                  1             0
4                   4               11                  2             1
5                   5                6                  6             1
6                   5               29                  4             1
  BUILTTYPEID_3 DISTANCE_TO_CITY_CENTER DISTANCE_TO_METRO
1             0               8.0584293         0.8720746
2             1               1.2502313         0.3370982
3             1               0.7535746         0.4371906
4             0               0.6227413         0.1622422
5             0               1.0341080         0.3147058
6             0               0.6328356         0.1954949
  DISTANCE_TO_CASTELLANA LONGITUDE LATITUDE
1               6.868677 -3.766933 40.36248
2               1.794136 -3.714340 40.40874
3               1.548310 -3.712390 40.41487
4               1.453994 -3.711072 40.41734
5               1.622230 -3.712053 40.40976
6               1.400989 -3.709651 40.42011</code></pre>
</div>
</div>
</section>
</section>
<section id="m√©todos-de-selecci√≥n-de-variables" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="m√©todos-de-selecci√≥n-de-variables"><span class="header-section-number">5.2</span> M√©todos de selecci√≥n de variables</h2>
<p>En el <em>subset</em> de variables que sobrevivien al proceso anterior, es necesario detectar cuales de ellas han de entrar en el modelo. Esta fase se realiza porque:</p>
<ul>
<li>Queremos simplificar los modelos para hacerlos m√°s interpretables</li>
<li>Mejorar la precisi√≥n del modelo</li>
<li>Reducir el tiempo de computaci√≥n. Entrenar algoritmos con mayor velocidad</li>
<li>Evitar la maldici√≥n de la dimensionalidad (efecto Huges), que se refiere a las consecuencias no deseadas que tiene lugar cuando la dimensionalidad de un problema es muy elevada.</li>
<li>Reducir la probabilidad de sobreajuste</li>
</ul>
<section id="filters" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="filters"><span class="header-section-number">5.2.1</span> <em>Filters</em></h3>
<p>Los <strong>m√©todos de selecci√≥n de variables tipo filtro</strong> usan t√©cnicas estad√≠sticas para evaluar la relaci√≥n entre cada variable predictora y la variable objetivo. Generalmente, consideran la influencia de cada variable predictora sobre la variable objetivo por separado. Las puntuaciones obtenidas se utilizan como base para clasificar y elegir las variables predictoras que se utilizar√°n en el modelo.</p>
<p>Si la variable predictora es num√©rica, entonces se usa el coeficiente de correlaci√≥n de Pearson o el de Spearman (si es o no lineal). Si las variables fueran todas categ√≥ricas se podria usar medidas de asociaci√≥n para tablas de contingencia. Por lo contrario si la entregada es categorica y la salida es num√©rica se podrian usar t√©cnicas de ANOVA para analizar que variables son influeyentes.</p>
<p>Podemos usar diferentes paquetes como <code>FSelector</code>, <code>caret</code> para implementar dicha t√©cnica. En este caso, usaremos el paquete <code>FSinR</code>. A continuaci√≥n se muestra un ejemplo para variables predictoras num√©ricas. Para ello, se toma una muestra del conjunto de datos. Una vez en disposici√≥n de la muestra, primeramente se transforma la variable objetivo en categ√≥rica, siendo las categor√≠as (intervalos) cuatro cortes de la distribuci√≥n de sus valores; dicha categorizaci√≥n se lleva a cabo mediante <strong>binning</strong> Tambi√©n se eliminan los registros con datos faltantes.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rsample"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Se toma una muestra con el paquete rsample</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num_sample <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Madrid_Sale_num), <span class="at">size =</span> <span class="dv">5000</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num_sample <span class="ot">&lt;-</span> Madrid_Sale_num[Madrid_Sale_num_sample, ]</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Se realiza binning con cuatro bins</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num_sample_bin <span class="ot">&lt;-</span> Madrid_Sale_num_sample <span class="sc">|&gt;</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price_bin =</span> <span class="fu">cut</span>(PRICE, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">250000</span>, <span class="dv">500000</span>, <span class="dv">750000</span>, <span class="dv">10000000</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"primerQ"</span>, <span class="st">"segundoQ"</span>, <span class="st">"tercerQ"</span>, <span class="st">"c"</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(price_bin, CONSTRUCTEDAREA, ROOMNUMBER, BATHNUMBER, HASTERRACE, HASLIFT)</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Se eliminan los registros con valores missing</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_sample_na <span class="ot">&lt;-</span> <span class="fu">drop_na</span>(Madrid_Sale_num_sample_bin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Una vez discretizada la variable objetivo, se selecciona el conjunto de variables predictoras de la variable objetivo <code>price_bin</code>, que es la variable <code>PRICE</code> transformada mediante <em>binning</em>. Como m√©todo tipo filtro se utiliza minimum description length (MDLM), que es un m√©todo de selecci√≥n de variables que se basa en una medida de la complejidad del modelo denominada ‚Äúlongitud m√≠nima de la descripci√≥n‚Äù (de ah√≠ el nombre del modelo), por lo que su objetivo es encontrar el modelo m√°s sencillo que proporcione una explicaci√≥n aceptable de los datos. Como algoritmo de b√∫squeda se utiliza sequential forward selection.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"FSinR"</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co"># M√©todo tipo filtro MDLC (Minimum-Description_Length-Criterion)</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>evaluador <span class="ot">&lt;-</span> <span class="fu">filterEvaluator</span>(<span class="st">"MDLC"</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Se genera el algoritmo de b√∫squeda</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>buscador <span class="ot">&lt;-</span> <span class="fu">searchAlgorithm</span>(<span class="st">"sequentialForwardSelection"</span>)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Se implementa el proceso, pasando a la funci√≥n los dos par√°metros anteriores</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">featureSelection</span>(Madrid_Sale_sample_na, <span class="st">"price_bin"</span>, buscador, evaluador)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Se muestran los resultados</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>resultados<span class="sc">$</span>bestFeatures</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>resultados<span class="sc">$</span>bestValue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="wrappers" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="wrappers"><span class="header-section-number">5.2.2</span> <em>Wrappers</em></h3>
<p>Este enfoque realiza una b√∫squeda a trav√©s de diferentes combinaciones o subconjuntos de variables predictoras/clasificadoras para comprobar el efecto que tienen en la precisi√≥n del modelo.</p>
<p>Los m√©todos wrapper son de gran eficacia a la hora de eliminar variables irrelevantes y/o redundantes (cosa que no ocurre en los de tipo filtro porque se centran en el poder predictor de cada variable de forma aislada).</p>
<p>tienen en cuenta la circunstancia de que dos o m√°s variables, aparentemente irrelevantes en cuanto a su capacidad predictiva o clasificatoria cuando se consideran una por una, pueden ser relevantes cuando se consideran conjuntamente. Sin embargo, son muy lentos, ya que tienen que aplicar much√≠simas veces el algoritmo de b√∫squeda, cambiando cada vez el n√∫mero de variables, siguiendo cada vez alg√∫n criterio tanto de b√∫squeda como de paro.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se fijan los par√°metros</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>evaluador <span class="ot">&lt;-</span> <span class="fu">wrapperEvaluator</span>(<span class="st">"rpart1SE"</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>buscador <span class="ot">&lt;-</span> <span class="fu">searchAlgorithm</span>(<span class="st">"sequentialForwardSelection"</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Se eval√∫an sobre Madrid_Sale_sample_na</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">featureSelection</span>(Madrid_Sale_sample_na, <span class="st">"price_bin"</span>, buscador, evaluador)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>resultados<span class="sc">$</span>bestFeatures</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>resultados<span class="sc">$</span>bestValue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="embeddings" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="embeddings"><span class="header-section-number">5.2.3</span> <em>Embeddings</em></h3>
<p>Hay algunos algoritmos de aprendizaje autom√°tico que realizan la selecci√≥n autom√°tica de variables como parte del aprendizaje del modelo. Estos son los m√©todos de selecci√≥n de tipo intr√≠nseco, que aglutinan las ventajas de los m√©todos de filtro y envoltura.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"randomForest"</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Usar random forest para la selecci√≥n de variables</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>rf_modelo <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(price_bin <span class="sc">~</span> ., <span class="at">data =</span> Madrid_Sale_num_sample_bin)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Listar las variables m√°s importantes</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="fu">varImp</span>(rf_modelo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="features-enginineering" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Features Enginineering</h1>
<p>La ingenier√≠a de variables consiste en el proceso de conseguir, a partir de la informaci√≥n disponible, las variables id√≥neas (y en el n√∫mero apropiado) para que los modelos o clasificadores proporcionen los mejores resultados posibles, dados los datos disponibles y el modelo a ejecutar.</p>
<p>Una de las herramientas m√°s populares es el <strong>One-hot encoding</strong>. El <strong>One-hot encoding</strong> consiste en asignar a cada etiqueta un n√∫mero entero o valor √∫nico seg√∫n el orden alfab√©tico. Es la codificaci√≥n m√°s popular y ampliamente utilizada.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>dummies <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="st">"  ~ ."</span>, <span class="at">data =</span> Madrid_Sale_num_sample_bin)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(dummies, <span class="at">newdata =</span> Madrid_Sale_num_sample_bin))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="validaci√≥n-y-control-de-calidad" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Validaci√≥n y control de calidad</h1>
<p>Al final del proceso de limpieza de datos, estos deber√≠an ser consistentes y seguir las reglas apropiadas para su campo de negocio. De no ser as√≠, los modelos que se estimen en base a ellos no representar√°n convenientemente la realidad objeto de estudio y las conclusiones que se obtengan de dichos modelos no ser√°n de utilidad para dicha realidad.</p>
<p>La verificaci√≥n de si los datos son o no consistentes y si siguen o no las reglas del campo de negocio del cual proceden se puede llevar a cabo con el paquete <code>tidyverse</code>, que permite hacer selecciones, filtrados o tablas de frecuencias, entre otras acciones.</p>
<p>Una opci√≥n m√°s sofisticada es el paquete <code>validate</code>, donde se pueden introducir las reglas de negocio dentro del propio c√≥digo o bien desde un fichero externo. A continuaci√≥n, se realiza un ejemplo con las reglas incrustadas en el propio c√≥digo. Estas reglas pueden ser avisos o normas que indican error en esos datos. En este ejemplo, se han definido siete reglas: por ejemplo, <code>PRICE</code> ‚â• 0, o que la suma de las variables <code>HASNORTHORIENTATION</code>, <code>HASSOUTHORIENTATION</code>, <code>HASEASTORIENTATION</code> y <code>HASWESTORIENTATION</code> sea la unidad. La salida que se obtiene se presenta a continuaci√≥n.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"validate"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_int <span class="sc">|&gt;</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_that</span>(</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    HASLIFT <span class="sc">&gt;=</span> <span class="dv">0</span>,</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    PRICE <span class="sc">&gt;=</span> <span class="dv">0</span>,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    HASNORTHORIENTATION <span class="sc">+</span> HASSOUTHORIENTATION <span class="sc">+</span> HASEASTORIENTATION <span class="sc">+</span> HASWESTORIENTATION <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.numeric</span>(PRICE),</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>    UNITPRICE <span class="sc">*</span> CONSTRUCTEDAREA <span class="sc">==</span> PRICE,</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ROOMNUMBER <span class="sc">&gt;</span> <span class="dv">3</span>) PRICE <span class="sc">&gt;</span> <span class="dv">100000</span>,</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(.) <span class="sc">&gt;=</span> <span class="dv">20000</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  name items passes fails nNA error warning
1   V1 94815  94815     0   0 FALSE   FALSE
2   V2 94815  94815     0   0 FALSE   FALSE
3   V3 94815  28080 66735   0 FALSE   FALSE
4   V4     1      1     0   0 FALSE   FALSE
5   V5 94815  20111 74704   0 FALSE   FALSE
6   V6 94815  94786    29   0 FALSE   FALSE
7   V7     1      1     0   0 FALSE   FALSE
                                                                                             expression
1                                                                                 HASLIFT - 0 &gt;= -1e-08
2                                                                                   PRICE - 0 &gt;= -1e-08
3 abs(HASNORTHORIENTATION + HASSOUTHORIENTATION + HASEASTORIENTATION + HASWESTORIENTATION - 1) &lt;= 1e-08
4                                                                                     is.numeric(PRICE)
5                                                                  UNITPRICE * CONSTRUCTEDAREA == PRICE
6                                                                     ROOMNUMBER &lt;= 3 | (PRICE &gt; 1e+05)
7                                                                                      nrow(.) &gt;= 20000</code></pre>
</div>
</div>
<p>En un esquema tradicional de validaci√≥n, adem√°s de las reglas de validaci√≥n aportadas por los expertos en el tema del que se trate, debe incluirse tambi√©n un listado de reglas de correcci√≥n (igualmente aportado por los expertos en la materia) que indique c√≥mo hay que corregir un registro cuando no cumple con una determinada regla de validaci√≥n. Este modo de proceder, adem√°s de suponer un doble esfuerzo, puede conducir a inconsistencias o validaciones c√≠clicas.</p>
<p>El <strong>M√©todo de Fellegi y Holt (MFH)</strong> da una soluci√≥n a este problema, evitando dichas inconsistencias, proporcionando un procedimiento que genera un conjunto completo de reglas de validaci√≥n, incorporando reglas impl√≠citas a las formuladas por los expertos de manera expl√≠cita.</p>
<p>Dicho m√©todo asegura el cumplimiento de las siguientes tres premisas:</p>
<ul>
<li>Minimizar el n√∫mero de campos a corregir en un registro para hacerlo pasar todas las validaciones.</li>
<li>Mantener, en la medida de lo posible, la distribuci√≥n conjunta original del conjunto de datos.</li>
<li>Derivar las reglas de correcci√≥n, directamente y de forma impl√≠cita, de las reglas de validaci√≥n. Por tanto, dichas reglas de correcci√≥n no son propuestas por el experto o, en su caso, por el validador.</li>
</ul>
<p>El <strong>MFH</strong> no est√° exento de limitaciones. La primera es el incremento del coste computacional, que puede llegar a constituir un problema en caso de que el n√∫mero de reglas impl√≠citas sea muy elevado, lo cual es muy frecuente. De hecho, hay casos en los que hay m√°s reglas impl√≠citas que registros. Para solucionar este problema, denominado <em>‚Äúproblema de localizaci√≥n del error‚Äù</em>, que consiste, b√°sicamente, en determinar el conjunto m√≠nimo de variables a corregir para cada validaci√≥n, se han propuesto varias alternativas, que incluyen m√©todos de investigaci√≥n de operaciones, √°rboles binarios y metaheur√≠sticas como algoritmos gen√©ticos y similares.</p>
<p>A efectos pr√°cticos, el MFH se puede aplicar con la funci√≥n <code>locate_errors()</code> del paquete <code>errorlocate</code>, determin√°ndose as√≠ cu√°les son las variables a corregir para solventar los errores en las reglas de negocio establecidas (objeto rules).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"errorlocate"</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_red2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(Madrid_Sale_int, <span class="at">price_bin =</span> Hmisc<span class="sc">::</span><span class="fu">cut2</span>(PRICE, <span class="at">g=</span><span class="dv">4</span>))</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="fu">validator</span>(<span class="cf">if</span> (ROOMNUMBER <span class="sc">&gt;=</span> <span class="dv">10</span>) price_bin <span class="sc">==</span> <span class="st">"[502000,7138000]"</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>(el <span class="ot">&lt;-</span> <span class="fu">locate_errors</span>(Madrid_Sale_red2, rules) <span class="sc">|&gt;</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(el))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Variable:
                            name errors missing
42                     price_bin     45       0
6                     ROOMNUMBER     35       0
1                        ASSETID      0       0
2                         PERIOD      0       0
3                          PRICE      0       0
4                      UNITPRICE      0       0
5                CONSTRUCTEDAREA      0       0
7                     BATHNUMBER      0       0
8                     HASTERRACE      0       0
9                        HASLIFT      0       0
10            HASAIRCONDITIONING      0       0
11                     AMENITYID      0       0
12               HASPARKINGSPACE      0       0
13 ISPARKINGSPACEINCLUDEDINPRICE      0       0
14             PARKINGSPACEPRICE      0       0
15           HASNORTHORIENTATION      0       0
16           HASSOUTHORIENTATION      0       0
17            HASEASTORIENTATION      0       0
18            HASWESTORIENTATION      0       0
19                    HASBOXROOM      0       0
20                   HASWARDROBE      0       0
21               HASSWIMMINGPOOL      0       0
22                    HASDOORMAN      0       0
23                     HASGARDEN      0       0
24                      ISDUPLEX      0       0
25                      ISSTUDIO      0       0
26                  ISINTOPFLOOR      0       0
27              CONSTRUCTIONYEAR      0   55873
28                    FLOORCLEAN      0    3846
29                FLATLOCATIONID      0    6387
30           CADCONSTRUCTIONYEAR      0       0
31           CADMAXBUILDINGFLOOR      0       0
32              CADDWELLINGCOUNT      0       0
33            CADASTRALQUALITYID      0       1
34                 BUILTTYPEID_1      0       0
35                 BUILTTYPEID_2      0       0
36                 BUILTTYPEID_3      0       0
37       DISTANCE_TO_CITY_CENTER      0       0
38             DISTANCE_TO_METRO      0       0
39        DISTANCE_TO_CASTELLANA      0       0
40                     LONGITUDE      0       0
41                      LATITUDE      0       0
Errors per record:
  errors records
1      0   94735
2      1      80</code></pre>
</div>
</div>
<p>¬øY qu√© se debe hacer con los registros que no cumplen las normas de validaci√≥n? La respuesta es, como norma, ‚Äúsiempre que se disponga de informaci√≥n de negocio, esta debe preponderar sobre cualquier tipo de imputaci√≥n‚Äù. A partir de este punto se puede proceder a realizar imputaciones determin√≠sticas para solucionar los problemas detectados.</p>
<p>En el ejemplo anterior, se propone imputar el valor <code>ROOMNUMBER=5</code> a los casos de los tres primeros cuartiles (todos menos el m√°s caro) que tengan m√°s de 10 habitaciones. Para ello, se utiliza la funci√≥n <code>modify_so()</code> del paquete <code>dcmodify</code>. Para comprobar que la imputaci√≥n se ha llevado a cabo con √©xito, se pueden comparar los conjuntos de datos antes y despu√©s de la imputaci√≥n con la funci√≥n <code>compare()</code>, comprob√°ndose que tal imputaci√≥n se ha realizado exitosamente en los 2 registros que presentaban problemas con la regla <code>ROOMNUMBER &gt;= 10</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dcmodify"</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> Madrid_Sale_red2 <span class="sc">|&gt;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_so</span>(<span class="cf">if</span> (ROOMNUMBER <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> price_bin <span class="sc">!=</span> <span class="st">"[502000,7138000]"</span>) ROOMNUMBER <span class="ot">&lt;-</span> <span class="dv">5</span>)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="fu">validator</span>(<span class="cf">if</span> (ROOMNUMBER <span class="sc">&gt;=</span> <span class="dv">10</span>) price_bin <span class="sc">==</span> <span class="st">"[502000,7138000]"</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(rules, <span class="at">raw =</span> Madrid_Sale_red2, <span class="at">modified =</span> out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Object of class validatorComparison:

   compare(x = rules, raw = Madrid_Sale_red2, modified = out)

                    Version
Status                 raw modified
  validations        94815    94815
  verifiable         94815    94815
  unverifiable           0        0
  still_unverifiable     0        0
  new_unverifiable       0        0
  satisfied          94735    94815
  still_satisfied    94735    94735
  new_satisfied          0       80
  violated              80        0
  still_violated        80        0
  new_violated           0        0</code></pre>
</div>
</div>
</section>
<section id="bibliograf√≠a" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Bibliograf√≠a</h1>
<section id="outliers-1" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="outliers-1"><span class="header-section-number">8.1</span> Outliers</h2>
<ul>
<li>https://statsandr.com/blog/outliers-detection-in-r/#z-scores</li>
<li>https://m-mburu.github.io/datacamp/anomaly_detection_R/anomaly_detection.html</li>
<li>https://github.com/pridiltal/ctv-AnomalyDetection</li>
</ul>
</section>
<section id="imputaci√≥n" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="imputaci√≥n"><span class="header-section-number">8.2</span> Imputaci√≥n</h2>
<ul>
<li>http://naniar.njtierney.com/articles/replace-with-na.html</li>
<li>https://cran.r-project.org/web/packages/visdat/vignettes/using_visdat.html</li>
<li>https://cran.r-project.org/web/packages/DMwR2/DMwR2.pdf</li>
<li>https://ltorgo.github.io/DMwR2/RintroDM.html#data_pre-processing</li>
<li>https://www.rdocumentation.org/packages/DMwR/versions/0.4.1/topics/knnImputation</li>
<li>https://amices.org/mice/</li>
</ul>


<!-- -->

</section>
</section>

<p>Esta web est√° creada por Dante Conti y Sergi Ram√≠rez, (c) 2025</p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb102" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Advance Preprocessing"</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Herramientas para el preprocesamiento de los datos"</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Dante Conti, Sergi Ramirez, (c) IDEAI</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cerulean</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cerulean</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: false</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># Descripci√≥n del problema</span></span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>Para hacer el apartado de preprocessing vamos a utilizar la base de datos <span class="co">[</span><span class="ot">`valentine_dataset.csv`</span><span class="co">](https://www.kaggle.com/datasets/anyasorc/valentine-dataset)</span>.</span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lectura-datos</span></span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Lectura de los datos</span></span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a>dades <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"E:/PROYECTOS/ramIA-lab_repositorio/MLforEducation/MLforEducation/material/Preprocessing/valentine_dataset.csv"</span>)</span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a>tipus <span class="ot">&lt;-</span> <span class="fu">sapply</span>(dades, class)</span>
<span id="cb102-46"><a href="#cb102-46" aria-hidden="true" tabindex="-1"></a>varNum <span class="ot">&lt;-</span> <span class="fu">names</span>(tipus)[<span class="fu">which</span>(tipus <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"integer"</span>, <span class="st">"numeric"</span>))]</span>
<span id="cb102-47"><a href="#cb102-47" aria-hidden="true" tabindex="-1"></a>varNum <span class="ot">&lt;-</span> varNum[<span class="fu">which</span>(<span class="sc">!</span>varNum <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Valentine_Date"</span>))]</span>
<span id="cb102-48"><a href="#cb102-48" aria-hidden="true" tabindex="-1"></a>varCat <span class="ot">&lt;-</span> <span class="fu">names</span>(tipus)[<span class="fu">which</span>(tipus <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"factor"</span>, <span class="st">"character"</span>))]</span>
<span id="cb102-49"><a href="#cb102-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-50"><a href="#cb102-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-51"><a href="#cb102-51" aria-hidden="true" tabindex="-1"></a><span class="fu"># Limpieza de los datos</span></span>
<span id="cb102-52"><a href="#cb102-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-53"><a href="#cb102-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Limpieza de los datos a nivel de variable</span></span>
<span id="cb102-54"><a href="#cb102-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-55"><a href="#cb102-55" aria-hidden="true" tabindex="-1"></a>Los **errores estructurales** a nivel de variable se centran fundamentalmente en el tipo de dato de las variables. En primer lugar, se visualizan los datos con la funci√≥n <span class="in">`diagnose()`</span> de <span class="in">`dlookr`</span>.</span>
<span id="cb102-56"><a href="#cb102-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-59"><a href="#cb102-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-60"><a href="#cb102-60" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: diagnostico-variables</span></span>
<span id="cb102-61"><a href="#cb102-61" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-62"><a href="#cb102-62" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-63"><a href="#cb102-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-64"><a href="#cb102-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-65"><a href="#cb102-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-66"><a href="#cb102-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dlookr)</span>
<span id="cb102-67"><a href="#cb102-67" aria-hidden="true" tabindex="-1"></a>dlookr<span class="sc">::</span><span class="fu">diagnose</span>(dades)</span>
<span id="cb102-68"><a href="#cb102-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-69"><a href="#cb102-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-70"><a href="#cb102-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Eliminaci√≥n de observaciones duplicadas o irrelevantes</span></span>
<span id="cb102-71"><a href="#cb102-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-72"><a href="#cb102-72" aria-hidden="true" tabindex="-1"></a>Las **observaciones duplicadas** aparecen frecuentemente durante la recogida de datos e integraci√≥n de las bases de datos, por lo que dichas duplicidades deben ser eliminadas en esta fase de limpieza.</span>
<span id="cb102-73"><a href="#cb102-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-74"><a href="#cb102-74" aria-hidden="true" tabindex="-1"></a>A continuaci√≥n, se usa la funci√≥n <span class="in">`overview()`</span> del paquete <span class="in">`dlookr`</span>.</span>
<span id="cb102-75"><a href="#cb102-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-78"><a href="#cb102-78" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-79"><a href="#cb102-79" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: obervaciones-duplicadas</span></span>
<span id="cb102-80"><a href="#cb102-80" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-81"><a href="#cb102-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-82"><a href="#cb102-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-83"><a href="#cb102-83" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-84"><a href="#cb102-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-85"><a href="#cb102-85" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">overview</span>(dades), <span class="at">n =</span> <span class="dv">9</span>)</span>
<span id="cb102-86"><a href="#cb102-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-87"><a href="#cb102-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-88"><a href="#cb102-88" aria-hidden="true" tabindex="-1"></a><span class="fu"># Outliers</span></span>
<span id="cb102-89"><a href="#cb102-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-90"><a href="#cb102-90" aria-hidden="true" tabindex="-1"></a>Un outlier es un valor extremo que se aleja significativamente del resto de observaciones. Detectarlos es importante porque pueden distorsionar las estad√≠sticas, influir en los modelos y generar conclusiones err√≥neas.</span>
<span id="cb102-91"><a href="#cb102-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-92"><a href="#cb102-92" aria-hidden="true" tabindex="-1"></a>Existen diferentes enfoques: desde an√°lisis univariantes (una variable a la vez) hasta multivariantes (considerando la relaci√≥n entre varias variables).</span>
<span id="cb102-93"><a href="#cb102-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-94"><a href="#cb102-94" aria-hidden="true" tabindex="-1"></a>Para detectar los valores at√≠picos podemos hacer uso de la funci√≥n <span class="in">`diagnose_numeric`</span> y <span class="in">`diagnose_category`</span>.</span>
<span id="cb102-95"><a href="#cb102-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-98"><a href="#cb102-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-99"><a href="#cb102-99" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_numeric</span>(dades)</span>
<span id="cb102-100"><a href="#cb102-100" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_category</span>(dades)</span>
<span id="cb102-101"><a href="#cb102-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-102"><a href="#cb102-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-103"><a href="#cb102-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## Univariate</span></span>
<span id="cb102-104"><a href="#cb102-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-105"><a href="#cb102-105" aria-hidden="true" tabindex="-1"></a>En este caso analizamos variable por variable.</span>
<span id="cb102-106"><a href="#cb102-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-107"><a href="#cb102-107" aria-hidden="true" tabindex="-1"></a><span class="fu">### Max and Min</span></span>
<span id="cb102-108"><a href="#cb102-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-109"><a href="#cb102-109" aria-hidden="true" tabindex="-1"></a>La primera estrategia consiste en observar los valores m√≠nimos y m√°ximos de cada variable num√©rica. Esto nos da una primera idea de los rangos de los datos y de si existen valores extra√±os.</span>
<span id="cb102-110"><a href="#cb102-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-113"><a href="#cb102-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-114"><a href="#cb102-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: min_max</span></span>
<span id="cb102-115"><a href="#cb102-115" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-116"><a href="#cb102-116" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-117"><a href="#cb102-117" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-118"><a href="#cb102-118" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-119"><a href="#cb102-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-120"><a href="#cb102-120" aria-hidden="true" tabindex="-1"></a><span class="fu">mapply</span>(<span class="cf">function</span>(x, name) {</span>
<span id="cb102-121"><a href="#cb102-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"var. "</span>, name, <span class="st">": </span><span class="sc">\n\t</span><span class="st"> min: "</span>, <span class="fu">min</span>(x), <span class="st">"</span><span class="sc">\n\t</span><span class="st"> max: "</span>, <span class="fu">max</span>(x), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb102-122"><a href="#cb102-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="cn">NULL</span>)  <span class="co"># Evita la salida de valores NULL</span></span>
<span id="cb102-123"><a href="#cb102-123" aria-hidden="true" tabindex="-1"></a>}, dades[, varNum], <span class="fu">colnames</span>(dades[, varNum]))</span>
<span id="cb102-124"><a href="#cb102-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-125"><a href="#cb102-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-126"><a href="#cb102-126" aria-hidden="true" tabindex="-1"></a><span class="fu">### IQR</span></span>
<span id="cb102-127"><a href="#cb102-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-128"><a href="#cb102-128" aria-hidden="true" tabindex="-1"></a>Otra manera de detectar outliers es usando el **rango intercuart√≠lico (IQR)**. Se definen como outliers los puntos que quedan fuera del intervalo:</span>
<span id="cb102-129"><a href="#cb102-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-130"><a href="#cb102-130" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb102-131"><a href="#cb102-131" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Q1 - 1.5xIQR, Q3 + 1.5xIQR</span><span class="co">]</span></span>
<span id="cb102-132"><a href="#cb102-132" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb102-133"><a href="#cb102-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-134"><a href="#cb102-134" aria-hidden="true" tabindex="-1"></a>donde $Q1$ es el primer cuartil, $Q3$ el tercer cuartil e $IQR = Q3 - Q1$.</span>
<span id="cb102-135"><a href="#cb102-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-138"><a href="#cb102-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-139"><a href="#cb102-139" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: iqr</span></span>
<span id="cb102-140"><a href="#cb102-140" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-141"><a href="#cb102-141" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-142"><a href="#cb102-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-143"><a href="#cb102-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-144"><a href="#cb102-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-145"><a href="#cb102-145" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EnvStats)</span>
<span id="cb102-146"><a href="#cb102-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-147"><a href="#cb102-147" aria-hidden="true" tabindex="-1"></a>IQROutlier <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">rmnas =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb102-148"><a href="#cb102-148" aria-hidden="true" tabindex="-1"></a>  IQ <span class="ot">&lt;-</span> <span class="fu">iqr</span>(variable, <span class="at">na.rm =</span> rmnas)</span>
<span id="cb102-149"><a href="#cb102-149" aria-hidden="true" tabindex="-1"></a>  intInf <span class="ot">&lt;-</span> <span class="fu">quantile</span>(variable, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))[[<span class="dv">1</span>]] <span class="sc">-</span> <span class="fl">1.5</span><span class="sc">*</span>IQ</span>
<span id="cb102-150"><a href="#cb102-150" aria-hidden="true" tabindex="-1"></a>  intSup <span class="ot">&lt;-</span> <span class="fu">quantile</span>(variable, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))[[<span class="dv">2</span>]] <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span>IQ</span>
<span id="cb102-151"><a href="#cb102-151" aria-hidden="true" tabindex="-1"></a>  posicions <span class="ot">&lt;-</span> <span class="fu">which</span>(variable <span class="sc">&gt;=</span> intSup <span class="sc">|</span> variable <span class="sc">&lt;=</span> intInf)</span>
<span id="cb102-152"><a href="#cb102-152" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(posicions) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb102-153"><a href="#cb102-153" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Existeixen outliers en les posicions:"</span>, <span class="fu">paste0</span>(posicions, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb102-154"><a href="#cb102-154" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb102-155"><a href="#cb102-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No existeixen outliers"</span>)</span>
<span id="cb102-156"><a href="#cb102-156" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-157"><a href="#cb102-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(posicions)</span>
<span id="cb102-158"><a href="#cb102-158" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-159"><a href="#cb102-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-160"><a href="#cb102-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-163"><a href="#cb102-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-164"><a href="#cb102-164" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: iqr_valor</span></span>
<span id="cb102-165"><a href="#cb102-165" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb102-166"><a href="#cb102-166" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-167"><a href="#cb102-167" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-168"><a href="#cb102-168" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-169"><a href="#cb102-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-170"><a href="#cb102-170" aria-hidden="true" tabindex="-1"></a><span class="fu">IQROutlier</span>(dades[, <span class="st">"Confidence_Score"</span>])</span>
<span id="cb102-171"><a href="#cb102-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-172"><a href="#cb102-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-173"><a href="#cb102-173" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; üëâ Aqu√≠ veremos cu√°ntos valores son considerados extremos seg√∫n este criterio en cada variable num√©rica.</span></span>
<span id="cb102-174"><a href="#cb102-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-175"><a href="#cb102-175" aria-hidden="true" tabindex="-1"></a><span class="fu">### Boxplot</span></span>
<span id="cb102-176"><a href="#cb102-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-177"><a href="#cb102-177" aria-hidden="true" tabindex="-1"></a>Visualitzaci√≥ basada en IQR per detectar outliers.</span>
<span id="cb102-178"><a href="#cb102-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-181"><a href="#cb102-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-182"><a href="#cb102-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: boxplot</span></span>
<span id="cb102-183"><a href="#cb102-183" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-184"><a href="#cb102-184" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-185"><a href="#cb102-185" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-186"><a href="#cb102-186" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-187"><a href="#cb102-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-188"><a href="#cb102-188" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb102-189"><a href="#cb102-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-190"><a href="#cb102-190" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb102-191"><a href="#cb102-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-192"><a href="#cb102-192" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(dades[, variable])</span>
<span id="cb102-193"><a href="#cb102-193" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot.stats</span>(dades[, variable])<span class="sc">$</span>out</span>
<span id="cb102-194"><a href="#cb102-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-195"><a href="#cb102-195" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un boxplot</span></span>
<span id="cb102-196"><a href="#cb102-196" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dades, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">get</span>(variable))) <span class="sc">+</span></span>
<span id="cb102-197"><a href="#cb102-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb102-198"><a href="#cb102-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Boxplot de "</span>, variable)) <span class="sc">+</span></span>
<span id="cb102-199"><a href="#cb102-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb102-200"><a href="#cb102-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-201"><a href="#cb102-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-202"><a href="#cb102-202" aria-hidden="true" tabindex="-1"></a><span class="fu">### Z-Score</span></span>
<span id="cb102-203"><a href="#cb102-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-204"><a href="#cb102-204" aria-hidden="true" tabindex="-1"></a>Un outlier es un valor amb \|z\| <span class="sc">\&gt;</span> 3 deviaci√≥ est√°ndar</span>
<span id="cb102-205"><a href="#cb102-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-208"><a href="#cb102-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-209"><a href="#cb102-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: z_score</span></span>
<span id="cb102-210"><a href="#cb102-210" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-211"><a href="#cb102-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-212"><a href="#cb102-212" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-213"><a href="#cb102-213" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-214"><a href="#cb102-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-215"><a href="#cb102-215" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb102-216"><a href="#cb102-216" aria-hidden="true" tabindex="-1"></a>valorEscalado <span class="ot">&lt;-</span> <span class="fu">scale</span>(dades[, variable])</span>
<span id="cb102-217"><a href="#cb102-217" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(valorEscalado)</span>
<span id="cb102-218"><a href="#cb102-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-219"><a href="#cb102-219" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">valor =</span> valorEscalado), <span class="fu">aes</span>(<span class="at">x =</span> valor)) <span class="sc">+</span></span>
<span id="cb102-220"><a href="#cb102-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="co"># Histograma</span></span>
<span id="cb102-221"><a href="#cb102-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># L√≠neas horizontales</span></span>
<span id="cb102-222"><a href="#cb102-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb102-223"><a href="#cb102-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-224"><a href="#cb102-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-225"><a href="#cb102-225" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hampel Identifier</span></span>
<span id="cb102-226"><a href="#cb102-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-227"><a href="#cb102-227" aria-hidden="true" tabindex="-1"></a>Utilitza la mediana i la desviaci√≥ absoluta mediana (MAD) en lloc de la mitjana</span>
<span id="cb102-228"><a href="#cb102-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-231"><a href="#cb102-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-232"><a href="#cb102-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: hampel</span></span>
<span id="cb102-233"><a href="#cb102-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-234"><a href="#cb102-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-235"><a href="#cb102-235" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-236"><a href="#cb102-236" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-237"><a href="#cb102-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-238"><a href="#cb102-238" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb102-239"><a href="#cb102-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-240"><a href="#cb102-240" aria-hidden="true" tabindex="-1"></a>lower_bound <span class="ot">&lt;-</span> <span class="fu">median</span>(dades[, variable]) <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">mad</span>(dades[, variable], <span class="at">constant =</span> <span class="dv">1</span>)</span>
<span id="cb102-241"><a href="#cb102-241" aria-hidden="true" tabindex="-1"></a>upper_bound <span class="ot">&lt;-</span> <span class="fu">median</span>(dades[, variable]) <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> <span class="fu">mad</span>(dades[, variable], <span class="at">constant =</span> <span class="dv">1</span>)</span>
<span id="cb102-242"><a href="#cb102-242" aria-hidden="true" tabindex="-1"></a>outlier_ind <span class="ot">&lt;-</span> <span class="fu">which</span>((dades[, variable] <span class="sc">&lt;</span> lower_bound) <span class="sc">|</span> (dades[, variable] <span class="sc">&gt;</span> upper_bound))</span>
<span id="cb102-243"><a href="#cb102-243" aria-hidden="true" tabindex="-1"></a>outlier_ind</span>
<span id="cb102-244"><a href="#cb102-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-245"><a href="#cb102-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-246"><a href="#cb102-246" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tests Estad√≠stics</span></span>
<span id="cb102-247"><a href="#cb102-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-248"><a href="#cb102-248" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Grubbs' Test</span></span>
<span id="cb102-249"><a href="#cb102-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-250"><a href="#cb102-250" aria-hidden="true" tabindex="-1"></a>Detecta valors extrems en una distribuci√≥ normal</span>
<span id="cb102-251"><a href="#cb102-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-254"><a href="#cb102-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-255"><a href="#cb102-255" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grubbs_test</span></span>
<span id="cb102-256"><a href="#cb102-256" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-257"><a href="#cb102-257" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-258"><a href="#cb102-258" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-259"><a href="#cb102-259" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-260"><a href="#cb102-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-261"><a href="#cb102-261" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(outliers)</span>
<span id="cb102-262"><a href="#cb102-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-263"><a href="#cb102-263" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb102-264"><a href="#cb102-264" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> outliers<span class="sc">::</span><span class="fu">grubbs.test</span>(dades[, variable], <span class="at">opposite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-265"><a href="#cb102-265" aria-hidden="true" tabindex="-1"></a><span class="co"># amb el par√†metre opposite controles quina de les dues cues est√°n buscant</span></span>
<span id="cb102-266"><a href="#cb102-266" aria-hidden="true" tabindex="-1"></a>test</span>
<span id="cb102-267"><a href="#cb102-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-268"><a href="#cb102-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-269"><a href="#cb102-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-270"><a href="#cb102-270" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dixon's Test</span></span>
<span id="cb102-271"><a href="#cb102-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-272"><a href="#cb102-272" aria-hidden="true" tabindex="-1"></a>Nom√©s utilitzar per a bbdd petites (entre 3 - 30) observacions</span>
<span id="cb102-273"><a href="#cb102-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-276"><a href="#cb102-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-277"><a href="#cb102-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: dixon-test</span></span>
<span id="cb102-278"><a href="#cb102-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-279"><a href="#cb102-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-280"><a href="#cb102-280" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-281"><a href="#cb102-281" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-282"><a href="#cb102-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-283"><a href="#cb102-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-284"><a href="#cb102-284" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb102-285"><a href="#cb102-285" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> outliers<span class="sc">::</span><span class="fu">dixon.test</span>(dades[, variable], <span class="at">opposite =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-286"><a href="#cb102-286" aria-hidden="true" tabindex="-1"></a>test</span>
<span id="cb102-287"><a href="#cb102-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-288"><a href="#cb102-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-289"><a href="#cb102-289" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Rosner's Test</span></span>
<span id="cb102-290"><a href="#cb102-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-291"><a href="#cb102-291" aria-hidden="true" tabindex="-1"></a>La prueba de Rosner para valores at√≠picos tiene las ventajas de que: 1. se utiliza para detectar varios valores at√≠picos a la vez (a diferencia de la prueba de Grubbs y Dixon, que debe realizarse de forma iterativa para detectar m√∫ltiples valores at√≠picos), 2. Est√° dise√±ado para evitar el problema del enmascaramiento, donde un valor at√≠pico cercano en valor a otro valor at√≠pico puede pasar desapercibido.</span>
<span id="cb102-292"><a href="#cb102-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-293"><a href="#cb102-293" aria-hidden="true" tabindex="-1"></a>A diferencia de la prueba de Dixon, tenga en cuenta que la prueba de Rosner es m√°s apropiada cuando el tama√±o de la muestra es grande (n ‚â• 20).</span>
<span id="cb102-294"><a href="#cb102-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-295"><a href="#cb102-295" aria-hidden="true" tabindex="-1"></a>Esta funci√≥n requiere al menos dos argumentos: - los datos - la cantidad de valores at√≠picos sospechosos k (k = 3 como cantidad predeterminada)</span>
<span id="cb102-296"><a href="#cb102-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-297"><a href="#cb102-297" aria-hidden="true" tabindex="-1"></a>Asumeix normalitat de les dades</span>
<span id="cb102-298"><a href="#cb102-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-301"><a href="#cb102-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-302"><a href="#cb102-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rosner</span></span>
<span id="cb102-303"><a href="#cb102-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-304"><a href="#cb102-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-305"><a href="#cb102-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-306"><a href="#cb102-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-307"><a href="#cb102-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-308"><a href="#cb102-308" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EnvStats)</span>
<span id="cb102-309"><a href="#cb102-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-310"><a href="#cb102-310" aria-hidden="true" tabindex="-1"></a>variable <span class="ot">&lt;-</span> <span class="st">"Age"</span></span>
<span id="cb102-311"><a href="#cb102-311" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> EnvStats<span class="sc">::</span><span class="fu">rosnerTest</span>(dades[, variable], <span class="at">k =</span> <span class="dv">1</span>)</span>
<span id="cb102-312"><a href="#cb102-312" aria-hidden="true" tabindex="-1"></a>test</span>
<span id="cb102-313"><a href="#cb102-313" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>all.stats</span>
<span id="cb102-314"><a href="#cb102-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-315"><a href="#cb102-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-316"><a href="#cb102-316" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multivariate</span></span>
<span id="cb102-317"><a href="#cb102-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-318"><a href="#cb102-318" aria-hidden="true" tabindex="-1"></a>Hasta ahora hemos visto cada variable por separado. Sin embargo, a veces los outliers aparecen **en combinaci√≥n** de variables.</span>
<span id="cb102-319"><a href="#cb102-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-320"><a href="#cb102-320" aria-hidden="true" tabindex="-1"></a>Para detectarlos se pueden usar m√©todos como la distancia de Mahalanobis o algoritmos m√°s avanzados de detecci√≥n de anomal√≠as.</span>
<span id="cb102-321"><a href="#cb102-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-324"><a href="#cb102-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-325"><a href="#cb102-325" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_multivariate</span></span>
<span id="cb102-326"><a href="#cb102-326" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-327"><a href="#cb102-327" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-328"><a href="#cb102-328" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-329"><a href="#cb102-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-330"><a href="#cb102-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-331"><a href="#cb102-331" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scatterplot3d)</span>
<span id="cb102-332"><a href="#cb102-332" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb102-333"><a href="#cb102-333" aria-hidden="true" tabindex="-1"></a>dades <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"https://archive.ics.uci.edu/ml/machine-learning-databases/forest-fires/forestfires.csv"</span>)</span>
<span id="cb102-334"><a href="#cb102-334" aria-hidden="true" tabindex="-1"></a>dades <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)])</span>
<span id="cb102-335"><a href="#cb102-335" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot3d</span>(dades[,<span class="st">"DC"</span>], dades[, <span class="st">"temp"</span>],dades[, <span class="st">"RH"</span>])</span>
<span id="cb102-336"><a href="#cb102-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-337"><a href="#cb102-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-340"><a href="#cb102-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-341"><a href="#cb102-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: 3d_scatterplot</span></span>
<span id="cb102-342"><a href="#cb102-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-343"><a href="#cb102-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-344"><a href="#cb102-344" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-345"><a href="#cb102-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-346"><a href="#cb102-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-347"><a href="#cb102-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-348"><a href="#cb102-348" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgl)</span>
<span id="cb102-349"><a href="#cb102-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-350"><a href="#cb102-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb102-351"><a href="#cb102-351" aria-hidden="true" tabindex="-1"></a>rgl<span class="sc">::</span><span class="fu">plot3d</span>(<span class="at">x =</span> dades[, <span class="st">"DC"</span>], <span class="at">y =</span> dades[, <span class="st">"temp"</span>], <span class="at">z =</span> dades[, <span class="st">"RH"</span>], </span>
<span id="cb102-352"><a href="#cb102-352" aria-hidden="true" tabindex="-1"></a><span class="at">col =</span> <span class="st">"black"</span>, <span class="at">type =</span> <span class="st">'p'</span>, <span class="at">radius =</span> .<span class="dv">1</span>)</span>
<span id="cb102-353"><a href="#cb102-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-354"><a href="#cb102-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-357"><a href="#cb102-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-358"><a href="#cb102-358" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: scatterplot_plotly</span></span>
<span id="cb102-359"><a href="#cb102-359" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-360"><a href="#cb102-360" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-361"><a href="#cb102-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-362"><a href="#cb102-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-363"><a href="#cb102-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-364"><a href="#cb102-364" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb102-365"><a href="#cb102-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-366"><a href="#cb102-366" aria-hidden="true" tabindex="-1"></a>(fig <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(dades, <span class="at">x =</span> <span class="sc">~</span>DC, <span class="at">y =</span> <span class="sc">~</span>temp, <span class="at">z =</span> <span class="sc">~</span>RH, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb102-367"><a href="#cb102-367" aria-hidden="true" tabindex="-1"></a>       <span class="fu">add_markers</span>())</span>
<span id="cb102-368"><a href="#cb102-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-369"><a href="#cb102-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-370"><a href="#cb102-370" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cas general</span></span>
<span id="cb102-371"><a href="#cb102-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-374"><a href="#cb102-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-375"><a href="#cb102-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: deteccio_outliers</span></span>
<span id="cb102-376"><a href="#cb102-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-377"><a href="#cb102-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-378"><a href="#cb102-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-379"><a href="#cb102-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-380"><a href="#cb102-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-381"><a href="#cb102-381" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvoutlier)</span>
<span id="cb102-382"><a href="#cb102-382" aria-hidden="true" tabindex="-1"></a>dades2 <span class="ot">&lt;-</span> dades; Y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dades2)</span>
<span id="cb102-383"><a href="#cb102-383" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> <span class="fu">dd.plot</span>(Y,<span class="at">quan=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha=</span><span class="fl">0.025</span>)</span>
<span id="cb102-384"><a href="#cb102-384" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(distances<span class="sc">$</span>md.cla)</span>
<span id="cb102-385"><a href="#cb102-385" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(distances<span class="sc">$</span>md.rob)</span>
<span id="cb102-386"><a href="#cb102-386" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">aq.plot</span>(Y,<span class="at">delta=</span><span class="fu">qchisq</span>(<span class="fl">0.975</span>,<span class="at">df=</span><span class="fu">ncol</span>(Y)),<span class="at">quan=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,<span class="at">alpha=</span><span class="fl">0.05</span>)</span>
<span id="cb102-387"><a href="#cb102-387" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(res)</span>
<span id="cb102-388"><a href="#cb102-388" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res<span class="sc">$</span>outliers)</span>
<span id="cb102-389"><a href="#cb102-389" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(res<span class="sc">$</span>outliers)</span>
<span id="cb102-390"><a href="#cb102-390" aria-hidden="true" tabindex="-1"></a><span class="co">#windows()</span></span>
<span id="cb102-391"><a href="#cb102-391" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb102-392"><a href="#cb102-392" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MVN)</span>
<span id="cb102-393"><a href="#cb102-393" aria-hidden="true" tabindex="-1"></a><span class="co"># mvnoutliers &lt;- mvn(dades, multivariateOutlierMethod = "adj", showOutliers = TRUE, </span></span>
<span id="cb102-394"><a href="#cb102-394" aria-hidden="true" tabindex="-1"></a><span class="co">#                   showNewData = TRUE)</span></span>
<span id="cb102-395"><a href="#cb102-395" aria-hidden="true" tabindex="-1"></a>mvnoutliers <span class="ot">&lt;-</span> <span class="fu">mvn</span>(<span class="at">data =</span> dades, <span class="at">mvn_test =</span> <span class="st">"royston"</span>, </span>
<span id="cb102-396"><a href="#cb102-396" aria-hidden="true" tabindex="-1"></a>                   <span class="at">univariate_test =</span> <span class="st">"AD"</span>, </span>
<span id="cb102-397"><a href="#cb102-397" aria-hidden="true" tabindex="-1"></a>              <span class="at">multivariate_outlier_method =</span> <span class="st">"adj"</span>,</span>
<span id="cb102-398"><a href="#cb102-398" aria-hidden="true" tabindex="-1"></a>              <span class="at">show_new_data =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-399"><a href="#cb102-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-400"><a href="#cb102-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-401"><a href="#cb102-401" aria-hidden="true" tabindex="-1"></a>Visualitzem tots els outliers detectats com a true</span>
<span id="cb102-402"><a href="#cb102-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-405"><a href="#cb102-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-406"><a href="#cb102-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: visualizacion_outliers</span></span>
<span id="cb102-407"><a href="#cb102-407" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-408"><a href="#cb102-408" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-409"><a href="#cb102-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-410"><a href="#cb102-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-411"><a href="#cb102-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-412"><a href="#cb102-412" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">summary</span>(mvnoutliers, <span class="at">select =</span> <span class="st">"outliers"</span>))</span>
<span id="cb102-413"><a href="#cb102-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-414"><a href="#cb102-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-415"><a href="#cb102-415" aria-hidden="true" tabindex="-1"></a>Visualitzem les variables originals quines han donat els que no son outliers</span>
<span id="cb102-416"><a href="#cb102-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-419"><a href="#cb102-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-420"><a href="#cb102-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: datos_sin_outliers</span></span>
<span id="cb102-421"><a href="#cb102-421" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-422"><a href="#cb102-422" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-423"><a href="#cb102-423" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-424"><a href="#cb102-424" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-425"><a href="#cb102-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-426"><a href="#cb102-426" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">summary</span>(mvnoutliers, <span class="at">select =</span> <span class="st">"new_data"</span>))</span>
<span id="cb102-427"><a href="#cb102-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-428"><a href="#cb102-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-429"><a href="#cb102-429" aria-hidden="true" tabindex="-1"></a>Visualitzem els resultats del test de normalitat univariant</span>
<span id="cb102-430"><a href="#cb102-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-433"><a href="#cb102-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-434"><a href="#cb102-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: test_normalidad_lof</span></span>
<span id="cb102-435"><a href="#cb102-435" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-436"><a href="#cb102-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-437"><a href="#cb102-437" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-438"><a href="#cb102-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-439"><a href="#cb102-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-440"><a href="#cb102-440" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">summary</span>(mvnoutliers, <span class="at">select =</span> <span class="st">"mvn"</span>))</span>
<span id="cb102-441"><a href="#cb102-441" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-442"><a href="#cb102-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-443"><a href="#cb102-443" aria-hidden="true" tabindex="-1"></a>i multivariant</span>
<span id="cb102-444"><a href="#cb102-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-447"><a href="#cb102-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-448"><a href="#cb102-448" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: test_normalidad_multi_lof</span></span>
<span id="cb102-449"><a href="#cb102-449" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-450"><a href="#cb102-450" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-451"><a href="#cb102-451" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-452"><a href="#cb102-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-453"><a href="#cb102-453" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb102-454"><a href="#cb102-454" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">summary</span>(mvnoutliers, <span class="at">select =</span> <span class="st">"univariate"</span>))</span>
<span id="cb102-455"><a href="#cb102-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-456"><a href="#cb102-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-457"><a href="#cb102-457" aria-hidden="true" tabindex="-1"></a><span class="fu">### PCA</span></span>
<span id="cb102-458"><a href="#cb102-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-459"><a href="#cb102-459" aria-hidden="true" tabindex="-1"></a>M√©todes basats en correlacions ens permeten detectar outliers</span>
<span id="cb102-460"><a href="#cb102-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-461"><a href="#cb102-461" aria-hidden="true" tabindex="-1"></a><span class="fu">### Distancia de Mahalanobis</span></span>
<span id="cb102-462"><a href="#cb102-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-463"><a href="#cb102-463" aria-hidden="true" tabindex="-1"></a>Medeix la distancia de un punt respecte a la mitjana considerant la covarian√ßa</span>
<span id="cb102-464"><a href="#cb102-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-467"><a href="#cb102-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-468"><a href="#cb102-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: dist_mahalanobis</span></span>
<span id="cb102-469"><a href="#cb102-469" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-470"><a href="#cb102-470" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-471"><a href="#cb102-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-472"><a href="#cb102-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-473"><a href="#cb102-473" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb102-474"><a href="#cb102-474" aria-hidden="true" tabindex="-1"></a>distancia_mahalanobis <span class="ot">&lt;-</span> <span class="fu">mahalanobis</span>(dades, <span class="fu">colMeans</span>(dades), <span class="fu">cov</span>(dades))</span>
<span id="cb102-475"><a href="#cb102-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-476"><a href="#cb102-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-477"><a href="#cb102-477" aria-hidden="true" tabindex="-1"></a>Grafiquem el plot de la densitat de les distancies</span>
<span id="cb102-478"><a href="#cb102-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-481"><a href="#cb102-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-482"><a href="#cb102-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_density_mahalanobis</span></span>
<span id="cb102-483"><a href="#cb102-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-484"><a href="#cb102-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-485"><a href="#cb102-485" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-486"><a href="#cb102-486" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-487"><a href="#cb102-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-488"><a href="#cb102-488" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(distancia_mahalanobis))</span>
<span id="cb102-489"><a href="#cb102-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-490"><a href="#cb102-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-491"><a href="#cb102-491" aria-hidden="true" tabindex="-1"></a>Es mostren els valors de la bbdd que queden per sobre de el 99% de la distribuci√≥ chi-cuadrat</span>
<span id="cb102-492"><a href="#cb102-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-495"><a href="#cb102-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-496"><a href="#cb102-496" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cuttoff_mahalanobis</span></span>
<span id="cb102-497"><a href="#cb102-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-498"><a href="#cb102-498" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-499"><a href="#cb102-499" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-500"><a href="#cb102-500" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-501"><a href="#cb102-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-502"><a href="#cb102-502" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> <span class="fu">qchisq</span>(<span class="at">p =</span> <span class="fl">0.99</span>, <span class="at">df =</span> <span class="fu">ncol</span>(dades))</span>
<span id="cb102-503"><a href="#cb102-503" aria-hidden="true" tabindex="-1"></a>dades[distancia_mahalanobis<span class="sc">&gt;</span>cutoff, ]</span>
<span id="cb102-504"><a href="#cb102-504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-505"><a href="#cb102-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-506"><a href="#cb102-506" aria-hidden="true" tabindex="-1"></a>Ordenamos de forma decreciente, seg√∫n el score de Mahalanobis</span>
<span id="cb102-507"><a href="#cb102-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-510"><a href="#cb102-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-511"><a href="#cb102-511" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: segmentar_mahalanobis</span></span>
<span id="cb102-512"><a href="#cb102-512" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-513"><a href="#cb102-513" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-514"><a href="#cb102-514" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-515"><a href="#cb102-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-516"><a href="#cb102-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-517"><a href="#cb102-517" aria-hidden="true" tabindex="-1"></a>dades <span class="ot">&lt;-</span> dades[<span class="fu">order</span>(distancia_mahalanobis, <span class="at">decreasing =</span> <span class="cn">TRUE</span>),]</span>
<span id="cb102-518"><a href="#cb102-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-519"><a href="#cb102-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-520"><a href="#cb102-520" aria-hidden="true" tabindex="-1"></a>Visualitzem l'histograma de les distancies per veure on tallem els outliers</span>
<span id="cb102-521"><a href="#cb102-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-524"><a href="#cb102-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-525"><a href="#cb102-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_mahalanobis</span></span>
<span id="cb102-526"><a href="#cb102-526" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-527"><a href="#cb102-527" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-528"><a href="#cb102-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-529"><a href="#cb102-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-530"><a href="#cb102-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-531"><a href="#cb102-531" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb102-532"><a href="#cb102-532" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(distancia_mahalanobis)</span>
<span id="cb102-533"><a href="#cb102-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-534"><a href="#cb102-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-535"><a href="#cb102-535" aria-hidden="true" tabindex="-1"></a>Descartamos los outliers seg√∫n un umbral</span>
<span id="cb102-536"><a href="#cb102-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-539"><a href="#cb102-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-540"><a href="#cb102-540" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: umbral_mahalanobis</span></span>
<span id="cb102-541"><a href="#cb102-541" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-542"><a href="#cb102-542" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-543"><a href="#cb102-543" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-544"><a href="#cb102-544" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-545"><a href="#cb102-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-546"><a href="#cb102-546" aria-hidden="true" tabindex="-1"></a>umbral <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb102-547"><a href="#cb102-547" aria-hidden="true" tabindex="-1"></a>dades[, <span class="st">"outlier"</span>] <span class="ot">&lt;-</span> (distancia_mahalanobis <span class="sc">&gt;</span> umbral)</span>
<span id="cb102-548"><a href="#cb102-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-549"><a href="#cb102-549" aria-hidden="true" tabindex="-1"></a>dades[, <span class="st">"color"</span>] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dades[, <span class="st">"outlier"</span>], <span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb102-550"><a href="#cb102-550" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplot3d</span>(dades[, <span class="st">"DC"</span>], dades[, <span class="st">"temp"</span>], dades[, <span class="st">"RH"</span>], </span>
<span id="cb102-551"><a href="#cb102-551" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> dades[, <span class="st">"color"</span>])</span>
<span id="cb102-552"><a href="#cb102-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-553"><a href="#cb102-553" aria-hidden="true" tabindex="-1"></a>(fig <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">plot_ly</span>(dades, <span class="at">x =</span> <span class="sc">~</span>DC, <span class="at">y =</span> <span class="sc">~</span>temp, <span class="at">z =</span> <span class="sc">~</span>RH, </span>
<span id="cb102-554"><a href="#cb102-554" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> <span class="sc">~</span>color, <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">'#0C4B8E'</span>, <span class="st">'#BF382A'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-555"><a href="#cb102-555" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">add_markers</span>())</span>
<span id="cb102-556"><a href="#cb102-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-557"><a href="#cb102-557" aria-hidden="true" tabindex="-1"></a>(quienes <span class="ot">&lt;-</span> <span class="fu">which</span>(dades[, <span class="st">"outlier"</span>] <span class="sc">==</span> <span class="cn">TRUE</span>))</span>
<span id="cb102-558"><a href="#cb102-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-559"><a href="#cb102-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-560"><a href="#cb102-560" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mahalanobis Robusto</span></span>
<span id="cb102-561"><a href="#cb102-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-564"><a href="#cb102-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-565"><a href="#cb102-565" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mahalanobis_robusto</span></span>
<span id="cb102-566"><a href="#cb102-566" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-567"><a href="#cb102-567" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-568"><a href="#cb102-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-569"><a href="#cb102-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-570"><a href="#cb102-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-571"><a href="#cb102-571" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chemometrics)</span>
<span id="cb102-572"><a href="#cb102-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-573"><a href="#cb102-573" aria-hidden="true" tabindex="-1"></a>dis <span class="ot">&lt;-</span> chemometrics<span class="sc">::</span><span class="fu">Moutlier</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">quantile =</span> <span class="fl">0.99</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-574"><a href="#cb102-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-575"><a href="#cb102-575" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb102-576"><a href="#cb102-576" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dis<span class="sc">$</span>md, dis<span class="sc">$</span>rd, <span class="at">type =</span> <span class="st">"n"</span>)</span>
<span id="cb102-577"><a href="#cb102-577" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(dis<span class="sc">$</span>md, dis<span class="sc">$</span>rd, <span class="at">labels =</span> <span class="fu">rownames</span>(dades))</span>
<span id="cb102-578"><a href="#cb102-578" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">which</span>(dis<span class="sc">$</span>rd <span class="sc">&gt;</span> <span class="dv">7</span>)</span>
<span id="cb102-579"><a href="#cb102-579" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span>
<span id="cb102-580"><a href="#cb102-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-581"><a href="#cb102-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-582"><a href="#cb102-582" aria-hidden="true" tabindex="-1"></a><span class="fu">### Regresi√≥ Lineal i residus</span></span>
<span id="cb102-583"><a href="#cb102-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-584"><a href="#cb102-584" aria-hidden="true" tabindex="-1"></a>Un punt amb un residu gran pot considerar-se un outlier</span>
<span id="cb102-585"><a href="#cb102-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-586"><a href="#cb102-586" aria-hidden="true" tabindex="-1"></a><span class="fu">### Distancia de Cook</span></span>
<span id="cb102-587"><a href="#cb102-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-588"><a href="#cb102-588" aria-hidden="true" tabindex="-1"></a>Identifica punts amb gran influ√®ncia en la regresi√≥. Un valor de Cook D_i <span class="sc">\&gt;</span> 1 √©s un outliers.</span>
<span id="cb102-589"><a href="#cb102-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-590"><a href="#cb102-590" aria-hidden="true" tabindex="-1"></a><span class="fu">### K-Nearest Neighbors (KNN) Outlier Score</span></span>
<span id="cb102-591"><a href="#cb102-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-592"><a href="#cb102-592" aria-hidden="true" tabindex="-1"></a>Basats en la densitat local de les dades</span>
<span id="cb102-593"><a href="#cb102-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-596"><a href="#cb102-596" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-597"><a href="#cb102-597" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: knn-outlier</span></span>
<span id="cb102-598"><a href="#cb102-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-599"><a href="#cb102-599" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-600"><a href="#cb102-600" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-601"><a href="#cb102-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-602"><a href="#cb102-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-603"><a href="#cb102-603" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adamethods)</span>
<span id="cb102-604"><a href="#cb102-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-605"><a href="#cb102-605" aria-hidden="true" tabindex="-1"></a><span class="fu">do_knno</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">k=</span><span class="dv">1</span>, <span class="at">top_n =</span> <span class="dv">30</span>)</span>
<span id="cb102-606"><a href="#cb102-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-607"><a href="#cb102-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-608"><a href="#cb102-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-609"><a href="#cb102-609" aria-hidden="true" tabindex="-1"></a><span class="fu">### Local Outlier Factor (LOF)</span></span>
<span id="cb102-610"><a href="#cb102-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-611"><a href="#cb102-611" aria-hidden="true" tabindex="-1"></a>Compara la densidat de un punt amb la densidat dels seus ve√Øns. Un valor LOF alt</span>
<span id="cb102-612"><a href="#cb102-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-615"><a href="#cb102-615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-616"><a href="#cb102-616" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lof1</span></span>
<span id="cb102-617"><a href="#cb102-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-618"><a href="#cb102-618" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-619"><a href="#cb102-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-620"><a href="#cb102-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-621"><a href="#cb102-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-622"><a href="#cb102-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-623"><a href="#cb102-623" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DMwR2)</span>
<span id="cb102-624"><a href="#cb102-624" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb102-625"><a href="#cb102-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-626"><a href="#cb102-626" aria-hidden="true" tabindex="-1"></a>outlier.scores <span class="ot">&lt;-</span> <span class="fu">lofactor</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb102-627"><a href="#cb102-627" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb102-628"><a href="#cb102-628" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(outlier.scores))</span>
<span id="cb102-629"><a href="#cb102-629" aria-hidden="true" tabindex="-1"></a>outlier.scores</span>
<span id="cb102-630"><a href="#cb102-630" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> <span class="fu">order</span>(outlier.scores, <span class="at">decreasing=</span>T)</span>
<span id="cb102-631"><a href="#cb102-631" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> <span class="fu">order</span>(outlier.scores, <span class="at">decreasing=</span>T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb102-632"><a href="#cb102-632" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-633"><a href="#cb102-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-634"><a href="#cb102-634" aria-hidden="true" tabindex="-1"></a>Aprofitarem el ACP per poder visualizar els outliers</span>
<span id="cb102-635"><a href="#cb102-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-638"><a href="#cb102-638" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-639"><a href="#cb102-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: acp_lof</span></span>
<span id="cb102-640"><a href="#cb102-640" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-641"><a href="#cb102-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-642"><a href="#cb102-642" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-643"><a href="#cb102-643" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-644"><a href="#cb102-644" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-645"><a href="#cb102-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-646"><a href="#cb102-646" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)]); labels <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n; labels[<span class="sc">-</span>outliers] <span class="ot">&lt;-</span> <span class="st">"."</span></span>
<span id="cb102-647"><a href="#cb102-647" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(<span class="fu">prcomp</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)]), <span class="at">cex =</span> .<span class="dv">8</span>, <span class="at">xlabs =</span> labels)</span>
<span id="cb102-648"><a href="#cb102-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-649"><a href="#cb102-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-650"><a href="#cb102-650" aria-hidden="true" tabindex="-1"></a>Grafiquem les correlacions per veure els gr√°fics</span>
<span id="cb102-651"><a href="#cb102-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-654"><a href="#cb102-654" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-655"><a href="#cb102-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: corrplot_lof</span></span>
<span id="cb102-656"><a href="#cb102-656" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-657"><a href="#cb102-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-658"><a href="#cb102-658" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-659"><a href="#cb102-659" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-660"><a href="#cb102-660" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-661"><a href="#cb102-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-662"><a href="#cb102-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-663"><a href="#cb102-663" aria-hidden="true" tabindex="-1"></a>pch <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"."</span>, n)</span>
<span id="cb102-664"><a href="#cb102-664" aria-hidden="true" tabindex="-1"></a>pch[outliers] <span class="ot">&lt;-</span> <span class="st">"+"</span></span>
<span id="cb102-665"><a href="#cb102-665" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"black"</span>, n)</span>
<span id="cb102-666"><a href="#cb102-666" aria-hidden="true" tabindex="-1"></a>col[outliers] <span class="ot">&lt;-</span> <span class="st">"red"</span></span>
<span id="cb102-667"><a href="#cb102-667" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">pch =</span> pch, <span class="at">col =</span> col)</span>
<span id="cb102-668"><a href="#cb102-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-669"><a href="#cb102-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-670"><a href="#cb102-670" aria-hidden="true" tabindex="-1"></a>Ho visualitzem en 3D</span>
<span id="cb102-671"><a href="#cb102-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-674"><a href="#cb102-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-675"><a href="#cb102-675" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pca_3d_outliers</span></span>
<span id="cb102-676"><a href="#cb102-676" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-677"><a href="#cb102-677" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-678"><a href="#cb102-678" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-679"><a href="#cb102-679" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-680"><a href="#cb102-680" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-681"><a href="#cb102-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-682"><a href="#cb102-682" aria-hidden="true" tabindex="-1"></a><span class="fu">plot3d</span>(dades[, <span class="st">"DC"</span>], dades[, <span class="st">"temp"</span>], dades[, <span class="st">"RH"</span>], <span class="at">type =</span> <span class="st">"s"</span>, <span class="at">col =</span> col, <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb102-683"><a href="#cb102-683" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-684"><a href="#cb102-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-685"><a href="#cb102-685" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Nueva versi√≥n de LOF</span></span>
<span id="cb102-686"><a href="#cb102-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-689"><a href="#cb102-689" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-690"><a href="#cb102-690" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lof2</span></span>
<span id="cb102-691"><a href="#cb102-691" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-692"><a href="#cb102-692" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-693"><a href="#cb102-693" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-694"><a href="#cb102-694" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-695"><a href="#cb102-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-696"><a href="#cb102-696" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rlof)</span>
<span id="cb102-697"><a href="#cb102-697" aria-hidden="true" tabindex="-1"></a>outliers.scores <span class="ot">&lt;-</span> Rlof<span class="sc">::</span><span class="fu">lof</span>(dades[, <span class="fu">c</span>(<span class="st">"DC"</span>, <span class="st">"temp"</span>, <span class="st">"RH"</span>)], <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb102-698"><a href="#cb102-698" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(outliers.scores))</span>
<span id="cb102-699"><a href="#cb102-699" aria-hidden="true" tabindex="-1"></a><span class="co">#outlier.scores &lt;- lof(dades[, c("DC", "temp", "RH")], k=c(5:10))</span></span>
<span id="cb102-700"><a href="#cb102-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-701"><a href="#cb102-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-702"><a href="#cb102-702" aria-hidden="true" tabindex="-1"></a><span class="fu">### Isolation Forest</span></span>
<span id="cb102-703"><a href="#cb102-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-706"><a href="#cb102-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-707"><a href="#cb102-707" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: isolation_forest_ddbb</span></span>
<span id="cb102-708"><a href="#cb102-708" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-709"><a href="#cb102-709" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-710"><a href="#cb102-710" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-711"><a href="#cb102-711" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-712"><a href="#cb102-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-713"><a href="#cb102-713" aria-hidden="true" tabindex="-1"></a><span class="do">### Cargamos las librerias necesarias</span></span>
<span id="cb102-714"><a href="#cb102-714" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R.matlab)   <span class="co"># Lectura de archivos .mat</span></span>
<span id="cb102-715"><a href="#cb102-715" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(solitude)   <span class="co"># Modelo isolation forest</span></span>
<span id="cb102-716"><a href="#cb102-716" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># Preparaci√≥n de datos y gr√°ficos</span></span>
<span id="cb102-717"><a href="#cb102-717" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLmetrics)</span>
<span id="cb102-718"><a href="#cb102-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-719"><a href="#cb102-719" aria-hidden="true" tabindex="-1"></a><span class="co"># Carreguem les dades</span></span>
<span id="cb102-720"><a href="#cb102-720" aria-hidden="true" tabindex="-1"></a>cardio_mat  <span class="ot">&lt;-</span> <span class="fu">readMat</span>(<span class="st">"https://www.dropbox.com/s/galg3ihvxklf0qi/cardio.mat?dl=1"</span>)</span>
<span id="cb102-721"><a href="#cb102-721" aria-hidden="true" tabindex="-1"></a>df_cardio   <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cardio_mat<span class="sc">$</span>X)</span>
<span id="cb102-722"><a href="#cb102-722" aria-hidden="true" tabindex="-1"></a>df_cardio<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">as.character</span>(cardio_mat<span class="sc">$</span>y)</span>
<span id="cb102-723"><a href="#cb102-723" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> df_cardio</span>
<span id="cb102-724"><a href="#cb102-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-725"><a href="#cb102-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-728"><a href="#cb102-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-729"><a href="#cb102-729" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: aplicar_isolationForest</span></span>
<span id="cb102-730"><a href="#cb102-730" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-731"><a href="#cb102-731" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-732"><a href="#cb102-732" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-733"><a href="#cb102-733" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-734"><a href="#cb102-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-735"><a href="#cb102-735" aria-hidden="true" tabindex="-1"></a>isoforest <span class="ot">&lt;-</span> isolationForest<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb102-736"><a href="#cb102-736" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="fu">as.integer</span>(<span class="fu">nrow</span>(datos)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb102-737"><a href="#cb102-737" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_trees   =</span> <span class="dv">500</span>, </span>
<span id="cb102-738"><a href="#cb102-738" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace     =</span> <span class="cn">TRUE</span>,</span>
<span id="cb102-739"><a href="#cb102-739" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed        =</span> <span class="dv">123</span></span>
<span id="cb102-740"><a href="#cb102-740" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-741"><a href="#cb102-741" aria-hidden="true" tabindex="-1"></a>isoforest<span class="sc">$</span><span class="fu">fit</span>(<span class="at">dataset =</span> datos <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>y))</span>
<span id="cb102-742"><a href="#cb102-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-743"><a href="#cb102-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-744"><a href="#cb102-744" aria-hidden="true" tabindex="-1"></a>Ara anem a realitzar les prediccions.</span>
<span id="cb102-745"><a href="#cb102-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-748"><a href="#cb102-748" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-749"><a href="#cb102-749" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predicciones_isolationForest</span></span>
<span id="cb102-750"><a href="#cb102-750" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-751"><a href="#cb102-751" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-752"><a href="#cb102-752" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-753"><a href="#cb102-753" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-754"><a href="#cb102-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-755"><a href="#cb102-755" aria-hidden="true" tabindex="-1"></a>predicciones <span class="ot">&lt;-</span> isoforest<span class="sc">$</span><span class="fu">predict</span>(</span>
<span id="cb102-756"><a href="#cb102-756" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> datos <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>y)</span>
<span id="cb102-757"><a href="#cb102-757" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-758"><a href="#cb102-758" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predicciones)</span>
<span id="cb102-759"><a href="#cb102-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-760"><a href="#cb102-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-763"><a href="#cb102-763" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-764"><a href="#cb102-764" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_isolationForest</span></span>
<span id="cb102-765"><a href="#cb102-765" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-766"><a href="#cb102-766" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-767"><a href="#cb102-767" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-768"><a href="#cb102-768" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-769"><a href="#cb102-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-770"><a href="#cb102-770" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> predicciones, <span class="fu">aes</span>(<span class="at">x =</span> average_depth)) <span class="sc">+</span></span>
<span id="cb102-771"><a href="#cb102-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb102-772"><a href="#cb102-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(</span>
<span id="cb102-773"><a href="#cb102-773" aria-hidden="true" tabindex="-1"></a>    <span class="at">xintercept =</span> <span class="fu">quantile</span>(predicciones<span class="sc">$</span>average_depth, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.1</span>)),</span>
<span id="cb102-774"><a href="#cb102-774" aria-hidden="true" tabindex="-1"></a>    <span class="at">color      =</span> <span class="st">"red"</span>,</span>
<span id="cb102-775"><a href="#cb102-775" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype   =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb102-776"><a href="#cb102-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb102-777"><a href="#cb102-777" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribuci√≥n de las distancias medias del Isolation Forest"</span>,</span>
<span id="cb102-778"><a href="#cb102-778" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Cuantiles marcados en rojo"</span>  ) <span class="sc">+</span></span>
<span id="cb102-779"><a href="#cb102-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb102-780"><a href="#cb102-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span>
<span id="cb102-781"><a href="#cb102-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-782"><a href="#cb102-782" aria-hidden="true" tabindex="-1"></a>cuantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="at">x =</span> predicciones<span class="sc">$</span>average_depth, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.05</span>))</span>
<span id="cb102-783"><a href="#cb102-783" aria-hidden="true" tabindex="-1"></a>cuantiles</span>
<span id="cb102-784"><a href="#cb102-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-785"><a href="#cb102-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-786"><a href="#cb102-786" aria-hidden="true" tabindex="-1"></a><span class="fu">### TIPS: Detecci√≥n de anomal√≠as</span></span>
<span id="cb102-787"><a href="#cb102-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-788"><a href="#cb102-788" aria-hidden="true" tabindex="-1"></a>Una vez que la distancia de separaci√≥n ha sido calculado, se puede emplear como criterio para identificar anomal√≠as. Asumiendo que las observaciones con valores at√≠picos en una o m√°s de sus variables se separan del resto con mayor facilidad, aquellas observaciones con menor distancia promedio deber√≠an ser las m√°s at√≠picas.</span>
<span id="cb102-789"><a href="#cb102-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-790"><a href="#cb102-790" aria-hidden="true" tabindex="-1"></a>En la pr√°ctica, si se est√° empleando esta estrategia de detecci√≥n es porque no se dispone de datos etiquetados, es decir, no se conoce qu√© observaciones son realmente anomal√≠as. Sin embargo, como en este ejemplo se dispone de la clasificaci√≥n real, se puede verificar si realmente los datos an√≥malos tienen menores distancias.</span>
<span id="cb102-791"><a href="#cb102-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-794"><a href="#cb102-794" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-795"><a href="#cb102-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot_deteccionAnomalias</span></span>
<span id="cb102-796"><a href="#cb102-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-797"><a href="#cb102-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-798"><a href="#cb102-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-799"><a href="#cb102-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-800"><a href="#cb102-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-801"><a href="#cb102-801" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb102-802"><a href="#cb102-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(predicciones)</span>
<span id="cb102-803"><a href="#cb102-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-804"><a href="#cb102-804" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datos,</span>
<span id="cb102-805"><a href="#cb102-805" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> y, <span class="at">y =</span> average_depth)) <span class="sc">+</span></span>
<span id="cb102-806"><a href="#cb102-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> y), <span class="at">width =</span> <span class="fl">0.03</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb102-807"><a href="#cb102-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb102-808"><a href="#cb102-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb102-809"><a href="#cb102-809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">colour =</span> <span class="st">"orangered2"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">geom =</span> <span class="st">"point"</span>) <span class="sc">+</span></span>
<span id="cb102-810"><a href="#cb102-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distancia promedio en el modelo Isolation Forest"</span>,</span>
<span id="cb102-811"><a href="#cb102-811" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"clasificaci√≥n (0 = normal, 1 = anomal√≠a)"</span>,</span>
<span id="cb102-812"><a href="#cb102-812" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Distancia promedio"</span>) <span class="sc">+</span></span>
<span id="cb102-813"><a href="#cb102-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb102-814"><a href="#cb102-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb102-815"><a href="#cb102-815" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb102-816"><a href="#cb102-816" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb102-817"><a href="#cb102-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-818"><a href="#cb102-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-819"><a href="#cb102-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-820"><a href="#cb102-820" aria-hidden="true" tabindex="-1"></a>La distancia promedio en el grupo de las anomal√≠as (1) es claramente inferior. Sin embargo, al existir solapamiento, si se clasifican las n observaciones con menor distancia como anomal√≠as, se incurrir√≠a en errores de falsos positivos.</span>
<span id="cb102-821"><a href="#cb102-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-822"><a href="#cb102-822" aria-hidden="true" tabindex="-1"></a>Acorde a la documentaci√≥n, el set de datos Cardiotocogrpahy contiene 176 anomal√≠as. V√©ase la matriz de confusi√≥n resultante si se clasifican como anomal√≠as las 176 observaciones con menor distancia predicha.</span>
<span id="cb102-823"><a href="#cb102-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-826"><a href="#cb102-826" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-827"><a href="#cb102-827" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: matriz_confusion</span></span>
<span id="cb102-828"><a href="#cb102-828" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-829"><a href="#cb102-829" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-830"><a href="#cb102-830" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-831"><a href="#cb102-831" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-832"><a href="#cb102-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-833"><a href="#cb102-833" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> datos <span class="sc">%&gt;%</span></span>
<span id="cb102-834"><a href="#cb102-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(y, average_depth) <span class="sc">%&gt;%</span></span>
<span id="cb102-835"><a href="#cb102-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(average_depth) <span class="sc">%&gt;%</span></span>
<span id="cb102-836"><a href="#cb102-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clasificacion =</span> <span class="fu">if_else</span>(average_depth <span class="sc">&lt;=</span> <span class="fl">8.5</span>, <span class="st">"1"</span>, <span class="st">"0"</span>))</span>
<span id="cb102-837"><a href="#cb102-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-838"><a href="#cb102-838" aria-hidden="true" tabindex="-1"></a>mat_confusion <span class="ot">&lt;-</span> MLmetrics<span class="sc">::</span><span class="fu">ConfusionMatrix</span>(</span>
<span id="cb102-839"><a href="#cb102-839" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_pred =</span> resultados<span class="sc">$</span>clasificacion,</span>
<span id="cb102-840"><a href="#cb102-840" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_true =</span> resultados<span class="sc">$</span>y)</span>
<span id="cb102-841"><a href="#cb102-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-842"><a href="#cb102-842" aria-hidden="true" tabindex="-1"></a>mat_confusion</span>
<span id="cb102-843"><a href="#cb102-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-844"><a href="#cb102-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-845"><a href="#cb102-845" aria-hidden="true" tabindex="-1"></a><span class="fu"># Missing values (valores faltantes)</span></span>
<span id="cb102-846"><a href="#cb102-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-847"><a href="#cb102-847" aria-hidden="true" tabindex="-1"></a>Los **valores faltantes** aparecen cuando una observaci√≥n no tiene registrado el valor en cierta variable.</span>
<span id="cb102-848"><a href="#cb102-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-849"><a href="#cb102-849" aria-hidden="true" tabindex="-1"></a>Manejar correctamente los NA es esencial: eliminarlos puede reducir mucho el dataset, mientras que imputarlos incorrectamente puede introducir sesgos.</span>
<span id="cb102-850"><a href="#cb102-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-851"><a href="#cb102-851" aria-hidden="true" tabindex="-1"></a>Existen varias t√©cnicas:</span>
<span id="cb102-852"><a href="#cb102-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-853"><a href="#cb102-853" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Eliminaci√≥n de filas/columnas** con demasiados NA.</span>
<span id="cb102-854"><a href="#cb102-854" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Imputaci√≥n simple**, por ejemplo reemplazando con la media o moda.</span>
<span id="cb102-855"><a href="#cb102-855" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Imputaci√≥n avanzada**, como KNN o modelos predictivos.</span>
<span id="cb102-856"><a href="#cb102-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-857"><a href="#cb102-857" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; üëâ La elecci√≥n depende de la importancia de la variable, la cantidad de NA y el contexto del problema.</span></span>
<span id="cb102-858"><a href="#cb102-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-859"><a href="#cb102-859" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generate data with NA's</span></span>
<span id="cb102-860"><a href="#cb102-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-863"><a href="#cb102-863" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-864"><a href="#cb102-864" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: generar_missings</span></span>
<span id="cb102-865"><a href="#cb102-865" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-866"><a href="#cb102-866" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-867"><a href="#cb102-867" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-868"><a href="#cb102-868" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-869"><a href="#cb102-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-870"><a href="#cb102-870" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(iris))</span>
<span id="cb102-871"><a href="#cb102-871" aria-hidden="true" tabindex="-1"></a>iris.mis <span class="ot">&lt;-</span> missForest<span class="sc">::</span><span class="fu">prodNA</span>(iris, <span class="at">noNA =</span> <span class="fl">0.1</span>)</span>
<span id="cb102-872"><a href="#cb102-872" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>((<span class="fu">is.na</span>(iris.mis)))</span>
<span id="cb102-873"><a href="#cb102-873" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-874"><a href="#cb102-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-875"><a href="#cb102-875" aria-hidden="true" tabindex="-1"></a>Otra forma de crear missings en el dataframe</span>
<span id="cb102-876"><a href="#cb102-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-879"><a href="#cb102-879" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-880"><a href="#cb102-880" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: generar_missings2</span></span>
<span id="cb102-881"><a href="#cb102-881" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-882"><a href="#cb102-882" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-883"><a href="#cb102-883" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-884"><a href="#cb102-884" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-885"><a href="#cb102-885" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-886"><a href="#cb102-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-887"><a href="#cb102-887" aria-hidden="true" tabindex="-1"></a>iris.mis <span class="ot">&lt;-</span> mi<span class="sc">::</span><span class="fu">create.missing</span>(iris, <span class="at">pct.mis =</span> <span class="dv">10</span>)</span>
<span id="cb102-888"><a href="#cb102-888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-889"><a href="#cb102-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-890"><a href="#cb102-890" aria-hidden="true" tabindex="-1"></a><span class="fu">## Little Test</span></span>
<span id="cb102-891"><a href="#cb102-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-892"><a href="#cb102-892" aria-hidden="true" tabindex="-1"></a>Es un test que nos permite detectar con que tipo de NA's estamos enfrente:</span>
<span id="cb102-893"><a href="#cb102-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-896"><a href="#cb102-896" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-897"><a href="#cb102-897" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: test_little</span></span>
<span id="cb102-898"><a href="#cb102-898" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-899"><a href="#cb102-899" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-900"><a href="#cb102-900" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-901"><a href="#cb102-901" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-902"><a href="#cb102-902" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-903"><a href="#cb102-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-904"><a href="#cb102-904" aria-hidden="true" tabindex="-1"></a>naniar<span class="sc">::</span><span class="fu">mcar_test</span>(iris.mis)</span>
<span id="cb102-905"><a href="#cb102-905" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-906"><a href="#cb102-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-907"><a href="#cb102-907" aria-hidden="true" tabindex="-1"></a>Si el valor p de la prova √©s inferior a 0 aix√≤ vol dir que les dades amb NAs s'han generat aleat√≤riament.</span>
<span id="cb102-908"><a href="#cb102-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-909"><a href="#cb102-909" aria-hidden="true" tabindex="-1"></a><span class="fu">## Patrons descriptius de NA en una base de dades</span></span>
<span id="cb102-910"><a href="#cb102-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-911"><a href="#cb102-911" aria-hidden="true" tabindex="-1"></a><span class="fu">### Explorar les relacions de NA's</span></span>
<span id="cb102-912"><a href="#cb102-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-915"><a href="#cb102-915" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-916"><a href="#cb102-916" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vis_na_total</span></span>
<span id="cb102-917"><a href="#cb102-917" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-918"><a href="#cb102-918" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-919"><a href="#cb102-919" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-920"><a href="#cb102-920" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-921"><a href="#cb102-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-922"><a href="#cb102-922" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb102-923"><a href="#cb102-923" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb102-924"><a href="#cb102-924" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb102-925"><a href="#cb102-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-926"><a href="#cb102-926" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_dat</span>(airquality);</span>
<span id="cb102-927"><a href="#cb102-927" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_dat</span>(iris.mis)</span>
<span id="cb102-928"><a href="#cb102-928" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(airquality);</span>
<span id="cb102-929"><a href="#cb102-929" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(iris.mis)</span>
<span id="cb102-930"><a href="#cb102-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-931"><a href="#cb102-931" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R,<span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb102-932"><a href="#cb102-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb102-933"><a href="#cb102-933" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R,  <span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb102-934"><a href="#cb102-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>()</span>
<span id="cb102-935"><a href="#cb102-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-936"><a href="#cb102-936" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb102-937"><a href="#cb102-937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>() <span class="sc">+</span> </span>
<span id="cb102-938"><a href="#cb102-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Month)</span>
<span id="cb102-939"><a href="#cb102-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-940"><a href="#cb102-940" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, <span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">y =</span> Ozone)) <span class="sc">+</span> </span>
<span id="cb102-941"><a href="#cb102-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>() <span class="sc">+</span> </span>
<span id="cb102-942"><a href="#cb102-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Month) <span class="sc">+</span> </span>
<span id="cb102-943"><a href="#cb102-943" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dark</span>()</span>
<span id="cb102-944"><a href="#cb102-944" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-945"><a href="#cb102-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-946"><a href="#cb102-946" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualitzaci√≥ dels NA's per variables</span></span>
<span id="cb102-947"><a href="#cb102-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-950"><a href="#cb102-950" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-951"><a href="#cb102-951" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: vis_na_variables</span></span>
<span id="cb102-952"><a href="#cb102-952" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-953"><a href="#cb102-953" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-954"><a href="#cb102-954" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-955"><a href="#cb102-955" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-956"><a href="#cb102-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-957"><a href="#cb102-957" aria-hidden="true" tabindex="-1"></a><span class="fu">gg_miss_var</span>(airquality) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Look at all the missing ones"</span>)</span>
<span id="cb102-958"><a href="#cb102-958" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-959"><a href="#cb102-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-960"><a href="#cb102-960" aria-hidden="true" tabindex="-1"></a><span class="fu">### Detecci√≥ de NA's en la base de dades</span></span>
<span id="cb102-961"><a href="#cb102-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-964"><a href="#cb102-964" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-965"><a href="#cb102-965" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: deteccio_na</span></span>
<span id="cb102-966"><a href="#cb102-966" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-967"><a href="#cb102-967" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-968"><a href="#cb102-968" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-969"><a href="#cb102-969" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-970"><a href="#cb102-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-971"><a href="#cb102-971" aria-hidden="true" tabindex="-1"></a>aq_shadow <span class="ot">&lt;-</span> <span class="fu">bind_shadow</span>(airquality)</span>
<span id="cb102-972"><a href="#cb102-972" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-973"><a href="#cb102-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-974"><a href="#cb102-974" aria-hidden="true" tabindex="-1"></a>Imprimeix el gr√†fic amb difer√®ncia a les NA i no a les NA,</span>
<span id="cb102-975"><a href="#cb102-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-978"><a href="#cb102-978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-979"><a href="#cb102-979" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_detec_na</span></span>
<span id="cb102-980"><a href="#cb102-980" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-981"><a href="#cb102-981" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-982"><a href="#cb102-982" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-983"><a href="#cb102-983" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-984"><a href="#cb102-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-985"><a href="#cb102-985" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">%&gt;%</span></span>
<span id="cb102-986"><a href="#cb102-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_shadow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb102-987"><a href="#cb102-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Ozone_NA) <span class="sc">%&gt;%</span></span>
<span id="cb102-988"><a href="#cb102-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="at">.vars =</span> <span class="st">"Solar.R"</span>,</span>
<span id="cb102-989"><a href="#cb102-989" aria-hidden="true" tabindex="-1"></a>               <span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"var"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>),</span>
<span id="cb102-990"><a href="#cb102-990" aria-hidden="true" tabindex="-1"></a>               <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-991"><a href="#cb102-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-992"><a href="#cb102-992" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(aq_shadow,</span>
<span id="cb102-993"><a href="#cb102-993" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Temp,</span>
<span id="cb102-994"><a href="#cb102-994" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> Ozone_NA)) <span class="sc">+</span> </span>
<span id="cb102-995"><a href="#cb102-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>()</span>
<span id="cb102-996"><a href="#cb102-996" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-997"><a href="#cb102-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-998"><a href="#cb102-998" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extreu estad√≠stiques amb NAs de la base de dades</span></span>
<span id="cb102-999"><a href="#cb102-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1002"><a href="#cb102-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1003"><a href="#cb102-1003" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: estadistiques_na</span></span>
<span id="cb102-1004"><a href="#cb102-1004" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1005"><a href="#cb102-1005" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1006"><a href="#cb102-1006" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1007"><a href="#cb102-1007" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1008"><a href="#cb102-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1009"><a href="#cb102-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">prop_miss_case</span>(airquality)</span>
<span id="cb102-1010"><a href="#cb102-1010" aria-hidden="true" tabindex="-1"></a><span class="fu">pct_miss_case</span>(airquality)</span>
<span id="cb102-1011"><a href="#cb102-1011" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_case_summary</span>(airquality)</span>
<span id="cb102-1012"><a href="#cb102-1012" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_case_table</span>(airquality)</span>
<span id="cb102-1013"><a href="#cb102-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">prop_miss_var</span>(airquality)</span>
<span id="cb102-1014"><a href="#cb102-1014" aria-hidden="true" tabindex="-1"></a><span class="fu">pct_miss_var</span>(airquality)</span>
<span id="cb102-1015"><a href="#cb102-1015" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_summary</span>(airquality)</span>
<span id="cb102-1016"><a href="#cb102-1016" aria-hidden="true" tabindex="-1"></a><span class="fu">miss_var_table</span>(airquality)</span>
<span id="cb102-1017"><a href="#cb102-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1018"><a href="#cb102-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1019"><a href="#cb102-1019" aria-hidden="true" tabindex="-1"></a><span class="fu">## Imputaci√≥ b√†sica</span></span>
<span id="cb102-1020"><a href="#cb102-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1021"><a href="#cb102-1021" aria-hidden="true" tabindex="-1"></a><span class="fu">### Imputar con la media</span></span>
<span id="cb102-1022"><a href="#cb102-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1025"><a href="#cb102-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1026"><a href="#cb102-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: NA_valor_mitja</span></span>
<span id="cb102-1027"><a href="#cb102-1027" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1028"><a href="#cb102-1028" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1029"><a href="#cb102-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1030"><a href="#cb102-1030" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1031"><a href="#cb102-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1032"><a href="#cb102-1032" aria-hidden="true" tabindex="-1"></a>iris.mis[, <span class="st">"imputed_Sepal.Length"</span>] <span class="ot">&lt;-</span> <span class="fu">with</span>(iris.mis, Hmisc<span class="sc">::</span><span class="fu">impute</span>(Sepal.Length, mean))</span>
<span id="cb102-1033"><a href="#cb102-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1034"><a href="#cb102-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1035"><a href="#cb102-1035" aria-hidden="true" tabindex="-1"></a><span class="fu">### Imputar con la mediana</span></span>
<span id="cb102-1036"><a href="#cb102-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1039"><a href="#cb102-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1040"><a href="#cb102-1040" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: NA_valor_mediana</span></span>
<span id="cb102-1041"><a href="#cb102-1041" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1042"><a href="#cb102-1042" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1043"><a href="#cb102-1043" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1044"><a href="#cb102-1044" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1045"><a href="#cb102-1045" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1046"><a href="#cb102-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1047"><a href="#cb102-1047" aria-hidden="true" tabindex="-1"></a>pre_median <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(dades, <span class="at">method =</span> <span class="st">"medianImpute"</span>)</span>
<span id="cb102-1048"><a href="#cb102-1048" aria-hidden="true" tabindex="-1"></a>imputed_median <span class="ot">&lt;-</span> <span class="fu">predict</span>(pre_median, dades)</span>
<span id="cb102-1049"><a href="#cb102-1049" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose</span>(imputed_median)</span>
<span id="cb102-1050"><a href="#cb102-1050" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1051"><a href="#cb102-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1052"><a href="#cb102-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">### Imputar con un valor aleatorio</span></span>
<span id="cb102-1053"><a href="#cb102-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1056"><a href="#cb102-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1057"><a href="#cb102-1057" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: NA_valor_aleatori</span></span>
<span id="cb102-1058"><a href="#cb102-1058" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1059"><a href="#cb102-1059" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1060"><a href="#cb102-1060" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1061"><a href="#cb102-1061" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1062"><a href="#cb102-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1063"><a href="#cb102-1063" aria-hidden="true" tabindex="-1"></a>iris.mis[, <span class="st">"imputed_Sepal.Length2"</span>] <span class="ot">&lt;-</span> <span class="fu">with</span>(iris.mis, Hmisc<span class="sc">::</span><span class="fu">impute</span>(Sepal.Length, <span class="st">'random'</span>))</span>
<span id="cb102-1064"><a href="#cb102-1064" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1065"><a href="#cb102-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1066"><a href="#cb102-1066" aria-hidden="true" tabindex="-1"></a>De manera similar podeu utilitzar la mediana min, max, per imputar el valor que manca.</span>
<span id="cb102-1067"><a href="#cb102-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1068"><a href="#cb102-1068" aria-hidden="true" tabindex="-1"></a><span class="fu">### Representa la distribuci√≥ a variables reals i d'imputaci√≥ a trav√©s del gr√°fico de densidad con ggplot2</span></span>
<span id="cb102-1069"><a href="#cb102-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1072"><a href="#cb102-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1073"><a href="#cb102-1073" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_imputacion</span></span>
<span id="cb102-1074"><a href="#cb102-1074" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1075"><a href="#cb102-1075" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1076"><a href="#cb102-1076" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1077"><a href="#cb102-1077" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1078"><a href="#cb102-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1079"><a href="#cb102-1079" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> iris.mis <span class="sc">%&gt;%</span></span>
<span id="cb102-1080"><a href="#cb102-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sepal.Length, imputed_Sepal.Length, imputed_Sepal.Length2) <span class="sc">%&gt;%</span></span>
<span id="cb102-1081"><a href="#cb102-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb102-1082"><a href="#cb102-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1083"><a href="#cb102-1083" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Variable)) <span class="sc">+</span></span>
<span id="cb102-1084"><a href="#cb102-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para mejor visualizaci√≥n</span></span>
<span id="cb102-1085"><a href="#cb102-1085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Densidad de las tres variables"</span>,</span>
<span id="cb102-1086"><a href="#cb102-1086" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb102-1087"><a href="#cb102-1087" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb102-1088"><a href="#cb102-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb102-1089"><a href="#cb102-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>))</span>
<span id="cb102-1090"><a href="#cb102-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1091"><a href="#cb102-1091" aria-hidden="true" tabindex="-1"></a>iris.mis[, <span class="fu">c</span>(<span class="st">"imputed_Sepal.Length"</span>, <span class="st">"imputed_Sepal.Length2"</span>)] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb102-1092"><a href="#cb102-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1093"><a href="#cb102-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1094"><a href="#cb102-1094" aria-hidden="true" tabindex="-1"></a>Otra forma es usando el paquete <span class="in">`argImpute`</span>.</span>
<span id="cb102-1095"><a href="#cb102-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1098"><a href="#cb102-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1099"><a href="#cb102-1099" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: argImpute</span></span>
<span id="cb102-1100"><a href="#cb102-1100" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1101"><a href="#cb102-1101" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1102"><a href="#cb102-1102" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1103"><a href="#cb102-1103" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1104"><a href="#cb102-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1105"><a href="#cb102-1105" aria-hidden="true" tabindex="-1"></a>(impute_arg <span class="ot">&lt;-</span> Hmisc<span class="sc">::</span><span class="fu">aregImpute</span>(<span class="sc">~</span> Sepal.Length <span class="sc">+</span> Sepal.Width <span class="sc">+</span> Petal.Length <span class="sc">+</span> Petal.Width <span class="sc">+</span></span>
<span id="cb102-1106"><a href="#cb102-1106" aria-hidden="true" tabindex="-1"></a>                           Species, <span class="at">data =</span> iris.mis, <span class="at">n.impute =</span> <span class="dv">5</span>))</span>
<span id="cb102-1107"><a href="#cb102-1107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1108"><a href="#cb102-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1109"><a href="#cb102-1109" aria-hidden="true" tabindex="-1"></a>Revisamos la variable <span class="in">`Sepal.Length`</span> con la imputaci√≥n realizada en cada una de las rondas.</span>
<span id="cb102-1110"><a href="#cb102-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1113"><a href="#cb102-1113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1114"><a href="#cb102-1114" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: imputacion_SL</span></span>
<span id="cb102-1115"><a href="#cb102-1115" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1116"><a href="#cb102-1116" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1117"><a href="#cb102-1117" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1118"><a href="#cb102-1118" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1119"><a href="#cb102-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1120"><a href="#cb102-1120" aria-hidden="true" tabindex="-1"></a>impute_arg<span class="sc">$</span>imputed<span class="sc">$</span>Sepal.Length</span>
<span id="cb102-1121"><a href="#cb102-1121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1122"><a href="#cb102-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1123"><a href="#cb102-1123" aria-hidden="true" tabindex="-1"></a>Calculamos la media para las 5 simulaciones.</span>
<span id="cb102-1124"><a href="#cb102-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1127"><a href="#cb102-1127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1128"><a href="#cb102-1128" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: media_simulaciones</span></span>
<span id="cb102-1129"><a href="#cb102-1129" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1130"><a href="#cb102-1130" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1131"><a href="#cb102-1131" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1132"><a href="#cb102-1132" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1133"><a href="#cb102-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1134"><a href="#cb102-1134" aria-hidden="true" tabindex="-1"></a>imputed_Sepal.Length <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(impute_arg<span class="sc">$</span>imputed<span class="sc">$</span>Sepal.Length)</span>
<span id="cb102-1135"><a href="#cb102-1135" aria-hidden="true" tabindex="-1"></a>new_var_imputed <span class="ot">&lt;-</span> iris<span class="sc">$</span>Sepal.Length</span>
<span id="cb102-1136"><a href="#cb102-1136" aria-hidden="true" tabindex="-1"></a>new_var_imputed[<span class="fu">as.numeric</span>(<span class="fu">names</span>(imputed_Sepal.Length))] <span class="ot">&lt;-</span> imputed_Sepal.Length</span>
<span id="cb102-1137"><a href="#cb102-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1138"><a href="#cb102-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1139"><a href="#cb102-1139" aria-hidden="true" tabindex="-1"></a>Revisamos la diferencia entre las dos imputaciones.</span>
<span id="cb102-1140"><a href="#cb102-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1143"><a href="#cb102-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1144"><a href="#cb102-1144" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_media_simulaciones</span></span>
<span id="cb102-1145"><a href="#cb102-1145" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1146"><a href="#cb102-1146" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1147"><a href="#cb102-1147" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1148"><a href="#cb102-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1149"><a href="#cb102-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1150"><a href="#cb102-1150" aria-hidden="true" tabindex="-1"></a>newBD <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">real =</span> iris[, <span class="st">"Sepal.Length"</span>], <span class="at">imputed =</span> new_var_imputed)</span>
<span id="cb102-1151"><a href="#cb102-1151" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> newBD <span class="sc">%&gt;%</span></span>
<span id="cb102-1152"><a href="#cb102-1152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb102-1153"><a href="#cb102-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1154"><a href="#cb102-1154" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Variable)) <span class="sc">+</span></span>
<span id="cb102-1155"><a href="#cb102-1155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para mejor visualizaci√≥n</span></span>
<span id="cb102-1156"><a href="#cb102-1156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Densidad de las tres variables"</span>,</span>
<span id="cb102-1157"><a href="#cb102-1157" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb102-1158"><a href="#cb102-1158" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb102-1159"><a href="#cb102-1159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb102-1160"><a href="#cb102-1160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb102-1161"><a href="#cb102-1161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1162"><a href="#cb102-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1163"><a href="#cb102-1163" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multiple Iterative Regression Imputation (MI method)</span></span>
<span id="cb102-1164"><a href="#cb102-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1165"><a href="#cb102-1165" aria-hidden="true" tabindex="-1"></a>Imputamos los valores NA's con mi</span>
<span id="cb102-1166"><a href="#cb102-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1169"><a href="#cb102-1169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1170"><a href="#cb102-1170" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mi_imputation</span></span>
<span id="cb102-1171"><a href="#cb102-1171" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1172"><a href="#cb102-1172" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1173"><a href="#cb102-1173" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1174"><a href="#cb102-1174" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1175"><a href="#cb102-1175" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1176"><a href="#cb102-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1177"><a href="#cb102-1177" aria-hidden="true" tabindex="-1"></a>mi_data <span class="ot">&lt;-</span> mi<span class="sc">::</span><span class="fu">mi</span>(iris.mis, <span class="at">seed =</span> <span class="dv">335</span>)</span>
<span id="cb102-1178"><a href="#cb102-1178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1179"><a href="#cb102-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1180"><a href="#cb102-1180" aria-hidden="true" tabindex="-1"></a>Revisamos la informaci√≥n de las imputaciones.</span>
<span id="cb102-1181"><a href="#cb102-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1184"><a href="#cb102-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1185"><a href="#cb102-1185" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_mi_imputation</span></span>
<span id="cb102-1186"><a href="#cb102-1186" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1187"><a href="#cb102-1187" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1188"><a href="#cb102-1188" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1189"><a href="#cb102-1189" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1190"><a href="#cb102-1190" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1191"><a href="#cb102-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1192"><a href="#cb102-1192" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mi_data)</span>
<span id="cb102-1193"><a href="#cb102-1193" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mi_data)</span>
<span id="cb102-1194"><a href="#cb102-1194" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">ask =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-1195"><a href="#cb102-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1196"><a href="#cb102-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1197"><a href="#cb102-1197" aria-hidden="true" tabindex="-1"></a>Revisamos las interaciones de la base de datos</span>
<span id="cb102-1198"><a href="#cb102-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1201"><a href="#cb102-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1202"><a href="#cb102-1202" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: graficamos_mi_iteration</span></span>
<span id="cb102-1203"><a href="#cb102-1203" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1204"><a href="#cb102-1204" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1205"><a href="#cb102-1205" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1206"><a href="#cb102-1206" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1207"><a href="#cb102-1207" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1208"><a href="#cb102-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1209"><a href="#cb102-1209" aria-hidden="true" tabindex="-1"></a>mi_data<span class="sc">@</span>data</span>
<span id="cb102-1210"><a href="#cb102-1210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1211"><a href="#cb102-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1212"><a href="#cb102-1212" aria-hidden="true" tabindex="-1"></a><span class="fu">## Media con una variable target</span></span>
<span id="cb102-1213"><a href="#cb102-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1214"><a href="#cb102-1214" aria-hidden="true" tabindex="-1"></a>Definimos la variable target</span>
<span id="cb102-1215"><a href="#cb102-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1218"><a href="#cb102-1218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1219"><a href="#cb102-1219" aria-hidden="true" tabindex="-1"></a>target <span class="ot">=</span> <span class="st">"Species"</span></span>
<span id="cb102-1220"><a href="#cb102-1220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1221"><a href="#cb102-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1222"><a href="#cb102-1222" aria-hidden="true" tabindex="-1"></a>Definimos la base de datos con NA's</span>
<span id="cb102-1223"><a href="#cb102-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1226"><a href="#cb102-1226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1227"><a href="#cb102-1227" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">subset</span>(iris, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="fu">get</span>(target)))</span>
<span id="cb102-1228"><a href="#cb102-1228" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> missForest<span class="sc">::</span><span class="fu">prodNA</span>(data, <span class="at">noNA =</span> <span class="fl">0.1</span>)</span>
<span id="cb102-1229"><a href="#cb102-1229" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Species <span class="ot">&lt;-</span> iris[, target]</span>
<span id="cb102-1230"><a href="#cb102-1230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1231"><a href="#cb102-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1232"><a href="#cb102-1232" aria-hidden="true" tabindex="-1"></a>Definir variables a imputar (excluyendo la variable target)</span>
<span id="cb102-1233"><a href="#cb102-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1236"><a href="#cb102-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1237"><a href="#cb102-1237" aria-hidden="true" tabindex="-1"></a>varImp <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data)[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">colnames</span>(data) <span class="sc">%in%</span> target)]</span>
<span id="cb102-1238"><a href="#cb102-1238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1239"><a href="#cb102-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1240"><a href="#cb102-1240" aria-hidden="true" tabindex="-1"></a>Calcular las medias por grupo</span>
<span id="cb102-1241"><a href="#cb102-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1244"><a href="#cb102-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1245"><a href="#cb102-1245" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(data[, varImp], <span class="fu">list</span>(data[, target]), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-1246"><a href="#cb102-1246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1247"><a href="#cb102-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1248"><a href="#cb102-1248" aria-hidden="true" tabindex="-1"></a>Imputar valores faltantes</span>
<span id="cb102-1249"><a href="#cb102-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1252"><a href="#cb102-1252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1253"><a href="#cb102-1253" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (c <span class="cf">in</span> varImp) {</span>
<span id="cb102-1254"><a href="#cb102-1254" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (g <span class="cf">in</span> means[, <span class="st">"Group.1"</span>]) {</span>
<span id="cb102-1255"><a href="#cb102-1255" aria-hidden="true" tabindex="-1"></a>    cond <span class="ot">&lt;-</span> data[, target] <span class="sc">==</span> g  <span class="co"># Condici√≥n booleana en vez de which()</span></span>
<span id="cb102-1256"><a href="#cb102-1256" aria-hidden="true" tabindex="-1"></a>    na_index <span class="ot">&lt;-</span> <span class="fu">is.na</span>(data[, c]) <span class="sc">&amp;</span> cond  <span class="co"># Seleccionar NA dentro del grupo</span></span>
<span id="cb102-1257"><a href="#cb102-1257" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-1258"><a href="#cb102-1258" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Asignar valores imputados</span></span>
<span id="cb102-1259"><a href="#cb102-1259" aria-hidden="true" tabindex="-1"></a>    data[na_index, c] <span class="ot">&lt;-</span> means[means[, <span class="st">"Group.1"</span>] <span class="sc">==</span> g, c]</span>
<span id="cb102-1260"><a href="#cb102-1260" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-1261"><a href="#cb102-1261" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-1262"><a href="#cb102-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span>
<span id="cb102-1263"><a href="#cb102-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1264"><a href="#cb102-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1265"><a href="#cb102-1265" aria-hidden="true" tabindex="-1"></a>Visualizamos la diferencia entre las imputaciones</span>
<span id="cb102-1266"><a href="#cb102-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1269"><a href="#cb102-1269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1270"><a href="#cb102-1270" aria-hidden="true" tabindex="-1"></a>iris[, <span class="st">"Tipo"</span>] <span class="ot">&lt;-</span> <span class="st">"original"</span></span>
<span id="cb102-1271"><a href="#cb102-1271" aria-hidden="true" tabindex="-1"></a>data[, <span class="st">"Tipo"</span>] <span class="ot">&lt;-</span> <span class="st">"imputed"</span></span>
<span id="cb102-1272"><a href="#cb102-1272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1273"><a href="#cb102-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1274"><a href="#cb102-1274" aria-hidden="true" tabindex="-1"></a>Unimos en un mismo dataframe</span>
<span id="cb102-1275"><a href="#cb102-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1278"><a href="#cb102-1278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1279"><a href="#cb102-1279" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(iris, data)</span>
<span id="cb102-1280"><a href="#cb102-1280" aria-hidden="true" tabindex="-1"></a>cols_numeric <span class="ot">&lt;-</span> <span class="fu">names</span>(data_long)[<span class="fu">sapply</span>(data_long, is.numeric) <span class="sc">&amp;</span> <span class="fu">names</span>(data_long) <span class="sc">!=</span> <span class="st">"Tipo"</span>]</span>
<span id="cb102-1281"><a href="#cb102-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1282"><a href="#cb102-1282" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert a large data</span></span>
<span id="cb102-1283"><a href="#cb102-1283" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> data_long <span class="sc">%&gt;%</span></span>
<span id="cb102-1284"><a href="#cb102-1284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">all_of</span>(cols_numeric), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb102-1285"><a href="#cb102-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1286"><a href="#cb102-1286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1287"><a href="#cb102-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1288"><a href="#cb102-1288" aria-hidden="true" tabindex="-1"></a>Creamos el gr√°fico con ggplot</span>
<span id="cb102-1289"><a href="#cb102-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1292"><a href="#cb102-1292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1293"><a href="#cb102-1293" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Tipo)) <span class="sc">+</span></span>
<span id="cb102-1294"><a href="#cb102-1294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para comparaci√≥n</span></span>
<span id="cb102-1295"><a href="#cb102-1295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Variable, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span>  <span class="co"># Un gr√°fico por variable</span></span>
<span id="cb102-1296"><a href="#cb102-1296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparaci√≥n de Distribuciones: Original vs Imputado"</span>,</span>
<span id="cb102-1297"><a href="#cb102-1297" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb102-1298"><a href="#cb102-1298" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb102-1299"><a href="#cb102-1299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb102-1300"><a href="#cb102-1300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb102-1301"><a href="#cb102-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1302"><a href="#cb102-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1303"><a href="#cb102-1303" aria-hidden="true" tabindex="-1"></a>Removemos la tipologia de variable</span>
<span id="cb102-1304"><a href="#cb102-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1307"><a href="#cb102-1307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1308"><a href="#cb102-1308" aria-hidden="true" tabindex="-1"></a>iris.mis[, <span class="st">"Tipo"</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb102-1309"><a href="#cb102-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1310"><a href="#cb102-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1311"><a href="#cb102-1311" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multiple Imputation by Chained Equations (MICE)</span></span>
<span id="cb102-1312"><a href="#cb102-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1313"><a href="#cb102-1313" aria-hidden="true" tabindex="-1"></a>Eliminamos las variables categoricas</span>
<span id="cb102-1314"><a href="#cb102-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1317"><a href="#cb102-1317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1318"><a href="#cb102-1318" aria-hidden="true" tabindex="-1"></a>quiCat <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">lapply</span>(iris.mis, class) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"character"</span>, <span class="st">"factor"</span>))</span>
<span id="cb102-1319"><a href="#cb102-1319" aria-hidden="true" tabindex="-1"></a>categories <span class="ot">&lt;-</span> <span class="fu">names</span>(iris.mis)[quiCat]</span>
<span id="cb102-1320"><a href="#cb102-1320" aria-hidden="true" tabindex="-1"></a>iris.mis2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(iris.mis, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="fu">get</span>(categories)))</span>
<span id="cb102-1321"><a href="#cb102-1321" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iris.mis2)</span>
<span id="cb102-1322"><a href="#cb102-1322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1323"><a href="#cb102-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1324"><a href="#cb102-1324" aria-hidden="true" tabindex="-1"></a>Visualizamos los patrones de NA's de la base de datos</span>
<span id="cb102-1325"><a href="#cb102-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1328"><a href="#cb102-1328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1329"><a href="#cb102-1329" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb102-1330"><a href="#cb102-1330" aria-hidden="true" tabindex="-1"></a>mice<span class="sc">::</span><span class="fu">md.pattern</span>(iris.mis2, <span class="at">rotate.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-1331"><a href="#cb102-1331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1332"><a href="#cb102-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1333"><a href="#cb102-1333" aria-hidden="true" tabindex="-1"></a>Tambi√©n lo podemos visualizar con el paquete VIM</span>
<span id="cb102-1334"><a href="#cb102-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1337"><a href="#cb102-1337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1338"><a href="#cb102-1338" aria-hidden="true" tabindex="-1"></a>mice_plot <span class="ot">&lt;-</span> VIM<span class="sc">::</span><span class="fu">aggr</span>(iris.mis2, <span class="at">col=</span><span class="fu">c</span>(<span class="st">'navyblue'</span>,<span class="st">'yellow'</span>),</span>
<span id="cb102-1339"><a href="#cb102-1339" aria-hidden="true" tabindex="-1"></a>                  <span class="at">numbers=</span><span class="cn">TRUE</span>, <span class="at">sortVars=</span><span class="cn">TRUE</span>,</span>
<span id="cb102-1340"><a href="#cb102-1340" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels=</span><span class="fu">names</span>(iris.mis), <span class="at">cex.axis=</span>.<span class="dv">7</span>,</span>
<span id="cb102-1341"><a href="#cb102-1341" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gap=</span><span class="dv">3</span>, <span class="at">ylab=</span><span class="fu">c</span>(<span class="st">"Missing data"</span>,<span class="st">"Pattern"</span>))</span>
<span id="cb102-1342"><a href="#cb102-1342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1343"><a href="#cb102-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1344"><a href="#cb102-1344" aria-hidden="true" tabindex="-1"></a>A continuaci√≥n realizamos la imputaci√≥n de los valores faltanes de manera multivariada</span>
<span id="cb102-1345"><a href="#cb102-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1348"><a href="#cb102-1348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1349"><a href="#cb102-1349" aria-hidden="true" tabindex="-1"></a>imputed_Data <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">mice</span>(iris.mis2, <span class="at">m=</span><span class="dv">5</span>, <span class="at">maxit =</span> <span class="dv">50</span>, <span class="at">method =</span> <span class="st">'pmm'</span>, <span class="at">seed =</span> <span class="dv">500</span>)</span>
<span id="cb102-1350"><a href="#cb102-1350" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(imputed_Data)</span>
<span id="cb102-1351"><a href="#cb102-1351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1352"><a href="#cb102-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1353"><a href="#cb102-1353" aria-hidden="true" tabindex="-1"></a>Inspeccionamos la calidad de las imputaciones</span>
<span id="cb102-1354"><a href="#cb102-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1357"><a href="#cb102-1357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1358"><a href="#cb102-1358" aria-hidden="true" tabindex="-1"></a>mice<span class="sc">::</span><span class="fu">stripplot</span>(imputed_Data, Sepal.Width, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">xlab =</span> <span class="st">"Imputation number"</span>)</span>
<span id="cb102-1359"><a href="#cb102-1359" aria-hidden="true" tabindex="-1"></a>imputed_Data<span class="sc">$</span>imp<span class="sc">$</span>Sepal.Width</span>
<span id="cb102-1360"><a href="#cb102-1360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1361"><a href="#cb102-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1362"><a href="#cb102-1362" aria-hidden="true" tabindex="-1"></a>Al final seleccionamos una de las iteracciones y la dejamos como imputaci√≥n de los valores faltantes.</span>
<span id="cb102-1363"><a href="#cb102-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1366"><a href="#cb102-1366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1367"><a href="#cb102-1367" aria-hidden="true" tabindex="-1"></a>completeData <span class="ot">&lt;-</span> mice<span class="sc">::</span><span class="fu">complete</span>(imputed_Data, <span class="at">action =</span> <span class="st">"long"</span>)</span>
<span id="cb102-1368"><a href="#cb102-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1369"><a href="#cb102-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1370"><a href="#cb102-1370" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercices:</span></span>
<span id="cb102-1371"><a href="#cb102-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1372"><a href="#cb102-1372" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Deploy the multiple plot to compare te imputation and not imputation with all numeric vars in dataframe</span>
<span id="cb102-1373"><a href="#cb102-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1374"><a href="#cb102-1374" aria-hidden="true" tabindex="-1"></a><span class="fu">## KNN</span></span>
<span id="cb102-1375"><a href="#cb102-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1378"><a href="#cb102-1378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1379"><a href="#cb102-1379" aria-hidden="true" tabindex="-1"></a>tipos <span class="ot">&lt;-</span> <span class="fu">sapply</span>(iris.mis, class)</span>
<span id="cb102-1380"><a href="#cb102-1380" aria-hidden="true" tabindex="-1"></a>varNum <span class="ot">&lt;-</span> <span class="fu">names</span>(tipos)[<span class="fu">which</span>(tipos <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"numeric"</span>, <span class="st">"integer"</span>))]</span>
<span id="cb102-1381"><a href="#cb102-1381" aria-hidden="true" tabindex="-1"></a>data_knn_imputation <span class="ot">&lt;-</span> multiUS<span class="sc">::</span><span class="fu">KNNimp</span>(iris.mis[, varNum], <span class="at">k =</span> <span class="dv">1</span>)</span>
<span id="cb102-1382"><a href="#cb102-1382" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data_knn_imputation)</span>
<span id="cb102-1383"><a href="#cb102-1383" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1384"><a href="#cb102-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1385"><a href="#cb102-1385" aria-hidden="true" tabindex="-1"></a>Visualizamos la diferencia entre las dos imputaciones.</span>
<span id="cb102-1386"><a href="#cb102-1386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1389"><a href="#cb102-1389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1390"><a href="#cb102-1390" aria-hidden="true" tabindex="-1"></a>newBD <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">real =</span> iris[, <span class="st">"Sepal.Length"</span>], <span class="at">imputed =</span> data_knn_imputation[, <span class="st">"Sepal.Length"</span>])</span>
<span id="cb102-1391"><a href="#cb102-1391" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> newBD <span class="sc">%&gt;%</span></span>
<span id="cb102-1392"><a href="#cb102-1392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb102-1393"><a href="#cb102-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1394"><a href="#cb102-1394" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Variable)) <span class="sc">+</span></span>
<span id="cb102-1395"><a href="#cb102-1395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para mejor visualizaci√≥n</span></span>
<span id="cb102-1396"><a href="#cb102-1396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Densidad de las tres variables"</span>,</span>
<span id="cb102-1397"><a href="#cb102-1397" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb102-1398"><a href="#cb102-1398" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb102-1399"><a href="#cb102-1399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb102-1400"><a href="#cb102-1400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb102-1401"><a href="#cb102-1401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1402"><a href="#cb102-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1403"><a href="#cb102-1403" aria-hidden="true" tabindex="-1"></a>Otra forma de hacerlo en R seria la siguiente:</span>
<span id="cb102-1404"><a href="#cb102-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1407"><a href="#cb102-1407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1408"><a href="#cb102-1408" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: graficamos_mi_iteration</span></span>
<span id="cb102-1409"><a href="#cb102-1409" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1410"><a href="#cb102-1410" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1411"><a href="#cb102-1411" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1412"><a href="#cb102-1412" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1413"><a href="#cb102-1413" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1414"><a href="#cb102-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1415"><a href="#cb102-1415" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"caret"</span>)</span>
<span id="cb102-1416"><a href="#cb102-1416" aria-hidden="true" tabindex="-1"></a>pre_knn <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(dades, <span class="at">method =</span> <span class="st">"knnImpute"</span>, <span class="at">k =</span> <span class="dv">2</span>)</span>
<span id="cb102-1417"><a href="#cb102-1417" aria-hidden="true" tabindex="-1"></a>imputed_knn <span class="ot">&lt;-</span> <span class="fu">predict</span>(pre_knn, dades)</span>
<span id="cb102-1418"><a href="#cb102-1418" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose</span>(imputed_knn)</span>
<span id="cb102-1419"><a href="#cb102-1419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1420"><a href="#cb102-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1421"><a href="#cb102-1421" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercices:</span></span>
<span id="cb102-1422"><a href="#cb102-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1423"><a href="#cb102-1423" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Deploy the multiple plot to compare the imputation and not imputation with all numeric vars in dataframe</span>
<span id="cb102-1424"><a href="#cb102-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1425"><a href="#cb102-1425" aria-hidden="true" tabindex="-1"></a><span class="fu">## missForest</span></span>
<span id="cb102-1426"><a href="#cb102-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1427"><a href="#cb102-1427" aria-hidden="true" tabindex="-1"></a>Imputamos los missings usando todos los parametros con los valores por defectos.</span>
<span id="cb102-1428"><a href="#cb102-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1431"><a href="#cb102-1431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1432"><a href="#cb102-1432" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(missForest)</span>
<span id="cb102-1433"><a href="#cb102-1433" aria-hidden="true" tabindex="-1"></a>iris.imp <span class="ot">&lt;-</span> <span class="fu">missForest</span>(iris.mis, <span class="at">variablewise =</span> T, <span class="at">verbose =</span> T) </span>
<span id="cb102-1434"><a href="#cb102-1434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1435"><a href="#cb102-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1436"><a href="#cb102-1436" aria-hidden="true" tabindex="-1"></a>Visualizamos los valores imputados</span>
<span id="cb102-1437"><a href="#cb102-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1440"><a href="#cb102-1440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1441"><a href="#cb102-1441" aria-hidden="true" tabindex="-1"></a>iris.imp<span class="sc">$</span>ximp</span>
<span id="cb102-1442"><a href="#cb102-1442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1443"><a href="#cb102-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1444"><a href="#cb102-1444" aria-hidden="true" tabindex="-1"></a>Visualizamos el error cometido en las imputaciones.</span>
<span id="cb102-1445"><a href="#cb102-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1448"><a href="#cb102-1448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1449"><a href="#cb102-1449" aria-hidden="true" tabindex="-1"></a>iris.imp<span class="sc">$</span>OOBerror</span>
<span id="cb102-1450"><a href="#cb102-1450" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1451"><a href="#cb102-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1452"><a href="#cb102-1452" aria-hidden="true" tabindex="-1"></a>NRMSE √©s un error normalitzat mitj√† al quadrat. S'utilitza per representar l'error derivat d'imputar valors continus. El PFC (proporci√≥ de falsament classificada) s'utilitza per representar l'error derivat d'imputar valors categ√≤rics.</span>
<span id="cb102-1453"><a href="#cb102-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1454"><a href="#cb102-1454" aria-hidden="true" tabindex="-1"></a>Comparamos el accuracy actual,</span>
<span id="cb102-1455"><a href="#cb102-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1458"><a href="#cb102-1458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1459"><a href="#cb102-1459" aria-hidden="true" tabindex="-1"></a>(iris.err <span class="ot">&lt;-</span> <span class="fu">mixError</span>(iris.imp<span class="sc">$</span>ximp, iris.mis, iris))</span>
<span id="cb102-1460"><a href="#cb102-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1461"><a href="#cb102-1461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1462"><a href="#cb102-1462" aria-hidden="true" tabindex="-1"></a>Miramos la diferencia entre las dos imputaciones</span>
<span id="cb102-1463"><a href="#cb102-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1466"><a href="#cb102-1466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1467"><a href="#cb102-1467" aria-hidden="true" tabindex="-1"></a>newBD <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">real =</span> iris[, <span class="st">"Sepal.Length"</span>], <span class="at">imputed =</span>  iris.imp<span class="sc">$</span>ximp[, <span class="st">"Sepal.Length"</span>])</span>
<span id="cb102-1468"><a href="#cb102-1468" aria-hidden="true" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> newBD <span class="sc">%&gt;%</span></span>
<span id="cb102-1469"><a href="#cb102-1469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Valor"</span>)</span>
<span id="cb102-1470"><a href="#cb102-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1471"><a href="#cb102-1471" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_long, <span class="fu">aes</span>(<span class="at">x =</span> Valor, <span class="at">fill =</span> Variable)) <span class="sc">+</span></span>
<span id="cb102-1472"><a href="#cb102-1472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span>  <span class="co"># Transparencia para mejor visualizaci√≥n</span></span>
<span id="cb102-1473"><a href="#cb102-1473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Densidad de las tres variables"</span>,</span>
<span id="cb102-1474"><a href="#cb102-1474" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Valor"</span>,</span>
<span id="cb102-1475"><a href="#cb102-1475" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Densidad"</span>) <span class="sc">+</span></span>
<span id="cb102-1476"><a href="#cb102-1476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb102-1477"><a href="#cb102-1477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb102-1478"><a href="#cb102-1478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1479"><a href="#cb102-1479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1480"><a href="#cb102-1480" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercises:</span></span>
<span id="cb102-1481"><a href="#cb102-1481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1482"><a href="#cb102-1482" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Deploy the multiple plot to compare te imputation and not imputation with all numeric vars in dataframe</span>
<span id="cb102-1483"><a href="#cb102-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1484"><a href="#cb102-1484" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extra</span></span>
<span id="cb102-1485"><a href="#cb102-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1486"><a href="#cb102-1486" aria-hidden="true" tabindex="-1"></a>Quan es tracta de valors que manquen, √©s possible que vulgueu reempla√ßar valors per valors que manquen (NA). Aix√≤ √©s √∫til en els casos en qu√® es coneix l'origen de les dades i es pot estar segur de quins valors han de faltar. Per exemple, podr√≠eu saber que tots els valors de ¬´N/A¬ª, ¬´N A¬ª i ¬´No disponible¬ª, o -99 o -1 se suposa que falten.</span>
<span id="cb102-1487"><a href="#cb102-1487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1488"><a href="#cb102-1488" aria-hidden="true" tabindex="-1"></a>naniar proporciona funcions per treballar espec√≠ficament en aquest tipus de problemes utilitzant la funci√≥ replace.with.na. Aquesta funci√≥ √©s el compliment a tidyr::replace els NA's, que reempla√ßa un valor NA per un valor especificat, mentre que naniar::replace,with_na reempla√ßa un valor per un NA:</span>
<span id="cb102-1489"><a href="#cb102-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1492"><a href="#cb102-1492" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1493"><a href="#cb102-1493" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: code_ejemplo</span></span>
<span id="cb102-1494"><a href="#cb102-1494" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1495"><a href="#cb102-1495" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1496"><a href="#cb102-1496" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1497"><a href="#cb102-1497" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1498"><a href="#cb102-1498" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1499"><a href="#cb102-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1500"><a href="#cb102-1500" aria-hidden="true" tabindex="-1"></a>tidyr<span class="sc">::</span>replace_na<span class="sc">:</span> Missing values turns into a <span class="fu">value</span> (<span class="cn">NA</span> ‚Äì<span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">99</span>)</span>
<span id="cb102-1501"><a href="#cb102-1501" aria-hidden="true" tabindex="-1"></a>naniar<span class="sc">::</span>replace_with_na<span class="sc">:</span> Value becomes a missing <span class="fu">value</span> (<span class="sc">-</span><span class="dv">99</span> ‚Äì<span class="sc">&gt;</span> <span class="cn">NA</span>)</span>
<span id="cb102-1502"><a href="#cb102-1502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1503"><a href="#cb102-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1504"><a href="#cb102-1504" aria-hidden="true" tabindex="-1"></a><span class="fu">## MIMMI</span></span>
<span id="cb102-1505"><a href="#cb102-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1506"><a href="#cb102-1506" aria-hidden="true" tabindex="-1"></a>Puedes descargar el fichero de MIMMI pinchando <span class="co">[</span><span class="ot">aqu√≠</span><span class="co">](03_02_MIMMI.R)</span></span>
<span id="cb102-1507"><a href="#cb102-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1508"><a href="#cb102-1508" aria-hidden="true" tabindex="-1"></a><span class="fu"># Features Selection</span></span>
<span id="cb102-1509"><a href="#cb102-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1510"><a href="#cb102-1510" aria-hidden="true" tabindex="-1"></a>La selecci√≥n de variables involucra un conjunto de t√©cnicas cuyo objetivo es seleccionar el subconjunto de variables predictoras m√°s relevante para las fases de modelizaci√≥n. Esto es importante porque:</span>
<span id="cb102-1511"><a href="#cb102-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1512"><a href="#cb102-1512" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Variables predictoras redundantes pueden distraer o enga√±ar a los algoritmos de aprendizaje, lo que posiblemente se traduzca en un menor rendimiento, no solo predictivo (exactitud y precisi√≥n), sino tambi√©n en t√©rminos de tiempo de computaci√≥n.</span>
<span id="cb102-1513"><a href="#cb102-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1514"><a href="#cb102-1514" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Igualmente, la inclusi√≥n de variables irrelevantes aumenta el coste computacional y dificulta la interpretabilidad.</span>
<span id="cb102-1515"><a href="#cb102-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1516"><a href="#cb102-1516" aria-hidden="true" tabindex="-1"></a>Una adecuada selecci√≥n de variables tiene ventajas importantes:</span>
<span id="cb102-1517"><a href="#cb102-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1518"><a href="#cb102-1518" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Elimina las variables con informaci√≥n redundante</span>
<span id="cb102-1519"><a href="#cb102-1519" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Reduce el grado de complejidad de los modelos</span>
<span id="cb102-1520"><a href="#cb102-1520" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Evita o reduce el sobreajuste</span>
<span id="cb102-1521"><a href="#cb102-1521" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Incrementa de la precisi√≥n de las predicciones</span>
<span id="cb102-1522"><a href="#cb102-1522" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Reduce la carga computacional</span>
<span id="cb102-1523"><a href="#cb102-1523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1524"><a href="#cb102-1524" aria-hidden="true" tabindex="-1"></a>Debe comprobarse la magnitud de la varianza de las variables candidatas a ser seleccionadas y de sus correlaciones dos a dos, as√≠ como si existen combinaciones lineales entre ellas (multicolinealidad).</span>
<span id="cb102-1525"><a href="#cb102-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1526"><a href="#cb102-1526" aria-hidden="true" tabindex="-1"></a>Los m√©todos de selecci√≥n de variables se pueden resumir en 2 grandes grupos:</span>
<span id="cb102-1527"><a href="#cb102-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1528"><a href="#cb102-1528" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Los que utilizan variables objetivo (supervisados)</span>
<span id="cb102-1529"><a href="#cb102-1529" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Los que no (no supervisados)</span>
<span id="cb102-1530"><a href="#cb102-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1531"><a href="#cb102-1531" aria-hidden="true" tabindex="-1"></a>Nos centraremos en los que utilizan variable objetivo (supervisados). Estos se pueden dividir en los siguientes grupos:</span>
<span id="cb102-1532"><a href="#cb102-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1533"><a href="#cb102-1533" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**M√©todos tipo filtro** *(Filter)*: puntua de mayor a menor cada variable predictora en base a su capacidad predictiva y selecciona un subconjunto de variables dependiendo de dicha puntuaci√≥n.</span>
<span id="cb102-1534"><a href="#cb102-1534" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**M√©todos tipo envoltura** *(wrapper)*: Elige un subconjunto de vaiables que dan como resultado el modelo con mayores prestaciones en cuanto a calidad de resultados y eficiencia.</span>
<span id="cb102-1535"><a href="#cb102-1535" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**M√©todos tipo intr√≠nsecos** *(embedded)*: Seleccionan las variables autom√°ticamente como parte del ajuste del modelo durante el entrenamiento.</span>
<span id="cb102-1536"><a href="#cb102-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1537"><a href="#cb102-1537" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preselecci√≥n de variables</span></span>
<span id="cb102-1538"><a href="#cb102-1538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1539"><a href="#cb102-1539" aria-hidden="true" tabindex="-1"></a><span class="fu">### Varianza nula</span></span>
<span id="cb102-1540"><a href="#cb102-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1541"><a href="#cb102-1541" aria-hidden="true" tabindex="-1"></a>Uno de los aspectos fundamentales en la selecci√≥n de variables es comprobar si su varianza es cero o cercana a cero porque, si es as√≠, sus valores son iguales o similares, respectivamente, y, por tanto, esas variables estar√°n perfectamente o cuasiperfectamente correlacionadas con el t√©rmino independiente del modelo, con lo cual, en el mejor de los casos, solo a√±adir√°n ruido al modelo. Este tipo de efecto acaba afectando en la divisi√≥n de los conjuntos de entrenamiento y validaci√≥n de los datos.</span>
<span id="cb102-1542"><a href="#cb102-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1543"><a href="#cb102-1543" aria-hidden="true" tabindex="-1"></a>Para visualizarlo en R, podemos hacer lo siguiente:</span>
<span id="cb102-1544"><a href="#cb102-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1547"><a href="#cb102-1547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1548"><a href="#cb102-1548" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: varianza_nula</span></span>
<span id="cb102-1549"><a href="#cb102-1549" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1550"><a href="#cb102-1550" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1551"><a href="#cb102-1551" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1552"><a href="#cb102-1552" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1553"><a href="#cb102-1553" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1554"><a href="#cb102-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1555"><a href="#cb102-1555" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb102-1556"><a href="#cb102-1556" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(idealista18)</span>
<span id="cb102-1557"><a href="#cb102-1557" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb102-1558"><a href="#cb102-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1559"><a href="#cb102-1559" aria-hidden="true" tabindex="-1"></a>Madrid_Sale <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Madrid_Sale)</span>
<span id="cb102-1560"><a href="#cb102-1560" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Madrid_Sale, is.numeric)</span>
<span id="cb102-1561"><a href="#cb102-1561" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num <span class="ot">&lt;-</span> Madrid_Sale[, numeric_cols]</span>
<span id="cb102-1562"><a href="#cb102-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1563"><a href="#cb102-1563" aria-hidden="true" tabindex="-1"></a>varianza <span class="ot">&lt;-</span> <span class="fu">nearZeroVar</span>(Madrid_Sale_num, <span class="at">saveMetrics =</span> T)</span>
<span id="cb102-1564"><a href="#cb102-1564" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(varianza, <span class="dv">2</span>)</span>
<span id="cb102-1565"><a href="#cb102-1565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1566"><a href="#cb102-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1567"><a href="#cb102-1567" aria-hidden="true" tabindex="-1"></a><span class="fu">### Correlaci√≥n entre variables</span></span>
<span id="cb102-1568"><a href="#cb102-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1569"><a href="#cb102-1569" aria-hidden="true" tabindex="-1"></a>Una de las cuestiones a tener en cuenta en el proceso de selecci√≥n de variables es la magnitud de las **correlaciones entre variables** ya que esto puede afectar a la fiabilidad de las predicciones al tener variables muy correlacionadas. En el caso extreno el modelo tendr√° problemas de colinealidad o multicolinealidad.</span>
<span id="cb102-1570"><a href="#cb102-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1571"><a href="#cb102-1571" aria-hidden="true" tabindex="-1"></a>Para detectar las variables con muy elevada correlaci√≥n entre ellas, se le pasa la funci√≥n <span class="in">`findCorrelation()`</span> de <span class="in">`caret`</span>, con valor 0,9, a la matriz de correlaciones lineales entre las variables susceptibles de ser seleccionadas.</span>
<span id="cb102-1572"><a href="#cb102-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1575"><a href="#cb102-1575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1576"><a href="#cb102-1576" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: correlaciones</span></span>
<span id="cb102-1577"><a href="#cb102-1577" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1578"><a href="#cb102-1578" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1579"><a href="#cb102-1579" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1580"><a href="#cb102-1580" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1581"><a href="#cb102-1581" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1582"><a href="#cb102-1582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1583"><a href="#cb102-1583" aria-hidden="true" tabindex="-1"></a>madrid_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(Madrid_Sale_num[, <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>])</span>
<span id="cb102-1584"><a href="#cb102-1584" aria-hidden="true" tabindex="-1"></a>(alta_corr <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(madrid_cor, <span class="at">cutoff =</span> .<span class="dv">9</span>))</span>
<span id="cb102-1585"><a href="#cb102-1585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1586"><a href="#cb102-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1587"><a href="#cb102-1587" aria-hidden="true" tabindex="-1"></a>Para visualizar, podemos ver el <span class="in">`corrplot`</span>:</span>
<span id="cb102-1588"><a href="#cb102-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1591"><a href="#cb102-1591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1592"><a href="#cb102-1592" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_correlaciones</span></span>
<span id="cb102-1593"><a href="#cb102-1593" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1594"><a href="#cb102-1594" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1595"><a href="#cb102-1595" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1596"><a href="#cb102-1596" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1597"><a href="#cb102-1597" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1598"><a href="#cb102-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1599"><a href="#cb102-1599" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"corrplot"</span>)</span>
<span id="cb102-1600"><a href="#cb102-1600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1601"><a href="#cb102-1601" aria-hidden="true" tabindex="-1"></a>matriz_corr <span class="ot">&lt;-</span> <span class="fu">cor</span>(Madrid_Sale_num[, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb102-1602"><a href="#cb102-1602" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(matriz_corr, <span class="at">method =</span> <span class="st">"circle"</span>)</span>
<span id="cb102-1603"><a href="#cb102-1603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1604"><a href="#cb102-1604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1605"><a href="#cb102-1605" aria-hidden="true" tabindex="-1"></a><span class="fu">### Combinaciones lineales</span></span>
<span id="cb102-1606"><a href="#cb102-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1607"><a href="#cb102-1607" aria-hidden="true" tabindex="-1"></a>En la mayor√≠a de los casos las variables que se utilizan como predictoras no son ortogonales, sino que tienen cierto grado de dependencia lineal entre ellas. Si dicho grado es moderado, las consecuencias de la no ortogonalidad en la predicci√≥n no son graves, pero en los casos de dependencia lineal cuasiperfecta las inferencias resultantes del modelo estimado distan mucho de la realidad. Dichas consecuencias son a√∫n m√°s graves en el caso de que las combinaciones lineales sean perfectas. Por ello, la existencia de colinealidad o combinaciones lineales entre las variables seleccionables tambi√©n es una circunstancia a evitar.</span>
<span id="cb102-1608"><a href="#cb102-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1609"><a href="#cb102-1609" aria-hidden="true" tabindex="-1"></a>Las principales fuentes de multicolinealidad son:</span>
<span id="cb102-1610"><a href="#cb102-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1611"><a href="#cb102-1611" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>El m√©todo utilizado en la recogida de datos (subespacios)</span>
<span id="cb102-1612"><a href="#cb102-1612" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Restricciones en el modelo o en la poblaci√≥n (existencia de variables correlacionadas)</span>
<span id="cb102-1613"><a href="#cb102-1613" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Especificaci√≥n del modelo (polinomios)</span>
<span id="cb102-1614"><a href="#cb102-1614" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>M√°s variables que observaciones</span>
<span id="cb102-1615"><a href="#cb102-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1616"><a href="#cb102-1616" aria-hidden="true" tabindex="-1"></a>Los efectos de la multicolinealidad en los modelos son los siguientes:</span>
<span id="cb102-1617"><a href="#cb102-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1618"><a href="#cb102-1618" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Los estimadores tendr√°n grandes varianzas y covarianzas</span>
<span id="cb102-1619"><a href="#cb102-1619" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Las estimaciones de los coeficientes del modelo ser√°n demasiado grandes</span>
<span id="cb102-1620"><a href="#cb102-1620" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Los signos de los coeficientes estimados suelen ser distintos a los esperados</span>
<span id="cb102-1621"><a href="#cb102-1621" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Peque√±as variaciones en los datos, o en las especificaciones del modelo, provocar√°n grandes cambios en los coeficientes</span>
<span id="cb102-1622"><a href="#cb102-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1623"><a href="#cb102-1623" aria-hidden="true" tabindex="-1"></a>Utilizando la funci√≥n <span class="in">`findLinearCombos()`</span> del paquete <span class="in">`caret`</span> permite encontrar combinaciones lineales de las variables predictoras.</span>
<span id="cb102-1624"><a href="#cb102-1624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1627"><a href="#cb102-1627" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1628"><a href="#cb102-1628" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: busqueda_combinaciones</span></span>
<span id="cb102-1629"><a href="#cb102-1629" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1630"><a href="#cb102-1630" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1631"><a href="#cb102-1631" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1632"><a href="#cb102-1632" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1633"><a href="#cb102-1633" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1634"><a href="#cb102-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1635"><a href="#cb102-1635" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num_na <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(Madrid_Sale_num) <span class="co"># Es necesario eliminar los NA.</span></span>
<span id="cb102-1636"><a href="#cb102-1636" aria-hidden="true" tabindex="-1"></a>(combos <span class="ot">&lt;-</span> <span class="fu">findLinearCombos</span>(Madrid_Sale_num_na))</span>
<span id="cb102-1637"><a href="#cb102-1637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1638"><a href="#cb102-1638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1639"><a href="#cb102-1639" aria-hidden="true" tabindex="-1"></a>En caso de encontrarse con problemas de multicolinealidad se deberia de realizar:</span>
<span id="cb102-1640"><a href="#cb102-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1641"><a href="#cb102-1641" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Eliminaci√≥n de variables predictoras que se encuentren altamente relacionadas con otras que permanecen en el modelo</span>
<span id="cb102-1642"><a href="#cb102-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1643"><a href="#cb102-1643" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sustituir las variables predictoras por componentes principales</span>
<span id="cb102-1644"><a href="#cb102-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1645"><a href="#cb102-1645" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Incluir informaci√≥n externa a los datos originales. Esta alternativa implica utilizar estimadores contra√≠dos (de Stein o ridge) o bayesianos.</span>
<span id="cb102-1646"><a href="#cb102-1646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1647"><a href="#cb102-1647" aria-hidden="true" tabindex="-1"></a>Si quisieramos eliminar variables que son combinaciones lineales deberiamos de hacer lo siguiente:</span>
<span id="cb102-1648"><a href="#cb102-1648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1651"><a href="#cb102-1651" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1652"><a href="#cb102-1652" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: eliminar_combinaci√≥n</span></span>
<span id="cb102-1653"><a href="#cb102-1653" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1654"><a href="#cb102-1654" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1655"><a href="#cb102-1655" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1656"><a href="#cb102-1656" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1657"><a href="#cb102-1657" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1658"><a href="#cb102-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1659"><a href="#cb102-1659" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Madrid_Sale_num_na[, <span class="sc">-</span>combos<span class="sc">$</span>remove])</span>
<span id="cb102-1660"><a href="#cb102-1660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1661"><a href="#cb102-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1662"><a href="#cb102-1662" aria-hidden="true" tabindex="-1"></a><span class="fu">## M√©todos de selecci√≥n de variables</span></span>
<span id="cb102-1663"><a href="#cb102-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1664"><a href="#cb102-1664" aria-hidden="true" tabindex="-1"></a>En el *subset* de variables que sobrevivien al proceso anterior, es necesario detectar cuales de ellas han de entrar en el modelo. Esta fase se realiza porque:</span>
<span id="cb102-1665"><a href="#cb102-1665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1666"><a href="#cb102-1666" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Queremos simplificar los modelos para hacerlos m√°s interpretables</span>
<span id="cb102-1667"><a href="#cb102-1667" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Mejorar la precisi√≥n del modelo</span>
<span id="cb102-1668"><a href="#cb102-1668" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Reducir el tiempo de computaci√≥n. Entrenar algoritmos con mayor velocidad</span>
<span id="cb102-1669"><a href="#cb102-1669" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Evitar la maldici√≥n de la dimensionalidad (efecto Huges), que se refiere a las consecuencias no deseadas que tiene lugar cuando la dimensionalidad de un problema es muy elevada.</span>
<span id="cb102-1670"><a href="#cb102-1670" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Reducir la probabilidad de sobreajuste</span>
<span id="cb102-1671"><a href="#cb102-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1672"><a href="#cb102-1672" aria-hidden="true" tabindex="-1"></a><span class="fu">### *Filters*</span></span>
<span id="cb102-1673"><a href="#cb102-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1674"><a href="#cb102-1674" aria-hidden="true" tabindex="-1"></a>Los **m√©todos de selecci√≥n de variables tipo filtro** usan t√©cnicas estad√≠sticas para evaluar la relaci√≥n entre cada variable predictora y la variable objetivo. Generalmente, consideran la influencia de cada variable predictora sobre la variable objetivo por separado. Las puntuaciones obtenidas se utilizan como base para clasificar y elegir las variables predictoras que se utilizar√°n en el modelo.</span>
<span id="cb102-1675"><a href="#cb102-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1676"><a href="#cb102-1676" aria-hidden="true" tabindex="-1"></a>Si la variable predictora es num√©rica, entonces se usa el coeficiente de correlaci√≥n de Pearson o el de Spearman (si es o no lineal). Si las variables fueran todas categ√≥ricas se podria usar medidas de asociaci√≥n para tablas de contingencia. Por lo contrario si la entregada es categorica y la salida es num√©rica se podrian usar t√©cnicas de ANOVA para analizar que variables son influeyentes.</span>
<span id="cb102-1677"><a href="#cb102-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1678"><a href="#cb102-1678" aria-hidden="true" tabindex="-1"></a>Podemos usar diferentes paquetes como <span class="in">`FSelector`</span>, <span class="in">`caret`</span> para implementar dicha t√©cnica. En este caso, usaremos el paquete <span class="in">`FSinR`</span>. A continuaci√≥n se muestra un ejemplo para variables predictoras num√©ricas. Para ello, se toma una muestra del conjunto de datos. Una vez en disposici√≥n de la muestra, primeramente se transforma la variable objetivo en categ√≥rica, siendo las categor√≠as (intervalos) cuatro cortes de la distribuci√≥n de sus valores; dicha categorizaci√≥n se lleva a cabo mediante **binning** Tambi√©n se eliminan los registros con datos faltantes.</span>
<span id="cb102-1679"><a href="#cb102-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1682"><a href="#cb102-1682" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1683"><a href="#cb102-1683" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: muestreo</span></span>
<span id="cb102-1684"><a href="#cb102-1684" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1685"><a href="#cb102-1685" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1686"><a href="#cb102-1686" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1687"><a href="#cb102-1687" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1688"><a href="#cb102-1688" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1689"><a href="#cb102-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1690"><a href="#cb102-1690" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rsample"</span>)</span>
<span id="cb102-1691"><a href="#cb102-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1692"><a href="#cb102-1692" aria-hidden="true" tabindex="-1"></a><span class="co"># Se toma una muestra con el paquete rsample</span></span>
<span id="cb102-1693"><a href="#cb102-1693" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb102-1694"><a href="#cb102-1694" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num_sample <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Madrid_Sale_num), <span class="at">size =</span> <span class="dv">5000</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb102-1695"><a href="#cb102-1695" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num_sample <span class="ot">&lt;-</span> Madrid_Sale_num[Madrid_Sale_num_sample, ]</span>
<span id="cb102-1696"><a href="#cb102-1696" aria-hidden="true" tabindex="-1"></a><span class="co"># Se realiza binning con cuatro bins</span></span>
<span id="cb102-1697"><a href="#cb102-1697" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_num_sample_bin <span class="ot">&lt;-</span> Madrid_Sale_num_sample <span class="sc">|&gt;</span></span>
<span id="cb102-1698"><a href="#cb102-1698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price_bin =</span> <span class="fu">cut</span>(PRICE, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">250000</span>, <span class="dv">500000</span>, <span class="dv">750000</span>, <span class="dv">10000000</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"primerQ"</span>, <span class="st">"segundoQ"</span>, <span class="st">"tercerQ"</span>, <span class="st">"c"</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb102-1699"><a href="#cb102-1699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(price_bin, CONSTRUCTEDAREA, ROOMNUMBER, BATHNUMBER, HASTERRACE, HASLIFT)</span>
<span id="cb102-1700"><a href="#cb102-1700" aria-hidden="true" tabindex="-1"></a><span class="co"># Se eliminan los registros con valores missing</span></span>
<span id="cb102-1701"><a href="#cb102-1701" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_sample_na <span class="ot">&lt;-</span> <span class="fu">drop_na</span>(Madrid_Sale_num_sample_bin)</span>
<span id="cb102-1702"><a href="#cb102-1702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1703"><a href="#cb102-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1704"><a href="#cb102-1704" aria-hidden="true" tabindex="-1"></a>Una vez discretizada la variable objetivo, se selecciona el conjunto de variables predictoras de la variable objetivo <span class="in">`price_bin`</span>, que es la variable <span class="in">`PRICE`</span> transformada mediante *binning*. Como m√©todo tipo filtro se utiliza minimum description length (MDLM), que es un m√©todo de selecci√≥n de variables que se basa en una medida de la complejidad del modelo denominada ‚Äúlongitud m√≠nima de la descripci√≥n‚Äù (de ah√≠ el nombre del modelo), por lo que su objetivo es encontrar el modelo m√°s sencillo que proporcione una explicaci√≥n aceptable de los datos. Como algoritmo de b√∫squeda se utiliza sequential forward selection.</span>
<span id="cb102-1705"><a href="#cb102-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1708"><a href="#cb102-1708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1709"><a href="#cb102-1709" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Filter</span></span>
<span id="cb102-1710"><a href="#cb102-1710" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1711"><a href="#cb102-1711" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1712"><a href="#cb102-1712" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1713"><a href="#cb102-1713" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1714"><a href="#cb102-1714" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1715"><a href="#cb102-1715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1716"><a href="#cb102-1716" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"FSinR"</span>)</span>
<span id="cb102-1717"><a href="#cb102-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1718"><a href="#cb102-1718" aria-hidden="true" tabindex="-1"></a><span class="co"># M√©todo tipo filtro MDLC (Minimum-Description_Length-Criterion)</span></span>
<span id="cb102-1719"><a href="#cb102-1719" aria-hidden="true" tabindex="-1"></a>evaluador <span class="ot">&lt;-</span> <span class="fu">filterEvaluator</span>(<span class="st">"MDLC"</span>)</span>
<span id="cb102-1720"><a href="#cb102-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1721"><a href="#cb102-1721" aria-hidden="true" tabindex="-1"></a><span class="co"># Se genera el algoritmo de b√∫squeda</span></span>
<span id="cb102-1722"><a href="#cb102-1722" aria-hidden="true" tabindex="-1"></a>buscador <span class="ot">&lt;-</span> <span class="fu">searchAlgorithm</span>(<span class="st">"sequentialForwardSelection"</span>)</span>
<span id="cb102-1723"><a href="#cb102-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1724"><a href="#cb102-1724" aria-hidden="true" tabindex="-1"></a><span class="co"># Se implementa el proceso, pasando a la funci√≥n los dos par√°metros anteriores</span></span>
<span id="cb102-1725"><a href="#cb102-1725" aria-hidden="true" tabindex="-1"></a>resultados <span class="ot">&lt;-</span> <span class="fu">featureSelection</span>(Madrid_Sale_sample_na, <span class="st">"price_bin"</span>, buscador, evaluador)</span>
<span id="cb102-1726"><a href="#cb102-1726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1727"><a href="#cb102-1727" aria-hidden="true" tabindex="-1"></a><span class="co"># Se muestran los resultados</span></span>
<span id="cb102-1728"><a href="#cb102-1728" aria-hidden="true" tabindex="-1"></a>resultados<span class="sc">$</span>bestFeatures</span>
<span id="cb102-1729"><a href="#cb102-1729" aria-hidden="true" tabindex="-1"></a>resultados<span class="sc">$</span>bestValue</span>
<span id="cb102-1730"><a href="#cb102-1730" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1731"><a href="#cb102-1731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1732"><a href="#cb102-1732" aria-hidden="true" tabindex="-1"></a><span class="fu">### *Wrappers*</span></span>
<span id="cb102-1733"><a href="#cb102-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1734"><a href="#cb102-1734" aria-hidden="true" tabindex="-1"></a>Este enfoque realiza una b√∫squeda a trav√©s de diferentes combinaciones o subconjuntos de variables predictoras/clasificadoras para comprobar el efecto que tienen en la precisi√≥n del modelo.</span>
<span id="cb102-1735"><a href="#cb102-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1736"><a href="#cb102-1736" aria-hidden="true" tabindex="-1"></a>Los m√©todos wrapper son de gran eficacia a la hora de eliminar variables irrelevantes y/o redundantes (cosa que no ocurre en los de tipo filtro porque se centran en el poder predictor de cada variable de forma aislada).</span>
<span id="cb102-1737"><a href="#cb102-1737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1738"><a href="#cb102-1738" aria-hidden="true" tabindex="-1"></a>tienen en cuenta la circunstancia de que dos o m√°s variables, aparentemente irrelevantes en cuanto a su capacidad predictiva o clasificatoria cuando se consideran una por una, pueden ser relevantes cuando se consideran conjuntamente. Sin embargo, son muy lentos, ya que tienen que aplicar much√≠simas veces el algoritmo de b√∫squeda, cambiando cada vez el n√∫mero de variables, siguiendo cada vez alg√∫n criterio tanto de b√∫squeda como de paro.</span>
<span id="cb102-1739"><a href="#cb102-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1742"><a href="#cb102-1742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1743"><a href="#cb102-1743" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Wrapper</span></span>
<span id="cb102-1744"><a href="#cb102-1744" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1745"><a href="#cb102-1745" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1746"><a href="#cb102-1746" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1747"><a href="#cb102-1747" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1748"><a href="#cb102-1748" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1749"><a href="#cb102-1749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1750"><a href="#cb102-1750" aria-hidden="true" tabindex="-1"></a><span class="co"># Se fijan los par√°metros</span></span>
<span id="cb102-1751"><a href="#cb102-1751" aria-hidden="true" tabindex="-1"></a>evaluador <span class="ot">&lt;-</span> <span class="fu">wrapperEvaluator</span>(<span class="st">"rpart1SE"</span>)</span>
<span id="cb102-1752"><a href="#cb102-1752" aria-hidden="true" tabindex="-1"></a>buscador <span class="ot">&lt;-</span> <span class="fu">searchAlgorithm</span>(<span class="st">"sequentialForwardSelection"</span>)</span>
<span id="cb102-1753"><a href="#cb102-1753" aria-hidden="true" tabindex="-1"></a><span class="co"># Se eval√∫an sobre Madrid_Sale_sample_na</span></span>
<span id="cb102-1754"><a href="#cb102-1754" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">featureSelection</span>(Madrid_Sale_sample_na, <span class="st">"price_bin"</span>, buscador, evaluador)</span>
<span id="cb102-1755"><a href="#cb102-1755" aria-hidden="true" tabindex="-1"></a>resultados<span class="sc">$</span>bestFeatures</span>
<span id="cb102-1756"><a href="#cb102-1756" aria-hidden="true" tabindex="-1"></a>resultados<span class="sc">$</span>bestValue</span>
<span id="cb102-1757"><a href="#cb102-1757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1758"><a href="#cb102-1758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1759"><a href="#cb102-1759" aria-hidden="true" tabindex="-1"></a><span class="fu">### *Embeddings*</span></span>
<span id="cb102-1760"><a href="#cb102-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1761"><a href="#cb102-1761" aria-hidden="true" tabindex="-1"></a>Hay algunos algoritmos de aprendizaje autom√°tico que realizan la selecci√≥n autom√°tica de variables como parte del aprendizaje del modelo. Estos son los m√©todos de selecci√≥n de tipo intr√≠nseco, que aglutinan las ventajas de los m√©todos de filtro y envoltura.</span>
<span id="cb102-1762"><a href="#cb102-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1765"><a href="#cb102-1765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1766"><a href="#cb102-1766" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Embeddings</span></span>
<span id="cb102-1767"><a href="#cb102-1767" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1768"><a href="#cb102-1768" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1769"><a href="#cb102-1769" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1770"><a href="#cb102-1770" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1771"><a href="#cb102-1771" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1772"><a href="#cb102-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1773"><a href="#cb102-1773" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"randomForest"</span>)</span>
<span id="cb102-1774"><a href="#cb102-1774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1775"><a href="#cb102-1775" aria-hidden="true" tabindex="-1"></a><span class="co"># Usar random forest para la selecci√≥n de variables</span></span>
<span id="cb102-1776"><a href="#cb102-1776" aria-hidden="true" tabindex="-1"></a>rf_modelo <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(price_bin <span class="sc">~</span> ., <span class="at">data =</span> Madrid_Sale_num_sample_bin)</span>
<span id="cb102-1777"><a href="#cb102-1777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1778"><a href="#cb102-1778" aria-hidden="true" tabindex="-1"></a><span class="co"># Listar las variables m√°s importantes</span></span>
<span id="cb102-1779"><a href="#cb102-1779" aria-hidden="true" tabindex="-1"></a><span class="fu">varImp</span>(rf_modelo)</span>
<span id="cb102-1780"><a href="#cb102-1780" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1781"><a href="#cb102-1781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1782"><a href="#cb102-1782" aria-hidden="true" tabindex="-1"></a><span class="fu"># Features Enginineering</span></span>
<span id="cb102-1783"><a href="#cb102-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1784"><a href="#cb102-1784" aria-hidden="true" tabindex="-1"></a>La ingenier√≠a de variables consiste en el proceso de conseguir, a partir de la informaci√≥n disponible, las variables id√≥neas (y en el n√∫mero apropiado) para que los modelos o clasificadores proporcionen los mejores resultados posibles, dados los datos disponibles y el modelo a ejecutar.</span>
<span id="cb102-1785"><a href="#cb102-1785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1786"><a href="#cb102-1786" aria-hidden="true" tabindex="-1"></a>Una de las herramientas m√°s populares es el **One-hot encoding**. El **One-hot encoding** consiste en asignar a cada etiqueta un n√∫mero entero o valor √∫nico seg√∫n el orden alfab√©tico. Es la codificaci√≥n m√°s popular y ampliamente utilizada.</span>
<span id="cb102-1787"><a href="#cb102-1787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1790"><a href="#cb102-1790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1791"><a href="#cb102-1791" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: one-hot-encoding</span></span>
<span id="cb102-1792"><a href="#cb102-1792" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1793"><a href="#cb102-1793" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1794"><a href="#cb102-1794" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1795"><a href="#cb102-1795" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1796"><a href="#cb102-1796" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1797"><a href="#cb102-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1798"><a href="#cb102-1798" aria-hidden="true" tabindex="-1"></a>dummies <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="st">"  ~ ."</span>, <span class="at">data =</span> Madrid_Sale_num_sample_bin)</span>
<span id="cb102-1799"><a href="#cb102-1799" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(dummies, <span class="at">newdata =</span> Madrid_Sale_num_sample_bin))</span>
<span id="cb102-1800"><a href="#cb102-1800" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1801"><a href="#cb102-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1802"><a href="#cb102-1802" aria-hidden="true" tabindex="-1"></a><span class="fu"># Validaci√≥n y control de calidad</span></span>
<span id="cb102-1803"><a href="#cb102-1803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1804"><a href="#cb102-1804" aria-hidden="true" tabindex="-1"></a>Al final del proceso de limpieza de datos, estos deber√≠an ser consistentes y seguir las reglas apropiadas para su campo de negocio. De no ser as√≠, los modelos que se estimen en base a ellos no representar√°n convenientemente la realidad objeto de estudio y las conclusiones que se obtengan de dichos modelos no ser√°n de utilidad para dicha realidad.</span>
<span id="cb102-1805"><a href="#cb102-1805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1806"><a href="#cb102-1806" aria-hidden="true" tabindex="-1"></a>La verificaci√≥n de si los datos son o no consistentes y si siguen o no las reglas del campo de negocio del cual proceden se puede llevar a cabo con el paquete <span class="in">`tidyverse`</span>, que permite hacer selecciones, filtrados o tablas de frecuencias, entre otras acciones.</span>
<span id="cb102-1807"><a href="#cb102-1807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1808"><a href="#cb102-1808" aria-hidden="true" tabindex="-1"></a>Una opci√≥n m√°s sofisticada es el paquete <span class="in">`validate`</span>, donde se pueden introducir las reglas de negocio dentro del propio c√≥digo o bien desde un fichero externo. A continuaci√≥n, se realiza un ejemplo con las reglas incrustadas en el propio c√≥digo. Estas reglas pueden ser avisos o normas que indican error en esos datos. En este ejemplo, se han definido siete reglas: por ejemplo, <span class="in">`PRICE`</span> ‚â• 0, o que la suma de las variables <span class="in">`HASNORTHORIENTATION`</span>, <span class="in">`HASSOUTHORIENTATION`</span>, <span class="in">`HASEASTORIENTATION`</span> y <span class="in">`HASWESTORIENTATION`</span> sea la unidad. La salida que se obtiene se presenta a continuaci√≥n.</span>
<span id="cb102-1809"><a href="#cb102-1809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1812"><a href="#cb102-1812" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1813"><a href="#cb102-1813" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bbdd_validate</span></span>
<span id="cb102-1814"><a href="#cb102-1814" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb102-1815"><a href="#cb102-1815" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1816"><a href="#cb102-1816" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1817"><a href="#cb102-1817" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1818"><a href="#cb102-1818" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1819"><a href="#cb102-1819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1820"><a href="#cb102-1820" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_int <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Madrid_Sale) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>geometry)</span>
<span id="cb102-1821"><a href="#cb102-1821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1822"><a href="#cb102-1822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1825"><a href="#cb102-1825" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1826"><a href="#cb102-1826" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: validate</span></span>
<span id="cb102-1827"><a href="#cb102-1827" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1828"><a href="#cb102-1828" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1829"><a href="#cb102-1829" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1830"><a href="#cb102-1830" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1831"><a href="#cb102-1831" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1832"><a href="#cb102-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1833"><a href="#cb102-1833" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"validate"</span>)</span>
<span id="cb102-1834"><a href="#cb102-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1835"><a href="#cb102-1835" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_int <span class="sc">|&gt;</span></span>
<span id="cb102-1836"><a href="#cb102-1836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_that</span>(</span>
<span id="cb102-1837"><a href="#cb102-1837" aria-hidden="true" tabindex="-1"></a>    HASLIFT <span class="sc">&gt;=</span> <span class="dv">0</span>,</span>
<span id="cb102-1838"><a href="#cb102-1838" aria-hidden="true" tabindex="-1"></a>    PRICE <span class="sc">&gt;=</span> <span class="dv">0</span>,</span>
<span id="cb102-1839"><a href="#cb102-1839" aria-hidden="true" tabindex="-1"></a>    HASNORTHORIENTATION <span class="sc">+</span> HASSOUTHORIENTATION <span class="sc">+</span> HASEASTORIENTATION <span class="sc">+</span> HASWESTORIENTATION <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb102-1840"><a href="#cb102-1840" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.numeric</span>(PRICE),</span>
<span id="cb102-1841"><a href="#cb102-1841" aria-hidden="true" tabindex="-1"></a>    UNITPRICE <span class="sc">*</span> CONSTRUCTEDAREA <span class="sc">==</span> PRICE,</span>
<span id="cb102-1842"><a href="#cb102-1842" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ROOMNUMBER <span class="sc">&gt;</span> <span class="dv">3</span>) PRICE <span class="sc">&gt;</span> <span class="dv">100000</span>,</span>
<span id="cb102-1843"><a href="#cb102-1843" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(.) <span class="sc">&gt;=</span> <span class="dv">20000</span></span>
<span id="cb102-1844"><a href="#cb102-1844" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb102-1845"><a href="#cb102-1845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span>
<span id="cb102-1846"><a href="#cb102-1846" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1847"><a href="#cb102-1847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1848"><a href="#cb102-1848" aria-hidden="true" tabindex="-1"></a>En un esquema tradicional de validaci√≥n, adem√°s de las reglas de validaci√≥n aportadas por los expertos en el tema del que se trate, debe incluirse tambi√©n un listado de reglas de correcci√≥n (igualmente aportado por los expertos en la materia) que indique c√≥mo hay que corregir un registro cuando no cumple con una determinada regla de validaci√≥n. Este modo de proceder, adem√°s de suponer un doble esfuerzo, puede conducir a inconsistencias o validaciones c√≠clicas.</span>
<span id="cb102-1849"><a href="#cb102-1849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1850"><a href="#cb102-1850" aria-hidden="true" tabindex="-1"></a>El **M√©todo de Fellegi y Holt (MFH)** da una soluci√≥n a este problema, evitando dichas inconsistencias, proporcionando un procedimiento que genera un conjunto completo de reglas de validaci√≥n, incorporando reglas impl√≠citas a las formuladas por los expertos de manera expl√≠cita.</span>
<span id="cb102-1851"><a href="#cb102-1851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1852"><a href="#cb102-1852" aria-hidden="true" tabindex="-1"></a>Dicho m√©todo asegura el cumplimiento de las siguientes tres premisas:</span>
<span id="cb102-1853"><a href="#cb102-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1854"><a href="#cb102-1854" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Minimizar el n√∫mero de campos a corregir en un registro para hacerlo pasar todas las validaciones.</span>
<span id="cb102-1855"><a href="#cb102-1855" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Mantener, en la medida de lo posible, la distribuci√≥n conjunta original del conjunto de datos.</span>
<span id="cb102-1856"><a href="#cb102-1856" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Derivar las reglas de correcci√≥n, directamente y de forma impl√≠cita, de las reglas de validaci√≥n. Por tanto, dichas reglas de correcci√≥n no son propuestas por el experto o, en su caso, por el validador.</span>
<span id="cb102-1857"><a href="#cb102-1857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1858"><a href="#cb102-1858" aria-hidden="true" tabindex="-1"></a>El **MFH** no est√° exento de limitaciones. La primera es el incremento del coste computacional, que puede llegar a constituir un problema en caso de que el n√∫mero de reglas impl√≠citas sea muy elevado, lo cual es muy frecuente. De hecho, hay casos en los que hay m√°s reglas impl√≠citas que registros. Para solucionar este problema, denominado *‚Äúproblema de localizaci√≥n del error‚Äù*, que consiste, b√°sicamente, en determinar el conjunto m√≠nimo de variables a corregir para cada validaci√≥n, se han propuesto varias alternativas, que incluyen m√©todos de investigaci√≥n de operaciones, √°rboles binarios y metaheur√≠sticas como algoritmos gen√©ticos y similares.</span>
<span id="cb102-1859"><a href="#cb102-1859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1860"><a href="#cb102-1860" aria-hidden="true" tabindex="-1"></a>A efectos pr√°cticos, el MFH se puede aplicar con la funci√≥n <span class="in">`locate_errors()`</span> del paquete <span class="in">`errorlocate`</span>, determin√°ndose as√≠ cu√°les son las variables a corregir para solventar los errores en las reglas de negocio establecidas (objeto rules).</span>
<span id="cb102-1861"><a href="#cb102-1861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1864"><a href="#cb102-1864" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1865"><a href="#cb102-1865" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: deteccion_error</span></span>
<span id="cb102-1866"><a href="#cb102-1866" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1867"><a href="#cb102-1867" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1868"><a href="#cb102-1868" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1869"><a href="#cb102-1869" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1870"><a href="#cb102-1870" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1871"><a href="#cb102-1871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1872"><a href="#cb102-1872" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"errorlocate"</span>)</span>
<span id="cb102-1873"><a href="#cb102-1873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1874"><a href="#cb102-1874" aria-hidden="true" tabindex="-1"></a>Madrid_Sale_red2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>(Madrid_Sale_int, <span class="at">price_bin =</span> Hmisc<span class="sc">::</span><span class="fu">cut2</span>(PRICE, <span class="at">g=</span><span class="dv">4</span>))</span>
<span id="cb102-1875"><a href="#cb102-1875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1876"><a href="#cb102-1876" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="fu">validator</span>(<span class="cf">if</span> (ROOMNUMBER <span class="sc">&gt;=</span> <span class="dv">10</span>) price_bin <span class="sc">==</span> <span class="st">"[502000,7138000]"</span>)</span>
<span id="cb102-1877"><a href="#cb102-1877" aria-hidden="true" tabindex="-1"></a>(el <span class="ot">&lt;-</span> <span class="fu">locate_errors</span>(Madrid_Sale_red2, rules) <span class="sc">|&gt;</span></span>
<span id="cb102-1878"><a href="#cb102-1878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(el))</span>
<span id="cb102-1879"><a href="#cb102-1879" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1880"><a href="#cb102-1880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1881"><a href="#cb102-1881" aria-hidden="true" tabindex="-1"></a>¬øY qu√© se debe hacer con los registros que no cumplen las normas de validaci√≥n? La respuesta es, como norma, ‚Äúsiempre que se disponga de informaci√≥n de negocio, esta debe preponderar sobre cualquier tipo de imputaci√≥n‚Äù. A partir de este punto se puede proceder a realizar imputaciones determin√≠sticas para solucionar los problemas detectados.</span>
<span id="cb102-1882"><a href="#cb102-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1883"><a href="#cb102-1883" aria-hidden="true" tabindex="-1"></a>En el ejemplo anterior, se propone imputar el valor <span class="in">`ROOMNUMBER=5`</span> a los casos de los tres primeros cuartiles (todos menos el m√°s caro) que tengan m√°s de 10 habitaciones. Para ello, se utiliza la funci√≥n <span class="in">`modify_so()`</span> del paquete <span class="in">`dcmodify`</span>. Para comprobar que la imputaci√≥n se ha llevado a cabo con √©xito, se pueden comparar los conjuntos de datos antes y despu√©s de la imputaci√≥n con la funci√≥n <span class="in">`compare()`</span>, comprob√°ndose que tal imputaci√≥n se ha realizado exitosamente en los 2 registros que presentaban problemas con la regla <span class="in">`ROOMNUMBER &gt;= 10`</span>.</span>
<span id="cb102-1884"><a href="#cb102-1884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1887"><a href="#cb102-1887" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1888"><a href="#cb102-1888" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: modificar_reglas</span></span>
<span id="cb102-1889"><a href="#cb102-1889" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb102-1890"><a href="#cb102-1890" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb102-1891"><a href="#cb102-1891" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb102-1892"><a href="#cb102-1892" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb102-1893"><a href="#cb102-1893" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb102-1894"><a href="#cb102-1894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1895"><a href="#cb102-1895" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dcmodify"</span>)</span>
<span id="cb102-1896"><a href="#cb102-1896" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> Madrid_Sale_red2 <span class="sc">|&gt;</span></span>
<span id="cb102-1897"><a href="#cb102-1897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">modify_so</span>(<span class="cf">if</span> (ROOMNUMBER <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">&amp;</span> price_bin <span class="sc">!=</span> <span class="st">"[502000,7138000]"</span>) ROOMNUMBER <span class="ot">&lt;-</span> <span class="dv">5</span>)</span>
<span id="cb102-1898"><a href="#cb102-1898" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="fu">validator</span>(<span class="cf">if</span> (ROOMNUMBER <span class="sc">&gt;=</span> <span class="dv">10</span>) price_bin <span class="sc">==</span> <span class="st">"[502000,7138000]"</span>)</span>
<span id="cb102-1899"><a href="#cb102-1899" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(rules, <span class="at">raw =</span> Madrid_Sale_red2, <span class="at">modified =</span> out)</span>
<span id="cb102-1900"><a href="#cb102-1900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1901"><a href="#cb102-1901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1902"><a href="#cb102-1902" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bibliograf√≠a</span></span>
<span id="cb102-1903"><a href="#cb102-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1904"><a href="#cb102-1904" aria-hidden="true" tabindex="-1"></a><span class="fu">## Outliers</span></span>
<span id="cb102-1905"><a href="#cb102-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1906"><a href="#cb102-1906" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://statsandr.com/blog/outliers-detection-in-r/#z-scores</span>
<span id="cb102-1907"><a href="#cb102-1907" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://m-mburu.github.io/datacamp/anomaly_detection_R/anomaly_detection.html</span>
<span id="cb102-1908"><a href="#cb102-1908" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://github.com/pridiltal/ctv-AnomalyDetection</span>
<span id="cb102-1909"><a href="#cb102-1909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1910"><a href="#cb102-1910" aria-hidden="true" tabindex="-1"></a><span class="fu">## Imputaci√≥n</span></span>
<span id="cb102-1911"><a href="#cb102-1911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1912"><a href="#cb102-1912" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>http://naniar.njtierney.com/articles/replace-with-na.html</span>
<span id="cb102-1913"><a href="#cb102-1913" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://cran.r-project.org/web/packages/visdat/vignettes/using_visdat.html</span>
<span id="cb102-1914"><a href="#cb102-1914" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://cran.r-project.org/web/packages/DMwR2/DMwR2.pdf</span>
<span id="cb102-1915"><a href="#cb102-1915" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://ltorgo.github.io/DMwR2/RintroDM.html#data_pre-processing</span>
<span id="cb102-1916"><a href="#cb102-1916" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://www.rdocumentation.org/packages/DMwR/versions/0.4.1/topics/knnImputation</span>
<span id="cb102-1917"><a href="#cb102-1917" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://amices.org/mice/</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>