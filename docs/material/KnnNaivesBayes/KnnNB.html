<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dante Conti, Sergi Ramirez, (c) IDEAI">
<meta name="dcterms.date" content="2025-10-14">

<title>Machine Learning I – Machine Learning for Data Scientist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../imagenes/ideai_logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-83f5ffed4bb819e1a410337fb71ccdff.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Machine Learning for Data Scientist</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Grau en Estadística</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src="../..\imagenes/Logo_UPC.svg.png" class="img-fluid"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#definición-del-problema" id="toc-definición-del-problema" class="nav-link active" data-scroll-target="#definición-del-problema"><span class="header-section-number">1</span> Definición del problema</a>
  <ul class="collapse">
  <li><a href="#contexto" id="toc-contexto" class="nav-link" data-scroll-target="#contexto"><span class="header-section-number">1.1</span> Contexto</a></li>
  <li><a href="#objetivo" id="toc-objetivo" class="nav-link" data-scroll-target="#objetivo"><span class="header-section-number">1.2</span> Objetivo</a></li>
  </ul></li>
  <li><a href="#knn" id="toc-knn" class="nav-link" data-scroll-target="#knn"><span class="header-section-number">2</span> KNN</a>
  <ul class="collapse">
  <li><a href="#knn-classifier" id="toc-knn-classifier" class="nav-link" data-scroll-target="#knn-classifier"><span class="header-section-number">2.1</span> KNN Classifier</a></li>
  <li><a href="#knn-regresor" id="toc-knn-regresor" class="nav-link" data-scroll-target="#knn-regresor"><span class="header-section-number">2.2</span> KNN Regresor</a></li>
  </ul></li>
  <li><a href="#naives-bayes-classifier" id="toc-naives-bayes-classifier" class="nav-link" data-scroll-target="#naives-bayes-classifier"><span class="header-section-number">3</span> Naives Bayes (<em>Classifier</em>)</a>
  <ul class="collapse">
  <li><a href="#definición-de-los-conjuntos-de-datos" id="toc-definición-de-los-conjuntos-de-datos" class="nav-link" data-scroll-target="#definición-de-los-conjuntos-de-datos"><span class="header-section-number">3.1</span> Definición de los conjuntos de datos</a></li>
  <li><a href="#entrenamiento-del-modelo-2" id="toc-entrenamiento-del-modelo-2" class="nav-link" data-scroll-target="#entrenamiento-del-modelo-2"><span class="header-section-number">3.2</span> Entrenamiento del modelo</a></li>
  <li><a href="#tunning-parameters-selección-de-los-valores-óptimos" id="toc-tunning-parameters-selección-de-los-valores-óptimos" class="nav-link" data-scroll-target="#tunning-parameters-selección-de-los-valores-óptimos"><span class="header-section-number">3.3</span> <em>Tunning parameters</em>: Selección de los valores óptimos</a></li>
  <li><a href="#predicción-de-la-variable-respuesta-2" id="toc-predicción-de-la-variable-respuesta-2" class="nav-link" data-scroll-target="#predicción-de-la-variable-respuesta-2"><span class="header-section-number">3.4</span> Predicción de la variable respuesta</a></li>
  <li><a href="#validación-de-la-performance-del-modelo-1" id="toc-validación-de-la-performance-del-modelo-1" class="nav-link" data-scroll-target="#validación-de-la-performance-del-modelo-1"><span class="header-section-number">3.5</span> Validación de la <em>performance</em> del modelo</a></li>
  </ul></li>
  <li><a href="#bibliografia" id="toc-bibliografia" class="nav-link" data-scroll-target="#bibliografia"><span class="header-section-number">4</span> Bibliografia</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="KnnNB.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Machine Learning I</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">KNN y Naives Bayes</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dante Conti, Sergi Ramirez, (c) IDEAI </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 14, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 14, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="definición-del-problema" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="definición-del-problema"><span class="header-section-number">1</span> Definición del problema</h2>
<section id="contexto" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="contexto"><span class="header-section-number">1.1</span> Contexto</h3>
<p>Una tienda está planteando la venta final del año. Queremos lanzar una oferta. Será válido sólo para los clientes existentes y la campaña a través de las llamadas telefónicas que se está planificando actualmente para ellos. La dirección considera que la mejor manera de reducir el coste de la campaña es hacer un modelo predictivo que clasifique a los clientes que puedan comprar la oferta.</p>
<p>Las variables que contiene la base de datos son:</p>
<ul>
<li><strong>Response (target)</strong>: 1 si el cliente aceptó la oferta en la última campaña, 0 en caso contrario</li>
<li><strong>ID</strong>: ID único de cada cliente</li>
<li><strong>Year_Birth</strong> - Edad del cliente</li>
<li><strong>Complain</strong> - 1 si el cliente presentó una queja en los últimos 2 años</li>
<li><strong>Dt_Customer</strong> - Fecha de alta del cliente en la empresa</li>
<li><strong>Education</strong> - Nivel de estudios del cliente</li>
<li><strong>Marital</strong> - Estado civil del cliente</li>
<li><strong>Kidhome</strong> - Número de niños pequeños en el hogar del cliente</li>
<li><strong>Teenhome</strong> - Número de adolescentes en el hogar del cliente</li>
<li><strong>Income</strong> - Ingresos anuales del hogar del cliente</li>
<li><strong>MntFishProducts</strong> - Cantidad gastada en productos de pescado en los últimos 2 años</li>
<li><strong>MntMeatProducts</strong> - Cantidad gastada en productos cárnicos en los últimos 2 años</li>
<li><strong>MntFruits</strong> - Cantidad gastada en frutas en los últimos 2 años</li>
<li><strong>MntSweetProducts</strong> - cantidad gastada en productos dulces en los últimos 2 años</li>
<li><strong>MntWines</strong> - cantidad gastada en productos de vino en los últimos 2 años</li>
<li><strong>MntGoldProds</strong> - cantidad gastada en productos de oro en los últimos 2 años</li>
<li><strong>NumDealsPurchases</strong> - número de compras realizadas con descuento</li>
<li><strong>NumCatalogPurchases</strong> - número de compras realizadas por catálogo (comprando productos con envío por correo)</li>
<li><strong>NumStorePurchases</strong> - número de compras realizadas directamente en tiendas</li>
<li><strong>NumWebPurchases</strong> - número de compras realizadas a través del sitio web de la empresa</li>
<li><strong>NumWebVisitsMonth</strong> - número de visitas al sitio web de la empresa en el último mes</li>
<li><strong>Recency</strong> - número de días desde la última compra</li>
</ul>
</section>
<section id="objetivo" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="objetivo"><span class="header-section-number">1.2</span> Objetivo</h3>
<p>Ls supertienda quiere predecir la probabilidad que el cliente de una respuesta positiva y identificar los diferentes factores que afectan la respuesta del cliente.</p>
<p>Podéis encontrar la base de datos en la siguiente <a href="https://www.kaggle.com/datasets/ahsan81/superstore-marketing-campaign-dataset">web</a></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  Income Kidhome Teenhome Recency MntWines MntFruits MntMeatProducts
1  84835       0        0       0      189       104             379
2  57091       0        0       0      464         5              64
3  67267       0        1       0      134        11              59
4  32474       1        1       0       10         0               1
5  21474       1        0       0        6        16              24
6  71691       0        0       0      336       130             411
  MntFishProducts MntSweetProducts MntGoldProds NumDealsPurchases
1             111              189          218                 1
2               7                0           37                 1
3              15                2           30                 1
4               0                0            0                 1
5              11                0           34                 2
6             240               32           43                 1
  NumWebPurchases NumCatalogPurchases NumStorePurchases NumWebVisitsMonth
1               4                   4                 6                 1
2               7                   3                 7                 5
3               3                   2                 5                 2
4               1                   0                 2                 7
5               3                   1                 2                 7
6               4                   7                 5                 2
  Response Edad Education_Basic Education_Graduation Education_Master
1      Yes   55               0                    1                0
2      Yes   64               0                    1                0
3       No   67               0                    1                0
4       No   58               0                    1                0
5      Yes   36               0                    1                0
6      Yes   67               0                    0                0
  Education_PhD Marital_Status_Alone Marital_Status_Divorced
1             0                    0                       1
2             0                    0                       0
3             0                    0                       0
4             0                    0                       0
5             0                    0                       0
6             1                    0                       0
  Marital_Status_Married Marital_Status_Single Marital_Status_Together
1                      0                     0                       0
2                      0                     1                       0
3                      1                     0                       0
4                      0                     0                       1
5                      0                     1                       0
6                      0                     1                       0
  Marital_Status_Widow Marital_Status_YOLO mes_cliente_2 mes_cliente_3
1                    0                   0             0             0
2                    0                   0             0             0
3                    0                   0             0             0
4                    0                   0             0             0
5                    0                   0             0             0
6                    0                   0             0             1
  mes_cliente_4 mes_cliente_5 mes_cliente_6 mes_cliente_7 mes_cliente_8
1             0             0             1             0             0
2             0             0             1             0             0
3             0             1             0             0             0
4             0             0             0             0             0
5             0             0             0             0             1
6             0             0             0             0             0
  mes_cliente_9 mes_cliente_10 mes_cliente_11 mes_cliente_12 Complain_Yes
1             0              0              0              0            0
2             0              0              0              0            0
3             0              0              0              0            0
4             0              0              1              0            0
5             0              0              0              0            0
6             0              0              0              0            0</code></pre>
</div>
</div>
</section>
</section>
<section id="knn" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="knn"><span class="header-section-number">2</span> KNN</h2>
<section id="knn-classifier" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="knn-classifier"><span class="header-section-number">2.1</span> KNN Classifier</h3>
<section id="definimos-los-conjuntos-de-datos" class="level4" data-number="2.1.1">
<h4 data-number="2.1.1" class="anchored" data-anchor-id="definimos-los-conjuntos-de-datos"><span class="header-section-number">2.1.1</span> Definimos los conjuntos de datos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R: R Base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ind_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">16</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos), <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> datos[default_idx, ]; test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> train[, <span class="sc">-</span>ind_col]; X_test <span class="ot">&lt;-</span> test[, <span class="sc">-</span>ind_col]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> train[, ind_col]; y_test <span class="ot">&lt;-</span> test[, ind_col]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos todas las columnas en numéricas para que se pueda utilizar el algoritmo</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># de KNN</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(X_train, as.numeric))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(X_test, as.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ind_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">16</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(datos<span class="sc">$</span>Response, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>X_trainC <span class="ot">&lt;-</span> datos[default_idx, ]</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>y_testC <span class="ot">&lt;-</span> X_testC[, ind_col]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> X_testC[, <span class="sc">-</span>ind_col]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelLookup</span>(<span class="st">"knn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  model parameter      label forReg forClass probModel
1   knn         k #Neighbors   TRUE     TRUE      TRUE</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> datos_py.drop([<span class="st">"Response"</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> datos_py[<span class="st">'Response'</span>]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>X_trainPy, X_testPy, y_trainPy, y_testPy <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.3</span>, random_state <span class="op">=</span> <span class="dv">1994</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="escalamos-los-datos" class="level4" data-number="2.1.2">
<h4 data-number="2.1.2" class="anchored" data-anchor-id="escalamos-los-datos"><span class="header-section-number">2.1.2</span> Escalamos los datos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R: R Base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Suponemos que X_train y X_test son data.frames numéricos</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X_train)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular medias y desviaciones estándar con X_train</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">sapply</span>(X_train, mean)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">sapply</span>(X_train, sd)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Estandarizar X_train</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">scale</span>(X_train, <span class="at">center =</span> means, <span class="at">scale =</span> sds)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar la misma transformación a X_test</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">scale</span>(X_test, <span class="at">center =</span> means, <span class="at">scale =</span> sds)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir de nuevo a data.frame</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(X_train)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(X_test)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Mantener nombres de columnas</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X_train) <span class="ot">&lt;-</span> cols</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X_test) <span class="ot">&lt;-</span> cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear preprocesador para centrado y escalado</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>preproc <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(X_trainC, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar transformación</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>X_trainC <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_trainC)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_testC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> X_trainPy.columns</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> scaler.fit_transform(X_trainPy)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>X_testPy <span class="op">=</span> scaler.transform(X_testPy)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> pd.DataFrame(X_trainPy, columns<span class="op">=</span>[cols])</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>X_testPy <span class="op">=</span> pd.DataFrame(X_testPy, columns<span class="op">=</span>[cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="entrenamiento-del-modelo" class="level4" data-number="2.1.3">
<h4 data-number="2.1.3" class="anchored" data-anchor-id="entrenamiento-del-modelo"><span class="header-section-number">2.1.3</span> Entrenamiento del modelo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>prediccion <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> X_train, <span class="at">test  =</span> X_test, <span class="at">cl =</span> y_train, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediccion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] No  Yes No  No  No  Yes
Levels: No Yes</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(entrenamiento <span class="ot">&lt;-</span> <span class="fu">train</span>(Response <span class="sc">~</span> ., <span class="at">data =</span> X_trainC, <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># preProcess = c("center", "scale"),</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">31</span>, <span class="at">by =</span> <span class="dv">2</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>k-Nearest Neighbors 

1553 samples
  39 predictor
   2 classes: 'No', 'Yes' 

No pre-processing
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 1243, 1242, 1243, 1242, 1242 
Resampling results across tuning parameters:

  k   Accuracy   Kappa      
   1  0.8325879  0.279679994
   3  0.8473976  0.213133436
   5  0.8493185  0.131995536
   7  0.8544695  0.126768918
   9  0.8538347  0.110964792
  11  0.8493206  0.054785486
  13  0.8486796  0.032064246
  15  0.8467483  0.023317027
  17  0.8467524  0.006447460
  19  0.8473955  0.007760759
  21  0.8493289  0.011490079
  23  0.8480386  0.003353250
  25  0.8486817  0.004620608
  27  0.8493248  0.005851422
  29  0.8486796  0.004579949
  31  0.8493227  0.005847308

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was k = 7.</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>entrenamiento<span class="sc">$</span>modelType</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Classification"</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import KNeighbors ClaSSifier from sklearn</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate the model</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>knn <span class="op">=</span> KNeighborsClassifier(n_neighbors <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model to the training set</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>knn.fit(X_trainPy, y_trainPy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsClassifier(n_neighbors=3)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>KNeighborsClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">n_neighbors&nbsp;</td>
<td class="value">3</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">weights&nbsp;</td>
<td class="value">'uniform'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">algorithm&nbsp;</td>
<td class="value">'auto'</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">leaf_size&nbsp;</td>
<td class="value">30</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">p&nbsp;</td>
<td class="value">2</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">metric&nbsp;</td>
<td class="value">'minkowski'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">metric_params&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="tunning-parameters-selección-del-valor-de-k" class="level4" data-number="2.1.4">
<h4 data-number="2.1.4" class="anchored" data-anchor-id="tunning-parameters-selección-del-valor-de-k"><span class="header-section-number">2.1.4</span> <em>Tunning parameters</em>: Selección del valor de k</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>k_to_try <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>err_k <span class="ot">=</span> <span class="fu">rep</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">times =</span> <span class="fu">length</span>(k_to_try))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(k_to_try)) {</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> X_train, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">test  =</span> X_test, </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">cl    =</span> y_train, </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">k     =</span> k_to_try[i], </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">prob =</span> T)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  err_k[i] <span class="ot">&lt;-</span> <span class="fu">calc_class_err</span>(y_test, pred)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs choice of k</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(err_k, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"dodgerblue"</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"k, number of neighbors"</span>, <span class="at">ylab =</span> <span class="st">"classification error"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"(Test) Error Rate vs Neighbors"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># add line for min error seen</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(err_k), <span class="at">col =</span> <span class="st">"darkorange"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add line for minority prevalence in test set</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(y_test <span class="sc">==</span> <span class="st">"Yes"</span>), <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/visualizar_movimiento_base-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>get_best_result <span class="ot">=</span> <span class="cf">function</span>(caret_fit) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  best <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rownames</span>(caret_fit<span class="sc">$</span>results) <span class="sc">==</span> <span class="fu">rownames</span>(caret_fit<span class="sc">$</span>bestTune))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  best_result <span class="ot">=</span> caret_fit<span class="sc">$</span>results[best, ]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(best_result) <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  best_result</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(entrenamiento<span class="sc">$</span>results, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  k  Accuracy     Kappa  AccuracySD    KappaSD
1 1 0.8325879 0.2796800 0.012589167 0.04474886
2 3 0.8473976 0.2131334 0.015312908 0.09135524
3 5 0.8493185 0.1319955 0.014549182 0.10608590
4 7 0.8544695 0.1267689 0.007133587 0.06311837
5 9 0.8538347 0.1109648 0.007330331 0.05904349</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(entrenamiento)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/grafico_accuracy_caret-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tablaResultados <span class="ot">&lt;-</span> entrenamiento<span class="sc">$</span>results</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>tablaResultados<span class="sc">$</span>error <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> tablaResultados<span class="sc">$</span>Accuracy</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs choice of k</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tablaResultados<span class="sc">$</span>error, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"dodgerblue"</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"k, number of neighbors"</span>, <span class="at">ylab =</span> <span class="st">"classification error"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"(Test) Error Rate vs Neighbors"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># add line for min error seen</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(err_k), <span class="at">col =</span> <span class="st">"darkorange"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add line for minority prevalence in test set</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(y_test <span class="sc">==</span> <span class="st">"Yes"</span>), <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/grafico_accuracy_caret-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_best_result</span>(entrenamiento)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  k  Accuracy     Kappa  AccuracySD    KappaSD
1 7 0.8544695 0.1267689 0.007133587 0.06311837</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>entrenamiento<span class="sc">$</span>finalModel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>7-nearest neighbor model
Training set outcome distribution:

  No  Yes 
1319  234 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co"># for data visualization purposes</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>k_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">20</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> []</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> k_range:</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    knn <span class="op">=</span> KNeighborsClassifier(n_neighbors <span class="op">=</span> k)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    knn.fit(X_trainPy, y_trainPy)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    scores.append(knn.score(X_testPy, y_testPy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsClassifier(n_neighbors=19)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>KNeighborsClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">n_neighbors&nbsp;</td>
<td class="value">19</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">weights&nbsp;</td>
<td class="value">'uniform'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">algorithm&nbsp;</td>
<td class="value">'auto'</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">leaf_size&nbsp;</td>
<td class="value">30</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">p&nbsp;</td>
<td class="value">2</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">metric&nbsp;</td>
<td class="value">'minkowski'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">metric_params&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'k'</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'accuracy'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(k_range, scores)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>([&lt;matplotlib.axis.XTick object at 0x000001A35B5A7450&gt;, &lt;matplotlib.axis.XTick object at 0x000001A35B5682D0&gt;, &lt;matplotlib.axis.XTick object at 0x000001A35A0071D0&gt;, &lt;matplotlib.axis.XTick object at 0x000001A35B5BABD0&gt;, &lt;matplotlib.axis.XTick object at 0x000001A35A017190&gt;], [Text(0, 0, '0'), Text(5, 0, '5'), Text(10, 0, '10'), Text(15, 0, '15'), Text(20, 0, '20')])</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/mejor_modelo_python-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="predicción-de-la-variable-respuesta" class="level4" data-number="2.1.5">
<h4 data-number="2.1.5" class="anchored" data-anchor-id="predicción-de-la-variable-respuesta"><span class="header-section-number">2.1.5</span> Predicción de la variable respuesta</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>La própia función que entrena el algoritmo ya devuelve las predicciones del algoritmo de KNN.</p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(entrenamiento, <span class="at">newdata =</span> X_testC, <span class="at">type =</span> <span class="st">"prob"</span>), <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          No       Yes
1  0.8571429 0.1428571
2  0.8571429 0.1428571
3  1.0000000 0.0000000
4  0.7142857 0.2857143
5  0.8571429 0.1428571
6  0.8571429 0.1428571
7  1.0000000 0.0000000
8  1.0000000 0.0000000
9  0.7142857 0.2857143
10 0.8571429 0.1428571</code></pre>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<section id="predicción-de-la-etiqueta" class="level5" data-number="2.1.5.1">
<h5 data-number="2.1.5.1" class="anchored" data-anchor-id="predicción-de-la-etiqueta"><span class="header-section-number">2.1.5.1</span> Predicción de la etiqueta</h5>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>y_predPy <span class="op">=</span> knn.predict(X_testPy)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>y_predPy[:<span class="dv">20</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>array(['No', 'No', 'No', 'No', 'No', 'No', 'No', 'No', 'No', 'No', 'No',
       'No', 'No', 'No', 'No', 'No', 'No', 'No', 'No', 'No'], dtype=object)</code></pre>
</div>
</div>
</section>
<section id="predicción-de-pertenecer-a-cada-etiqueta" class="level5" data-number="2.1.5.2">
<h5 data-number="2.1.5.2" class="anchored" data-anchor-id="predicción-de-pertenecer-a-cada-etiqueta"><span class="header-section-number">2.1.5.2</span> Predicción de pertenecer a cada etiqueta</h5>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># probability of getting output as 2 - benign cancer</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>knn.predict_proba(X_testPy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>array([[0.68421053, 0.31578947],
       [0.84210526, 0.15789474],
       [0.89473684, 0.10526316],
       ...,
       [0.89473684, 0.10526316],
       [1.        , 0.        ],
       [1.        , 0.        ]], shape=(665, 2))</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="validación-de-la-performance-del-modelo" class="level4" data-number="2.1.6">
<h4 data-number="2.1.6" class="anchored" data-anchor-id="validación-de-la-performance-del-modelo"><span class="header-section-number">2.1.6</span> Validación de la <em>performance</em> del modelo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>calc_class_err <span class="ot">=</span> <span class="cf">function</span>(actual, predicted) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(actual <span class="sc">!=</span> predicted)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_class_err</span>(<span class="at">actual    =</span> y_test,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">predicted =</span> <span class="fu">knn</span>(<span class="at">train =</span> X_train,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">test  =</span> X_test,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">cl    =</span> y_train,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">k     =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1684211</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">which</span>(err_k <span class="sc">==</span> <span class="fu">min</span>(err_k)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>predicciones <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> X_train, <span class="at">test =</span> X_test, <span class="at">cl =</span> y_train, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predicciones, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            y_test
predicciones  No Yes
         No  539  90
         Yes  22  14</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Paquetes</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class)      <span class="co"># knn</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)    <span class="co"># plotting</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)      <span class="co"># %&gt;%, mutate</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Datos de entrada esperados ---</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train, X_test: data.frames/ matrices numéricas</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train, y_test: vector/factor de etiquetas (clases)</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) PCA AJUSTADO EN TRAIN (con centrado y escalado). Proyectamos train y test.</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(X_train, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>Z_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, <span class="at">newdata =</span> X_train)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, <span class="at">newdata =</span> X_test)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Z_train) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PC1"</span>,<span class="st">"PC2"</span>)</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Z_test)  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PC1"</span>,<span class="st">"PC2"</span>)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Rango para el grid (usamos TRAIN para coherencia)</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>x_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train[,<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>; x_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train[,<span class="dv">1</span>]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>y_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train[,<span class="dv">2</span>]) <span class="sc">-</span> <span class="dv">1</span>; y_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train[,<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC1 =</span> <span class="fu">seq</span>(x_min, x_max, <span class="at">by =</span> h),</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC2 =</span> <span class="fu">seq</span>(y_min, y_max, <span class="at">by =</span> h)</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) kNN en el plano PCA (class::knn no "entrena"; predice dado train/test)</span></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="co">#    Usamos las coordenadas PCA de train como "train", y el grid como "test".</span></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a><span class="co">#    Asegura que y_train sea factor.</span></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_train)</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>y_test  <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_test, <span class="at">levels =</span> <span class="fu">levels</span>(y_train))</span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>grid_pred <span class="ot">&lt;-</span> <span class="fu">knn</span>(</span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> Z_train,</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">test  =</span> grid,</span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl    =</span> y_train,</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">k     =</span> k</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">factor</span>(grid_pred, <span class="at">levels =</span> <span class="fu">levels</span>(y_train))</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Data frames para puntos</span></span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_train, <span class="at">clase =</span> y_train, <span class="at">split =</span> <span class="st">"Train"</span>)</span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>df_test  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_test,  <span class="at">clase =</span> y_test,  <span class="at">split =</span> <span class="st">"Test"</span>)</span>
<span id="cb44-50"><a href="#cb44-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-51"><a href="#cb44-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Paleta (ajusta si hay &gt;2 clases)</span></span>
<span id="cb44-52"><a href="#cb44-52" aria-hidden="true" tabindex="-1"></a>pal_cls  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FF0000"</span>, <span class="st">"#00ffff"</span>)           <span class="co"># puntos (clases)</span></span>
<span id="cb44-53"><a href="#cb44-53" aria-hidden="true" tabindex="-1"></a>pal_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FFAAAA"</span>, <span class="st">"#b3ffff"</span>)           <span class="co"># fondo (clases)</span></span>
<span id="cb44-54"><a href="#cb44-54" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pal_cls)  <span class="ot">&lt;-</span> <span class="fu">levels</span>(y_train)</span>
<span id="cb44-55"><a href="#cb44-55" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pal_fill) <span class="ot">&lt;-</span> <span class="fu">levels</span>(y_train)</span>
<span id="cb44-56"><a href="#cb44-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-57"><a href="#cb44-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Plot: fondo (grid) + puntos (train/test)</span></span>
<span id="cb44-58"><a href="#cb44-58" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-59"><a href="#cb44-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> grid, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">fill =</span> pred), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb44-60"><a href="#cb44-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_fill, <span class="at">name =</span> <span class="st">"Clase (fondo)"</span>) <span class="sc">+</span></span>
<span id="cb44-61"><a href="#cb44-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_train, <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">1.8</span>, <span class="at">stroke =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb44-62"><a href="#cb44-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_test,  <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">stroke =</span> .<span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb44-63"><a href="#cb44-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_cls, <span class="at">name =</span> <span class="st">"Clase (puntos)"</span>) <span class="sc">+</span></span>
<span id="cb44-64"><a href="#cb44-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-65"><a href="#cb44-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">sprintf</span>(<span class="st">"Frontera kNN en plano PCA (k=%d, weights='distance')"</span>, k),</span>
<span id="cb44-66"><a href="#cb44-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC1"</span>, <span class="at">y =</span> <span class="st">"PC2"</span></span>
<span id="cb44-67"><a href="#cb44-67" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb44-68"><a href="#cb44-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max), <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb44-69"><a href="#cb44-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-70"><a href="#cb44-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/grafico_pca_modelo-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="fu">predict</span>(entrenamiento, <span class="at">newdata =</span> X_testC), y_testC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  No Yes
       No  555  89
       Yes   9  10
                                          
               Accuracy : 0.8522          
                 95% CI : (0.8229, 0.8783)
    No Information Rate : 0.8507          
    P-Value [Acc &gt; NIR] : 0.4833          
                                          
                  Kappa : 0.1275          
                                          
 Mcnemar's Test P-Value : 1.461e-15       
                                          
            Sensitivity : 0.9840          
            Specificity : 0.1010          
         Pos Pred Value : 0.8618          
         Neg Pred Value : 0.5263          
             Prevalence : 0.8507          
         Detection Rate : 0.8371          
   Detection Prevalence : 0.9713          
      Balanced Accuracy : 0.5425          
                                          
       'Positive' Class : No              
                                          </code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear matriz de confusión como tabla</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>conf_tbl <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Predicted =</span> <span class="fu">predict</span>(entrenamiento, <span class="at">newdata =</span> X_testC), <span class="at">Actual =</span> y_testC)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir a data.frame para ggplot</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>conf_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(conf_tbl)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(conf_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Predicted"</span>, <span class="st">"Actual"</span>, <span class="st">"Freq"</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización con ggplot2</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(conf_df, <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted, <span class="at">fill =</span> Freq)) <span class="sc">+</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Freq), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#f7fcf0"</span>, <span class="at">high =</span> <span class="st">"#084081"</span>) <span class="sc">+</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Matriz de confusión"</span>, <span class="at">x =</span> <span class="st">"Valor real"</span>, <span class="at">y =</span> <span class="st">"Predicción"</span>) <span class="sc">+</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/confusion_matrix_ggplot2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Si X_trainC incluye la columna 'Response', separamos:</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     (si ya la tienes separada, omite estas dos líneas y usa tus objetos)</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>y_trainC <span class="ot">&lt;-</span> <span class="fu">factor</span>(X_trainC<span class="sc">$</span>Response)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>X_train_num <span class="ot">&lt;-</span> X_trainC[, <span class="fu">setdiff</span>(<span class="fu">names</span>(X_trainC), <span class="st">"Response"</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegura que los predictores son numéricos</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>X_train_num[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X_train_num, <span class="cf">function</span>(col) <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(col)))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Preprocesado SOLO sobre predictores (center, scale, pca=2)</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>preproc <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(X_train_num, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>, <span class="st">"pca"</span>), <span class="at">pcaComp =</span> <span class="dv">2</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>Z_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_train_num)  <span class="co"># tendrá columnas PC1 y PC2</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Prepara también el test de forma consistente ---</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Si X_testC tiene 'Response', sepárala:</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"Response"</span> <span class="sc">%in%</span> <span class="fu">names</span>(X_testC)) {</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>  y_testC  <span class="ot">&lt;-</span> <span class="fu">factor</span>(X_testC<span class="sc">$</span>Response, <span class="at">levels =</span> <span class="fu">levels</span>(y_trainC))</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  X_test_num <span class="ot">&lt;-</span> X_testC[, <span class="fu">setdiff</span>(<span class="fu">names</span>(X_testC), <span class="st">"Response"</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># si ya tienes y_testC aparte:</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>  X_test_num <span class="ot">&lt;-</span> X_testC</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>  y_testC    <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_testC, <span class="at">levels =</span> <span class="fu">levels</span>(y_trainC))</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>X_test_num[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X_test_num, <span class="cf">function</span>(col) <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(col)))</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>Z_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_test_num)</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Control de entrenamiento (CV estratificada)</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>)</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Entrenar kNN en el espacio PCA</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>modelo_knn <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> Z_train,</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_trainC,</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> k),</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> ctrl,</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Accuracy"</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Grid en el plano PCA (rango del TRAIN)</span></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>x_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train<span class="sc">$</span>PC1) <span class="sc">-</span> <span class="dv">1</span>; x_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train<span class="sc">$</span>PC1) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>y_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train<span class="sc">$</span>PC2) <span class="sc">-</span> <span class="dv">1</span>; y_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train<span class="sc">$</span>PC2) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC1 =</span> <span class="fu">seq</span>(x_min, x_max, <span class="at">by =</span> h),</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC2 =</span> <span class="fu">seq</span>(y_min, y_max, <span class="at">by =</span> h)</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Predicción del fondo en el grid</span></span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_knn, <span class="at">newdata =</span> grid)</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Data frames para puntos</span></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_train, <span class="at">clase =</span> y_trainC, <span class="at">split =</span> <span class="st">"Train"</span>)</span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>df_test  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_test,  <span class="at">clase =</span> y_testC,  <span class="at">split =</span> <span class="st">"Test"</span>)</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Paletas</span></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>pal_cls  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FF0000"</span>, <span class="st">"#00ffff"</span>)</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>pal_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FFAAAA"</span>, <span class="st">"#b3ffff"</span>)</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pal_cls)  <span class="ot">&lt;-</span> <span class="fu">levels</span>(y_trainC)</span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pal_fill) <span class="ot">&lt;-</span> <span class="fu">levels</span>(y_trainC)</span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 7) Plot</span></span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> grid, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">fill =</span> pred), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_fill, <span class="at">name =</span> <span class="st">"Clase (fondo)"</span>) <span class="sc">+</span></span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_train, <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">1.8</span>, <span class="at">stroke =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_test,  <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">stroke =</span> .<span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_cls, <span class="at">name =</span> <span class="st">"Clase (puntos)"</span>) <span class="sc">+</span></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">sprintf</span>(<span class="st">"Frontera kNN en plano PCA (k=%d)"</span>, k),</span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC1"</span>, <span class="at">y =</span> <span class="st">"PC2"</span></span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max), <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/grafico_pca_caret-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Model accuracy score: </span><span class="sc">{0:0.4f}</span><span class="st">'</span>. <span class="bu">format</span>(accuracy_score(y_testPy, y_predPy)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model accuracy score: 0.8571</code></pre>
</div>
</div>
<section id="estudio-del-sobreajuste" class="level4" data-number="2.1.7">
<h4 data-number="2.1.7" class="anchored" data-anchor-id="estudio-del-sobreajuste"><span class="header-section-number">2.1.7</span> Estudio del sobreajuste</h4>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Training set score: </span><span class="sc">{:.4f}</span><span class="st">'</span>.<span class="bu">format</span>(knn.score(X_trainPy, y_trainPy)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training set score: 0.8478</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test set score: </span><span class="sc">{:.4f}</span><span class="st">'</span>.<span class="bu">format</span>(knn.score(X_testPy, y_testPy)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Test set score: 0.8571</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns <span class="co"># for data visualization</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize confusion matrix with seaborn heatmap</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>confMatrix <span class="op">=</span> confusion_matrix(y_testPy, y_predPy)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>cm_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confMatrix, columns<span class="op">=</span>[<span class="st">'Actual Positive:1'</span>, <span class="st">'Actual Negative:0'</span>], index<span class="op">=</span>[<span class="st">'Predict Positive:1'</span>, <span class="st">'Predict Negative:0'</span>])</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'YlGnBu'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/heatmap_matriz_confusion_python-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_testPy, y_predPy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

          No       0.86      1.00      0.92       570
         Yes       0.00      0.00      0.00        95

    accuracy                           0.86       665
   macro avg       0.43      0.50      0.46       665
weighted avg       0.73      0.86      0.79       665</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> ListedColormap</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelEncoder</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Parámetros ====</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>n_neighbors <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> <span class="st">'distance'</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 0) Asegurar tipos correctos ====</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> np.asarray(X_trainPy, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>X_testPy  <span class="op">=</span> np.asarray(X_testPy,  dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>y_trainPy <span class="op">=</span> np.asarray(y_trainPy)</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>y_testPy  <span class="op">=</span> np.asarray(y_testPy)</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Codificar etiquetas a enteros (necesario para c= y pcolormesh)</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> LabelEncoder()</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>y_train_num <span class="op">=</span> le.fit_transform(y_trainPy)</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>y_test_num  <span class="op">=</span> le.transform(y_testPy)</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 1) Estandarizar con medias/SD de train + PCA en train ====</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_trainPy)</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>X_test_scaled  <span class="op">=</span> scaler.transform(X_testPy)</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>Z_train <span class="op">=</span> pca.fit_transform(X_train_scaled).astype(<span class="bu">float</span>)   <span class="co"># coords PCA train</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="op">=</span> pca.transform(X_test_scaled).astype(<span class="bu">float</span>)        <span class="co"># coords PCA test</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 2) Entrenar KNN en el espacio PCA (train) ====</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span>n_neighbors, weights<span class="op">=</span>weights)</span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>clf.fit(Z_train, y_train_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-3 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsClassifier(weights='distance')</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>KNeighborsClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.neighbors.KNeighborsClassifier.html">?<span>Documentation for KNeighborsClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="default odd">
<td><em></em></td>
<td class="param">n_neighbors&nbsp;</td>
<td class="value">5</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">weights&nbsp;</td>
<td class="value">'distance'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">algorithm&nbsp;</td>
<td class="value">'auto'</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">leaf_size&nbsp;</td>
<td class="value">30</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">p&nbsp;</td>
<td class="value">2</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">metric&nbsp;</td>
<td class="value">'minkowski'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">metric_params&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 3) Mallado en el plano PCA (usando rango de TRAIN para coherencia) ====</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>x_min, x_max <span class="op">=</span> Z_train[:, <span class="dv">0</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, Z_train[:, <span class="dv">0</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>y_min, y_max <span class="op">=</span> Z_train[:, <span class="dv">1</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, Z_train[:, <span class="dv">1</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>xx, yy <span class="op">=</span> np.meshgrid(np.arange(x_min, x_max, h),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                     np.arange(y_min, y_max, h))</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>Z_grid_pred_num <span class="op">=</span> clf.predict(np.c_[xx.ravel(), yy.ravel()]).reshape(xx.shape)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 4) Paletas (binario por tus colores; amplía si hay &gt;2 clases) ====</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>cmap_light <span class="op">=</span> ListedColormap([<span class="st">'#FFAAAA'</span>, <span class="st">'#b3ffff'</span>])</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>cmap_bold  <span class="op">=</span> ListedColormap([<span class="st">'#FF0000'</span>, <span class="st">'#00ffff'</span>])</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 5) Plot fondo + puntos ====</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>plt.pcolormesh(xx, yy, Z_grid_pred_num, cmap<span class="op">=</span>cmap_light, shading<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Train</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>plt.scatter(Z_train[:, <span class="dv">0</span>], Z_train[:, <span class="dv">1</span>], c<span class="op">=</span>y_train_num, cmap<span class="op">=</span>cmap_bold,</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>            edgecolor<span class="op">=</span><span class="st">'k'</span>, s<span class="op">=</span><span class="dv">25</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Train'</span>)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>plt.scatter(Z_test[:, <span class="dv">0</span>],  Z_test[:, <span class="dv">1</span>],  c<span class="op">=</span>y_test_num,  cmap<span class="op">=</span>cmap_bold,</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>            edgecolor<span class="op">=</span><span class="st">'k'</span>, s<span class="op">=</span><span class="dv">35</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Test'</span>)</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>plt.xlim(xx.<span class="bu">min</span>(), xx.<span class="bu">max</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(-6.339168687276463, 7.340831312723245)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>plt.ylim(yy.<span class="bu">min</span>(), yy.<span class="bu">max</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(-4.743849161138547, 5.6961508388612305)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'PC1'</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'PC2'</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Frontera KNN en plano PCA (k=</span><span class="sc">{</span>n_neighbors<span class="sc">}</span><span class="ss">, weights='</span><span class="sc">{</span>weights<span class="sc">}</span><span class="ss">')"</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Leyenda de clases con nombres originales</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> <span class="bu">list</span>(le.classes_)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#FF0000'</span>, <span class="st">'#00ffff'</span>]  <span class="co"># ajusta si hay más clases</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> [mpatches.Patch(color<span class="op">=</span>palette[i <span class="op">%</span> <span class="bu">len</span>(palette)], label<span class="op">=</span><span class="bu">str</span>(lbl))</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>           <span class="cf">for</span> i, lbl <span class="kw">in</span> <span class="bu">enumerate</span>(classes)]</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>legend_classes <span class="op">=</span> plt.legend(handles<span class="op">=</span>patches, title<span class="op">=</span><span class="st">"Clases"</span>,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>                            loc<span class="op">=</span><span class="st">'upper right'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.32</span>, <span class="fl">1.0</span>))</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>plt.gca().add_artist(legend_classes)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)  <span class="co"># leyenda Train/Test</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/grafico_clasificacion_python-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</div>
</div>
</div>
</section>
</section>
<section id="knn-regresor" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="knn-regresor"><span class="header-section-number">2.2</span> KNN Regresor</h3>
<section id="definimos-los-conjuntos-de-datos-1" class="level4" data-number="2.2.1">
<h4 data-number="2.2.1" class="anchored" data-anchor-id="definimos-los-conjuntos-de-datos-1"><span class="header-section-number">2.2.1</span> Definimos los conjuntos de datos</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">R: packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FNN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos), <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>)]</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> datos[default_idx, ]; test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> train[, <span class="sc">-</span><span class="dv">6</span>]; X_test <span class="ot">&lt;-</span> test[, <span class="sc">-</span><span class="dv">6</span>]</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> train[, <span class="dv">6</span>]; y_test <span class="ot">&lt;-</span> test[, <span class="dv">6</span>]</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos todas las columnas en numéricas para que se pueda utilizar el algoritmo</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co"># de KNN</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(X_train, as.numeric))</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(X_test, as.numeric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(datos<span class="sc">$</span>Recency, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>X_trainC <span class="ot">&lt;-</span> datos[default_idx, ]</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>y_testC <span class="ot">&lt;-</span> X_testC[, <span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> datos_py.drop([<span class="st">"Recency"</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> datos_py[<span class="st">'Recency'</span>]</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>X_trainPy, X_testPy, y_trainPy, y_testPy <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.3</span>, random_state <span class="op">=</span> <span class="dv">1994</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="co"># y para regresión debe ser numérico:</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.asarray(y_trainPy, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>y_test  <span class="op">=</span> np.asarray(y_testPy,  dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Detecta tipos</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> X_trainPy.select_dtypes(include<span class="op">=</span>[np.number]).columns.tolist()</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> X_trainPy.select_dtypes(exclude<span class="op">=</span>[np.number]).columns.tolist()</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocesador: escala numéricas y one-hot en categóricas</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>preprocess <span class="op">=</span> ColumnTransformer(</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"num"</span>, StandardScaler(), num_cols),</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"cat"</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>, sparse_output<span class="op">=</span><span class="va">False</span>), cat_cols),</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforma los datos usando el preprocesador ya ajustado</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> preprocess.fit_transform(X_trainPy)</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>X_testPy  <span class="op">=</span> preprocess.transform(X_testPy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="entrenamiento-del-modelo-1" class="level4" data-number="2.2.2">
<h4 data-number="2.2.2" class="anchored" data-anchor-id="entrenamiento-del-modelo-1"><span class="header-section-number">2.2.2</span> Entrenamiento del modelo</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">R: packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">knn.reg</span>(<span class="at">train =</span> X_train, <span class="at">test =</span> X_test, <span class="at">y =</span> y_train, <span class="at">k =</span> <span class="dv">1</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$call
knn.reg(train = X_train, test = X_test, y = y_train, k = 1)

$k
[1] 1

$n
[1] 665

$pred
  [1] 171  14 102  32 469  14  38  67  64 171   2  43 746 217  17  69 818 333
 [19]   1 222 223  11  22 711  42 483  38   3  31 300  44  81  21  50  45 319
 [37] 352  31  42  62  24  24 115 300   6 117   8 223  16   5 186  90  13 168
 [55]  35   6  56   5  40   4 345 300  61 194  38 717 226  58  58   5  24  30
 [73] 168  27 145 689 107  67  16  50  44  70 100  21  46  92 431 178 570 161
 [91] 292   5  10  99  26 348  71  50 597  26 252  18   7  13  13 132  21 694
[109]  30  24  17  24   8   8 141  14   8  14 175 115 161  13   3  69 320 185
[127] 215  13  16  13  63 128 189  24 860  39 417  97   2 689  13   4  26 194
[145] 199 364   4 860 215 195 119 507  73  27 142   5  28  11 711  75 172  92
[163]  10  12 267 929  12   6   3 101  65  22 161 129 129   3  30   2 561 129
[181]  29  47 108  92  11   2 384  83  11 249  46  44  24 217 294  18 212   8
[199]   8 128   2 178 501 127 132 119 413 559  11 704 843  50  46 137  22 137
[217]   3  35  10   4   7  69 929  11  19  10  92   7  31 568  47 243 424 689
[235]   8  14 130 212  31  15 420 395  40  49 706  50 107 142 108 333  50   7
[253]   8  22  18 132  50 535   8   6 226   8  14   5 275  83 119 119   5 845
[271]  23  57  17   6  27  21  59 154   4   5  40 746 746  39  43   5 204 295
[289]  13 264 132  83 107 160   4   5  17  81 205  16   6 305 305 845 107  18
[307]  92  65 238  18 253 169  18 194 292  50  15  64   2 100 100  85 746  98
[325]  11  32  46  29  81 317 259   8   3  10  46  84  18 237  10  13  29  75
[343]  29 639  17  27  60  89  18  10 189 123  11  51 864   4   7  29   7  16
[361]   3  29 594  17  29 445   3  27  17 206 913  97 377  22   9  21  84  11
[379]  16 149  10  10   4  51 238 238 345 171  30  76  16 215   5  13 493 403
[397] 128 107  21 444 756 104 104 345 345  57  27  49 298 352  12 131 216   7
[415]  20 154  28 217 160  10  13  14  31  44 403 403 128 137  64 294  14 925
[433]  74 790  19   7   5 590 590  33 142 217   5 101  93 100 180   8  46  93
[451]  15   1   6 247  64   3 140  93   8  10  21 257 697  19  72  15  14 109
[469]  93 124   6 108 462 568  83  10  29 160   6 465  74  14  14  66  71   7
[487] 756  20 567  85 183  12  76 112 690 168 179 140  56   5  26 309 128  11
[505] 137  13  15  11  54  54  16 151  24 387 133   9  16  27  30 324 287   7
[523]  12 170  15  12  24 430  30  24 114 447 129  25  25  28 239  92   7  18
[541]   5 612 154  10  22 168  73 368  15  11   5 253  76 287 112 217 133  19
[559]   3  60 329   7  25 815  73 487  14 135  15   9  19   2 264  63  63 936
[577]  16  79 359  88 415  65 792 387 449  11  12 278 221  10 534 428  18  19
[595]  63   2  11 213  17 387  24  48 159   7   7   3  60  19 430  23  19 113
[613]   9  46  54  41  21 500 103  74 597  23 420  39  25   4  14  43 106  33
[631]  55 103  20 363 217  21  19 110   3  15 103  10   5 414  14  14 255  99
[649]  22 159  19   3 838 818  15  11 128 838   6  24 142   3  21 159 500

$residuals
NULL

$PRESS
NULL</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">modelLookup</span>(<span class="st">"knn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  model parameter      label forReg forClass probModel
1   knn         k #Neighbors   TRUE     TRUE      TRUE</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>knn <span class="ot">&lt;-</span> <span class="fu">train</span>(Recency <span class="sc">~</span> ., <span class="at">data =</span> X_trainC, <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">preProc =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>), <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>))</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(knn, <span class="at">highlight =</span> <span class="cn">TRUE</span>) <span class="co"># Alternativamente: plot(knn)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/training_caret_regresion-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and train the KNN regressor</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>knn_regressor <span class="op">=</span> KNeighborsRegressor(n_neighbors <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>knn_regressor.fit(X_trainPy, y_trainPy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-4 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-4 {
  color: var(--sklearn-color-text);
}

#sk-container-id-4 pre {
  padding: 0;
}

#sk-container-id-4 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-4 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-4 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-4 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-4 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-4 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-4 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-4 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-4 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-4 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-4 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-4 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-4 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-4 div.sk-label label.sk-toggleable__label,
#sk-container-id-4 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-4 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-4 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-4 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-4 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-4 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-4 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-4 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-4 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-4 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsRegressor()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>KNeighborsRegressor</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.neighbors.KNeighborsRegressor.html">?<span>Documentation for KNeighborsRegressor</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="default odd">
<td><em></em></td>
<td class="param">n_neighbors&nbsp;</td>
<td class="value">5</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">weights&nbsp;</td>
<td class="value">'uniform'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">algorithm&nbsp;</td>
<td class="value">'auto'</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">leaf_size&nbsp;</td>
<td class="value">30</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">p&nbsp;</td>
<td class="value">2</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">metric&nbsp;</td>
<td class="value">'minkowski'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">metric_params&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="tunning-parameters-selección-del-valor-de-k-1" class="level4" data-number="2.2.3">
<h4 data-number="2.2.3" class="anchored" data-anchor-id="tunning-parameters-selección-del-valor-de-k-1"><span class="header-section-number">2.2.3</span> <strong>Tunning parameters:</strong> Selección del valor de k</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">R: packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">=</span> <span class="cf">function</span>(actual, predicted) {</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">mean</span>((actual <span class="sc">-</span> predicted) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># define helper function for getting knn.reg predictions</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># note: this function is highly specific to this situation and dataset</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>make_knn_pred <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">k =</span> <span class="dv">1</span>, training, predicting, valueTarget) {</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">=</span> FNN<span class="sc">::</span><span class="fu">knn.reg</span>(<span class="at">train =</span> training, </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">test =</span> predicting, </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> valueTarget, <span class="at">k =</span> k)<span class="sc">$</span>pred</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  act  <span class="ot">=</span> predicting<span class="sc">$</span>Recency</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse</span>(<span class="at">predicted =</span> pred, <span class="at">actual =</span> act)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define values of k to evaluate</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">250</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get requested train RMSEs</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>knn_trn_rmse <span class="ot">&lt;-</span> <span class="fu">sapply</span>(k, make_knn_pred, <span class="at">training =</span> X_train, </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">predicting =</span> X_train, </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">valueTarget =</span> y_train)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># determine "best" k</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>best_k <span class="ot">&lt;-</span> k[<span class="fu">which.min</span>(knn_trn_rmse)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>regSummary <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">lev =</span> <span class="cn">NULL</span>, <span class="at">model =</span> <span class="cn">NULL</span>) {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE =</span> <span class="fu">RMSE</span>(data<span class="sc">$</span>pred, data<span class="sc">$</span>obs),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rsquared =</span> <span class="fu">R2</span>(data<span class="sc">$</span>pred, data<span class="sc">$</span>obs),</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE =</span> <span class="fu">MAE</span>(data<span class="sc">$</span>pred, data<span class="sc">$</span>obs)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos un método de remuestreo</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"repeatedcv"</span>,</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">repeats =</span> <span class="dv">5</span>,</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">preProcOptions =</span> <span class="fu">list</span>(<span class="st">"center"</span>),</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> regSummary, </span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>)</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos la red de posibles valores del hiperparámetro</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>hyper_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Se entrena el modelo ajustando el hiperparámetro óptimo</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  Recency <span class="sc">~</span> .,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> X_trainC,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> cv,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> hyper_grid,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"MAPE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co"># for data visualization purposes</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_absolute_percentage_error(y_true, y_pred):</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    y_true, y_pred <span class="op">=</span> np.array(y_true), np.array(y_pred)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evitar divisiones por cero</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> y_true <span class="op">!=</span> <span class="dv">0</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(np.<span class="bu">abs</span>((y_true[mask] <span class="op">-</span> y_pred[mask]) <span class="op">/</span> y_true[mask])) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>k_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">20</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> []</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> k_range:</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    knn <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span>k)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>    knn.fit(X_trainPy, y_trainPy)</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> knn.predict(X_testPy)</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>    mape <span class="op">=</span> mean_absolute_percentage_error(y_testPy, y_pred)</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    scores.append(mape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-5 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-5 {
  color: var(--sklearn-color-text);
}

#sk-container-id-5 pre {
  padding: 0;
}

#sk-container-id-5 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-5 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-5 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-5 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-5 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-5 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-5 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-5 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-5 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-5 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-5 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-5 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-5 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-5 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-5 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-5 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-5 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-5 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-5 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-5 div.sk-label label.sk-toggleable__label,
#sk-container-id-5 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-5 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-5 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-5 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-5 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-5 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-5 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-5 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-5 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-5 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-5 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-5 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-5 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-5" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>KNeighborsRegressor(n_neighbors=19)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" checked=""><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>KNeighborsRegressor</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.neighbors.KNeighborsRegressor.html">?<span>Documentation for KNeighborsRegressor</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">n_neighbors&nbsp;</td>
<td class="value">19</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">weights&nbsp;</td>
<td class="value">'uniform'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">algorithm&nbsp;</td>
<td class="value">'auto'</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">leaf_size&nbsp;</td>
<td class="value">30</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">p&nbsp;</td>
<td class="value">2</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">metric&nbsp;</td>
<td class="value">'minkowski'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">metric_params&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">None</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>plt.plot(k_range, scores, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'k'</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'MAPE (%)'</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Error porcentual medio absoluto vs número de vecinos (k)'</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>([&lt;matplotlib.axis.XTick object at 0x000001A38A98E110&gt;, &lt;matplotlib.axis.XTick object at 0x000001A35A031450&gt;, &lt;matplotlib.axis.XTick object at 0x000001A38A8E88D0&gt;, &lt;matplotlib.axis.XTick object at 0x000001A38A8AFE50&gt;, &lt;matplotlib.axis.XTick object at 0x000001A38A896910&gt;], [Text(0, 0, '0'), Text(5, 0, '5'), Text(10, 0, '10'), Text(15, 0, '15'), Text(20, 0, '20')])</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/entrenamiento_cv_python-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="predicción-de-la-variable-respuesta-1" class="level4" data-number="2.2.4">
<h4 data-number="2.2.4" class="anchored" data-anchor-id="predicción-de-la-variable-respuesta-1"><span class="header-section-number">2.2.4</span> Predicción de la variable respuesta</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">R: packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<p>La própia función que entrena el algoritmo ya devuelve las predicciones del algoritmo de KNN.</p>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(model, <span class="at">newdata =</span> X_testC), <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 53.42667 45.97333 45.33333 45.33333 49.16000 50.50667 42.37333 51.86667
 [9] 41.64474 45.14667</code></pre>
</div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>y_predPy <span class="op">=</span> knn_regressor.predict(X_testPy)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>y_predPy[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>array([59.8, 56.4, 52. , 30.6, 24.6, 64.2, 48.8, 19.8, 56.6, 44. ])</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="naives-bayes-classifier" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="naives-bayes-classifier"><span class="header-section-number">3</span> Naives Bayes (<em>Classifier</em>)</h2>
<section id="definición-de-los-conjuntos-de-datos" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="definición-de-los-conjuntos-de-datos"><span class="header-section-number">3.1</span> Definición de los conjuntos de datos</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R: R Base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>ind_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">16</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos), <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> datos[default_idx, ]; test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> train; </span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train &lt;- train[, -ind_col];</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> test[, <span class="sc">-</span>ind_col]</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> train[, ind_col]; y_test <span class="ot">&lt;-</span> test[, ind_col]</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos todas las columnas en numéricas para que se pueda utilizar el algoritmo</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="co"># de KNN</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train &lt;- data.frame(lapply(X_train, as.numeric))</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test &lt;- data.frame(lapply(X_test, as.numeric))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"caret"</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"naivebayes"</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"reshape"</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>ind_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">16</span>)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(datos<span class="sc">$</span>Response, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>X_trainC <span class="ot">&lt;-</span> datos[default_idx, ]</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>y_testC <span class="ot">&lt;-</span> X_testC[, ind_col]</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> X_testC[, <span class="sc">-</span>ind_col]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelLookup</span>(<span class="st">"naive_bayes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        model parameter                label forReg forClass probModel
1 naive_bayes   laplace   Laplace Correction  FALSE     TRUE      TRUE
2 naive_bayes usekernel    Distribution Type  FALSE     TRUE      TRUE
3 naive_bayes    adjust Bandwidth Adjustment  FALSE     TRUE      TRUE</code></pre>
</div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> datos_py.drop([<span class="st">"Response"</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> datos_py[<span class="st">'Response'</span>]</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>X_trainPy, X_testPy, y_trainPy, y_testPy <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.3</span>, random_state <span class="op">=</span> <span class="dv">1994</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="entrenamiento-del-modelo-2" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="entrenamiento-del-modelo-2"><span class="header-section-number">3.2</span> Entrenamiento del modelo</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>(nb_base <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(Response <span class="sc">~</span> ., <span class="at">data =</span> X_train))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Naive Bayes Classifier for Discrete Predictors

Call:
naiveBayes.default(x = X, y = Y, laplace = laplace)

A-priori probabilities:
Y
       No       Yes 
0.8523533 0.1476467 

Conditional probabilities:
     Kidhome
Y          [,1]      [,2]
  No  0.4349470 0.5383867
  Yes 0.3799127 0.5041390

     Teenhome
Y          [,1]      [,2]
  No  0.5378215 0.5437755
  Yes 0.2969432 0.4857977

     Recency
Y         [,1]     [,2]
  No  51.97731 28.59796
  Yes 34.79476 27.41649

     MntWines
Y         [,1]     [,2]
  No  274.1944 303.7532
  Yes 491.6987 425.0553

     MntFruits
Y         [,1]     [,2]
  No  25.40847 39.46007
  Yes 38.14410 46.63587

     MntMeatProducts
Y         [,1]     [,2]
  No  150.5719 210.0253
  Yes 289.3406 288.9687

     MntFishProducts
Y         [,1]     [,2]
  No  35.83888 53.15100
  Yes 53.18341 64.71829

     MntSweetProducts
Y         [,1]     [,2]
  No  26.44781 40.62991
  Yes 41.91266 50.01554

     MntGoldProds
Y         [,1]     [,2]
  No  41.22617 49.78208
  Yes 58.64192 56.85865

     NumDealsPurchases
Y         [,1]     [,2]
  No  2.274584 1.841840
  Yes 2.305677 2.078084

     NumWebPurchases
Y         [,1]     [,2]
  No  3.925870 2.684626
  Yes 4.982533 2.630731

     NumCatalogPurchases
Y         [,1]     [,2]
  No  2.472769 2.870076
  Yes 4.283843 3.201254

     NumStorePurchases
Y         [,1]     [,2]
  No  5.806354 3.278682
  Yes 6.213974 3.247479

     NumWebVisitsMonth
Y         [,1]     [,2]
  No  5.245083 2.443703
  Yes 5.275109 2.655405

     Edad
Y         [,1]     [,2]
  No  56.27837 12.05355
  Yes 54.92576 12.28602

     Education_Basic
Y            [,1]       [,2]
  No  0.027231467 0.16281882
  Yes 0.008733624 0.09324869

     Education_Graduation
Y          [,1]      [,2]
  No  0.5136157 0.5000037
  Yes 0.4454148 0.4981003

     Education_Master
Y          [,1]      [,2]
  No  0.1641452 0.3705475
  Yes 0.1441048 0.3519653

     Education_PhD
Y          [,1]      [,2]
  No  0.2027231 0.4021801
  Yes 0.3231441 0.4687017

     Marital_Status_Alone
Y             [,1]       [,2]
  No  0.0007564297 0.02750327
  Yes 0.0043668122 0.06608186

     Marital_Status_Divorced
Y           [,1]      [,2]
  No  0.09077156 0.2873927
  Yes 0.15283843 0.3606199

     Marital_Status_Married
Y          [,1]      [,2]
  No  0.4054463 0.4911640
  Yes 0.3100437 0.4635243

     Marital_Status_Single
Y          [,1]      [,2]
  No  0.1891074 0.3917421
  Yes 0.3144105 0.4652977

     Marital_Status_Together
Y          [,1]      [,2]
  No  0.2813918 0.4498484
  Yes 0.1659389 0.3728407

     Marital_Status_Widow
Y           [,1]      [,2]
  No  0.03101362 0.1734201
  Yes 0.04803493 0.2143085

     Marital_Status_YOLO
Y             [,1]       [,2]
  No  0.0007564297 0.02750327
  Yes 0.0000000000 0.00000000

     mes_cliente_2
Y              0          1
  No  0.91527988 0.08472012
  Yes 0.90829694 0.09170306

     mes_cliente_3
Y              0          1
  No  0.90544629 0.09455371
  Yes 0.92576419 0.07423581

     mes_cliente_4
Y              0          1
  No  0.91830560 0.08169440
  Yes 0.91266376 0.08733624

     mes_cliente_5
Y              0          1
  No  0.90922844 0.09077156
  Yes 0.95633188 0.04366812

     mes_cliente_6
Y              0          1
  No  0.91906203 0.08093797
  Yes 0.92576419 0.07423581

     mes_cliente_7
Y              0          1
  No  0.93948563 0.06051437
  Yes 0.93886463 0.06113537

     mes_cliente_8
Y              0          1
  No  0.90771558 0.09228442
  Yes 0.89956332 0.10043668

     mes_cliente_9
Y              0          1
  No  0.93267776 0.06732224
  Yes 0.90829694 0.09170306

     mes_cliente_10
Y              0          1
  No  0.91301059 0.08698941
  Yes 0.86462882 0.13537118

     mes_cliente_11
Y              0          1
  No  0.91981846 0.08018154
  Yes 0.92576419 0.07423581

     mes_cliente_12
Y              0          1
  No  0.90771558 0.09228442
  Yes 0.92576419 0.07423581

     Complain_Yes
Y           [,1]      [,2]
  No  0.01059002 0.1024002
  Yes 0.01310044 0.1139540</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># se fija la semilla aleatoria</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># se entrena el modelo</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(Response <span class="sc">~</span> .,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>X_trainC,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">method=</span><span class="st">"nb"</span>,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">metric=</span><span class="st">"Accuracy"</span>,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">trControl=</span><span class="fu">trainControl</span>(<span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">number =</span> <span class="dv">10</span>))</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="co"># se muestra la salida del modelo</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Naive Bayes 

1553 samples
  38 predictor
   2 classes: 'No', 'Yes' 

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 1397, 1398, 1397, 1397, 1398, 1398, ... 
Resampling results across tuning parameters:

  usekernel  Accuracy  Kappa   
  FALSE           NaN       NaN
   TRUE      0.845491  0.237876

Tuning parameter 'fL' was held constant at a value of 0
Tuning
 parameter 'adjust' was held constant at a value of 1
Accuracy was used to select the optimal model using the largest value.
The final values used for the model were fL = 0, usekernel = TRUE and adjust
 = 1.</code></pre>
</div>
</div>
</div>
<div id="tabset-12-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 0) Asegura DataFrames (ajusta nombres si los tuyos son otros)</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>X_train_df <span class="op">=</span> pd.DataFrame(X_trainPy).copy()</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>X_test_df  <span class="op">=</span> pd.DataFrame(X_testPy).copy()</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.asarray(y_trainPy)   <span class="co"># 'No'/'Yes' OK</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>y_test  <span class="op">=</span> np.asarray(y_testPy)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1) Detecta columnas category (tus mes_cliente_*)</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [c <span class="cf">for</span> c, dt <span class="kw">in</span> X_train_df.dtypes.items() <span class="cf">if</span> <span class="bu">str</span>(dt) <span class="op">==</span> <span class="st">'category'</span>]</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convierte category -&gt; numérico 0/1 (maneja '0'/'1' o niveles raros)</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cat_to_01(s: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pasa a string, mapea '0'-&gt;0, '1'-&gt;1; si hay otros niveles, coerciona a num</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> pd.to_numeric(s.astype(<span class="bu">str</span>).<span class="bu">map</span>({<span class="st">'0'</span>: <span class="st">'0'</span>, <span class="st">'1'</span>: <span class="st">'1'</span>}).fillna(s.astype(<span class="bu">str</span>)),</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>                        errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out.fillna(<span class="dv">0</span>).astype(np.int64)</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df <span class="kw">in</span> (X_train_df, X_test_df):</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cat_cols:</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>        df[c] <span class="op">=</span> cat_to_01(df[c])</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2) Asegura que </span><span class="al">TODO</span><span class="co"> es numérico y ≥0</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a><span class="co"># convierte posibles 'object' residuales a num (si los hubiera)</span></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df <span class="kw">in</span> (X_train_df, X_test_df):</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> df.columns:</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df[c].dtype <span class="op">==</span> <span class="st">'O'</span>:</span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>            df[c] <span class="op">=</span> pd.to_numeric(df[c], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a><span class="co"># rellena NaN con 0</span></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>X_train_df <span class="op">=</span> X_train_df.fillna(<span class="dv">0</span>)</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>X_test_df  <span class="op">=</span> X_test_df.fillna(<span class="dv">0</span>)</span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a><span class="co"># clip a [0, +inf) por si hubiera algún negativo residual</span></span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>X_train_df <span class="op">=</span> X_train_df.clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>X_test_df  <span class="op">=</span> X_test_df.clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3) Alinear columnas </span><span class="al">TEST</span><span class="co"> = columnas TRAIN (mismo orden)</span></span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a>X_test_df <span class="op">=</span> X_test_df.reindex(columns<span class="op">=</span>X_train_df.columns, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-42"><a href="#cb95-42" aria-hidden="true" tabindex="-1"></a><span class="co"># (opcional) comprobaciones útiles</span></span>
<span id="cb95-43"><a href="#cb95-43" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="kw">not</span> X_train_df.isna().<span class="bu">any</span>().<span class="bu">any</span>(), <span class="st">"NaN en train"</span></span>
<span id="cb95-44"><a href="#cb95-44" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="kw">not</span> X_test_df.isna().<span class="bu">any</span>().<span class="bu">any</span>(),  <span class="st">"NaN en test"</span></span>
<span id="cb95-45"><a href="#cb95-45" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (X_train_df.dtypes <span class="op">!=</span> <span class="st">'O'</span>).<span class="bu">all</span>(),   <span class="st">"Quedan object en train"</span></span>
<span id="cb95-46"><a href="#cb95-46" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (X_test_df.dtypes  <span class="op">!=</span> <span class="st">'O'</span>).<span class="bu">all</span>(),   <span class="st">"Quedan object en test"</span></span>
<span id="cb95-47"><a href="#cb95-47" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (X_train_df.values <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>(),     <span class="st">"Negativos en train"</span></span>
<span id="cb95-48"><a href="#cb95-48" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (X_test_df.values  <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>(),     <span class="st">"Negativos en test"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the model</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>naive_bayes <span class="op">=</span> MultinomialNB()</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>naive_bayes_fit <span class="op">=</span> naive_bayes.fit(X_train_df, y_trainPy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="tunning-parameters-selección-de-los-valores-óptimos" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="tunning-parameters-selección-de-los-valores-óptimos"><span class="header-section-number">3.3</span> <em>Tunning parameters</em>: Selección de los valores óptimos</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define tuning grid </span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>nb_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">usekernel =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">laplace =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">adjust =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>))</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>accuracys <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(nb_grid)) {</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  kn <span class="ot">&lt;-</span> nb_grid[i, <span class="st">"usekernel"</span>]</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  lp <span class="ot">&lt;-</span> nb_grid[i, <span class="st">"laplace"</span>]</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>  nb_base <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(Response <span class="sc">~</span> ., <span class="at">data =</span> X_train, <span class="at">laplace =</span> lp, <span class="at">kernel =</span> kn)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>  prediccion <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb_base, X_train)</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>  tabla <span class="ot">&lt;-</span> <span class="fu">table</span>(prediccion, y_train)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(tabla))<span class="sc">/</span><span class="fu">sum</span>(tabla)</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>  accuracys <span class="ot">&lt;-</span> <span class="fu">c</span>(accuracys, accuracy)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define tuning grid </span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>nb_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">usekernel =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">laplace =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">adjust =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>))</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Naive Bayes model with parameter tuning</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2550</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>naive_bayes_via_caret2 <span class="ot">&lt;-</span> <span class="fu">train</span>(Response <span class="sc">~</span> ., </span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> X_trainC, </span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method =</span> <span class="st">"naive_bayes"</span>,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">usepoisson =</span> <span class="cn">TRUE</span>,</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">tuneGrid =</span> nb_grid)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co"># View the selected tuning parameters</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>naive_bayes_via_caret2<span class="sc">$</span>finalModel<span class="sc">$</span>tuneValue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   laplace usekernel adjust
13       0      TRUE   0.75</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the tuning process</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(naive_bayes_via_caret2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/nb_caret_parametrizar-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-13-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV, StratifiedKFold</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB, BernoulliNB, ComplementNB</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Métrica (elige la que te convenga)</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>scorer <span class="op">=</span> <span class="st">"balanced_accuracy"</span>  <span class="co"># o 'balanced_accuracy', 'roc_auc', 'accuracy', etc.</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"clf"</span>, MultinomialNB())  <span class="co"># nombre del paso = 'clf'</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Espacio de búsqueda: probamos 3 NB distintos</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> [</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  {  <span class="co"># MultinomialNB</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf"</span>: [MultinomialNB()],</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__alpha"</span>: [<span class="fl">1e-3</span>, <span class="fl">1e-2</span>, <span class="fl">1e-1</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>],</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__fit_prior"</span>: [<span class="va">True</span>, <span class="va">False</span>],</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>  {  <span class="co"># ComplementNB</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf"</span>: [ComplementNB()],</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__alpha"</span>: [<span class="fl">1e-3</span>, <span class="fl">1e-2</span>, <span class="fl">1e-1</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>],</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__fit_prior"</span>: [<span class="va">True</span>, <span class="va">False</span>],</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__norm"</span>: [<span class="va">True</span>, <span class="va">False</span>],</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>  {  <span class="co"># BernoulliNB</span></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf"</span>: [BernoulliNB()],</span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__alpha"</span>: [<span class="fl">1e-3</span>, <span class="fl">1e-2</span>, <span class="fl">1e-1</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>],</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(</span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>pipe,</span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>    param_grid<span class="op">=</span>param_grid,</span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">"roc_auc"</span>,</span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span>cv,</span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=</span><span class="dv">1</span>,     <span class="co"># importante en tu entorno</span></span>
<span id="cb101-39"><a href="#cb101-39" aria-hidden="true" tabindex="-1"></a>    refit<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb101-40"><a href="#cb101-40" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb101-41"><a href="#cb101-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb101-42"><a href="#cb101-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-43"><a href="#cb101-43" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train_df, y_trainPy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-6 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-6 {
  color: var(--sklearn-color-text);
}

#sk-container-id-6 pre {
  padding: 0;
}

#sk-container-id-6 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-6 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-6 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-6 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-6 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-6 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-6 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-6 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-6 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-6 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-6 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-6 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-6 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-6 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-6 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-6 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-6 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-6 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-6 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-6 div.sk-label label.sk-toggleable__label,
#sk-container-id-6 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-6 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-6 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-6 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-6 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-6 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-6 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-6 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-6 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-6 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-6 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-6 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-6 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-6" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=5, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[('clf', MultinomialNB())]), n_jobs=1,
             param_grid=[{'clf': [MultinomialNB()],
                          'clf__alpha': [0.001, 0.01, 0.1, 1.0, 2.0],
                          'clf__fit_prior': [True, False]},
                         {'clf': [ComplementNB()],
                          'clf__alpha': [0.001, 0.01, 0.1, 1.0, 2.0],
                          'clf__fit_prior': [True, False],
                          'clf__norm': [True, False]},
                         {'clf': [BernoulliNB()],
                          'clf__alpha': [0.001, 0.01, 0.1, 1.0, 2.0]}],
             scoring='roc_auc', verbose=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>GridSearchCV</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">estimator&nbsp;</td>
<td class="value">Pipeline(step...inomialNB())])</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">param_grid&nbsp;</td>
<td class="value">[{'clf': [MultinomialNB()], 'clf__alpha': [0.001, 0.01, ...], 'clf__fit_prior': [True, False]}, {'clf': [ComplementNB()], 'clf__alpha': [0.001, 0.01, ...], 'clf__fit_prior': [True, False], 'clf__norm': [True, False]}, ...]</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">scoring&nbsp;</td>
<td class="value">'roc_auc'</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">n_jobs&nbsp;</td>
<td class="value">1</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">refit&nbsp;</td>
<td class="value">True</td>
</tr>
<tr class="user-set even">
<td><em></em></td>
<td class="param">cv&nbsp;</td>
<td class="value">StratifiedKFo... shuffle=True)</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">verbose&nbsp;</td>
<td class="value">1</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">pre_dispatch&nbsp;</td>
<td class="value">'2*n_jobs'</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">error_score&nbsp;</td>
<td class="value">nan</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">return_train_score&nbsp;</td>
<td class="value">False</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox"><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>best_estimator_: Pipeline</div></div></label><div class="sk-toggleable__content fitted" data-param-prefix="best_estimator___"></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox"><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>ComplementNB</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.naive_bayes.ComplementNB.html">?<span>Documentation for ComplementNB</span></a></div></label><div class="sk-toggleable__content fitted" data-param-prefix="best_estimator___clf__">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">alpha&nbsp;</td>
<td class="value">2.0</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">force_alpha&nbsp;</td>
<td class="value">True</td>
</tr>
<tr class="default odd">
<td><em></em></td>
<td class="param">fit_prior&nbsp;</td>
<td class="value">True</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">class_prior&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="user-set odd">
<td><em></em></td>
<td class="param">norm&nbsp;</td>
<td class="value">True</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div></div></div></div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best:"</span>, grid.best_estimator_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Best: Pipeline(steps=[('clf', ComplementNB(alpha=2.0, norm=True))])</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Params:"</span>, grid.best_params_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Params: {'clf': ComplementNB(), 'clf__alpha': 2.0, 'clf__fit_prior': True, 'clf__norm': True}</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CV score:"</span>, grid.best_score_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>CV score: 0.7211343106077495</code></pre>
</div>
</div>
</div>
</div>
</div>
</div></section>
<section id="predicción-de-la-variable-respuesta-2" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="predicción-de-la-variable-respuesta-2"><span class="header-section-number">3.4</span> Predicción de la variable respuesta</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R: R base</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-3" role="tab" aria-controls="tabset-14-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(nb_base, X_test, <span class="at">type =</span> <span class="st">"class"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Yes No  No  No  Yes No 
Levels: No Yes</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(nb_base, X_test, <span class="at">type =</span> <span class="st">"raw"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               No        Yes
[1,] 2.226092e-01 0.77739080
[2,] 5.937698e-01 0.40623023
[3,] 6.046064e-01 0.39539356
[4,] 9.384762e-01 0.06152378
[5,] 3.985234e-05 0.99996015
[6,] 8.472974e-01 0.15270257</code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(naive_bayes_via_caret2, X_testC))</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(naive_bayes_via_caret2, X_testC, <span class="at">type =</span> <span class="st">"prob"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-14-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-3-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, balanced_accuracy_score</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>train_predict <span class="op">=</span> naive_bayes_fit.predict(X_train_df)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>test_predict <span class="op">=</span> naive_bayes_fit.predict(X_test_df)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_scores(y_real, predict):</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  ba_train <span class="op">=</span> balanced_accuracy_score(y_real, predict)</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  cm_train <span class="op">=</span> confusion_matrix(y_real, predict)</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ba_train, cm_train </span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_scores(scores):</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="ss">f"Balanced Accuracy: </span><span class="sc">{</span>scores[<span class="dv">0</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">Confussion Matrix:</span><span class="ch">\n</span><span class="ss"> </span><span class="sc">{</span>scores[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>train_scores <span class="op">=</span> get_scores(y_trainPy, train_predict)</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>test_scores <span class="op">=</span> get_scores(y_testPy, test_predict)</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"## Train Scores"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## Train Scores</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(print_scores(train_scores))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced Accuracy: 0.6493724679513846
Confussion Matrix:
 [[966 347]
 [104 134]]</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">## Test Scores"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

## Test Scores</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(print_scores(test_scores))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Balanced Accuracy: 0.6157894736842106
Confussion Matrix:
 [[432 138]
 [ 50  45]]</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="validación-de-la-performance-del-modelo-1" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="validación-de-la-performance-del-modelo-1"><span class="header-section-number">3.5</span> Validación de la <em>performance</em> del modelo</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">R: R base</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>nb_trn_pred <span class="ot">=</span> <span class="fu">predict</span>(nb_base, X_train)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>nb_tst_pred <span class="ot">=</span> <span class="fu">predict</span>(nb_base, X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_class_err</span>(<span class="at">predicted =</span> nb_trn_pred, <span class="at">actual =</span> y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_class_err</span>(<span class="at">predicted =</span> nb_tst_pred, <span class="at">actual =</span> y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">predicted =</span> nb_tst_pred, <span class="at">actual =</span> y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         actual
predicted 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52
      No   0  0  0  3  1  4  4  4  3  9  6  4  6  6 11  3 13 18 11 21 15 15 15
      Yes  1  1  2  2  3  4  3  1  4  2  2  3  6  5  3  5  1  5  5  9 12  7  6
         actual
predicted 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75
      No  18 20 18 15  9  8  8 12  6  6 13  7  8  7  5  8 10 10  7  6  7  8  2
      Yes 11  9  5  6  7  3  8  8 10  5  9  3  4  7  4  5 11  7 11  3  8  5  3
         actual
predicted 76 77 78 79 80 81 82 84 125
      No   3  1  1  3  0  0  0  0   0
      Yes  6  2  3  1  3  3  3  1   1</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_train)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>y_test  <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_test, <span class="at">levels =</span> <span class="fu">levels</span>(y_train))</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Pasar predictores a numérico con dummies (model.matrix)</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co">#    Si X_* ya NO incluyen la respuesta, usa ~ . - 1</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>mm_train <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> X_train)  <span class="co"># matriz numérica</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>mm_test  <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> X_test)</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) PCA en TRAIN (centrado y escalado), proyectar </span><span class="al">TEST</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(mm_train, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>Z_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, <span class="at">newdata =</span> mm_train)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, <span class="at">newdata =</span> mm_test)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Z_train) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PC1"</span>,<span class="st">"PC2"</span>)</span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Z_test)  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PC1"</span>,<span class="st">"PC2"</span>)</span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Naive Bayes (e1071) en el plano PCA</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(<span class="at">x =</span> <span class="fu">as.data.frame</span>(Z_train), <span class="at">y =</span> y_train, <span class="at">laplace =</span> <span class="dv">0</span>)</span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Grid y predicción para pintar la frontera</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a>x_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train[,<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>; x_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train[,<span class="dv">1</span>]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a>y_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train[,<span class="dv">2</span>]) <span class="sc">-</span> <span class="dv">1</span>; y_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train[,<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">PC1 =</span> <span class="fu">seq</span>(x_min, x_max, <span class="at">by =</span> h),</span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">PC2 =</span> <span class="fu">seq</span>(y_min, y_max, <span class="at">by =</span> h))</span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb, <span class="at">newdata =</span> grid)</span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Plot fondo + puntos</span></span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>pal_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="st">"#FFAAAA"</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"#b3ffff"</span>)</span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a>pal_pts  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="st">"#FF0000"</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"#00ffff"</span>)</span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_train, <span class="at">clase =</span> y_train, <span class="at">split =</span> <span class="st">"Train"</span>)</span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a>df_test  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_test,  <span class="at">clase =</span> y_test,  <span class="at">split =</span> <span class="st">"Test"</span>)</span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> grid, <span class="fu">aes</span>(PC1, PC2, <span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_fill, <span class="at">name =</span> <span class="st">"Fondo"</span>) <span class="sc">+</span></span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_train, <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_test,  <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_pts, <span class="at">name =</span> <span class="st">"Puntos"</span>) <span class="sc">+</span></span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max), <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Frontera Naive Bayes (e1071) en plano PCA"</span>, <span class="at">x =</span> <span class="st">"PC1"</span>, <span class="at">y =</span> <span class="st">"PC2"</span>) <span class="sc">+</span></span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="e1071.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">R: Packages <code>caret</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(naive_bayes_via_caret2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrapped (25 reps) Confusion Matrix 

(entries are percentual average cell counts across resamples)
 
          Reference
Prediction   No  Yes
       No  84.1 14.1
       Yes  0.9  1.0
                            
 Accuracy (average) : 0.8509</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">melt</span>(naive_bayes_via_caret2<span class="sc">$</span>resample[,<span class="sc">-</span><span class="dv">4</span>]), <span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> value, <span class="at">fill=</span>variable)) <span class="sc">+</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co"># y como factor</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>y_trainC <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_trainC)</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>y_testC  <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_testC, <span class="at">levels =</span> <span class="fu">levels</span>(y_train))</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Preprocesado: centrar, escalar, PCA=2 (ajustado en train)</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>preproc <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(X_trainC, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>, <span class="st">"pca"</span>), <span class="at">pcaComp =</span> <span class="dv">2</span>)</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>Z_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_trainC)  <span class="co"># PC1, PC2</span></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_testC)</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Entrenar Naive Bayes (klaR) en el espacio PCA (dos predictores)</span></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">summaryFunction =</span> twoClassSummary)</span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>modelo_nb <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> Z_train[, <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>)], <span class="at">y =</span> y_trainC,</span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nb"</span>,                 <span class="co"># klaR::NaiveBayes vía caret</span></span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> ctrl,</span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"ROC"</span>,                <span class="co"># mejor que Accuracy si hay desbalance</span></span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">usekernel =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">fL =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),                <span class="co"># laplace</span></span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjust =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Grid en el plano PCA (rango del TRAIN)</span></span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb132-31"><a href="#cb132-31" aria-hidden="true" tabindex="-1"></a>x_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train<span class="sc">$</span>PC1) <span class="sc">-</span> <span class="dv">1</span>; x_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train<span class="sc">$</span>PC1) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb132-32"><a href="#cb132-32" aria-hidden="true" tabindex="-1"></a>y_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train<span class="sc">$</span>PC2) <span class="sc">-</span> <span class="dv">1</span>; y_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train<span class="sc">$</span>PC2) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb132-33"><a href="#cb132-33" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb132-34"><a href="#cb132-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC1 =</span> <span class="fu">seq</span>(x_min, x_max, <span class="at">by =</span> h),</span>
<span id="cb132-35"><a href="#cb132-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC2 =</span> <span class="fu">seq</span>(y_min, y_max, <span class="at">by =</span> h)</span>
<span id="cb132-36"><a href="#cb132-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb132-37"><a href="#cb132-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-38"><a href="#cb132-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Predicción del modelo en el grid</span></span>
<span id="cb132-39"><a href="#cb132-39" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_nb, <span class="at">newdata =</span> grid)</span>
<span id="cb132-40"><a href="#cb132-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-41"><a href="#cb132-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Plot fondo + puntos</span></span>
<span id="cb132-42"><a href="#cb132-42" aria-hidden="true" tabindex="-1"></a>pal_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="st">"#FFAAAA"</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"#b3ffff"</span>)</span>
<span id="cb132-43"><a href="#cb132-43" aria-hidden="true" tabindex="-1"></a>pal_pts  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="st">"#FF0000"</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"#00ffff"</span>)</span>
<span id="cb132-44"><a href="#cb132-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-45"><a href="#cb132-45" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_train, <span class="at">clase =</span> y_trainC, <span class="at">split =</span> <span class="st">"Train"</span>)</span>
<span id="cb132-46"><a href="#cb132-46" aria-hidden="true" tabindex="-1"></a>df_test  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_test,  <span class="at">clase =</span> y_testC,  <span class="at">split =</span> <span class="st">"Test"</span>)</span>
<span id="cb132-47"><a href="#cb132-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-48"><a href="#cb132-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb132-49"><a href="#cb132-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> grid, <span class="fu">aes</span>(PC1, PC2, <span class="at">fill =</span> pred), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb132-50"><a href="#cb132-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_fill, <span class="at">name =</span> <span class="st">"Fondo"</span>) <span class="sc">+</span></span>
<span id="cb132-51"><a href="#cb132-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_train, <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb132-52"><a href="#cb132-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_test,  <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb132-53"><a href="#cb132-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_pts, <span class="at">name =</span> <span class="st">"Puntos"</span>) <span class="sc">+</span></span>
<span id="cb132-54"><a href="#cb132-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max), <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb132-55"><a href="#cb132-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Frontera Naive Bayes (caret::nb) en plano PCA"</span>,</span>
<span id="cb132-56"><a href="#cb132-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"PC1"</span>, <span class="at">y =</span> <span class="st">"PC2"</span>) <span class="sc">+</span></span>
<span id="cb132-57"><a href="#cb132-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb132-58"><a href="#cb132-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="caret.jpg" width="647" height="389"></p>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_testPy, test_predict))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

          No       0.90      0.76      0.82       570
         Yes       0.25      0.47      0.32        95

    accuracy                           0.72       665
   macro avg       0.57      0.62      0.57       665
weighted avg       0.80      0.72      0.75       665</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> ListedColormap</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelEncoder</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> GaussianNB  <span class="co"># &lt;&lt; cambio clave</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Parámetros ====</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 0) Tipos correctos ====</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> np.asarray(X_trainPy, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>X_testPy  <span class="op">=</span> np.asarray(X_testPy,  dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>y_trainPy <span class="op">=</span> np.asarray(y_trainPy)</span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>y_testPy  <span class="op">=</span> np.asarray(y_testPy)</span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Codificar etiquetas (para colorear y leyendas)</span></span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> LabelEncoder()</span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>y_train_num <span class="op">=</span> le.fit_transform(y_trainPy)</span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>y_test_num  <span class="op">=</span> le.transform(y_testPy)</span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 1) Estandarizar (fit en train) + PCA (fit en train) ====</span></span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb135-26"><a href="#cb135-26" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_trainPy)</span>
<span id="cb135-27"><a href="#cb135-27" aria-hidden="true" tabindex="-1"></a>X_test_scaled  <span class="op">=</span> scaler.transform(X_testPy)</span>
<span id="cb135-28"><a href="#cb135-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-29"><a href="#cb135-29" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb135-30"><a href="#cb135-30" aria-hidden="true" tabindex="-1"></a>Z_train <span class="op">=</span> pca.fit_transform(X_train_scaled).astype(<span class="bu">float</span>)</span>
<span id="cb135-31"><a href="#cb135-31" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="op">=</span> pca.transform(X_test_scaled).astype(<span class="bu">float</span>)</span>
<span id="cb135-32"><a href="#cb135-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-33"><a href="#cb135-33" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 2) Entrenar Naive Bayes (Gaussian) en el espacio PCA ====</span></span>
<span id="cb135-34"><a href="#cb135-34" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> GaussianNB()</span>
<span id="cb135-35"><a href="#cb135-35" aria-hidden="true" tabindex="-1"></a>clf.fit(Z_train, y_train_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-7 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-7 {
  color: var(--sklearn-color-text);
}

#sk-container-id-7 pre {
  padding: 0;
}

#sk-container-id-7 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-7 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-7 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-7 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-7 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-7 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-7 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-7 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-7 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-7 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-7 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-7 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-7 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-7 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-7 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-7 div.sk-toggleable__content {
  display: none;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-7 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  display: block;
  width: 100%;
  overflow: visible;
}

#sk-container-id-7 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-7 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-7 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-7 div.sk-label label.sk-toggleable__label,
#sk-container-id-7 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-7 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-7 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-7 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-7 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-7 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-7 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-7 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-7 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-7 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-7 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-7 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-7 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}

.estimator-table summary {
    padding: .5rem;
    font-family: monospace;
    cursor: pointer;
}

.estimator-table details[open] {
    padding-left: 0.1rem;
    padding-right: 0.1rem;
    padding-bottom: 0.3rem;
}

.estimator-table .parameters-table {
    margin-left: auto !important;
    margin-right: auto !important;
}

.estimator-table .parameters-table tr:nth-child(odd) {
    background-color: #fff;
}

.estimator-table .parameters-table tr:nth-child(even) {
    background-color: #f6f6f6;
}

.estimator-table .parameters-table tr:hover {
    background-color: #e0e0e0;
}

.estimator-table table td {
    border: 1px solid rgba(106, 105, 104, 0.232);
}

.user-set td {
    color:rgb(255, 94, 0);
    text-align: left;
}

.user-set td.value pre {
    color:rgb(255, 94, 0) !important;
    background-color: transparent !important;
}

.default td {
    color: black;
    text-align: left;
}

.user-set td i,
.default td i {
    color: black;
}

.copy-paste-icon {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
    background-repeat: no-repeat;
    background-size: 14px 14px;
    background-position: 0;
    display: inline-block;
    width: 14px;
    height: 14px;
    cursor: pointer;
}
</style><div id="sk-container-id-7" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GaussianNB()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" checked=""><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>GaussianNB</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.naive_bayes.GaussianNB.html">?<span>Documentation for GaussianNB</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
        <div class="estimator-table">
            <details>
                <summary>Parameters</summary>
                
<table class="parameters-table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="default odd">
<td><em></em></td>
<td class="param">priors&nbsp;</td>
<td class="value">None</td>
</tr>
<tr class="default even">
<td><em></em></td>
<td class="param">var_smoothing&nbsp;</td>
<td class="value">1e-09</td>
</tr>
</tbody>
</table>

            </details>
        </div>
    </div></div></div></div></div><script>function copyToClipboard(text, element) {
    // Get the parameter prefix from the closest toggleable content
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

    const originalStyle = element.style;
    const computedStyle = window.getComputedStyle(element);
    const originalWidth = computedStyle.width;
    const originalHTML = element.innerHTML.replace('Copied!', '');

    navigator.clipboard.writeText(fullParamName)
        .then(() => {
            element.style.width = originalWidth;
            element.style.color = 'green';
            element.innerHTML = "Copied!";

            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        })
        .catch(err => {
            console.error('Failed to copy:', err);
            element.style.color = 'red';
            element.innerHTML = "Failed!";
            setTimeout(() => {
                element.innerHTML = originalHTML;
                element.style = originalStyle;
            }, 2000);
        });
    return false;
}

document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
    const toggleableContent = element.closest('.sk-toggleable__content');
    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
    const paramName = element.parentElement.nextElementSibling.textContent.trim();
    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

    element.setAttribute('title', fullParamName);
});
</script>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 3) Mallado y predicción para el fondo ====</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>x_min, x_max <span class="op">=</span> Z_train[:, <span class="dv">0</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, Z_train[:, <span class="dv">0</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>y_min, y_max <span class="op">=</span> Z_train[:, <span class="dv">1</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, Z_train[:, <span class="dv">1</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>xx, yy <span class="op">=</span> np.meshgrid(np.arange(x_min, x_max, h),</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>                     np.arange(y_min, y_max, h))</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>Z_grid_pred_num <span class="op">=</span> clf.predict(np.c_[xx.ravel(), yy.ravel()]).reshape(xx.shape)</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 4) Paletas ====</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>cmap_light <span class="op">=</span> ListedColormap([<span class="st">'#FFAAAA'</span>, <span class="st">'#b3ffff'</span>])</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>cmap_bold  <span class="op">=</span> ListedColormap([<span class="st">'#FF0000'</span>,  <span class="st">'#00ffff'</span>])</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 5) Plot ====</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">5</span>))</span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>plt.pcolormesh(xx, yy, Z_grid_pred_num, cmap<span class="op">=</span>cmap_light, shading<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>plt.scatter(Z_train[:, <span class="dv">0</span>], Z_train[:, <span class="dv">1</span>], c<span class="op">=</span>y_train_num, cmap<span class="op">=</span>cmap_bold,</span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>            edgecolor<span class="op">=</span><span class="st">'k'</span>, s<span class="op">=</span><span class="dv">25</span>, alpha<span class="op">=</span><span class="fl">0.85</span>, label<span class="op">=</span><span class="st">'Train'</span>)</span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>plt.scatter(Z_test[:, <span class="dv">0</span>],  Z_test[:, <span class="dv">1</span>],  c<span class="op">=</span>y_test_num,  cmap<span class="op">=</span>cmap_bold,</span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>            edgecolor<span class="op">=</span><span class="st">'k'</span>, s<span class="op">=</span><span class="dv">35</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Test'</span>)</span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a>plt.xlim(xx.<span class="bu">min</span>(), xx.<span class="bu">max</span>())<span class="op">;</span> plt.ylim(yy.<span class="bu">min</span>(), yy.<span class="bu">max</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(-6.3391686872764605, 7.340831312723248)
(-4.7438491611385425, 5.696150838861235)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'PC1'</span>)<span class="op">;</span> plt.ylabel(<span class="st">'PC2'</span>)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Frontera Naive Bayes (Gaussian) en plano PCA"</span>)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Leyenda de clases (nombres originales)</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> <span class="bu">list</span>(le.classes_)</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#FF0000'</span>, <span class="st">'#00ffff'</span>]</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> [mpatches.Patch(color<span class="op">=</span>palette[i <span class="op">%</span> <span class="bu">len</span>(palette)], label<span class="op">=</span><span class="bu">str</span>(lbl))</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>           <span class="cf">for</span> i, lbl <span class="kw">in</span> <span class="bu">enumerate</span>(classes)]</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>legend_classes <span class="op">=</span> plt.legend(handles<span class="op">=</span>patches, title<span class="op">=</span><span class="st">"Clases"</span>,</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>                            loc<span class="op">=</span><span class="st">'upper right'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.32</span>, <span class="fl">1.0</span>))</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>plt.gca().add_artist(legend_classes)</span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)  <span class="co"># Train/Test</span></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="KnnNB_files/figure-html/grafico_clasificacion_python_nb-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="bibliografia" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="bibliografia"><span class="header-section-number">4</span> Bibliografia</h2>
<ul>
<li>https://daviddalpiaz.github.io/r</li>
<li></li>
</ul>


<!-- -->

</section>

<p>Esta web está creada por Dante Conti y Sergi Ramírez, (c) 2025</p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb139" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Machine Learning I"</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "KNN y Naives Bayes"</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Dante Conti, Sergi Ramirez, (c) IDEAI</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.Date())`"</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cerulean</span></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf:</span></span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cerulean</span></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: true</span></span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb139-26"><a href="#cb139-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-27"><a href="#cb139-27" aria-hidden="true" tabindex="-1"></a><span class="fu">## Definición del problema</span></span>
<span id="cb139-28"><a href="#cb139-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-29"><a href="#cb139-29" aria-hidden="true" tabindex="-1"></a><span class="fu">### Contexto</span></span>
<span id="cb139-30"><a href="#cb139-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-31"><a href="#cb139-31" aria-hidden="true" tabindex="-1"></a>Una tienda está planteando la venta final del año. Queremos lanzar una oferta. Será válido sólo para los clientes existentes y la campaña a través de las llamadas telefónicas que se está planificando actualmente para ellos. La dirección considera que la mejor manera de reducir el coste de la campaña es hacer un modelo predictivo que clasifique a los clientes que puedan comprar la oferta.</span>
<span id="cb139-32"><a href="#cb139-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-33"><a href="#cb139-33" aria-hidden="true" tabindex="-1"></a>Las variables que contiene la base de datos son:</span>
<span id="cb139-34"><a href="#cb139-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-35"><a href="#cb139-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Response (target)**: 1 si el cliente aceptó la oferta en la última campaña, 0 en caso contrario</span>
<span id="cb139-36"><a href="#cb139-36" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**ID**: ID único de cada cliente</span>
<span id="cb139-37"><a href="#cb139-37" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Year_Birth** - Edad del cliente</span>
<span id="cb139-38"><a href="#cb139-38" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Complain** - 1 si el cliente presentó una queja en los últimos 2 años</span>
<span id="cb139-39"><a href="#cb139-39" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Dt_Customer** - Fecha de alta del cliente en la empresa</span>
<span id="cb139-40"><a href="#cb139-40" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Education** - Nivel de estudios del cliente</span>
<span id="cb139-41"><a href="#cb139-41" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Marital** - Estado civil del cliente</span>
<span id="cb139-42"><a href="#cb139-42" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Kidhome** - Número de niños pequeños en el hogar del cliente</span>
<span id="cb139-43"><a href="#cb139-43" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Teenhome** - Número de adolescentes en el hogar del cliente</span>
<span id="cb139-44"><a href="#cb139-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Income** - Ingresos anuales del hogar del cliente</span>
<span id="cb139-45"><a href="#cb139-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**MntFishProducts** - Cantidad gastada en productos de pescado en los últimos 2 años</span>
<span id="cb139-46"><a href="#cb139-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**MntMeatProducts** - Cantidad gastada en productos cárnicos en los últimos 2 años</span>
<span id="cb139-47"><a href="#cb139-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**MntFruits** - Cantidad gastada en frutas en los últimos 2 años</span>
<span id="cb139-48"><a href="#cb139-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**MntSweetProducts** - cantidad gastada en productos dulces en los últimos 2 años</span>
<span id="cb139-49"><a href="#cb139-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**MntWines** - cantidad gastada en productos de vino en los últimos 2 años</span>
<span id="cb139-50"><a href="#cb139-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**MntGoldProds** - cantidad gastada en productos de oro en los últimos 2 años</span>
<span id="cb139-51"><a href="#cb139-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**NumDealsPurchases** - número de compras realizadas con descuento</span>
<span id="cb139-52"><a href="#cb139-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**NumCatalogPurchases** - número de compras realizadas por catálogo (comprando productos con envío por correo)</span>
<span id="cb139-53"><a href="#cb139-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**NumStorePurchases** - número de compras realizadas directamente en tiendas</span>
<span id="cb139-54"><a href="#cb139-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**NumWebPurchases** - número de compras realizadas a través del sitio web de la empresa</span>
<span id="cb139-55"><a href="#cb139-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**NumWebVisitsMonth** - número de visitas al sitio web de la empresa en el último mes</span>
<span id="cb139-56"><a href="#cb139-56" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Recency** - número de días desde la última compra</span>
<span id="cb139-57"><a href="#cb139-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-58"><a href="#cb139-58" aria-hidden="true" tabindex="-1"></a><span class="fu">### Objetivo</span></span>
<span id="cb139-59"><a href="#cb139-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-60"><a href="#cb139-60" aria-hidden="true" tabindex="-1"></a>Ls supertienda quiere predecir la probabilidad que el cliente de una respuesta positiva y identificar los diferentes factores que afectan la respuesta del cliente.</span>
<span id="cb139-61"><a href="#cb139-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-62"><a href="#cb139-62" aria-hidden="true" tabindex="-1"></a>Podéis encontrar la base de datos en la siguiente <span class="co">[</span><span class="ot">web</span><span class="co">](https://www.kaggle.com/datasets/ahsan81/superstore-marketing-campaign-dataset)</span></span>
<span id="cb139-63"><a href="#cb139-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-66"><a href="#cb139-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-67"><a href="#cb139-67" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cargar-dataset</span></span>
<span id="cb139-68"><a href="#cb139-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb139-69"><a href="#cb139-69" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-70"><a href="#cb139-70" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-71"><a href="#cb139-71" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-72"><a href="#cb139-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-73"><a href="#cb139-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-74"><a href="#cb139-74" aria-hidden="true" tabindex="-1"></a>path <span class="ot">=</span> <span class="st">"./superstore_data.csv"</span></span>
<span id="cb139-75"><a href="#cb139-75" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(path)</span>
<span id="cb139-76"><a href="#cb139-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-77"><a href="#cb139-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizamos el preprocessing necesario</span></span>
<span id="cb139-78"><a href="#cb139-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-79"><a href="#cb139-79" aria-hidden="true" tabindex="-1"></a><span class="do">## Eliminamos el ID</span></span>
<span id="cb139-80"><a href="#cb139-80" aria-hidden="true" tabindex="-1"></a>datos[, <span class="st">"ID"</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb139-81"><a href="#cb139-81" aria-hidden="true" tabindex="-1"></a>datos[, <span class="st">"Edad"</span>] <span class="ot">&lt;-</span> <span class="dv">2025</span> <span class="sc">-</span> datos[, <span class="st">"Year_Birth"</span>]</span>
<span id="cb139-82"><a href="#cb139-82" aria-hidden="true" tabindex="-1"></a>datos[, <span class="st">"Year_Birth"</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb139-83"><a href="#cb139-83" aria-hidden="true" tabindex="-1"></a>datos[, <span class="st">"mes_cliente"</span>] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(datos[, <span class="st">"Dt_Customer"</span>], <span class="st">"/"</span>))[<span class="fu">c</span>(T, F, F)]</span>
<span id="cb139-84"><a href="#cb139-84" aria-hidden="true" tabindex="-1"></a>datos[, <span class="st">"Dt_Customer"</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb139-85"><a href="#cb139-85" aria-hidden="true" tabindex="-1"></a>datos[, <span class="st">"Response"</span>] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(datos[, <span class="st">"Response"</span>], <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb139-86"><a href="#cb139-86" aria-hidden="true" tabindex="-1"></a>datos[, <span class="st">"Complain"</span>] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(datos[, <span class="st">"Complain"</span>], <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb139-87"><a href="#cb139-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-88"><a href="#cb139-88" aria-hidden="true" tabindex="-1"></a>datos[, <span class="st">"Id"</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb139-89"><a href="#cb139-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-90"><a href="#cb139-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos dummies</span></span>
<span id="cb139-91"><a href="#cb139-91" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fastDummies)</span>
<span id="cb139-92"><a href="#cb139-92" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">dummy_cols</span>(datos,  <span class="at">select_columns =</span> <span class="fu">c</span>(<span class="st">"Education"</span>, <span class="st">"Marital_Status"</span>, </span>
<span id="cb139-93"><a href="#cb139-93" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">"mes_cliente"</span>, <span class="st">"Complain"</span>), <span class="at">remove_first_dummy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-94"><a href="#cb139-94" aria-hidden="true" tabindex="-1"></a>datos[, <span class="fu">c</span>(<span class="st">"Education"</span>, <span class="st">"Marital_Status"</span>, </span>
<span id="cb139-95"><a href="#cb139-95" aria-hidden="true" tabindex="-1"></a>                                               <span class="st">"mes_cliente"</span>, <span class="st">"Complain"</span>)] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb139-96"><a href="#cb139-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-97"><a href="#cb139-97" aria-hidden="true" tabindex="-1"></a>col_cliente <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"mes_cliente_"</span>, <span class="fu">colnames</span>(datos), <span class="at">value =</span> T)</span>
<span id="cb139-98"><a href="#cb139-98" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> col_cliente) {</span>
<span id="cb139-99"><a href="#cb139-99" aria-hidden="true" tabindex="-1"></a>  datos[, col] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(datos[, col])</span>
<span id="cb139-100"><a href="#cb139-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-101"><a href="#cb139-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-102"><a href="#cb139-102" aria-hidden="true" tabindex="-1"></a>naIncome <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(datos<span class="sc">$</span>Income))</span>
<span id="cb139-103"><a href="#cb139-103" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos[<span class="sc">-</span>naIncome, ]</span>
<span id="cb139-104"><a href="#cb139-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-105"><a href="#cb139-105" aria-hidden="true" tabindex="-1"></a>quien <span class="ot">&lt;-</span> <span class="fu">sapply</span>(datos, class)</span>
<span id="cb139-106"><a href="#cb139-106" aria-hidden="true" tabindex="-1"></a>quien <span class="ot">&lt;-</span> <span class="fu">names</span>(quien)[<span class="fu">which</span>(quien <span class="sc">==</span> <span class="st">"character"</span>)]</span>
<span id="cb139-107"><a href="#cb139-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-108"><a href="#cb139-108" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (qu <span class="cf">in</span> quien) {</span>
<span id="cb139-109"><a href="#cb139-109" aria-hidden="true" tabindex="-1"></a>  datos[, qu] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(datos[, qu])</span>
<span id="cb139-110"><a href="#cb139-110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-111"><a href="#cb139-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-112"><a href="#cb139-112" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(datos)</span>
<span id="cb139-113"><a href="#cb139-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-114"><a href="#cb139-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-117"><a href="#cb139-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-118"><a href="#cb139-118" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cargar-dataset-py</span></span>
<span id="cb139-119"><a href="#cb139-119" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb139-120"><a href="#cb139-120" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-121"><a href="#cb139-121" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-122"><a href="#cb139-122" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-123"><a href="#cb139-123" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-124"><a href="#cb139-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-125"><a href="#cb139-125" aria-hidden="true" tabindex="-1"></a>datos_py <span class="op">=</span> r.datos</span>
<span id="cb139-126"><a href="#cb139-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-127"><a href="#cb139-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-128"><a href="#cb139-128" aria-hidden="true" tabindex="-1"></a><span class="fu">## KNN</span></span>
<span id="cb139-129"><a href="#cb139-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-130"><a href="#cb139-130" aria-hidden="true" tabindex="-1"></a><span class="fu">### KNN Classifier</span></span>
<span id="cb139-131"><a href="#cb139-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-132"><a href="#cb139-132" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Definimos los conjuntos de datos</span></span>
<span id="cb139-133"><a href="#cb139-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-134"><a href="#cb139-134" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-135"><a href="#cb139-135" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R Base</span></span>
<span id="cb139-136"><a href="#cb139-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-139"><a href="#cb139-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-140"><a href="#cb139-140" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cargar-librerias-knn-classifier</span></span>
<span id="cb139-141"><a href="#cb139-141" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb139-142"><a href="#cb139-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-143"><a href="#cb139-143" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-144"><a href="#cb139-144" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-145"><a href="#cb139-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-146"><a href="#cb139-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-147"><a href="#cb139-147" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class)</span>
<span id="cb139-148"><a href="#cb139-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-149"><a href="#cb139-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-152"><a href="#cb139-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-153"><a href="#cb139-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: crear-datasets_separados</span></span>
<span id="cb139-154"><a href="#cb139-154" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-155"><a href="#cb139-155" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-156"><a href="#cb139-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-157"><a href="#cb139-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-158"><a href="#cb139-158" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-159"><a href="#cb139-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-160"><a href="#cb139-160" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb139-161"><a href="#cb139-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-162"><a href="#cb139-162" aria-hidden="true" tabindex="-1"></a>ind_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">16</span>)</span>
<span id="cb139-163"><a href="#cb139-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-164"><a href="#cb139-164" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos), <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb139-165"><a href="#cb139-165" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> datos[default_idx, ]; test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb139-166"><a href="#cb139-166" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> train[, <span class="sc">-</span>ind_col]; X_test <span class="ot">&lt;-</span> test[, <span class="sc">-</span>ind_col]</span>
<span id="cb139-167"><a href="#cb139-167" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> train[, ind_col]; y_test <span class="ot">&lt;-</span> test[, ind_col]</span>
<span id="cb139-168"><a href="#cb139-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-169"><a href="#cb139-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos todas las columnas en numéricas para que se pueda utilizar el algoritmo</span></span>
<span id="cb139-170"><a href="#cb139-170" aria-hidden="true" tabindex="-1"></a><span class="co"># de KNN</span></span>
<span id="cb139-171"><a href="#cb139-171" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(X_train, as.numeric))</span>
<span id="cb139-172"><a href="#cb139-172" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(X_test, as.numeric))</span>
<span id="cb139-173"><a href="#cb139-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-174"><a href="#cb139-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-175"><a href="#cb139-175" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-176"><a href="#cb139-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-179"><a href="#cb139-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-180"><a href="#cb139-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: crea_caret</span></span>
<span id="cb139-181"><a href="#cb139-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-182"><a href="#cb139-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-183"><a href="#cb139-183" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-184"><a href="#cb139-184" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-185"><a href="#cb139-185" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-186"><a href="#cb139-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-187"><a href="#cb139-187" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb139-188"><a href="#cb139-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-189"><a href="#cb139-189" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb139-190"><a href="#cb139-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-191"><a href="#cb139-191" aria-hidden="true" tabindex="-1"></a>ind_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">16</span>)</span>
<span id="cb139-192"><a href="#cb139-192" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(datos<span class="sc">$</span>Response, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb139-193"><a href="#cb139-193" aria-hidden="true" tabindex="-1"></a>X_trainC <span class="ot">&lt;-</span> datos[default_idx, ]</span>
<span id="cb139-194"><a href="#cb139-194" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb139-195"><a href="#cb139-195" aria-hidden="true" tabindex="-1"></a>y_testC <span class="ot">&lt;-</span> X_testC[, ind_col]</span>
<span id="cb139-196"><a href="#cb139-196" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> X_testC[, <span class="sc">-</span>ind_col]</span>
<span id="cb139-197"><a href="#cb139-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-198"><a href="#cb139-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-201"><a href="#cb139-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-202"><a href="#cb139-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: modelo_caret</span></span>
<span id="cb139-203"><a href="#cb139-203" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-204"><a href="#cb139-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-205"><a href="#cb139-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-206"><a href="#cb139-206" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-207"><a href="#cb139-207" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-208"><a href="#cb139-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-209"><a href="#cb139-209" aria-hidden="true" tabindex="-1"></a><span class="fu">modelLookup</span>(<span class="st">"knn"</span>)</span>
<span id="cb139-210"><a href="#cb139-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-211"><a href="#cb139-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-212"><a href="#cb139-212" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-213"><a href="#cb139-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-216"><a href="#cb139-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-217"><a href="#cb139-217" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: python_test_train</span></span>
<span id="cb139-218"><a href="#cb139-218" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-219"><a href="#cb139-219" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-220"><a href="#cb139-220" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-221"><a href="#cb139-221" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-222"><a href="#cb139-222" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-223"><a href="#cb139-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-224"><a href="#cb139-224" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb139-225"><a href="#cb139-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-226"><a href="#cb139-226" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> datos_py.drop([<span class="st">"Response"</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb139-227"><a href="#cb139-227" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> datos_py[<span class="st">'Response'</span>]</span>
<span id="cb139-228"><a href="#cb139-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-229"><a href="#cb139-229" aria-hidden="true" tabindex="-1"></a>X_trainPy, X_testPy, y_trainPy, y_testPy <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.3</span>, random_state <span class="op">=</span> <span class="dv">1994</span>)</span>
<span id="cb139-230"><a href="#cb139-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-231"><a href="#cb139-231" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-232"><a href="#cb139-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-233"><a href="#cb139-233" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Escalamos los datos</span></span>
<span id="cb139-234"><a href="#cb139-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-235"><a href="#cb139-235" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-236"><a href="#cb139-236" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R Base</span></span>
<span id="cb139-237"><a href="#cb139-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-240"><a href="#cb139-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-241"><a href="#cb139-241" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: escalamiento_base</span></span>
<span id="cb139-242"><a href="#cb139-242" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-243"><a href="#cb139-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-244"><a href="#cb139-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-245"><a href="#cb139-245" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-246"><a href="#cb139-246" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-247"><a href="#cb139-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-248"><a href="#cb139-248" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb139-249"><a href="#cb139-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-250"><a href="#cb139-250" aria-hidden="true" tabindex="-1"></a><span class="co"># Suponemos que X_train y X_test son data.frames numéricos</span></span>
<span id="cb139-251"><a href="#cb139-251" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X_train)</span>
<span id="cb139-252"><a href="#cb139-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-253"><a href="#cb139-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular medias y desviaciones estándar con X_train</span></span>
<span id="cb139-254"><a href="#cb139-254" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">sapply</span>(X_train, mean)</span>
<span id="cb139-255"><a href="#cb139-255" aria-hidden="true" tabindex="-1"></a>sds <span class="ot">&lt;-</span> <span class="fu">sapply</span>(X_train, sd)</span>
<span id="cb139-256"><a href="#cb139-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-257"><a href="#cb139-257" aria-hidden="true" tabindex="-1"></a><span class="co"># Estandarizar X_train</span></span>
<span id="cb139-258"><a href="#cb139-258" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">scale</span>(X_train, <span class="at">center =</span> means, <span class="at">scale =</span> sds)</span>
<span id="cb139-259"><a href="#cb139-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-260"><a href="#cb139-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar la misma transformación a X_test</span></span>
<span id="cb139-261"><a href="#cb139-261" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">scale</span>(X_test, <span class="at">center =</span> means, <span class="at">scale =</span> sds)</span>
<span id="cb139-262"><a href="#cb139-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-263"><a href="#cb139-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir de nuevo a data.frame</span></span>
<span id="cb139-264"><a href="#cb139-264" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(X_train)</span>
<span id="cb139-265"><a href="#cb139-265" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(X_test)</span>
<span id="cb139-266"><a href="#cb139-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-267"><a href="#cb139-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Mantener nombres de columnas</span></span>
<span id="cb139-268"><a href="#cb139-268" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X_train) <span class="ot">&lt;-</span> cols</span>
<span id="cb139-269"><a href="#cb139-269" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X_test) <span class="ot">&lt;-</span> cols</span>
<span id="cb139-270"><a href="#cb139-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-271"><a href="#cb139-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-272"><a href="#cb139-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-273"><a href="#cb139-273" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-274"><a href="#cb139-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-277"><a href="#cb139-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-278"><a href="#cb139-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: escalamiento_caret</span></span>
<span id="cb139-279"><a href="#cb139-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-280"><a href="#cb139-280" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-281"><a href="#cb139-281" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-282"><a href="#cb139-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-283"><a href="#cb139-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-284"><a href="#cb139-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-285"><a href="#cb139-285" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb139-286"><a href="#cb139-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-287"><a href="#cb139-287" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear preprocesador para centrado y escalado</span></span>
<span id="cb139-288"><a href="#cb139-288" aria-hidden="true" tabindex="-1"></a>preproc <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(X_trainC, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>))</span>
<span id="cb139-289"><a href="#cb139-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-290"><a href="#cb139-290" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicar transformación</span></span>
<span id="cb139-291"><a href="#cb139-291" aria-hidden="true" tabindex="-1"></a>X_trainC <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_trainC)</span>
<span id="cb139-292"><a href="#cb139-292" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_testC)</span>
<span id="cb139-293"><a href="#cb139-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-294"><a href="#cb139-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-295"><a href="#cb139-295" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-296"><a href="#cb139-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-299"><a href="#cb139-299" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-300"><a href="#cb139-300" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: escalamiento_python</span></span>
<span id="cb139-301"><a href="#cb139-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-302"><a href="#cb139-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-303"><a href="#cb139-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-304"><a href="#cb139-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-305"><a href="#cb139-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-306"><a href="#cb139-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-307"><a href="#cb139-307" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> X_trainPy.columns</span>
<span id="cb139-308"><a href="#cb139-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-309"><a href="#cb139-309" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb139-310"><a href="#cb139-310" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb139-311"><a href="#cb139-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-312"><a href="#cb139-312" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb139-313"><a href="#cb139-313" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> scaler.fit_transform(X_trainPy)</span>
<span id="cb139-314"><a href="#cb139-314" aria-hidden="true" tabindex="-1"></a>X_testPy <span class="op">=</span> scaler.transform(X_testPy)</span>
<span id="cb139-315"><a href="#cb139-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-316"><a href="#cb139-316" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> pd.DataFrame(X_trainPy, columns<span class="op">=</span>[cols])</span>
<span id="cb139-317"><a href="#cb139-317" aria-hidden="true" tabindex="-1"></a>X_testPy <span class="op">=</span> pd.DataFrame(X_testPy, columns<span class="op">=</span>[cols])</span>
<span id="cb139-318"><a href="#cb139-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-319"><a href="#cb139-319" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-320"><a href="#cb139-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-321"><a href="#cb139-321" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Entrenamiento del modelo</span></span>
<span id="cb139-322"><a href="#cb139-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-323"><a href="#cb139-323" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-324"><a href="#cb139-324" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-325"><a href="#cb139-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-328"><a href="#cb139-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-329"><a href="#cb139-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: train_knn_base</span></span>
<span id="cb139-330"><a href="#cb139-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-331"><a href="#cb139-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-332"><a href="#cb139-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-333"><a href="#cb139-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-334"><a href="#cb139-334" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-335"><a href="#cb139-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-336"><a href="#cb139-336" aria-hidden="true" tabindex="-1"></a>prediccion <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> X_train, <span class="at">test  =</span> X_test, <span class="at">cl =</span> y_train, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb139-337"><a href="#cb139-337" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediccion)</span>
<span id="cb139-338"><a href="#cb139-338" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-339"><a href="#cb139-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-340"><a href="#cb139-340" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-341"><a href="#cb139-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-344"><a href="#cb139-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-345"><a href="#cb139-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: train_knn_caret</span></span>
<span id="cb139-346"><a href="#cb139-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-347"><a href="#cb139-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-348"><a href="#cb139-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-349"><a href="#cb139-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-350"><a href="#cb139-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-351"><a href="#cb139-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-352"><a href="#cb139-352" aria-hidden="true" tabindex="-1"></a>(entrenamiento <span class="ot">&lt;-</span> <span class="fu">train</span>(Response <span class="sc">~</span> ., <span class="at">data =</span> X_trainC, <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb139-353"><a href="#cb139-353" aria-hidden="true" tabindex="-1"></a>                        <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>),</span>
<span id="cb139-354"><a href="#cb139-354" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># preProcess = c("center", "scale"),</span></span>
<span id="cb139-355"><a href="#cb139-355" aria-hidden="true" tabindex="-1"></a>                        <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">31</span>, <span class="at">by =</span> <span class="dv">2</span>))))</span>
<span id="cb139-356"><a href="#cb139-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-357"><a href="#cb139-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-360"><a href="#cb139-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-361"><a href="#cb139-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: train_knn_caret_verModelo</span></span>
<span id="cb139-362"><a href="#cb139-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-363"><a href="#cb139-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-364"><a href="#cb139-364" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-365"><a href="#cb139-365" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-366"><a href="#cb139-366" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-367"><a href="#cb139-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-368"><a href="#cb139-368" aria-hidden="true" tabindex="-1"></a>entrenamiento<span class="sc">$</span>modelType</span>
<span id="cb139-369"><a href="#cb139-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-370"><a href="#cb139-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-371"><a href="#cb139-371" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-372"><a href="#cb139-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-375"><a href="#cb139-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-376"><a href="#cb139-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: train_knn_python</span></span>
<span id="cb139-377"><a href="#cb139-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-378"><a href="#cb139-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-379"><a href="#cb139-379" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-380"><a href="#cb139-380" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-381"><a href="#cb139-381" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-382"><a href="#cb139-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-383"><a href="#cb139-383" aria-hidden="true" tabindex="-1"></a><span class="co"># import KNeighbors ClaSSifier from sklearn</span></span>
<span id="cb139-384"><a href="#cb139-384" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb139-385"><a href="#cb139-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-386"><a href="#cb139-386" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate the model</span></span>
<span id="cb139-387"><a href="#cb139-387" aria-hidden="true" tabindex="-1"></a>knn <span class="op">=</span> KNeighborsClassifier(n_neighbors <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb139-388"><a href="#cb139-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-389"><a href="#cb139-389" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model to the training set</span></span>
<span id="cb139-390"><a href="#cb139-390" aria-hidden="true" tabindex="-1"></a>knn.fit(X_trainPy, y_trainPy)</span>
<span id="cb139-391"><a href="#cb139-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-392"><a href="#cb139-392" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-393"><a href="#cb139-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-394"><a href="#cb139-394" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Tunning parameters*: Selección del valor de k</span></span>
<span id="cb139-395"><a href="#cb139-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-396"><a href="#cb139-396" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-397"><a href="#cb139-397" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-398"><a href="#cb139-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-401"><a href="#cb139-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-402"><a href="#cb139-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: funcion_calculo_error</span></span>
<span id="cb139-403"><a href="#cb139-403" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb139-404"><a href="#cb139-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-405"><a href="#cb139-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-406"><a href="#cb139-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-407"><a href="#cb139-407" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-408"><a href="#cb139-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-409"><a href="#cb139-409" aria-hidden="true" tabindex="-1"></a>calc_class_err <span class="ot">=</span> <span class="cf">function</span>(actual, predicted) {</span>
<span id="cb139-410"><a href="#cb139-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(actual <span class="sc">!=</span> predicted)</span>
<span id="cb139-411"><a href="#cb139-411" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-412"><a href="#cb139-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-413"><a href="#cb139-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-416"><a href="#cb139-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-417"><a href="#cb139-417" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bucle_calculo_k_base</span></span>
<span id="cb139-418"><a href="#cb139-418" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-419"><a href="#cb139-419" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-420"><a href="#cb139-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-421"><a href="#cb139-421" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-422"><a href="#cb139-422" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-423"><a href="#cb139-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-424"><a href="#cb139-424" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb139-425"><a href="#cb139-425" aria-hidden="true" tabindex="-1"></a>k_to_try <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb139-426"><a href="#cb139-426" aria-hidden="true" tabindex="-1"></a>err_k <span class="ot">=</span> <span class="fu">rep</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">times =</span> <span class="fu">length</span>(k_to_try))</span>
<span id="cb139-427"><a href="#cb139-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-428"><a href="#cb139-428" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(k_to_try)) {</span>
<span id="cb139-429"><a href="#cb139-429" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> X_train, </span>
<span id="cb139-430"><a href="#cb139-430" aria-hidden="true" tabindex="-1"></a>             <span class="at">test  =</span> X_test, </span>
<span id="cb139-431"><a href="#cb139-431" aria-hidden="true" tabindex="-1"></a>             <span class="at">cl    =</span> y_train, </span>
<span id="cb139-432"><a href="#cb139-432" aria-hidden="true" tabindex="-1"></a>             <span class="at">k     =</span> k_to_try[i], </span>
<span id="cb139-433"><a href="#cb139-433" aria-hidden="true" tabindex="-1"></a>             <span class="at">prob =</span> T)</span>
<span id="cb139-434"><a href="#cb139-434" aria-hidden="true" tabindex="-1"></a>  err_k[i] <span class="ot">&lt;-</span> <span class="fu">calc_class_err</span>(y_test, pred)</span>
<span id="cb139-435"><a href="#cb139-435" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-436"><a href="#cb139-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-437"><a href="#cb139-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-440"><a href="#cb139-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-441"><a href="#cb139-441" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: visualizar_movimiento_base</span></span>
<span id="cb139-442"><a href="#cb139-442" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-443"><a href="#cb139-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-444"><a href="#cb139-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-445"><a href="#cb139-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-446"><a href="#cb139-446" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-447"><a href="#cb139-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-448"><a href="#cb139-448" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs choice of k</span></span>
<span id="cb139-449"><a href="#cb139-449" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(err_k, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"dodgerblue"</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb139-450"><a href="#cb139-450" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"k, number of neighbors"</span>, <span class="at">ylab =</span> <span class="st">"classification error"</span>,</span>
<span id="cb139-451"><a href="#cb139-451" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"(Test) Error Rate vs Neighbors"</span>)</span>
<span id="cb139-452"><a href="#cb139-452" aria-hidden="true" tabindex="-1"></a><span class="co"># add line for min error seen</span></span>
<span id="cb139-453"><a href="#cb139-453" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(err_k), <span class="at">col =</span> <span class="st">"darkorange"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb139-454"><a href="#cb139-454" aria-hidden="true" tabindex="-1"></a><span class="co"># add line for minority prevalence in test set</span></span>
<span id="cb139-455"><a href="#cb139-455" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(y_test <span class="sc">==</span> <span class="st">"Yes"</span>), <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb139-456"><a href="#cb139-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-457"><a href="#cb139-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-458"><a href="#cb139-458" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-459"><a href="#cb139-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-462"><a href="#cb139-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-463"><a href="#cb139-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: funcion_mejor_resultados_caret</span></span>
<span id="cb139-464"><a href="#cb139-464" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-465"><a href="#cb139-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-466"><a href="#cb139-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-467"><a href="#cb139-467" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-468"><a href="#cb139-468" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-469"><a href="#cb139-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-470"><a href="#cb139-470" aria-hidden="true" tabindex="-1"></a>get_best_result <span class="ot">=</span> <span class="cf">function</span>(caret_fit) {</span>
<span id="cb139-471"><a href="#cb139-471" aria-hidden="true" tabindex="-1"></a>  best <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rownames</span>(caret_fit<span class="sc">$</span>results) <span class="sc">==</span> <span class="fu">rownames</span>(caret_fit<span class="sc">$</span>bestTune))</span>
<span id="cb139-472"><a href="#cb139-472" aria-hidden="true" tabindex="-1"></a>  best_result <span class="ot">=</span> caret_fit<span class="sc">$</span>results[best, ]</span>
<span id="cb139-473"><a href="#cb139-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(best_result) <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb139-474"><a href="#cb139-474" aria-hidden="true" tabindex="-1"></a>  best_result</span>
<span id="cb139-475"><a href="#cb139-475" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-476"><a href="#cb139-476" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-477"><a href="#cb139-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-480"><a href="#cb139-480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-481"><a href="#cb139-481" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tabla_resultados_caret</span></span>
<span id="cb139-482"><a href="#cb139-482" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-483"><a href="#cb139-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-484"><a href="#cb139-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-485"><a href="#cb139-485" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-486"><a href="#cb139-486" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-487"><a href="#cb139-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-488"><a href="#cb139-488" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(entrenamiento<span class="sc">$</span>results, <span class="dv">5</span>)</span>
<span id="cb139-489"><a href="#cb139-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-490"><a href="#cb139-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-493"><a href="#cb139-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-494"><a href="#cb139-494" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_accuracy_caret</span></span>
<span id="cb139-495"><a href="#cb139-495" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-496"><a href="#cb139-496" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-497"><a href="#cb139-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-498"><a href="#cb139-498" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-499"><a href="#cb139-499" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-500"><a href="#cb139-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-501"><a href="#cb139-501" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(entrenamiento)</span>
<span id="cb139-502"><a href="#cb139-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-503"><a href="#cb139-503" aria-hidden="true" tabindex="-1"></a>tablaResultados <span class="ot">&lt;-</span> entrenamiento<span class="sc">$</span>results</span>
<span id="cb139-504"><a href="#cb139-504" aria-hidden="true" tabindex="-1"></a>tablaResultados<span class="sc">$</span>error <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> tablaResultados<span class="sc">$</span>Accuracy</span>
<span id="cb139-505"><a href="#cb139-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-506"><a href="#cb139-506" aria-hidden="true" tabindex="-1"></a><span class="co"># plot error vs choice of k</span></span>
<span id="cb139-507"><a href="#cb139-507" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tablaResultados<span class="sc">$</span>error, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"dodgerblue"</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb139-508"><a href="#cb139-508" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"k, number of neighbors"</span>, <span class="at">ylab =</span> <span class="st">"classification error"</span>,</span>
<span id="cb139-509"><a href="#cb139-509" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"(Test) Error Rate vs Neighbors"</span>)</span>
<span id="cb139-510"><a href="#cb139-510" aria-hidden="true" tabindex="-1"></a><span class="co"># add line for min error seen</span></span>
<span id="cb139-511"><a href="#cb139-511" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">min</span>(err_k), <span class="at">col =</span> <span class="st">"darkorange"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb139-512"><a href="#cb139-512" aria-hidden="true" tabindex="-1"></a><span class="co"># add line for minority prevalence in test set</span></span>
<span id="cb139-513"><a href="#cb139-513" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(y_test <span class="sc">==</span> <span class="st">"Yes"</span>), <span class="at">col =</span> <span class="st">"grey"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb139-514"><a href="#cb139-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-515"><a href="#cb139-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-516"><a href="#cb139-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-517"><a href="#cb139-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-520"><a href="#cb139-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-521"><a href="#cb139-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mejor_modelo_caret</span></span>
<span id="cb139-522"><a href="#cb139-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-523"><a href="#cb139-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-524"><a href="#cb139-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-525"><a href="#cb139-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-526"><a href="#cb139-526" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-527"><a href="#cb139-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-528"><a href="#cb139-528" aria-hidden="true" tabindex="-1"></a><span class="fu">get_best_result</span>(entrenamiento)</span>
<span id="cb139-529"><a href="#cb139-529" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-530"><a href="#cb139-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-533"><a href="#cb139-533" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-534"><a href="#cb139-534" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mejor_modelo_caret2</span></span>
<span id="cb139-535"><a href="#cb139-535" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-536"><a href="#cb139-536" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-537"><a href="#cb139-537" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-538"><a href="#cb139-538" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-539"><a href="#cb139-539" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-540"><a href="#cb139-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-541"><a href="#cb139-541" aria-hidden="true" tabindex="-1"></a>entrenamiento<span class="sc">$</span>finalModel</span>
<span id="cb139-542"><a href="#cb139-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-543"><a href="#cb139-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-544"><a href="#cb139-544" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-545"><a href="#cb139-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-548"><a href="#cb139-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-549"><a href="#cb139-549" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mejor_modelo_python</span></span>
<span id="cb139-550"><a href="#cb139-550" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-551"><a href="#cb139-551" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-552"><a href="#cb139-552" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-553"><a href="#cb139-553" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-554"><a href="#cb139-554" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-555"><a href="#cb139-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-556"><a href="#cb139-556" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co"># for data visualization purposes</span></span>
<span id="cb139-557"><a href="#cb139-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-558"><a href="#cb139-558" aria-hidden="true" tabindex="-1"></a>k_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">20</span>)</span>
<span id="cb139-559"><a href="#cb139-559" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> []</span>
<span id="cb139-560"><a href="#cb139-560" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> k_range:</span>
<span id="cb139-561"><a href="#cb139-561" aria-hidden="true" tabindex="-1"></a>    knn <span class="op">=</span> KNeighborsClassifier(n_neighbors <span class="op">=</span> k)</span>
<span id="cb139-562"><a href="#cb139-562" aria-hidden="true" tabindex="-1"></a>    knn.fit(X_trainPy, y_trainPy)</span>
<span id="cb139-563"><a href="#cb139-563" aria-hidden="true" tabindex="-1"></a>    scores.append(knn.score(X_testPy, y_testPy))</span>
<span id="cb139-564"><a href="#cb139-564" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb139-565"><a href="#cb139-565" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'k'</span>)</span>
<span id="cb139-566"><a href="#cb139-566" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'accuracy'</span>)</span>
<span id="cb139-567"><a href="#cb139-567" aria-hidden="true" tabindex="-1"></a>plt.scatter(k_range, scores)</span>
<span id="cb139-568"><a href="#cb139-568" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>])</span>
<span id="cb139-569"><a href="#cb139-569" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-570"><a href="#cb139-570" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-571"><a href="#cb139-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-572"><a href="#cb139-572" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Predicción de la variable respuesta</span></span>
<span id="cb139-573"><a href="#cb139-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-574"><a href="#cb139-574" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-575"><a href="#cb139-575" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-576"><a href="#cb139-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-577"><a href="#cb139-577" aria-hidden="true" tabindex="-1"></a>La própia función que entrena el algoritmo ya devuelve las predicciones del algoritmo de KNN.</span>
<span id="cb139-578"><a href="#cb139-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-579"><a href="#cb139-579" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-580"><a href="#cb139-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-583"><a href="#cb139-583" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-584"><a href="#cb139-584" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prediccion_caret_prob</span></span>
<span id="cb139-585"><a href="#cb139-585" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-586"><a href="#cb139-586" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-587"><a href="#cb139-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-588"><a href="#cb139-588" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-589"><a href="#cb139-589" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-590"><a href="#cb139-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-591"><a href="#cb139-591" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(entrenamiento, <span class="at">newdata =</span> X_testC, <span class="at">type =</span> <span class="st">"prob"</span>), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb139-592"><a href="#cb139-592" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-593"><a href="#cb139-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-594"><a href="#cb139-594" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-595"><a href="#cb139-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-596"><a href="#cb139-596" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Predicción de la etiqueta</span></span>
<span id="cb139-597"><a href="#cb139-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-600"><a href="#cb139-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-601"><a href="#cb139-601" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prediccion_python</span></span>
<span id="cb139-602"><a href="#cb139-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-603"><a href="#cb139-603" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-604"><a href="#cb139-604" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-605"><a href="#cb139-605" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-606"><a href="#cb139-606" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-607"><a href="#cb139-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-608"><a href="#cb139-608" aria-hidden="true" tabindex="-1"></a>y_predPy <span class="op">=</span> knn.predict(X_testPy)</span>
<span id="cb139-609"><a href="#cb139-609" aria-hidden="true" tabindex="-1"></a>y_predPy[:<span class="dv">20</span>]</span>
<span id="cb139-610"><a href="#cb139-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-611"><a href="#cb139-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-612"><a href="#cb139-612" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Predicción de pertenecer a cada etiqueta</span></span>
<span id="cb139-613"><a href="#cb139-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-616"><a href="#cb139-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-617"><a href="#cb139-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prediccion_python_prob</span></span>
<span id="cb139-618"><a href="#cb139-618" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-619"><a href="#cb139-619" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-620"><a href="#cb139-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-621"><a href="#cb139-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-622"><a href="#cb139-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-623"><a href="#cb139-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-624"><a href="#cb139-624" aria-hidden="true" tabindex="-1"></a><span class="co"># probability of getting output as 2 - benign cancer</span></span>
<span id="cb139-625"><a href="#cb139-625" aria-hidden="true" tabindex="-1"></a>knn.predict_proba(X_testPy)</span>
<span id="cb139-626"><a href="#cb139-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-627"><a href="#cb139-627" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-628"><a href="#cb139-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-629"><a href="#cb139-629" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Validación de la *performance* del modelo</span></span>
<span id="cb139-630"><a href="#cb139-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-631"><a href="#cb139-631" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-632"><a href="#cb139-632" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-633"><a href="#cb139-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-636"><a href="#cb139-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-637"><a href="#cb139-637" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: funcion_calculo_error2</span></span>
<span id="cb139-638"><a href="#cb139-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-639"><a href="#cb139-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-640"><a href="#cb139-640" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-641"><a href="#cb139-641" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-642"><a href="#cb139-642" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-643"><a href="#cb139-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-644"><a href="#cb139-644" aria-hidden="true" tabindex="-1"></a>calc_class_err <span class="ot">=</span> <span class="cf">function</span>(actual, predicted) {</span>
<span id="cb139-645"><a href="#cb139-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(actual <span class="sc">!=</span> predicted)</span>
<span id="cb139-646"><a href="#cb139-646" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-647"><a href="#cb139-647" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-648"><a href="#cb139-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-651"><a href="#cb139-651" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-652"><a href="#cb139-652" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: aplicar_calculo_error</span></span>
<span id="cb139-653"><a href="#cb139-653" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-654"><a href="#cb139-654" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-655"><a href="#cb139-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-656"><a href="#cb139-656" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-657"><a href="#cb139-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-658"><a href="#cb139-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-659"><a href="#cb139-659" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_class_err</span>(<span class="at">actual    =</span> y_test,</span>
<span id="cb139-660"><a href="#cb139-660" aria-hidden="true" tabindex="-1"></a>               <span class="at">predicted =</span> <span class="fu">knn</span>(<span class="at">train =</span> X_train,</span>
<span id="cb139-661"><a href="#cb139-661" aria-hidden="true" tabindex="-1"></a>                               <span class="at">test  =</span> X_test,</span>
<span id="cb139-662"><a href="#cb139-662" aria-hidden="true" tabindex="-1"></a>                               <span class="at">cl    =</span> y_train,</span>
<span id="cb139-663"><a href="#cb139-663" aria-hidden="true" tabindex="-1"></a>                               <span class="at">k     =</span> <span class="dv">5</span>))</span>
<span id="cb139-664"><a href="#cb139-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-665"><a href="#cb139-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-668"><a href="#cb139-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-669"><a href="#cb139-669" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: extraer_valor_tabla</span></span>
<span id="cb139-670"><a href="#cb139-670" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-671"><a href="#cb139-671" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-672"><a href="#cb139-672" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-673"><a href="#cb139-673" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-674"><a href="#cb139-674" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-675"><a href="#cb139-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-676"><a href="#cb139-676" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">which</span>(err_k <span class="sc">==</span> <span class="fu">min</span>(err_k)))</span>
<span id="cb139-677"><a href="#cb139-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-678"><a href="#cb139-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-681"><a href="#cb139-681" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-682"><a href="#cb139-682" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: matriz_confusion_base</span></span>
<span id="cb139-683"><a href="#cb139-683" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-684"><a href="#cb139-684" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-685"><a href="#cb139-685" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-686"><a href="#cb139-686" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-687"><a href="#cb139-687" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-688"><a href="#cb139-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-689"><a href="#cb139-689" aria-hidden="true" tabindex="-1"></a>predicciones <span class="ot">&lt;-</span> <span class="fu">knn</span>(<span class="at">train =</span> X_train, <span class="at">test =</span> X_test, <span class="at">cl =</span> y_train, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb139-690"><a href="#cb139-690" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predicciones, y_test)</span>
<span id="cb139-691"><a href="#cb139-691" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-692"><a href="#cb139-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-695"><a href="#cb139-695" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-696"><a href="#cb139-696" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_pca_modelo</span></span>
<span id="cb139-697"><a href="#cb139-697" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-698"><a href="#cb139-698" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-699"><a href="#cb139-699" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-700"><a href="#cb139-700" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-701"><a href="#cb139-701" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-702"><a href="#cb139-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-703"><a href="#cb139-703" aria-hidden="true" tabindex="-1"></a><span class="co"># Paquetes</span></span>
<span id="cb139-704"><a href="#cb139-704" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class)      <span class="co"># knn</span></span>
<span id="cb139-705"><a href="#cb139-705" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)    <span class="co"># plotting</span></span>
<span id="cb139-706"><a href="#cb139-706" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)      <span class="co"># %&gt;%, mutate</span></span>
<span id="cb139-707"><a href="#cb139-707" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb139-708"><a href="#cb139-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-709"><a href="#cb139-709" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Datos de entrada esperados ---</span></span>
<span id="cb139-710"><a href="#cb139-710" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train, X_test: data.frames/ matrices numéricas</span></span>
<span id="cb139-711"><a href="#cb139-711" aria-hidden="true" tabindex="-1"></a><span class="co"># y_train, y_test: vector/factor de etiquetas (clases)</span></span>
<span id="cb139-712"><a href="#cb139-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-713"><a href="#cb139-713" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb139-714"><a href="#cb139-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-715"><a href="#cb139-715" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) PCA AJUSTADO EN TRAIN (con centrado y escalado). Proyectamos train y test.</span></span>
<span id="cb139-716"><a href="#cb139-716" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(X_train, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-717"><a href="#cb139-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-718"><a href="#cb139-718" aria-hidden="true" tabindex="-1"></a>Z_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, <span class="at">newdata =</span> X_train)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb139-719"><a href="#cb139-719" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, <span class="at">newdata =</span> X_test)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb139-720"><a href="#cb139-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-721"><a href="#cb139-721" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Z_train) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PC1"</span>,<span class="st">"PC2"</span>)</span>
<span id="cb139-722"><a href="#cb139-722" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Z_test)  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PC1"</span>,<span class="st">"PC2"</span>)</span>
<span id="cb139-723"><a href="#cb139-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-724"><a href="#cb139-724" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Rango para el grid (usamos TRAIN para coherencia)</span></span>
<span id="cb139-725"><a href="#cb139-725" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb139-726"><a href="#cb139-726" aria-hidden="true" tabindex="-1"></a>x_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train[,<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>; x_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train[,<span class="dv">1</span>]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb139-727"><a href="#cb139-727" aria-hidden="true" tabindex="-1"></a>y_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train[,<span class="dv">2</span>]) <span class="sc">-</span> <span class="dv">1</span>; y_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train[,<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb139-728"><a href="#cb139-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-729"><a href="#cb139-729" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb139-730"><a href="#cb139-730" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC1 =</span> <span class="fu">seq</span>(x_min, x_max, <span class="at">by =</span> h),</span>
<span id="cb139-731"><a href="#cb139-731" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC2 =</span> <span class="fu">seq</span>(y_min, y_max, <span class="at">by =</span> h)</span>
<span id="cb139-732"><a href="#cb139-732" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-733"><a href="#cb139-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-734"><a href="#cb139-734" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) kNN en el plano PCA (class::knn no "entrena"; predice dado train/test)</span></span>
<span id="cb139-735"><a href="#cb139-735" aria-hidden="true" tabindex="-1"></a><span class="co">#    Usamos las coordenadas PCA de train como "train", y el grid como "test".</span></span>
<span id="cb139-736"><a href="#cb139-736" aria-hidden="true" tabindex="-1"></a><span class="co">#    Asegura que y_train sea factor.</span></span>
<span id="cb139-737"><a href="#cb139-737" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_train)</span>
<span id="cb139-738"><a href="#cb139-738" aria-hidden="true" tabindex="-1"></a>y_test  <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_test, <span class="at">levels =</span> <span class="fu">levels</span>(y_train))</span>
<span id="cb139-739"><a href="#cb139-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-740"><a href="#cb139-740" aria-hidden="true" tabindex="-1"></a>grid_pred <span class="ot">&lt;-</span> <span class="fu">knn</span>(</span>
<span id="cb139-741"><a href="#cb139-741" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> Z_train,</span>
<span id="cb139-742"><a href="#cb139-742" aria-hidden="true" tabindex="-1"></a>  <span class="at">test  =</span> grid,</span>
<span id="cb139-743"><a href="#cb139-743" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl    =</span> y_train,</span>
<span id="cb139-744"><a href="#cb139-744" aria-hidden="true" tabindex="-1"></a>  <span class="at">k     =</span> k</span>
<span id="cb139-745"><a href="#cb139-745" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-746"><a href="#cb139-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-747"><a href="#cb139-747" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">factor</span>(grid_pred, <span class="at">levels =</span> <span class="fu">levels</span>(y_train))</span>
<span id="cb139-748"><a href="#cb139-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-749"><a href="#cb139-749" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Data frames para puntos</span></span>
<span id="cb139-750"><a href="#cb139-750" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_train, <span class="at">clase =</span> y_train, <span class="at">split =</span> <span class="st">"Train"</span>)</span>
<span id="cb139-751"><a href="#cb139-751" aria-hidden="true" tabindex="-1"></a>df_test  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_test,  <span class="at">clase =</span> y_test,  <span class="at">split =</span> <span class="st">"Test"</span>)</span>
<span id="cb139-752"><a href="#cb139-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-753"><a href="#cb139-753" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Paleta (ajusta si hay &gt;2 clases)</span></span>
<span id="cb139-754"><a href="#cb139-754" aria-hidden="true" tabindex="-1"></a>pal_cls  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FF0000"</span>, <span class="st">"#00ffff"</span>)           <span class="co"># puntos (clases)</span></span>
<span id="cb139-755"><a href="#cb139-755" aria-hidden="true" tabindex="-1"></a>pal_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FFAAAA"</span>, <span class="st">"#b3ffff"</span>)           <span class="co"># fondo (clases)</span></span>
<span id="cb139-756"><a href="#cb139-756" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pal_cls)  <span class="ot">&lt;-</span> <span class="fu">levels</span>(y_train)</span>
<span id="cb139-757"><a href="#cb139-757" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pal_fill) <span class="ot">&lt;-</span> <span class="fu">levels</span>(y_train)</span>
<span id="cb139-758"><a href="#cb139-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-759"><a href="#cb139-759" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Plot: fondo (grid) + puntos (train/test)</span></span>
<span id="cb139-760"><a href="#cb139-760" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb139-761"><a href="#cb139-761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> grid, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">fill =</span> pred), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb139-762"><a href="#cb139-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_fill, <span class="at">name =</span> <span class="st">"Clase (fondo)"</span>) <span class="sc">+</span></span>
<span id="cb139-763"><a href="#cb139-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_train, <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">1.8</span>, <span class="at">stroke =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb139-764"><a href="#cb139-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_test,  <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">stroke =</span> .<span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb139-765"><a href="#cb139-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_cls, <span class="at">name =</span> <span class="st">"Clase (puntos)"</span>) <span class="sc">+</span></span>
<span id="cb139-766"><a href="#cb139-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb139-767"><a href="#cb139-767" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">sprintf</span>(<span class="st">"Frontera kNN en plano PCA (k=%d, weights='distance')"</span>, k),</span>
<span id="cb139-768"><a href="#cb139-768" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC1"</span>, <span class="at">y =</span> <span class="st">"PC2"</span></span>
<span id="cb139-769"><a href="#cb139-769" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb139-770"><a href="#cb139-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max), <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb139-771"><a href="#cb139-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-772"><a href="#cb139-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb139-773"><a href="#cb139-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-774"><a href="#cb139-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-775"><a href="#cb139-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-776"><a href="#cb139-776" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-777"><a href="#cb139-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-780"><a href="#cb139-780" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-781"><a href="#cb139-781" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: aplicar_calculo_error2</span></span>
<span id="cb139-782"><a href="#cb139-782" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-783"><a href="#cb139-783" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-784"><a href="#cb139-784" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-785"><a href="#cb139-785" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-786"><a href="#cb139-786" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-787"><a href="#cb139-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-788"><a href="#cb139-788" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="fu">predict</span>(entrenamiento, <span class="at">newdata =</span> X_testC), y_testC)</span>
<span id="cb139-789"><a href="#cb139-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-790"><a href="#cb139-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-793"><a href="#cb139-793" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-794"><a href="#cb139-794" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: confusion_matrix_ggplot2</span></span>
<span id="cb139-795"><a href="#cb139-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-796"><a href="#cb139-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-797"><a href="#cb139-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-798"><a href="#cb139-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-799"><a href="#cb139-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-800"><a href="#cb139-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-801"><a href="#cb139-801" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb139-802"><a href="#cb139-802" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb139-803"><a href="#cb139-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-804"><a href="#cb139-804" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear matriz de confusión como tabla</span></span>
<span id="cb139-805"><a href="#cb139-805" aria-hidden="true" tabindex="-1"></a>conf_tbl <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Predicted =</span> <span class="fu">predict</span>(entrenamiento, <span class="at">newdata =</span> X_testC), <span class="at">Actual =</span> y_testC)</span>
<span id="cb139-806"><a href="#cb139-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-807"><a href="#cb139-807" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertir a data.frame para ggplot</span></span>
<span id="cb139-808"><a href="#cb139-808" aria-hidden="true" tabindex="-1"></a>conf_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(conf_tbl)</span>
<span id="cb139-809"><a href="#cb139-809" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(conf_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Predicted"</span>, <span class="st">"Actual"</span>, <span class="st">"Freq"</span>)</span>
<span id="cb139-810"><a href="#cb139-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-811"><a href="#cb139-811" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualización con ggplot2</span></span>
<span id="cb139-812"><a href="#cb139-812" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(conf_df, <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted, <span class="at">fill =</span> Freq)) <span class="sc">+</span></span>
<span id="cb139-813"><a href="#cb139-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb139-814"><a href="#cb139-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Freq), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb139-815"><a href="#cb139-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#f7fcf0"</span>, <span class="at">high =</span> <span class="st">"#084081"</span>) <span class="sc">+</span></span>
<span id="cb139-816"><a href="#cb139-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Matriz de confusión"</span>, <span class="at">x =</span> <span class="st">"Valor real"</span>, <span class="at">y =</span> <span class="st">"Predicción"</span>) <span class="sc">+</span></span>
<span id="cb139-817"><a href="#cb139-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb139-818"><a href="#cb139-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-819"><a href="#cb139-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-822"><a href="#cb139-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-823"><a href="#cb139-823" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_pca_caret</span></span>
<span id="cb139-824"><a href="#cb139-824" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-825"><a href="#cb139-825" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-826"><a href="#cb139-826" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-827"><a href="#cb139-827" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-828"><a href="#cb139-828" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-829"><a href="#cb139-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-830"><a href="#cb139-830" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb139-831"><a href="#cb139-831" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb139-832"><a href="#cb139-832" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb139-833"><a href="#cb139-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-834"><a href="#cb139-834" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Si X_trainC incluye la columna 'Response', separamos:</span></span>
<span id="cb139-835"><a href="#cb139-835" aria-hidden="true" tabindex="-1"></a><span class="co">#     (si ya la tienes separada, omite estas dos líneas y usa tus objetos)</span></span>
<span id="cb139-836"><a href="#cb139-836" aria-hidden="true" tabindex="-1"></a>y_trainC <span class="ot">&lt;-</span> <span class="fu">factor</span>(X_trainC<span class="sc">$</span>Response)</span>
<span id="cb139-837"><a href="#cb139-837" aria-hidden="true" tabindex="-1"></a>X_train_num <span class="ot">&lt;-</span> X_trainC[, <span class="fu">setdiff</span>(<span class="fu">names</span>(X_trainC), <span class="st">"Response"</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb139-838"><a href="#cb139-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-839"><a href="#cb139-839" aria-hidden="true" tabindex="-1"></a><span class="co"># Asegura que los predictores son numéricos</span></span>
<span id="cb139-840"><a href="#cb139-840" aria-hidden="true" tabindex="-1"></a>X_train_num[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X_train_num, <span class="cf">function</span>(col) <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(col)))</span>
<span id="cb139-841"><a href="#cb139-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-842"><a href="#cb139-842" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Preprocesado SOLO sobre predictores (center, scale, pca=2)</span></span>
<span id="cb139-843"><a href="#cb139-843" aria-hidden="true" tabindex="-1"></a>preproc <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(X_train_num, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>, <span class="st">"pca"</span>), <span class="at">pcaComp =</span> <span class="dv">2</span>)</span>
<span id="cb139-844"><a href="#cb139-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-845"><a href="#cb139-845" aria-hidden="true" tabindex="-1"></a>Z_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_train_num)  <span class="co"># tendrá columnas PC1 y PC2</span></span>
<span id="cb139-846"><a href="#cb139-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-847"><a href="#cb139-847" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Prepara también el test de forma consistente ---</span></span>
<span id="cb139-848"><a href="#cb139-848" aria-hidden="true" tabindex="-1"></a><span class="co"># Si X_testC tiene 'Response', sepárala:</span></span>
<span id="cb139-849"><a href="#cb139-849" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="st">"Response"</span> <span class="sc">%in%</span> <span class="fu">names</span>(X_testC)) {</span>
<span id="cb139-850"><a href="#cb139-850" aria-hidden="true" tabindex="-1"></a>  y_testC  <span class="ot">&lt;-</span> <span class="fu">factor</span>(X_testC<span class="sc">$</span>Response, <span class="at">levels =</span> <span class="fu">levels</span>(y_trainC))</span>
<span id="cb139-851"><a href="#cb139-851" aria-hidden="true" tabindex="-1"></a>  X_test_num <span class="ot">&lt;-</span> X_testC[, <span class="fu">setdiff</span>(<span class="fu">names</span>(X_testC), <span class="st">"Response"</span>), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb139-852"><a href="#cb139-852" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb139-853"><a href="#cb139-853" aria-hidden="true" tabindex="-1"></a>  <span class="co"># si ya tienes y_testC aparte:</span></span>
<span id="cb139-854"><a href="#cb139-854" aria-hidden="true" tabindex="-1"></a>  X_test_num <span class="ot">&lt;-</span> X_testC</span>
<span id="cb139-855"><a href="#cb139-855" aria-hidden="true" tabindex="-1"></a>  y_testC    <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_testC, <span class="at">levels =</span> <span class="fu">levels</span>(y_trainC))</span>
<span id="cb139-856"><a href="#cb139-856" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-857"><a href="#cb139-857" aria-hidden="true" tabindex="-1"></a>X_test_num[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(X_test_num, <span class="cf">function</span>(col) <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(col)))</span>
<span id="cb139-858"><a href="#cb139-858" aria-hidden="true" tabindex="-1"></a>Z_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_test_num)</span>
<span id="cb139-859"><a href="#cb139-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-860"><a href="#cb139-860" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Control de entrenamiento (CV estratificada)</span></span>
<span id="cb139-861"><a href="#cb139-861" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>)</span>
<span id="cb139-862"><a href="#cb139-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-863"><a href="#cb139-863" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Entrenar kNN en el espacio PCA</span></span>
<span id="cb139-864"><a href="#cb139-864" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb139-865"><a href="#cb139-865" aria-hidden="true" tabindex="-1"></a>modelo_knn <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb139-866"><a href="#cb139-866" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> Z_train,</span>
<span id="cb139-867"><a href="#cb139-867" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_trainC,</span>
<span id="cb139-868"><a href="#cb139-868" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb139-869"><a href="#cb139-869" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> k),</span>
<span id="cb139-870"><a href="#cb139-870" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> ctrl,</span>
<span id="cb139-871"><a href="#cb139-871" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Accuracy"</span></span>
<span id="cb139-872"><a href="#cb139-872" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-873"><a href="#cb139-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-874"><a href="#cb139-874" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Grid en el plano PCA (rango del TRAIN)</span></span>
<span id="cb139-875"><a href="#cb139-875" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb139-876"><a href="#cb139-876" aria-hidden="true" tabindex="-1"></a>x_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train<span class="sc">$</span>PC1) <span class="sc">-</span> <span class="dv">1</span>; x_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train<span class="sc">$</span>PC1) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb139-877"><a href="#cb139-877" aria-hidden="true" tabindex="-1"></a>y_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train<span class="sc">$</span>PC2) <span class="sc">-</span> <span class="dv">1</span>; y_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train<span class="sc">$</span>PC2) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb139-878"><a href="#cb139-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-879"><a href="#cb139-879" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb139-880"><a href="#cb139-880" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC1 =</span> <span class="fu">seq</span>(x_min, x_max, <span class="at">by =</span> h),</span>
<span id="cb139-881"><a href="#cb139-881" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC2 =</span> <span class="fu">seq</span>(y_min, y_max, <span class="at">by =</span> h)</span>
<span id="cb139-882"><a href="#cb139-882" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-883"><a href="#cb139-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-884"><a href="#cb139-884" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Predicción del fondo en el grid</span></span>
<span id="cb139-885"><a href="#cb139-885" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_knn, <span class="at">newdata =</span> grid)</span>
<span id="cb139-886"><a href="#cb139-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-887"><a href="#cb139-887" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Data frames para puntos</span></span>
<span id="cb139-888"><a href="#cb139-888" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_train, <span class="at">clase =</span> y_trainC, <span class="at">split =</span> <span class="st">"Train"</span>)</span>
<span id="cb139-889"><a href="#cb139-889" aria-hidden="true" tabindex="-1"></a>df_test  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_test,  <span class="at">clase =</span> y_testC,  <span class="at">split =</span> <span class="st">"Test"</span>)</span>
<span id="cb139-890"><a href="#cb139-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-891"><a href="#cb139-891" aria-hidden="true" tabindex="-1"></a><span class="co"># 6) Paletas</span></span>
<span id="cb139-892"><a href="#cb139-892" aria-hidden="true" tabindex="-1"></a>pal_cls  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FF0000"</span>, <span class="st">"#00ffff"</span>)</span>
<span id="cb139-893"><a href="#cb139-893" aria-hidden="true" tabindex="-1"></a>pal_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#FFAAAA"</span>, <span class="st">"#b3ffff"</span>)</span>
<span id="cb139-894"><a href="#cb139-894" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pal_cls)  <span class="ot">&lt;-</span> <span class="fu">levels</span>(y_trainC)</span>
<span id="cb139-895"><a href="#cb139-895" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pal_fill) <span class="ot">&lt;-</span> <span class="fu">levels</span>(y_trainC)</span>
<span id="cb139-896"><a href="#cb139-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-897"><a href="#cb139-897" aria-hidden="true" tabindex="-1"></a><span class="co"># 7) Plot</span></span>
<span id="cb139-898"><a href="#cb139-898" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb139-899"><a href="#cb139-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> grid, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">fill =</span> pred), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb139-900"><a href="#cb139-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_fill, <span class="at">name =</span> <span class="st">"Clase (fondo)"</span>) <span class="sc">+</span></span>
<span id="cb139-901"><a href="#cb139-901" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_train, <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">1.8</span>, <span class="at">stroke =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb139-902"><a href="#cb139-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_test,  <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">stroke =</span> .<span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb139-903"><a href="#cb139-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_cls, <span class="at">name =</span> <span class="st">"Clase (puntos)"</span>) <span class="sc">+</span></span>
<span id="cb139-904"><a href="#cb139-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb139-905"><a href="#cb139-905" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">sprintf</span>(<span class="st">"Frontera kNN en plano PCA (k=%d)"</span>, k),</span>
<span id="cb139-906"><a href="#cb139-906" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC1"</span>, <span class="at">y =</span> <span class="st">"PC2"</span></span>
<span id="cb139-907"><a href="#cb139-907" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb139-908"><a href="#cb139-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max), <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb139-909"><a href="#cb139-909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-910"><a href="#cb139-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb139-911"><a href="#cb139-911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-912"><a href="#cb139-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-913"><a href="#cb139-913" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-914"><a href="#cb139-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-917"><a href="#cb139-917" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-918"><a href="#cb139-918" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: acurracy_python</span></span>
<span id="cb139-919"><a href="#cb139-919" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-920"><a href="#cb139-920" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-921"><a href="#cb139-921" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-922"><a href="#cb139-922" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-923"><a href="#cb139-923" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-924"><a href="#cb139-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-925"><a href="#cb139-925" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb139-926"><a href="#cb139-926" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Model accuracy score: </span><span class="sc">{0:0.4f}</span><span class="st">'</span>. <span class="bu">format</span>(accuracy_score(y_testPy, y_predPy)))</span>
<span id="cb139-927"><a href="#cb139-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-928"><a href="#cb139-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-929"><a href="#cb139-929" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Estudio del sobreajuste</span></span>
<span id="cb139-930"><a href="#cb139-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-933"><a href="#cb139-933" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-934"><a href="#cb139-934" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: python_sobreajuste</span></span>
<span id="cb139-935"><a href="#cb139-935" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-936"><a href="#cb139-936" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-937"><a href="#cb139-937" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-938"><a href="#cb139-938" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-939"><a href="#cb139-939" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-940"><a href="#cb139-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-941"><a href="#cb139-941" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Training set score: </span><span class="sc">{:.4f}</span><span class="st">'</span>.<span class="bu">format</span>(knn.score(X_trainPy, y_trainPy)))</span>
<span id="cb139-942"><a href="#cb139-942" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test set score: </span><span class="sc">{:.4f}</span><span class="st">'</span>.<span class="bu">format</span>(knn.score(X_testPy, y_testPy)))</span>
<span id="cb139-943"><a href="#cb139-943" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-944"><a href="#cb139-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-947"><a href="#cb139-947" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-948"><a href="#cb139-948" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: heatmap_matriz_confusion_python</span></span>
<span id="cb139-949"><a href="#cb139-949" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-950"><a href="#cb139-950" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-951"><a href="#cb139-951" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-952"><a href="#cb139-952" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-953"><a href="#cb139-953" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-954"><a href="#cb139-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-955"><a href="#cb139-955" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns <span class="co"># for data visualization</span></span>
<span id="cb139-956"><a href="#cb139-956" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb139-957"><a href="#cb139-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-958"><a href="#cb139-958" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize confusion matrix with seaborn heatmap</span></span>
<span id="cb139-959"><a href="#cb139-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-960"><a href="#cb139-960" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb139-961"><a href="#cb139-961" aria-hidden="true" tabindex="-1"></a>confMatrix <span class="op">=</span> confusion_matrix(y_testPy, y_predPy)</span>
<span id="cb139-962"><a href="#cb139-962" aria-hidden="true" tabindex="-1"></a>cm_matrix <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>confMatrix, columns<span class="op">=</span>[<span class="st">'Actual Positive:1'</span>, <span class="st">'Actual Negative:0'</span>], index<span class="op">=</span>[<span class="st">'Predict Positive:1'</span>, <span class="st">'Predict Negative:0'</span>])</span>
<span id="cb139-963"><a href="#cb139-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-964"><a href="#cb139-964" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'YlGnBu'</span>)</span>
<span id="cb139-965"><a href="#cb139-965" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-966"><a href="#cb139-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-969"><a href="#cb139-969" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-970"><a href="#cb139-970" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: classificacion_python</span></span>
<span id="cb139-971"><a href="#cb139-971" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-972"><a href="#cb139-972" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-973"><a href="#cb139-973" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-974"><a href="#cb139-974" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-975"><a href="#cb139-975" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-976"><a href="#cb139-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-977"><a href="#cb139-977" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb139-978"><a href="#cb139-978" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_testPy, y_predPy))</span>
<span id="cb139-979"><a href="#cb139-979" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-980"><a href="#cb139-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-983"><a href="#cb139-983" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-984"><a href="#cb139-984" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_clasificacion_python</span></span>
<span id="cb139-985"><a href="#cb139-985" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-986"><a href="#cb139-986" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-987"><a href="#cb139-987" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-988"><a href="#cb139-988" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-989"><a href="#cb139-989" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-990"><a href="#cb139-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-991"><a href="#cb139-991" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb139-992"><a href="#cb139-992" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb139-993"><a href="#cb139-993" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> ListedColormap</span>
<span id="cb139-994"><a href="#cb139-994" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb139-995"><a href="#cb139-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-996"><a href="#cb139-996" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelEncoder</span>
<span id="cb139-997"><a href="#cb139-997" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb139-998"><a href="#cb139-998" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb139-999"><a href="#cb139-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1000"><a href="#cb139-1000" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Parámetros ====</span></span>
<span id="cb139-1001"><a href="#cb139-1001" aria-hidden="true" tabindex="-1"></a>n_neighbors <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb139-1002"><a href="#cb139-1002" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> <span class="st">'distance'</span></span>
<span id="cb139-1003"><a href="#cb139-1003" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb139-1004"><a href="#cb139-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1005"><a href="#cb139-1005" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 0) Asegurar tipos correctos ====</span></span>
<span id="cb139-1006"><a href="#cb139-1006" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> np.asarray(X_trainPy, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb139-1007"><a href="#cb139-1007" aria-hidden="true" tabindex="-1"></a>X_testPy  <span class="op">=</span> np.asarray(X_testPy,  dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb139-1008"><a href="#cb139-1008" aria-hidden="true" tabindex="-1"></a>y_trainPy <span class="op">=</span> np.asarray(y_trainPy)</span>
<span id="cb139-1009"><a href="#cb139-1009" aria-hidden="true" tabindex="-1"></a>y_testPy  <span class="op">=</span> np.asarray(y_testPy)</span>
<span id="cb139-1010"><a href="#cb139-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1011"><a href="#cb139-1011" aria-hidden="true" tabindex="-1"></a><span class="co"># Codificar etiquetas a enteros (necesario para c= y pcolormesh)</span></span>
<span id="cb139-1012"><a href="#cb139-1012" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> LabelEncoder()</span>
<span id="cb139-1013"><a href="#cb139-1013" aria-hidden="true" tabindex="-1"></a>y_train_num <span class="op">=</span> le.fit_transform(y_trainPy)</span>
<span id="cb139-1014"><a href="#cb139-1014" aria-hidden="true" tabindex="-1"></a>y_test_num  <span class="op">=</span> le.transform(y_testPy)</span>
<span id="cb139-1015"><a href="#cb139-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1016"><a href="#cb139-1016" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 1) Estandarizar con medias/SD de train + PCA en train ====</span></span>
<span id="cb139-1017"><a href="#cb139-1017" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb139-1018"><a href="#cb139-1018" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_trainPy)</span>
<span id="cb139-1019"><a href="#cb139-1019" aria-hidden="true" tabindex="-1"></a>X_test_scaled  <span class="op">=</span> scaler.transform(X_testPy)</span>
<span id="cb139-1020"><a href="#cb139-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1021"><a href="#cb139-1021" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb139-1022"><a href="#cb139-1022" aria-hidden="true" tabindex="-1"></a>Z_train <span class="op">=</span> pca.fit_transform(X_train_scaled).astype(<span class="bu">float</span>)   <span class="co"># coords PCA train</span></span>
<span id="cb139-1023"><a href="#cb139-1023" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="op">=</span> pca.transform(X_test_scaled).astype(<span class="bu">float</span>)        <span class="co"># coords PCA test</span></span>
<span id="cb139-1024"><a href="#cb139-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1025"><a href="#cb139-1025" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 2) Entrenar KNN en el espacio PCA (train) ====</span></span>
<span id="cb139-1026"><a href="#cb139-1026" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span>n_neighbors, weights<span class="op">=</span>weights)</span>
<span id="cb139-1027"><a href="#cb139-1027" aria-hidden="true" tabindex="-1"></a>clf.fit(Z_train, y_train_num)</span>
<span id="cb139-1028"><a href="#cb139-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1029"><a href="#cb139-1029" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 3) Mallado en el plano PCA (usando rango de TRAIN para coherencia) ====</span></span>
<span id="cb139-1030"><a href="#cb139-1030" aria-hidden="true" tabindex="-1"></a>x_min, x_max <span class="op">=</span> Z_train[:, <span class="dv">0</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, Z_train[:, <span class="dv">0</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb139-1031"><a href="#cb139-1031" aria-hidden="true" tabindex="-1"></a>y_min, y_max <span class="op">=</span> Z_train[:, <span class="dv">1</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, Z_train[:, <span class="dv">1</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb139-1032"><a href="#cb139-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1033"><a href="#cb139-1033" aria-hidden="true" tabindex="-1"></a>xx, yy <span class="op">=</span> np.meshgrid(np.arange(x_min, x_max, h),</span>
<span id="cb139-1034"><a href="#cb139-1034" aria-hidden="true" tabindex="-1"></a>                     np.arange(y_min, y_max, h))</span>
<span id="cb139-1035"><a href="#cb139-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1036"><a href="#cb139-1036" aria-hidden="true" tabindex="-1"></a>Z_grid_pred_num <span class="op">=</span> clf.predict(np.c_[xx.ravel(), yy.ravel()]).reshape(xx.shape)</span>
<span id="cb139-1037"><a href="#cb139-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1038"><a href="#cb139-1038" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 4) Paletas (binario por tus colores; amplía si hay &gt;2 clases) ====</span></span>
<span id="cb139-1039"><a href="#cb139-1039" aria-hidden="true" tabindex="-1"></a>cmap_light <span class="op">=</span> ListedColormap([<span class="st">'#FFAAAA'</span>, <span class="st">'#b3ffff'</span>])</span>
<span id="cb139-1040"><a href="#cb139-1040" aria-hidden="true" tabindex="-1"></a>cmap_bold  <span class="op">=</span> ListedColormap([<span class="st">'#FF0000'</span>, <span class="st">'#00ffff'</span>])</span>
<span id="cb139-1041"><a href="#cb139-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1042"><a href="#cb139-1042" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 5) Plot fondo + puntos ====</span></span>
<span id="cb139-1043"><a href="#cb139-1043" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb139-1044"><a href="#cb139-1044" aria-hidden="true" tabindex="-1"></a>plt.pcolormesh(xx, yy, Z_grid_pred_num, cmap<span class="op">=</span>cmap_light, shading<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb139-1045"><a href="#cb139-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1046"><a href="#cb139-1046" aria-hidden="true" tabindex="-1"></a><span class="co"># Train</span></span>
<span id="cb139-1047"><a href="#cb139-1047" aria-hidden="true" tabindex="-1"></a>plt.scatter(Z_train[:, <span class="dv">0</span>], Z_train[:, <span class="dv">1</span>], c<span class="op">=</span>y_train_num, cmap<span class="op">=</span>cmap_bold,</span>
<span id="cb139-1048"><a href="#cb139-1048" aria-hidden="true" tabindex="-1"></a>            edgecolor<span class="op">=</span><span class="st">'k'</span>, s<span class="op">=</span><span class="dv">25</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span><span class="st">'Train'</span>)</span>
<span id="cb139-1049"><a href="#cb139-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1050"><a href="#cb139-1050" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb139-1051"><a href="#cb139-1051" aria-hidden="true" tabindex="-1"></a>plt.scatter(Z_test[:, <span class="dv">0</span>],  Z_test[:, <span class="dv">1</span>],  c<span class="op">=</span>y_test_num,  cmap<span class="op">=</span>cmap_bold,</span>
<span id="cb139-1052"><a href="#cb139-1052" aria-hidden="true" tabindex="-1"></a>            edgecolor<span class="op">=</span><span class="st">'k'</span>, s<span class="op">=</span><span class="dv">35</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Test'</span>)</span>
<span id="cb139-1053"><a href="#cb139-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1054"><a href="#cb139-1054" aria-hidden="true" tabindex="-1"></a>plt.xlim(xx.<span class="bu">min</span>(), xx.<span class="bu">max</span>())</span>
<span id="cb139-1055"><a href="#cb139-1055" aria-hidden="true" tabindex="-1"></a>plt.ylim(yy.<span class="bu">min</span>(), yy.<span class="bu">max</span>())</span>
<span id="cb139-1056"><a href="#cb139-1056" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'PC1'</span>)</span>
<span id="cb139-1057"><a href="#cb139-1057" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'PC2'</span>)</span>
<span id="cb139-1058"><a href="#cb139-1058" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Frontera KNN en plano PCA (k=</span><span class="sc">{</span>n_neighbors<span class="sc">}</span><span class="ss">, weights='</span><span class="sc">{</span>weights<span class="sc">}</span><span class="ss">')"</span>)</span>
<span id="cb139-1059"><a href="#cb139-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1060"><a href="#cb139-1060" aria-hidden="true" tabindex="-1"></a><span class="co"># Leyenda de clases con nombres originales</span></span>
<span id="cb139-1061"><a href="#cb139-1061" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> <span class="bu">list</span>(le.classes_)</span>
<span id="cb139-1062"><a href="#cb139-1062" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#FF0000'</span>, <span class="st">'#00ffff'</span>]  <span class="co"># ajusta si hay más clases</span></span>
<span id="cb139-1063"><a href="#cb139-1063" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> [mpatches.Patch(color<span class="op">=</span>palette[i <span class="op">%</span> <span class="bu">len</span>(palette)], label<span class="op">=</span><span class="bu">str</span>(lbl))</span>
<span id="cb139-1064"><a href="#cb139-1064" aria-hidden="true" tabindex="-1"></a>           <span class="cf">for</span> i, lbl <span class="kw">in</span> <span class="bu">enumerate</span>(classes)]</span>
<span id="cb139-1065"><a href="#cb139-1065" aria-hidden="true" tabindex="-1"></a>legend_classes <span class="op">=</span> plt.legend(handles<span class="op">=</span>patches, title<span class="op">=</span><span class="st">"Clases"</span>,</span>
<span id="cb139-1066"><a href="#cb139-1066" aria-hidden="true" tabindex="-1"></a>                            loc<span class="op">=</span><span class="st">'upper right'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.32</span>, <span class="fl">1.0</span>))</span>
<span id="cb139-1067"><a href="#cb139-1067" aria-hidden="true" tabindex="-1"></a>plt.gca().add_artist(legend_classes)</span>
<span id="cb139-1068"><a href="#cb139-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1069"><a href="#cb139-1069" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)  <span class="co"># leyenda Train/Test</span></span>
<span id="cb139-1070"><a href="#cb139-1070" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb139-1071"><a href="#cb139-1071" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb139-1072"><a href="#cb139-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1073"><a href="#cb139-1073" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1074"><a href="#cb139-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1075"><a href="#cb139-1075" aria-hidden="true" tabindex="-1"></a><span class="fu">### KNN Regresor</span></span>
<span id="cb139-1076"><a href="#cb139-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1077"><a href="#cb139-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Definimos los conjuntos de datos</span></span>
<span id="cb139-1078"><a href="#cb139-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1079"><a href="#cb139-1079" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1080"><a href="#cb139-1080" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-1081"><a href="#cb139-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1084"><a href="#cb139-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1085"><a href="#cb139-1085" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cargar_paquete_r_regression</span></span>
<span id="cb139-1086"><a href="#cb139-1086" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1087"><a href="#cb139-1087" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1088"><a href="#cb139-1088" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1089"><a href="#cb139-1089" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1090"><a href="#cb139-1090" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1091"><a href="#cb139-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1092"><a href="#cb139-1092" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FNN)</span>
<span id="cb139-1093"><a href="#cb139-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1094"><a href="#cb139-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1097"><a href="#cb139-1097" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1098"><a href="#cb139-1098" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: datos_dbds_regresion_base</span></span>
<span id="cb139-1099"><a href="#cb139-1099" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1100"><a href="#cb139-1100" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1101"><a href="#cb139-1101" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1102"><a href="#cb139-1102" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1103"><a href="#cb139-1103" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1104"><a href="#cb139-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1105"><a href="#cb139-1105" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb139-1106"><a href="#cb139-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1107"><a href="#cb139-1107" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos), <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb139-1108"><a href="#cb139-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1109"><a href="#cb139-1109" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> datos[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>)]</span>
<span id="cb139-1110"><a href="#cb139-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1111"><a href="#cb139-1111" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> datos[default_idx, ]; test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb139-1112"><a href="#cb139-1112" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> train[, <span class="sc">-</span><span class="dv">6</span>]; X_test <span class="ot">&lt;-</span> test[, <span class="sc">-</span><span class="dv">6</span>]</span>
<span id="cb139-1113"><a href="#cb139-1113" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> train[, <span class="dv">6</span>]; y_test <span class="ot">&lt;-</span> test[, <span class="dv">6</span>]</span>
<span id="cb139-1114"><a href="#cb139-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1115"><a href="#cb139-1115" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos todas las columnas en numéricas para que se pueda utilizar el algoritmo</span></span>
<span id="cb139-1116"><a href="#cb139-1116" aria-hidden="true" tabindex="-1"></a><span class="co"># de KNN</span></span>
<span id="cb139-1117"><a href="#cb139-1117" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(X_train, as.numeric))</span>
<span id="cb139-1118"><a href="#cb139-1118" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(X_test, as.numeric))</span>
<span id="cb139-1119"><a href="#cb139-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1120"><a href="#cb139-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1121"><a href="#cb139-1121" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: packages `caret`</span></span>
<span id="cb139-1122"><a href="#cb139-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1125"><a href="#cb139-1125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1126"><a href="#cb139-1126" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: dataset_caret_regresion</span></span>
<span id="cb139-1127"><a href="#cb139-1127" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1128"><a href="#cb139-1128" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1129"><a href="#cb139-1129" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1130"><a href="#cb139-1130" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1131"><a href="#cb139-1131" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1132"><a href="#cb139-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1133"><a href="#cb139-1133" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb139-1134"><a href="#cb139-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1135"><a href="#cb139-1135" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb139-1136"><a href="#cb139-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1137"><a href="#cb139-1137" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(datos<span class="sc">$</span>Recency, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb139-1138"><a href="#cb139-1138" aria-hidden="true" tabindex="-1"></a>X_trainC <span class="ot">&lt;-</span> datos[default_idx, ]</span>
<span id="cb139-1139"><a href="#cb139-1139" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb139-1140"><a href="#cb139-1140" aria-hidden="true" tabindex="-1"></a>y_testC <span class="ot">&lt;-</span> X_testC[, <span class="dv">6</span>]</span>
<span id="cb139-1141"><a href="#cb139-1141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1142"><a href="#cb139-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1143"><a href="#cb139-1143" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-1144"><a href="#cb139-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1147"><a href="#cb139-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-1148"><a href="#cb139-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: python_test_train_regresion</span></span>
<span id="cb139-1149"><a href="#cb139-1149" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1150"><a href="#cb139-1150" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1151"><a href="#cb139-1151" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1152"><a href="#cb139-1152" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1153"><a href="#cb139-1153" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1154"><a href="#cb139-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1155"><a href="#cb139-1155" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb139-1156"><a href="#cb139-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1157"><a href="#cb139-1157" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> datos_py.drop([<span class="st">"Recency"</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb139-1158"><a href="#cb139-1158" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> datos_py[<span class="st">'Recency'</span>]</span>
<span id="cb139-1159"><a href="#cb139-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1160"><a href="#cb139-1160" aria-hidden="true" tabindex="-1"></a>X_trainPy, X_testPy, y_trainPy, y_testPy <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.3</span>, random_state <span class="op">=</span> <span class="dv">1994</span>)</span>
<span id="cb139-1161"><a href="#cb139-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1162"><a href="#cb139-1162" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb139-1163"><a href="#cb139-1163" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler</span>
<span id="cb139-1164"><a href="#cb139-1164" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb139-1165"><a href="#cb139-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1166"><a href="#cb139-1166" aria-hidden="true" tabindex="-1"></a><span class="co"># y para regresión debe ser numérico:</span></span>
<span id="cb139-1167"><a href="#cb139-1167" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.asarray(y_trainPy, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb139-1168"><a href="#cb139-1168" aria-hidden="true" tabindex="-1"></a>y_test  <span class="op">=</span> np.asarray(y_testPy,  dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb139-1169"><a href="#cb139-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1170"><a href="#cb139-1170" aria-hidden="true" tabindex="-1"></a><span class="co"># Detecta tipos</span></span>
<span id="cb139-1171"><a href="#cb139-1171" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> X_trainPy.select_dtypes(include<span class="op">=</span>[np.number]).columns.tolist()</span>
<span id="cb139-1172"><a href="#cb139-1172" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> X_trainPy.select_dtypes(exclude<span class="op">=</span>[np.number]).columns.tolist()</span>
<span id="cb139-1173"><a href="#cb139-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1174"><a href="#cb139-1174" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocesador: escala numéricas y one-hot en categóricas</span></span>
<span id="cb139-1175"><a href="#cb139-1175" aria-hidden="true" tabindex="-1"></a>preprocess <span class="op">=</span> ColumnTransformer(</span>
<span id="cb139-1176"><a href="#cb139-1176" aria-hidden="true" tabindex="-1"></a>    transformers<span class="op">=</span>[</span>
<span id="cb139-1177"><a href="#cb139-1177" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"num"</span>, StandardScaler(), num_cols),</span>
<span id="cb139-1178"><a href="#cb139-1178" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"cat"</span>, OneHotEncoder(handle_unknown<span class="op">=</span><span class="st">"ignore"</span>, sparse_output<span class="op">=</span><span class="va">False</span>), cat_cols),</span>
<span id="cb139-1179"><a href="#cb139-1179" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb139-1180"><a href="#cb139-1180" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb139-1181"><a href="#cb139-1181" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-1182"><a href="#cb139-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1183"><a href="#cb139-1183" aria-hidden="true" tabindex="-1"></a><span class="co"># Transforma los datos usando el preprocesador ya ajustado</span></span>
<span id="cb139-1184"><a href="#cb139-1184" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> preprocess.fit_transform(X_trainPy)</span>
<span id="cb139-1185"><a href="#cb139-1185" aria-hidden="true" tabindex="-1"></a>X_testPy  <span class="op">=</span> preprocess.transform(X_testPy)</span>
<span id="cb139-1186"><a href="#cb139-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1187"><a href="#cb139-1187" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1188"><a href="#cb139-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1189"><a href="#cb139-1189" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Entrenamiento del modelo</span></span>
<span id="cb139-1190"><a href="#cb139-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1191"><a href="#cb139-1191" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1192"><a href="#cb139-1192" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-1193"><a href="#cb139-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1196"><a href="#cb139-1196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1197"><a href="#cb139-1197" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: base_prediccion_regresion</span></span>
<span id="cb139-1198"><a href="#cb139-1198" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1199"><a href="#cb139-1199" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1200"><a href="#cb139-1200" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1201"><a href="#cb139-1201" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1202"><a href="#cb139-1202" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1203"><a href="#cb139-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1204"><a href="#cb139-1204" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">knn.reg</span>(<span class="at">train =</span> X_train, <span class="at">test =</span> X_test, <span class="at">y =</span> y_train, <span class="at">k =</span> <span class="dv">1</span>)</span>
<span id="cb139-1205"><a href="#cb139-1205" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred)</span>
<span id="cb139-1206"><a href="#cb139-1206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1207"><a href="#cb139-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1208"><a href="#cb139-1208" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: packages `caret`</span></span>
<span id="cb139-1209"><a href="#cb139-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1212"><a href="#cb139-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1213"><a href="#cb139-1213" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: caret_info_modelos</span></span>
<span id="cb139-1214"><a href="#cb139-1214" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1215"><a href="#cb139-1215" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1216"><a href="#cb139-1216" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1217"><a href="#cb139-1217" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1218"><a href="#cb139-1218" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1219"><a href="#cb139-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1220"><a href="#cb139-1220" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">modelLookup</span>(<span class="st">"knn"</span>)</span>
<span id="cb139-1221"><a href="#cb139-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1222"><a href="#cb139-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1225"><a href="#cb139-1225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1226"><a href="#cb139-1226" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: training_caret_regresion</span></span>
<span id="cb139-1227"><a href="#cb139-1227" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1228"><a href="#cb139-1228" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1229"><a href="#cb139-1229" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1230"><a href="#cb139-1230" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1231"><a href="#cb139-1231" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1232"><a href="#cb139-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1233"><a href="#cb139-1233" aria-hidden="true" tabindex="-1"></a>knn <span class="ot">&lt;-</span> <span class="fu">train</span>(Recency <span class="sc">~</span> ., <span class="at">data =</span> X_trainC, <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb139-1234"><a href="#cb139-1234" aria-hidden="true" tabindex="-1"></a>             <span class="at">preProc =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>), <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb139-1235"><a href="#cb139-1235" aria-hidden="true" tabindex="-1"></a>             <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>))</span>
<span id="cb139-1236"><a href="#cb139-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1237"><a href="#cb139-1237" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(knn, <span class="at">highlight =</span> <span class="cn">TRUE</span>) <span class="co"># Alternativamente: plot(knn)</span></span>
<span id="cb139-1238"><a href="#cb139-1238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1239"><a href="#cb139-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1240"><a href="#cb139-1240" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-1241"><a href="#cb139-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1244"><a href="#cb139-1244" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-1245"><a href="#cb139-1245" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: training_python_regresion</span></span>
<span id="cb139-1246"><a href="#cb139-1246" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1247"><a href="#cb139-1247" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1248"><a href="#cb139-1248" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1249"><a href="#cb139-1249" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1250"><a href="#cb139-1250" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1251"><a href="#cb139-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1252"><a href="#cb139-1252" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb139-1253"><a href="#cb139-1253" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score</span>
<span id="cb139-1254"><a href="#cb139-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1255"><a href="#cb139-1255" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and train the KNN regressor</span></span>
<span id="cb139-1256"><a href="#cb139-1256" aria-hidden="true" tabindex="-1"></a>knn_regressor <span class="op">=</span> KNeighborsRegressor(n_neighbors <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb139-1257"><a href="#cb139-1257" aria-hidden="true" tabindex="-1"></a>knn_regressor.fit(X_trainPy, y_trainPy)</span>
<span id="cb139-1258"><a href="#cb139-1258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1259"><a href="#cb139-1259" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1260"><a href="#cb139-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1261"><a href="#cb139-1261" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Tunning parameters:** Selección del valor de k</span></span>
<span id="cb139-1262"><a href="#cb139-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1263"><a href="#cb139-1263" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1264"><a href="#cb139-1264" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-1265"><a href="#cb139-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1268"><a href="#cb139-1268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1269"><a href="#cb139-1269" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: funciones_base_regresion</span></span>
<span id="cb139-1270"><a href="#cb139-1270" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1271"><a href="#cb139-1271" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1272"><a href="#cb139-1272" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1273"><a href="#cb139-1273" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1274"><a href="#cb139-1274" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1275"><a href="#cb139-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1276"><a href="#cb139-1276" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">=</span> <span class="cf">function</span>(actual, predicted) {</span>
<span id="cb139-1277"><a href="#cb139-1277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">mean</span>((actual <span class="sc">-</span> predicted) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb139-1278"><a href="#cb139-1278" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-1279"><a href="#cb139-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1280"><a href="#cb139-1280" aria-hidden="true" tabindex="-1"></a><span class="co"># define helper function for getting knn.reg predictions</span></span>
<span id="cb139-1281"><a href="#cb139-1281" aria-hidden="true" tabindex="-1"></a><span class="co"># note: this function is highly specific to this situation and dataset</span></span>
<span id="cb139-1282"><a href="#cb139-1282" aria-hidden="true" tabindex="-1"></a>make_knn_pred <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">k =</span> <span class="dv">1</span>, training, predicting, valueTarget) {</span>
<span id="cb139-1283"><a href="#cb139-1283" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">=</span> FNN<span class="sc">::</span><span class="fu">knn.reg</span>(<span class="at">train =</span> training, </span>
<span id="cb139-1284"><a href="#cb139-1284" aria-hidden="true" tabindex="-1"></a>                      <span class="at">test =</span> predicting, </span>
<span id="cb139-1285"><a href="#cb139-1285" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> valueTarget, <span class="at">k =</span> k)<span class="sc">$</span>pred</span>
<span id="cb139-1286"><a href="#cb139-1286" aria-hidden="true" tabindex="-1"></a>  act  <span class="ot">=</span> predicting<span class="sc">$</span>Recency</span>
<span id="cb139-1287"><a href="#cb139-1287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse</span>(<span class="at">predicted =</span> pred, <span class="at">actual =</span> act)</span>
<span id="cb139-1288"><a href="#cb139-1288" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-1289"><a href="#cb139-1289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1290"><a href="#cb139-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1293"><a href="#cb139-1293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1294"><a href="#cb139-1294" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: aplicacion_base_cv</span></span>
<span id="cb139-1295"><a href="#cb139-1295" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1296"><a href="#cb139-1296" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1297"><a href="#cb139-1297" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1298"><a href="#cb139-1298" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1299"><a href="#cb139-1299" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1300"><a href="#cb139-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1301"><a href="#cb139-1301" aria-hidden="true" tabindex="-1"></a><span class="co"># define values of k to evaluate</span></span>
<span id="cb139-1302"><a href="#cb139-1302" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">250</span>)</span>
<span id="cb139-1303"><a href="#cb139-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1304"><a href="#cb139-1304" aria-hidden="true" tabindex="-1"></a><span class="co"># get requested train RMSEs</span></span>
<span id="cb139-1305"><a href="#cb139-1305" aria-hidden="true" tabindex="-1"></a>knn_trn_rmse <span class="ot">&lt;-</span> <span class="fu">sapply</span>(k, make_knn_pred, <span class="at">training =</span> X_train, </span>
<span id="cb139-1306"><a href="#cb139-1306" aria-hidden="true" tabindex="-1"></a>                      <span class="at">predicting =</span> X_train, </span>
<span id="cb139-1307"><a href="#cb139-1307" aria-hidden="true" tabindex="-1"></a>                      <span class="at">valueTarget =</span> y_train)</span>
<span id="cb139-1308"><a href="#cb139-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1309"><a href="#cb139-1309" aria-hidden="true" tabindex="-1"></a><span class="co"># determine "best" k</span></span>
<span id="cb139-1310"><a href="#cb139-1310" aria-hidden="true" tabindex="-1"></a>best_k <span class="ot">&lt;-</span> k[<span class="fu">which.min</span>(knn_trn_rmse)]</span>
<span id="cb139-1311"><a href="#cb139-1311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1312"><a href="#cb139-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1313"><a href="#cb139-1313" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: packages `caret`</span></span>
<span id="cb139-1314"><a href="#cb139-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1317"><a href="#cb139-1317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1318"><a href="#cb139-1318" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: caret_parametrizacion</span></span>
<span id="cb139-1319"><a href="#cb139-1319" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1320"><a href="#cb139-1320" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1321"><a href="#cb139-1321" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1322"><a href="#cb139-1322" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1323"><a href="#cb139-1323" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1324"><a href="#cb139-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1325"><a href="#cb139-1325" aria-hidden="true" tabindex="-1"></a>regSummary <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">lev =</span> <span class="cn">NULL</span>, <span class="at">model =</span> <span class="cn">NULL</span>) {</span>
<span id="cb139-1326"><a href="#cb139-1326" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb139-1327"><a href="#cb139-1327" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE =</span> <span class="fu">RMSE</span>(data<span class="sc">$</span>pred, data<span class="sc">$</span>obs),</span>
<span id="cb139-1328"><a href="#cb139-1328" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rsquared =</span> <span class="fu">R2</span>(data<span class="sc">$</span>pred, data<span class="sc">$</span>obs),</span>
<span id="cb139-1329"><a href="#cb139-1329" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE =</span> <span class="fu">MAE</span>(data<span class="sc">$</span>pred, data<span class="sc">$</span>obs)</span>
<span id="cb139-1330"><a href="#cb139-1330" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-1331"><a href="#cb139-1331" aria-hidden="true" tabindex="-1"></a>  out</span>
<span id="cb139-1332"><a href="#cb139-1332" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-1333"><a href="#cb139-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1334"><a href="#cb139-1334" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos un método de remuestreo</span></span>
<span id="cb139-1335"><a href="#cb139-1335" aria-hidden="true" tabindex="-1"></a>cv <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb139-1336"><a href="#cb139-1336" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"repeatedcv"</span>,</span>
<span id="cb139-1337"><a href="#cb139-1337" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb139-1338"><a href="#cb139-1338" aria-hidden="true" tabindex="-1"></a>  <span class="at">repeats =</span> <span class="dv">5</span>,</span>
<span id="cb139-1339"><a href="#cb139-1339" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb139-1340"><a href="#cb139-1340" aria-hidden="true" tabindex="-1"></a>  <span class="at">preProcOptions =</span> <span class="fu">list</span>(<span class="st">"center"</span>),</span>
<span id="cb139-1341"><a href="#cb139-1341" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> regSummary, </span>
<span id="cb139-1342"><a href="#cb139-1342" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>)</span>
<span id="cb139-1343"><a href="#cb139-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1344"><a href="#cb139-1344" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos la red de posibles valores del hiperparámetro</span></span>
<span id="cb139-1345"><a href="#cb139-1345" aria-hidden="true" tabindex="-1"></a>hyper_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">50</span>,<span class="dv">75</span>,<span class="dv">100</span>))</span>
<span id="cb139-1346"><a href="#cb139-1346" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1347"><a href="#cb139-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1350"><a href="#cb139-1350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1351"><a href="#cb139-1351" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: entrenamiento_cv_caret</span></span>
<span id="cb139-1352"><a href="#cb139-1352" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1353"><a href="#cb139-1353" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1354"><a href="#cb139-1354" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1355"><a href="#cb139-1355" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1356"><a href="#cb139-1356" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1357"><a href="#cb139-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1358"><a href="#cb139-1358" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb139-1359"><a href="#cb139-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1360"><a href="#cb139-1360" aria-hidden="true" tabindex="-1"></a><span class="co"># Se entrena el modelo ajustando el hiperparámetro óptimo</span></span>
<span id="cb139-1361"><a href="#cb139-1361" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb139-1362"><a href="#cb139-1362" aria-hidden="true" tabindex="-1"></a>  Recency <span class="sc">~</span> .,</span>
<span id="cb139-1363"><a href="#cb139-1363" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> X_trainC,</span>
<span id="cb139-1364"><a href="#cb139-1364" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb139-1365"><a href="#cb139-1365" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> cv,</span>
<span id="cb139-1366"><a href="#cb139-1366" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> hyper_grid,</span>
<span id="cb139-1367"><a href="#cb139-1367" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"MAPE"</span>)</span>
<span id="cb139-1368"><a href="#cb139-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1369"><a href="#cb139-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1370"><a href="#cb139-1370" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-1371"><a href="#cb139-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1374"><a href="#cb139-1374" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-1375"><a href="#cb139-1375" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: entrenamiento_cv_python</span></span>
<span id="cb139-1376"><a href="#cb139-1376" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1377"><a href="#cb139-1377" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1378"><a href="#cb139-1378" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1379"><a href="#cb139-1379" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1380"><a href="#cb139-1380" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1381"><a href="#cb139-1381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1382"><a href="#cb139-1382" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co"># for data visualization purposes</span></span>
<span id="cb139-1383"><a href="#cb139-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1384"><a href="#cb139-1384" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_absolute_percentage_error(y_true, y_pred):</span>
<span id="cb139-1385"><a href="#cb139-1385" aria-hidden="true" tabindex="-1"></a>    y_true, y_pred <span class="op">=</span> np.array(y_true), np.array(y_pred)</span>
<span id="cb139-1386"><a href="#cb139-1386" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Evitar divisiones por cero</span></span>
<span id="cb139-1387"><a href="#cb139-1387" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> y_true <span class="op">!=</span> <span class="dv">0</span></span>
<span id="cb139-1388"><a href="#cb139-1388" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(np.<span class="bu">abs</span>((y_true[mask] <span class="op">-</span> y_pred[mask]) <span class="op">/</span> y_true[mask])) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb139-1389"><a href="#cb139-1389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1390"><a href="#cb139-1390" aria-hidden="true" tabindex="-1"></a>k_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">20</span>)</span>
<span id="cb139-1391"><a href="#cb139-1391" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> []</span>
<span id="cb139-1392"><a href="#cb139-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1393"><a href="#cb139-1393" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> k_range:</span>
<span id="cb139-1394"><a href="#cb139-1394" aria-hidden="true" tabindex="-1"></a>    knn <span class="op">=</span> KNeighborsRegressor(n_neighbors<span class="op">=</span>k)</span>
<span id="cb139-1395"><a href="#cb139-1395" aria-hidden="true" tabindex="-1"></a>    knn.fit(X_trainPy, y_trainPy)</span>
<span id="cb139-1396"><a href="#cb139-1396" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> knn.predict(X_testPy)</span>
<span id="cb139-1397"><a href="#cb139-1397" aria-hidden="true" tabindex="-1"></a>    mape <span class="op">=</span> mean_absolute_percentage_error(y_testPy, y_pred)</span>
<span id="cb139-1398"><a href="#cb139-1398" aria-hidden="true" tabindex="-1"></a>    scores.append(mape)</span>
<span id="cb139-1399"><a href="#cb139-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1400"><a href="#cb139-1400" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb139-1401"><a href="#cb139-1401" aria-hidden="true" tabindex="-1"></a>plt.plot(k_range, scores, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb139-1402"><a href="#cb139-1402" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'k'</span>)</span>
<span id="cb139-1403"><a href="#cb139-1403" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'MAPE (%)'</span>)</span>
<span id="cb139-1404"><a href="#cb139-1404" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Error porcentual medio absoluto vs número de vecinos (k)'</span>)</span>
<span id="cb139-1405"><a href="#cb139-1405" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>])</span>
<span id="cb139-1406"><a href="#cb139-1406" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb139-1407"><a href="#cb139-1407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1408"><a href="#cb139-1408" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1409"><a href="#cb139-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1410"><a href="#cb139-1410" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Predicción de la variable respuesta</span></span>
<span id="cb139-1411"><a href="#cb139-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1412"><a href="#cb139-1412" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1413"><a href="#cb139-1413" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-1414"><a href="#cb139-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1415"><a href="#cb139-1415" aria-hidden="true" tabindex="-1"></a>La própia función que entrena el algoritmo ya devuelve las predicciones del algoritmo de KNN.</span>
<span id="cb139-1416"><a href="#cb139-1416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1417"><a href="#cb139-1417" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: packages `caret`</span></span>
<span id="cb139-1418"><a href="#cb139-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1421"><a href="#cb139-1421" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1422"><a href="#cb139-1422" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prediccion_caret_regresion</span></span>
<span id="cb139-1423"><a href="#cb139-1423" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1424"><a href="#cb139-1424" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1425"><a href="#cb139-1425" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1426"><a href="#cb139-1426" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1427"><a href="#cb139-1427" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1428"><a href="#cb139-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1429"><a href="#cb139-1429" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(model, <span class="at">newdata =</span> X_testC), <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb139-1430"><a href="#cb139-1430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1431"><a href="#cb139-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1432"><a href="#cb139-1432" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-1433"><a href="#cb139-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1436"><a href="#cb139-1436" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-1437"><a href="#cb139-1437" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prediccion_regresion_python</span></span>
<span id="cb139-1438"><a href="#cb139-1438" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1439"><a href="#cb139-1439" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1440"><a href="#cb139-1440" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1441"><a href="#cb139-1441" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1442"><a href="#cb139-1442" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1443"><a href="#cb139-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1444"><a href="#cb139-1444" aria-hidden="true" tabindex="-1"></a>y_predPy <span class="op">=</span> knn_regressor.predict(X_testPy)</span>
<span id="cb139-1445"><a href="#cb139-1445" aria-hidden="true" tabindex="-1"></a>y_predPy[:<span class="dv">10</span>]</span>
<span id="cb139-1446"><a href="#cb139-1446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1447"><a href="#cb139-1447" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1448"><a href="#cb139-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1449"><a href="#cb139-1449" aria-hidden="true" tabindex="-1"></a><span class="fu">## Naives Bayes (*Classifier*)</span></span>
<span id="cb139-1450"><a href="#cb139-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1451"><a href="#cb139-1451" aria-hidden="true" tabindex="-1"></a><span class="fu">### Definición de los conjuntos de datos</span></span>
<span id="cb139-1452"><a href="#cb139-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1453"><a href="#cb139-1453" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1454"><a href="#cb139-1454" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R Base</span></span>
<span id="cb139-1455"><a href="#cb139-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1458"><a href="#cb139-1458" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1459"><a href="#cb139-1459" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: crear-datasets_separados_base</span></span>
<span id="cb139-1460"><a href="#cb139-1460" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1461"><a href="#cb139-1461" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1462"><a href="#cb139-1462" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1463"><a href="#cb139-1463" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1464"><a href="#cb139-1464" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1465"><a href="#cb139-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1466"><a href="#cb139-1466" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb139-1467"><a href="#cb139-1467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1468"><a href="#cb139-1468" aria-hidden="true" tabindex="-1"></a>ind_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">16</span>)</span>
<span id="cb139-1469"><a href="#cb139-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1470"><a href="#cb139-1470" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">=</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos), <span class="fu">nrow</span>(datos)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb139-1471"><a href="#cb139-1471" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> datos[default_idx, ]; test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb139-1472"><a href="#cb139-1472" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> train; </span>
<span id="cb139-1473"><a href="#cb139-1473" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train &lt;- train[, -ind_col];</span></span>
<span id="cb139-1474"><a href="#cb139-1474" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> test[, <span class="sc">-</span>ind_col]</span>
<span id="cb139-1475"><a href="#cb139-1475" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> train[, ind_col]; y_test <span class="ot">&lt;-</span> test[, ind_col]</span>
<span id="cb139-1476"><a href="#cb139-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1477"><a href="#cb139-1477" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos todas las columnas en numéricas para que se pueda utilizar el algoritmo</span></span>
<span id="cb139-1478"><a href="#cb139-1478" aria-hidden="true" tabindex="-1"></a><span class="co"># de KNN</span></span>
<span id="cb139-1479"><a href="#cb139-1479" aria-hidden="true" tabindex="-1"></a><span class="co"># X_train &lt;- data.frame(lapply(X_train, as.numeric))</span></span>
<span id="cb139-1480"><a href="#cb139-1480" aria-hidden="true" tabindex="-1"></a><span class="co"># X_test &lt;- data.frame(lapply(X_test, as.numeric))</span></span>
<span id="cb139-1481"><a href="#cb139-1481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1482"><a href="#cb139-1482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1483"><a href="#cb139-1483" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-1484"><a href="#cb139-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1487"><a href="#cb139-1487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1488"><a href="#cb139-1488" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: crear-datasets_separados_caret</span></span>
<span id="cb139-1489"><a href="#cb139-1489" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1490"><a href="#cb139-1490" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1491"><a href="#cb139-1491" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1492"><a href="#cb139-1492" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1493"><a href="#cb139-1493" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1494"><a href="#cb139-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1495"><a href="#cb139-1495" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"caret"</span>)</span>
<span id="cb139-1496"><a href="#cb139-1496" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"naivebayes"</span>)</span>
<span id="cb139-1497"><a href="#cb139-1497" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"reshape"</span>)</span>
<span id="cb139-1498"><a href="#cb139-1498" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb139-1499"><a href="#cb139-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1500"><a href="#cb139-1500" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb139-1501"><a href="#cb139-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1502"><a href="#cb139-1502" aria-hidden="true" tabindex="-1"></a>ind_col <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">16</span>)</span>
<span id="cb139-1503"><a href="#cb139-1503" aria-hidden="true" tabindex="-1"></a>default_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(datos<span class="sc">$</span>Response, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb139-1504"><a href="#cb139-1504" aria-hidden="true" tabindex="-1"></a>X_trainC <span class="ot">&lt;-</span> datos[default_idx, ]</span>
<span id="cb139-1505"><a href="#cb139-1505" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> datos[<span class="sc">-</span>default_idx, ]</span>
<span id="cb139-1506"><a href="#cb139-1506" aria-hidden="true" tabindex="-1"></a>y_testC <span class="ot">&lt;-</span> X_testC[, ind_col]</span>
<span id="cb139-1507"><a href="#cb139-1507" aria-hidden="true" tabindex="-1"></a>X_testC <span class="ot">&lt;-</span> X_testC[, <span class="sc">-</span>ind_col]</span>
<span id="cb139-1508"><a href="#cb139-1508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1509"><a href="#cb139-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1512"><a href="#cb139-1512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1513"><a href="#cb139-1513" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: modelo_caret_nb</span></span>
<span id="cb139-1514"><a href="#cb139-1514" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1515"><a href="#cb139-1515" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1516"><a href="#cb139-1516" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1517"><a href="#cb139-1517" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1518"><a href="#cb139-1518" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1519"><a href="#cb139-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1520"><a href="#cb139-1520" aria-hidden="true" tabindex="-1"></a><span class="fu">modelLookup</span>(<span class="st">"naive_bayes"</span>)</span>
<span id="cb139-1521"><a href="#cb139-1521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1522"><a href="#cb139-1522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1523"><a href="#cb139-1523" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-1524"><a href="#cb139-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1527"><a href="#cb139-1527" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-1528"><a href="#cb139-1528" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: python_test_train2</span></span>
<span id="cb139-1529"><a href="#cb139-1529" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1530"><a href="#cb139-1530" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1531"><a href="#cb139-1531" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1532"><a href="#cb139-1532" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1533"><a href="#cb139-1533" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1534"><a href="#cb139-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1535"><a href="#cb139-1535" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb139-1536"><a href="#cb139-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1537"><a href="#cb139-1537" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> datos_py.drop([<span class="st">"Response"</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb139-1538"><a href="#cb139-1538" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> datos_py[<span class="st">'Response'</span>]</span>
<span id="cb139-1539"><a href="#cb139-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1540"><a href="#cb139-1540" aria-hidden="true" tabindex="-1"></a>X_trainPy, X_testPy, y_trainPy, y_testPy <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">0.3</span>, random_state <span class="op">=</span> <span class="dv">1994</span>)</span>
<span id="cb139-1541"><a href="#cb139-1541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1542"><a href="#cb139-1542" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1543"><a href="#cb139-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1544"><a href="#cb139-1544" aria-hidden="true" tabindex="-1"></a><span class="fu">### Entrenamiento del modelo</span></span>
<span id="cb139-1545"><a href="#cb139-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1546"><a href="#cb139-1546" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1547"><a href="#cb139-1547" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-1548"><a href="#cb139-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1551"><a href="#cb139-1551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1552"><a href="#cb139-1552" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: train_nb_base</span></span>
<span id="cb139-1553"><a href="#cb139-1553" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1554"><a href="#cb139-1554" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1555"><a href="#cb139-1555" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1556"><a href="#cb139-1556" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1557"><a href="#cb139-1557" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1558"><a href="#cb139-1558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1559"><a href="#cb139-1559" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb139-1560"><a href="#cb139-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1561"><a href="#cb139-1561" aria-hidden="true" tabindex="-1"></a>(nb_base <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(Response <span class="sc">~</span> ., <span class="at">data =</span> X_train))</span>
<span id="cb139-1562"><a href="#cb139-1562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1563"><a href="#cb139-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1564"><a href="#cb139-1564" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-1565"><a href="#cb139-1565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1568"><a href="#cb139-1568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1569"><a href="#cb139-1569" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: train_nb_caret</span></span>
<span id="cb139-1570"><a href="#cb139-1570" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1571"><a href="#cb139-1571" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1572"><a href="#cb139-1572" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1573"><a href="#cb139-1573" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1574"><a href="#cb139-1574" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1575"><a href="#cb139-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1576"><a href="#cb139-1576" aria-hidden="true" tabindex="-1"></a><span class="co"># se fija la semilla aleatoria</span></span>
<span id="cb139-1577"><a href="#cb139-1577" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1994</span>)</span>
<span id="cb139-1578"><a href="#cb139-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1579"><a href="#cb139-1579" aria-hidden="true" tabindex="-1"></a><span class="co"># se entrena el modelo</span></span>
<span id="cb139-1580"><a href="#cb139-1580" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(Response <span class="sc">~</span> .,</span>
<span id="cb139-1581"><a href="#cb139-1581" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>X_trainC,</span>
<span id="cb139-1582"><a href="#cb139-1582" aria-hidden="true" tabindex="-1"></a>            <span class="at">method=</span><span class="st">"nb"</span>,</span>
<span id="cb139-1583"><a href="#cb139-1583" aria-hidden="true" tabindex="-1"></a>            <span class="at">metric=</span><span class="st">"Accuracy"</span>,</span>
<span id="cb139-1584"><a href="#cb139-1584" aria-hidden="true" tabindex="-1"></a>            <span class="at">trControl=</span><span class="fu">trainControl</span>(<span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb139-1585"><a href="#cb139-1585" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb139-1586"><a href="#cb139-1586" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">number =</span> <span class="dv">10</span>))</span>
<span id="cb139-1587"><a href="#cb139-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1588"><a href="#cb139-1588" aria-hidden="true" tabindex="-1"></a><span class="co"># se muestra la salida del modelo</span></span>
<span id="cb139-1589"><a href="#cb139-1589" aria-hidden="true" tabindex="-1"></a>model</span>
<span id="cb139-1590"><a href="#cb139-1590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1591"><a href="#cb139-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1592"><a href="#cb139-1592" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-1593"><a href="#cb139-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1596"><a href="#cb139-1596" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-1597"><a href="#cb139-1597" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: preprocessing_python</span></span>
<span id="cb139-1598"><a href="#cb139-1598" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1599"><a href="#cb139-1599" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1600"><a href="#cb139-1600" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1601"><a href="#cb139-1601" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1602"><a href="#cb139-1602" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1603"><a href="#cb139-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1604"><a href="#cb139-1604" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb139-1605"><a href="#cb139-1605" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb139-1606"><a href="#cb139-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1607"><a href="#cb139-1607" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 0) Asegura DataFrames (ajusta nombres si los tuyos son otros)</span></span>
<span id="cb139-1608"><a href="#cb139-1608" aria-hidden="true" tabindex="-1"></a>X_train_df <span class="op">=</span> pd.DataFrame(X_trainPy).copy()</span>
<span id="cb139-1609"><a href="#cb139-1609" aria-hidden="true" tabindex="-1"></a>X_test_df  <span class="op">=</span> pd.DataFrame(X_testPy).copy()</span>
<span id="cb139-1610"><a href="#cb139-1610" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> np.asarray(y_trainPy)   <span class="co"># 'No'/'Yes' OK</span></span>
<span id="cb139-1611"><a href="#cb139-1611" aria-hidden="true" tabindex="-1"></a>y_test  <span class="op">=</span> np.asarray(y_testPy)</span>
<span id="cb139-1612"><a href="#cb139-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1613"><a href="#cb139-1613" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1) Detecta columnas category (tus mes_cliente_*)</span></span>
<span id="cb139-1614"><a href="#cb139-1614" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [c <span class="cf">for</span> c, dt <span class="kw">in</span> X_train_df.dtypes.items() <span class="cf">if</span> <span class="bu">str</span>(dt) <span class="op">==</span> <span class="st">'category'</span>]</span>
<span id="cb139-1615"><a href="#cb139-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1616"><a href="#cb139-1616" aria-hidden="true" tabindex="-1"></a><span class="co"># Convierte category -&gt; numérico 0/1 (maneja '0'/'1' o niveles raros)</span></span>
<span id="cb139-1617"><a href="#cb139-1617" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cat_to_01(s: pd.Series) <span class="op">-&gt;</span> pd.Series:</span>
<span id="cb139-1618"><a href="#cb139-1618" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pasa a string, mapea '0'-&gt;0, '1'-&gt;1; si hay otros niveles, coerciona a num</span></span>
<span id="cb139-1619"><a href="#cb139-1619" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> pd.to_numeric(s.astype(<span class="bu">str</span>).<span class="bu">map</span>({<span class="st">'0'</span>: <span class="st">'0'</span>, <span class="st">'1'</span>: <span class="st">'1'</span>}).fillna(s.astype(<span class="bu">str</span>)),</span>
<span id="cb139-1620"><a href="#cb139-1620" aria-hidden="true" tabindex="-1"></a>                        errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb139-1621"><a href="#cb139-1621" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out.fillna(<span class="dv">0</span>).astype(np.int64)</span>
<span id="cb139-1622"><a href="#cb139-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1623"><a href="#cb139-1623" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df <span class="kw">in</span> (X_train_df, X_test_df):</span>
<span id="cb139-1624"><a href="#cb139-1624" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> cat_cols:</span>
<span id="cb139-1625"><a href="#cb139-1625" aria-hidden="true" tabindex="-1"></a>        df[c] <span class="op">=</span> cat_to_01(df[c])</span>
<span id="cb139-1626"><a href="#cb139-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1627"><a href="#cb139-1627" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2) Asegura que </span><span class="al">TODO</span><span class="co"> es numérico y ≥0</span></span>
<span id="cb139-1628"><a href="#cb139-1628" aria-hidden="true" tabindex="-1"></a><span class="co"># convierte posibles 'object' residuales a num (si los hubiera)</span></span>
<span id="cb139-1629"><a href="#cb139-1629" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df <span class="kw">in</span> (X_train_df, X_test_df):</span>
<span id="cb139-1630"><a href="#cb139-1630" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> df.columns:</span>
<span id="cb139-1631"><a href="#cb139-1631" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df[c].dtype <span class="op">==</span> <span class="st">'O'</span>:</span>
<span id="cb139-1632"><a href="#cb139-1632" aria-hidden="true" tabindex="-1"></a>            df[c] <span class="op">=</span> pd.to_numeric(df[c], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb139-1633"><a href="#cb139-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1634"><a href="#cb139-1634" aria-hidden="true" tabindex="-1"></a><span class="co"># rellena NaN con 0</span></span>
<span id="cb139-1635"><a href="#cb139-1635" aria-hidden="true" tabindex="-1"></a>X_train_df <span class="op">=</span> X_train_df.fillna(<span class="dv">0</span>)</span>
<span id="cb139-1636"><a href="#cb139-1636" aria-hidden="true" tabindex="-1"></a>X_test_df  <span class="op">=</span> X_test_df.fillna(<span class="dv">0</span>)</span>
<span id="cb139-1637"><a href="#cb139-1637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1638"><a href="#cb139-1638" aria-hidden="true" tabindex="-1"></a><span class="co"># clip a [0, +inf) por si hubiera algún negativo residual</span></span>
<span id="cb139-1639"><a href="#cb139-1639" aria-hidden="true" tabindex="-1"></a>X_train_df <span class="op">=</span> X_train_df.clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb139-1640"><a href="#cb139-1640" aria-hidden="true" tabindex="-1"></a>X_test_df  <span class="op">=</span> X_test_df.clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb139-1641"><a href="#cb139-1641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1642"><a href="#cb139-1642" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3) Alinear columnas </span><span class="al">TEST</span><span class="co"> = columnas TRAIN (mismo orden)</span></span>
<span id="cb139-1643"><a href="#cb139-1643" aria-hidden="true" tabindex="-1"></a>X_test_df <span class="op">=</span> X_test_df.reindex(columns<span class="op">=</span>X_train_df.columns, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb139-1644"><a href="#cb139-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1645"><a href="#cb139-1645" aria-hidden="true" tabindex="-1"></a><span class="co"># (opcional) comprobaciones útiles</span></span>
<span id="cb139-1646"><a href="#cb139-1646" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="kw">not</span> X_train_df.isna().<span class="bu">any</span>().<span class="bu">any</span>(), <span class="st">"NaN en train"</span></span>
<span id="cb139-1647"><a href="#cb139-1647" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="kw">not</span> X_test_df.isna().<span class="bu">any</span>().<span class="bu">any</span>(),  <span class="st">"NaN en test"</span></span>
<span id="cb139-1648"><a href="#cb139-1648" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (X_train_df.dtypes <span class="op">!=</span> <span class="st">'O'</span>).<span class="bu">all</span>(),   <span class="st">"Quedan object en train"</span></span>
<span id="cb139-1649"><a href="#cb139-1649" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (X_test_df.dtypes  <span class="op">!=</span> <span class="st">'O'</span>).<span class="bu">all</span>(),   <span class="st">"Quedan object en test"</span></span>
<span id="cb139-1650"><a href="#cb139-1650" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (X_train_df.values <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>(),     <span class="st">"Negativos en train"</span></span>
<span id="cb139-1651"><a href="#cb139-1651" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (X_test_df.values  <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>(),     <span class="st">"Negativos en test"</span></span>
<span id="cb139-1652"><a href="#cb139-1652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1653"><a href="#cb139-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1656"><a href="#cb139-1656" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-1657"><a href="#cb139-1657" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: train_nb_python</span></span>
<span id="cb139-1658"><a href="#cb139-1658" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1659"><a href="#cb139-1659" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1660"><a href="#cb139-1660" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1661"><a href="#cb139-1661" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1662"><a href="#cb139-1662" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1663"><a href="#cb139-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1664"><a href="#cb139-1664" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the model</span></span>
<span id="cb139-1665"><a href="#cb139-1665" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB</span>
<span id="cb139-1666"><a href="#cb139-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1667"><a href="#cb139-1667" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model</span></span>
<span id="cb139-1668"><a href="#cb139-1668" aria-hidden="true" tabindex="-1"></a>naive_bayes <span class="op">=</span> MultinomialNB()</span>
<span id="cb139-1669"><a href="#cb139-1669" aria-hidden="true" tabindex="-1"></a>naive_bayes_fit <span class="op">=</span> naive_bayes.fit(X_train_df, y_trainPy)</span>
<span id="cb139-1670"><a href="#cb139-1670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1671"><a href="#cb139-1671" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1672"><a href="#cb139-1672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1673"><a href="#cb139-1673" aria-hidden="true" tabindex="-1"></a><span class="fu">### *Tunning parameters*: Selección de los valores óptimos</span></span>
<span id="cb139-1674"><a href="#cb139-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1675"><a href="#cb139-1675" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1676"><a href="#cb139-1676" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-1677"><a href="#cb139-1677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1680"><a href="#cb139-1680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1681"><a href="#cb139-1681" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: nb_base_parametrizar</span></span>
<span id="cb139-1682"><a href="#cb139-1682" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1683"><a href="#cb139-1683" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb139-1684"><a href="#cb139-1684" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1685"><a href="#cb139-1685" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1686"><a href="#cb139-1686" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1687"><a href="#cb139-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1688"><a href="#cb139-1688" aria-hidden="true" tabindex="-1"></a><span class="co"># Define tuning grid </span></span>
<span id="cb139-1689"><a href="#cb139-1689" aria-hidden="true" tabindex="-1"></a>nb_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">usekernel =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb139-1690"><a href="#cb139-1690" aria-hidden="true" tabindex="-1"></a>                       <span class="at">laplace =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), </span>
<span id="cb139-1691"><a href="#cb139-1691" aria-hidden="true" tabindex="-1"></a>                       <span class="at">adjust =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>))</span>
<span id="cb139-1692"><a href="#cb139-1692" aria-hidden="true" tabindex="-1"></a>accuracys <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb139-1693"><a href="#cb139-1693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1694"><a href="#cb139-1694" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(nb_grid)) {</span>
<span id="cb139-1695"><a href="#cb139-1695" aria-hidden="true" tabindex="-1"></a>  kn <span class="ot">&lt;-</span> nb_grid[i, <span class="st">"usekernel"</span>]</span>
<span id="cb139-1696"><a href="#cb139-1696" aria-hidden="true" tabindex="-1"></a>  lp <span class="ot">&lt;-</span> nb_grid[i, <span class="st">"laplace"</span>]</span>
<span id="cb139-1697"><a href="#cb139-1697" aria-hidden="true" tabindex="-1"></a>  nb_base <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(Response <span class="sc">~</span> ., <span class="at">data =</span> X_train, <span class="at">laplace =</span> lp, <span class="at">kernel =</span> kn)</span>
<span id="cb139-1698"><a href="#cb139-1698" aria-hidden="true" tabindex="-1"></a>  prediccion <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb_base, X_train)</span>
<span id="cb139-1699"><a href="#cb139-1699" aria-hidden="true" tabindex="-1"></a>  tabla <span class="ot">&lt;-</span> <span class="fu">table</span>(prediccion, y_train)</span>
<span id="cb139-1700"><a href="#cb139-1700" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(tabla))<span class="sc">/</span><span class="fu">sum</span>(tabla)</span>
<span id="cb139-1701"><a href="#cb139-1701" aria-hidden="true" tabindex="-1"></a>  accuracys <span class="ot">&lt;-</span> <span class="fu">c</span>(accuracys, accuracy)</span>
<span id="cb139-1702"><a href="#cb139-1702" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-1703"><a href="#cb139-1703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1704"><a href="#cb139-1704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1705"><a href="#cb139-1705" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-1706"><a href="#cb139-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1709"><a href="#cb139-1709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1710"><a href="#cb139-1710" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: nb_caret_parametrizar</span></span>
<span id="cb139-1711"><a href="#cb139-1711" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1712"><a href="#cb139-1712" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1713"><a href="#cb139-1713" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1714"><a href="#cb139-1714" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1715"><a href="#cb139-1715" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1716"><a href="#cb139-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1717"><a href="#cb139-1717" aria-hidden="true" tabindex="-1"></a><span class="co"># Define tuning grid </span></span>
<span id="cb139-1718"><a href="#cb139-1718" aria-hidden="true" tabindex="-1"></a>nb_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">usekernel =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb139-1719"><a href="#cb139-1719" aria-hidden="true" tabindex="-1"></a>                       <span class="at">laplace =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>), </span>
<span id="cb139-1720"><a href="#cb139-1720" aria-hidden="true" tabindex="-1"></a>                       <span class="at">adjust =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>))</span>
<span id="cb139-1721"><a href="#cb139-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1722"><a href="#cb139-1722" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Naive Bayes model with parameter tuning</span></span>
<span id="cb139-1723"><a href="#cb139-1723" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2550</span>)</span>
<span id="cb139-1724"><a href="#cb139-1724" aria-hidden="true" tabindex="-1"></a>naive_bayes_via_caret2 <span class="ot">&lt;-</span> <span class="fu">train</span>(Response <span class="sc">~</span> ., </span>
<span id="cb139-1725"><a href="#cb139-1725" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> X_trainC, </span>
<span id="cb139-1726"><a href="#cb139-1726" aria-hidden="true" tabindex="-1"></a>                                <span class="at">method =</span> <span class="st">"naive_bayes"</span>,</span>
<span id="cb139-1727"><a href="#cb139-1727" aria-hidden="true" tabindex="-1"></a>                                <span class="at">usepoisson =</span> <span class="cn">TRUE</span>,</span>
<span id="cb139-1728"><a href="#cb139-1728" aria-hidden="true" tabindex="-1"></a>                                <span class="at">tuneGrid =</span> nb_grid)</span>
<span id="cb139-1729"><a href="#cb139-1729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1730"><a href="#cb139-1730" aria-hidden="true" tabindex="-1"></a><span class="co"># View the selected tuning parameters</span></span>
<span id="cb139-1731"><a href="#cb139-1731" aria-hidden="true" tabindex="-1"></a>naive_bayes_via_caret2<span class="sc">$</span>finalModel<span class="sc">$</span>tuneValue</span>
<span id="cb139-1732"><a href="#cb139-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1733"><a href="#cb139-1733" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the tuning process</span></span>
<span id="cb139-1734"><a href="#cb139-1734" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(naive_bayes_via_caret2)</span>
<span id="cb139-1735"><a href="#cb139-1735" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1736"><a href="#cb139-1736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1737"><a href="#cb139-1737" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-1738"><a href="#cb139-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1741"><a href="#cb139-1741" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-1742"><a href="#cb139-1742" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: nb_python_parametrizar</span></span>
<span id="cb139-1743"><a href="#cb139-1743" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1744"><a href="#cb139-1744" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1745"><a href="#cb139-1745" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1746"><a href="#cb139-1746" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1747"><a href="#cb139-1747" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1748"><a href="#cb139-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1749"><a href="#cb139-1749" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV, StratifiedKFold</span>
<span id="cb139-1750"><a href="#cb139-1750" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB, BernoulliNB, ComplementNB</span>
<span id="cb139-1751"><a href="#cb139-1751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1752"><a href="#cb139-1752" aria-hidden="true" tabindex="-1"></a><span class="co"># Métrica (elige la que te convenga)</span></span>
<span id="cb139-1753"><a href="#cb139-1753" aria-hidden="true" tabindex="-1"></a>scorer <span class="op">=</span> <span class="st">"balanced_accuracy"</span>  <span class="co"># o 'balanced_accuracy', 'roc_auc', 'accuracy', etc.</span></span>
<span id="cb139-1754"><a href="#cb139-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1755"><a href="#cb139-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1756"><a href="#cb139-1756" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb139-1757"><a href="#cb139-1757" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"clf"</span>, MultinomialNB())  <span class="co"># nombre del paso = 'clf'</span></span>
<span id="cb139-1758"><a href="#cb139-1758" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb139-1759"><a href="#cb139-1759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1760"><a href="#cb139-1760" aria-hidden="true" tabindex="-1"></a><span class="co"># Espacio de búsqueda: probamos 3 NB distintos</span></span>
<span id="cb139-1761"><a href="#cb139-1761" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> [</span>
<span id="cb139-1762"><a href="#cb139-1762" aria-hidden="true" tabindex="-1"></a>  {  <span class="co"># MultinomialNB</span></span>
<span id="cb139-1763"><a href="#cb139-1763" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf"</span>: [MultinomialNB()],</span>
<span id="cb139-1764"><a href="#cb139-1764" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__alpha"</span>: [<span class="fl">1e-3</span>, <span class="fl">1e-2</span>, <span class="fl">1e-1</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>],</span>
<span id="cb139-1765"><a href="#cb139-1765" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__fit_prior"</span>: [<span class="va">True</span>, <span class="va">False</span>],</span>
<span id="cb139-1766"><a href="#cb139-1766" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb139-1767"><a href="#cb139-1767" aria-hidden="true" tabindex="-1"></a>  {  <span class="co"># ComplementNB</span></span>
<span id="cb139-1768"><a href="#cb139-1768" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf"</span>: [ComplementNB()],</span>
<span id="cb139-1769"><a href="#cb139-1769" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__alpha"</span>: [<span class="fl">1e-3</span>, <span class="fl">1e-2</span>, <span class="fl">1e-1</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>],</span>
<span id="cb139-1770"><a href="#cb139-1770" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__fit_prior"</span>: [<span class="va">True</span>, <span class="va">False</span>],</span>
<span id="cb139-1771"><a href="#cb139-1771" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__norm"</span>: [<span class="va">True</span>, <span class="va">False</span>],</span>
<span id="cb139-1772"><a href="#cb139-1772" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb139-1773"><a href="#cb139-1773" aria-hidden="true" tabindex="-1"></a>  {  <span class="co"># BernoulliNB</span></span>
<span id="cb139-1774"><a href="#cb139-1774" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf"</span>: [BernoulliNB()],</span>
<span id="cb139-1775"><a href="#cb139-1775" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__alpha"</span>: [<span class="fl">1e-3</span>, <span class="fl">1e-2</span>, <span class="fl">1e-1</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>],</span>
<span id="cb139-1776"><a href="#cb139-1776" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb139-1777"><a href="#cb139-1777" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb139-1778"><a href="#cb139-1778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1779"><a href="#cb139-1779" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb139-1780"><a href="#cb139-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1781"><a href="#cb139-1781" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> GridSearchCV(</span>
<span id="cb139-1782"><a href="#cb139-1782" aria-hidden="true" tabindex="-1"></a>    estimator<span class="op">=</span>pipe,</span>
<span id="cb139-1783"><a href="#cb139-1783" aria-hidden="true" tabindex="-1"></a>    param_grid<span class="op">=</span>param_grid,</span>
<span id="cb139-1784"><a href="#cb139-1784" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span><span class="st">"roc_auc"</span>,</span>
<span id="cb139-1785"><a href="#cb139-1785" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span>cv,</span>
<span id="cb139-1786"><a href="#cb139-1786" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=</span><span class="dv">1</span>,     <span class="co"># importante en tu entorno</span></span>
<span id="cb139-1787"><a href="#cb139-1787" aria-hidden="true" tabindex="-1"></a>    refit<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb139-1788"><a href="#cb139-1788" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">1</span></span>
<span id="cb139-1789"><a href="#cb139-1789" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-1790"><a href="#cb139-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1791"><a href="#cb139-1791" aria-hidden="true" tabindex="-1"></a>grid.fit(X_train_df, y_trainPy)</span>
<span id="cb139-1792"><a href="#cb139-1792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1793"><a href="#cb139-1793" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best:"</span>, grid.best_estimator_)</span>
<span id="cb139-1794"><a href="#cb139-1794" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Params:"</span>, grid.best_params_)</span>
<span id="cb139-1795"><a href="#cb139-1795" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CV score:"</span>, grid.best_score_)</span>
<span id="cb139-1796"><a href="#cb139-1796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1797"><a href="#cb139-1797" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1798"><a href="#cb139-1798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1799"><a href="#cb139-1799" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predicción de la variable respuesta</span></span>
<span id="cb139-1800"><a href="#cb139-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1801"><a href="#cb139-1801" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1802"><a href="#cb139-1802" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-1803"><a href="#cb139-1803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1806"><a href="#cb139-1806" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1807"><a href="#cb139-1807" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predicicon_base</span></span>
<span id="cb139-1808"><a href="#cb139-1808" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1809"><a href="#cb139-1809" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-1810"><a href="#cb139-1810" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1811"><a href="#cb139-1811" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1812"><a href="#cb139-1812" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1813"><a href="#cb139-1813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1814"><a href="#cb139-1814" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(nb_base, X_test, <span class="at">type =</span> <span class="st">"class"</span>))</span>
<span id="cb139-1815"><a href="#cb139-1815" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(nb_base, X_test, <span class="at">type =</span> <span class="st">"raw"</span>))</span>
<span id="cb139-1816"><a href="#cb139-1816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1817"><a href="#cb139-1817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1818"><a href="#cb139-1818" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-1819"><a href="#cb139-1819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1822"><a href="#cb139-1822" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1823"><a href="#cb139-1823" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predicicon_caret</span></span>
<span id="cb139-1824"><a href="#cb139-1824" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1825"><a href="#cb139-1825" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false   </span></span>
<span id="cb139-1826"><a href="#cb139-1826" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1827"><a href="#cb139-1827" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1828"><a href="#cb139-1828" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1829"><a href="#cb139-1829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1830"><a href="#cb139-1830" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(naive_bayes_via_caret2, X_testC))</span>
<span id="cb139-1831"><a href="#cb139-1831" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(naive_bayes_via_caret2, X_testC, <span class="at">type =</span> <span class="st">"prob"</span>))</span>
<span id="cb139-1832"><a href="#cb139-1832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1833"><a href="#cb139-1833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1834"><a href="#cb139-1834" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-1835"><a href="#cb139-1835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1838"><a href="#cb139-1838" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-1839"><a href="#cb139-1839" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix, balanced_accuracy_score</span>
<span id="cb139-1840"><a href="#cb139-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1841"><a href="#cb139-1841" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb139-1842"><a href="#cb139-1842" aria-hidden="true" tabindex="-1"></a>train_predict <span class="op">=</span> naive_bayes_fit.predict(X_train_df)</span>
<span id="cb139-1843"><a href="#cb139-1843" aria-hidden="true" tabindex="-1"></a>test_predict <span class="op">=</span> naive_bayes_fit.predict(X_test_df)</span>
<span id="cb139-1844"><a href="#cb139-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1845"><a href="#cb139-1845" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_scores(y_real, predict):</span>
<span id="cb139-1846"><a href="#cb139-1846" aria-hidden="true" tabindex="-1"></a>  ba_train <span class="op">=</span> balanced_accuracy_score(y_real, predict)</span>
<span id="cb139-1847"><a href="#cb139-1847" aria-hidden="true" tabindex="-1"></a>  cm_train <span class="op">=</span> confusion_matrix(y_real, predict)</span>
<span id="cb139-1848"><a href="#cb139-1848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1849"><a href="#cb139-1849" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ba_train, cm_train </span>
<span id="cb139-1850"><a href="#cb139-1850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1851"><a href="#cb139-1851" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_scores(scores):</span>
<span id="cb139-1852"><a href="#cb139-1852" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="ss">f"Balanced Accuracy: </span><span class="sc">{</span>scores[<span class="dv">0</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">Confussion Matrix:</span><span class="ch">\n</span><span class="ss"> </span><span class="sc">{</span>scores[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb139-1853"><a href="#cb139-1853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1854"><a href="#cb139-1854" aria-hidden="true" tabindex="-1"></a>train_scores <span class="op">=</span> get_scores(y_trainPy, train_predict)</span>
<span id="cb139-1855"><a href="#cb139-1855" aria-hidden="true" tabindex="-1"></a>test_scores <span class="op">=</span> get_scores(y_testPy, test_predict)</span>
<span id="cb139-1856"><a href="#cb139-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1857"><a href="#cb139-1857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1858"><a href="#cb139-1858" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"## Train Scores"</span>)</span>
<span id="cb139-1859"><a href="#cb139-1859" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(print_scores(train_scores))</span>
<span id="cb139-1860"><a href="#cb139-1860" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">## Test Scores"</span>)</span>
<span id="cb139-1861"><a href="#cb139-1861" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(print_scores(test_scores))</span>
<span id="cb139-1862"><a href="#cb139-1862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1863"><a href="#cb139-1863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1864"><a href="#cb139-1864" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1865"><a href="#cb139-1865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1866"><a href="#cb139-1866" aria-hidden="true" tabindex="-1"></a><span class="fu">### Validación de la *performance* del modelo</span></span>
<span id="cb139-1867"><a href="#cb139-1867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1868"><a href="#cb139-1868" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1869"><a href="#cb139-1869" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: R base</span></span>
<span id="cb139-1870"><a href="#cb139-1870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1873"><a href="#cb139-1873" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1874"><a href="#cb139-1874" aria-hidden="true" tabindex="-1"></a>nb_trn_pred <span class="ot">=</span> <span class="fu">predict</span>(nb_base, X_train)</span>
<span id="cb139-1875"><a href="#cb139-1875" aria-hidden="true" tabindex="-1"></a>nb_tst_pred <span class="ot">=</span> <span class="fu">predict</span>(nb_base, X_test)</span>
<span id="cb139-1876"><a href="#cb139-1876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1877"><a href="#cb139-1877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1880"><a href="#cb139-1880" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1881"><a href="#cb139-1881" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_class_err</span>(<span class="at">predicted =</span> nb_trn_pred, <span class="at">actual =</span> y_train)</span>
<span id="cb139-1882"><a href="#cb139-1882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1883"><a href="#cb139-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1886"><a href="#cb139-1886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1887"><a href="#cb139-1887" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_class_err</span>(<span class="at">predicted =</span> nb_tst_pred, <span class="at">actual =</span> y_test)</span>
<span id="cb139-1888"><a href="#cb139-1888" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1889"><a href="#cb139-1889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1892"><a href="#cb139-1892" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1893"><a href="#cb139-1893" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">predicted =</span> nb_tst_pred, <span class="at">actual =</span> y_test)</span>
<span id="cb139-1894"><a href="#cb139-1894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1895"><a href="#cb139-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1898"><a href="#cb139-1898" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1899"><a href="#cb139-1899" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_pred_nb_base</span></span>
<span id="cb139-1900"><a href="#cb139-1900" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1901"><a href="#cb139-1901" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false   </span></span>
<span id="cb139-1902"><a href="#cb139-1902" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1903"><a href="#cb139-1903" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1904"><a href="#cb139-1904" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1905"><a href="#cb139-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1906"><a href="#cb139-1906" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)</span>
<span id="cb139-1907"><a href="#cb139-1907" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb139-1908"><a href="#cb139-1908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1909"><a href="#cb139-1909" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_train)</span>
<span id="cb139-1910"><a href="#cb139-1910" aria-hidden="true" tabindex="-1"></a>y_test  <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_test, <span class="at">levels =</span> <span class="fu">levels</span>(y_train))</span>
<span id="cb139-1911"><a href="#cb139-1911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1912"><a href="#cb139-1912" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Pasar predictores a numérico con dummies (model.matrix)</span></span>
<span id="cb139-1913"><a href="#cb139-1913" aria-hidden="true" tabindex="-1"></a><span class="co">#    Si X_* ya NO incluyen la respuesta, usa ~ . - 1</span></span>
<span id="cb139-1914"><a href="#cb139-1914" aria-hidden="true" tabindex="-1"></a>mm_train <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> X_train)  <span class="co"># matriz numérica</span></span>
<span id="cb139-1915"><a href="#cb139-1915" aria-hidden="true" tabindex="-1"></a>mm_test  <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> X_test)</span>
<span id="cb139-1916"><a href="#cb139-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1917"><a href="#cb139-1917" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) PCA en TRAIN (centrado y escalado), proyectar </span><span class="al">TEST</span></span>
<span id="cb139-1918"><a href="#cb139-1918" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(mm_train, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-1919"><a href="#cb139-1919" aria-hidden="true" tabindex="-1"></a>Z_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, <span class="at">newdata =</span> mm_train)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb139-1920"><a href="#cb139-1920" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="ot">&lt;-</span> <span class="fu">predict</span>(pca, <span class="at">newdata =</span> mm_test)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb139-1921"><a href="#cb139-1921" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Z_train) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PC1"</span>,<span class="st">"PC2"</span>)</span>
<span id="cb139-1922"><a href="#cb139-1922" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Z_test)  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PC1"</span>,<span class="st">"PC2"</span>)</span>
<span id="cb139-1923"><a href="#cb139-1923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1924"><a href="#cb139-1924" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Naive Bayes (e1071) en el plano PCA</span></span>
<span id="cb139-1925"><a href="#cb139-1925" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">naiveBayes</span>(<span class="at">x =</span> <span class="fu">as.data.frame</span>(Z_train), <span class="at">y =</span> y_train, <span class="at">laplace =</span> <span class="dv">0</span>)</span>
<span id="cb139-1926"><a href="#cb139-1926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1927"><a href="#cb139-1927" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Grid y predicción para pintar la frontera</span></span>
<span id="cb139-1928"><a href="#cb139-1928" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb139-1929"><a href="#cb139-1929" aria-hidden="true" tabindex="-1"></a>x_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train[,<span class="dv">1</span>]) <span class="sc">-</span> <span class="dv">1</span>; x_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train[,<span class="dv">1</span>]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb139-1930"><a href="#cb139-1930" aria-hidden="true" tabindex="-1"></a>y_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train[,<span class="dv">2</span>]) <span class="sc">-</span> <span class="dv">1</span>; y_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train[,<span class="dv">2</span>]) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb139-1931"><a href="#cb139-1931" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">PC1 =</span> <span class="fu">seq</span>(x_min, x_max, <span class="at">by =</span> h),</span>
<span id="cb139-1932"><a href="#cb139-1932" aria-hidden="true" tabindex="-1"></a>                    <span class="at">PC2 =</span> <span class="fu">seq</span>(y_min, y_max, <span class="at">by =</span> h))</span>
<span id="cb139-1933"><a href="#cb139-1933" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb, <span class="at">newdata =</span> grid)</span>
<span id="cb139-1934"><a href="#cb139-1934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1935"><a href="#cb139-1935" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Plot fondo + puntos</span></span>
<span id="cb139-1936"><a href="#cb139-1936" aria-hidden="true" tabindex="-1"></a>pal_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="st">"#FFAAAA"</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"#b3ffff"</span>)</span>
<span id="cb139-1937"><a href="#cb139-1937" aria-hidden="true" tabindex="-1"></a>pal_pts  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="st">"#FF0000"</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"#00ffff"</span>)</span>
<span id="cb139-1938"><a href="#cb139-1938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1939"><a href="#cb139-1939" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_train, <span class="at">clase =</span> y_train, <span class="at">split =</span> <span class="st">"Train"</span>)</span>
<span id="cb139-1940"><a href="#cb139-1940" aria-hidden="true" tabindex="-1"></a>df_test  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_test,  <span class="at">clase =</span> y_test,  <span class="at">split =</span> <span class="st">"Test"</span>)</span>
<span id="cb139-1941"><a href="#cb139-1941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1942"><a href="#cb139-1942" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb139-1943"><a href="#cb139-1943" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> grid, <span class="fu">aes</span>(PC1, PC2, <span class="at">fill =</span> pred)) <span class="sc">+</span></span>
<span id="cb139-1944"><a href="#cb139-1944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_fill, <span class="at">name =</span> <span class="st">"Fondo"</span>) <span class="sc">+</span></span>
<span id="cb139-1945"><a href="#cb139-1945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_train, <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb139-1946"><a href="#cb139-1946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_test,  <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb139-1947"><a href="#cb139-1947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_pts, <span class="at">name =</span> <span class="st">"Puntos"</span>) <span class="sc">+</span></span>
<span id="cb139-1948"><a href="#cb139-1948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max), <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb139-1949"><a href="#cb139-1949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Frontera Naive Bayes (e1071) en plano PCA"</span>, <span class="at">x =</span> <span class="st">"PC1"</span>, <span class="at">y =</span> <span class="st">"PC2"</span>) <span class="sc">+</span></span>
<span id="cb139-1950"><a href="#cb139-1950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb139-1951"><a href="#cb139-1951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1952"><a href="#cb139-1952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1953"><a href="#cb139-1953" aria-hidden="true" tabindex="-1"></a><span class="al">![](e1071.jpg)</span>{fig-align="center"}</span>
<span id="cb139-1954"><a href="#cb139-1954" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-1955"><a href="#cb139-1955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1956"><a href="#cb139-1956" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb139-1957"><a href="#cb139-1957" aria-hidden="true" tabindex="-1"></a><span class="fu">## R: Packages `caret`</span></span>
<span id="cb139-1958"><a href="#cb139-1958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1961"><a href="#cb139-1961" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1962"><a href="#cb139-1962" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(naive_bayes_via_caret2)</span>
<span id="cb139-1963"><a href="#cb139-1963" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1964"><a href="#cb139-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1967"><a href="#cb139-1967" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1968"><a href="#cb139-1968" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">melt</span>(naive_bayes_via_caret2<span class="sc">$</span>resample[,<span class="sc">-</span><span class="dv">4</span>]), <span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> value, <span class="at">fill=</span>variable)) <span class="sc">+</span></span>
<span id="cb139-1969"><a href="#cb139-1969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">show.legend=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb139-1970"><a href="#cb139-1970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span>
<span id="cb139-1971"><a href="#cb139-1971" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-1972"><a href="#cb139-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1975"><a href="#cb139-1975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb139-1976"><a href="#cb139-1976" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_clasificacion_caret_nb</span></span>
<span id="cb139-1977"><a href="#cb139-1977" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-1978"><a href="#cb139-1978" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb139-1979"><a href="#cb139-1979" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-1980"><a href="#cb139-1980" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-1981"><a href="#cb139-1981" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-1982"><a href="#cb139-1982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1983"><a href="#cb139-1983" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb139-1984"><a href="#cb139-1984" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb139-1985"><a href="#cb139-1985" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb139-1986"><a href="#cb139-1986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1987"><a href="#cb139-1987" aria-hidden="true" tabindex="-1"></a><span class="co"># y como factor</span></span>
<span id="cb139-1988"><a href="#cb139-1988" aria-hidden="true" tabindex="-1"></a>y_trainC <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_trainC)</span>
<span id="cb139-1989"><a href="#cb139-1989" aria-hidden="true" tabindex="-1"></a>y_testC  <span class="ot">&lt;-</span> <span class="fu">factor</span>(y_testC, <span class="at">levels =</span> <span class="fu">levels</span>(y_train))</span>
<span id="cb139-1990"><a href="#cb139-1990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1991"><a href="#cb139-1991" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Preprocesado: centrar, escalar, PCA=2 (ajustado en train)</span></span>
<span id="cb139-1992"><a href="#cb139-1992" aria-hidden="true" tabindex="-1"></a>preproc <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(X_trainC, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>, <span class="st">"pca"</span>), <span class="at">pcaComp =</span> <span class="dv">2</span>)</span>
<span id="cb139-1993"><a href="#cb139-1993" aria-hidden="true" tabindex="-1"></a>Z_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_trainC)  <span class="co"># PC1, PC2</span></span>
<span id="cb139-1994"><a href="#cb139-1994" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, X_testC)</span>
<span id="cb139-1995"><a href="#cb139-1995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-1996"><a href="#cb139-1996" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Entrenar Naive Bayes (klaR) en el espacio PCA (dos predictores)</span></span>
<span id="cb139-1997"><a href="#cb139-1997" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb139-1998"><a href="#cb139-1998" aria-hidden="true" tabindex="-1"></a>                     <span class="at">summaryFunction =</span> twoClassSummary)</span>
<span id="cb139-1999"><a href="#cb139-1999" aria-hidden="true" tabindex="-1"></a>modelo_nb <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb139-2000"><a href="#cb139-2000" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> Z_train[, <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>)], <span class="at">y =</span> y_trainC,</span>
<span id="cb139-2001"><a href="#cb139-2001" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nb"</span>,                 <span class="co"># klaR::NaiveBayes vía caret</span></span>
<span id="cb139-2002"><a href="#cb139-2002" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> ctrl,</span>
<span id="cb139-2003"><a href="#cb139-2003" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"ROC"</span>,                <span class="co"># mejor que Accuracy si hay desbalance</span></span>
<span id="cb139-2004"><a href="#cb139-2004" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(</span>
<span id="cb139-2005"><a href="#cb139-2005" aria-hidden="true" tabindex="-1"></a>    <span class="at">usekernel =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb139-2006"><a href="#cb139-2006" aria-hidden="true" tabindex="-1"></a>    <span class="at">fL =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),                <span class="co"># laplace</span></span>
<span id="cb139-2007"><a href="#cb139-2007" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjust =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb139-2008"><a href="#cb139-2008" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb139-2009"><a href="#cb139-2009" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-2010"><a href="#cb139-2010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2011"><a href="#cb139-2011" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Grid en el plano PCA (rango del TRAIN)</span></span>
<span id="cb139-2012"><a href="#cb139-2012" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb139-2013"><a href="#cb139-2013" aria-hidden="true" tabindex="-1"></a>x_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train<span class="sc">$</span>PC1) <span class="sc">-</span> <span class="dv">1</span>; x_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train<span class="sc">$</span>PC1) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb139-2014"><a href="#cb139-2014" aria-hidden="true" tabindex="-1"></a>y_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Z_train<span class="sc">$</span>PC2) <span class="sc">-</span> <span class="dv">1</span>; y_max <span class="ot">&lt;-</span> <span class="fu">max</span>(Z_train<span class="sc">$</span>PC2) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb139-2015"><a href="#cb139-2015" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb139-2016"><a href="#cb139-2016" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC1 =</span> <span class="fu">seq</span>(x_min, x_max, <span class="at">by =</span> h),</span>
<span id="cb139-2017"><a href="#cb139-2017" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC2 =</span> <span class="fu">seq</span>(y_min, y_max, <span class="at">by =</span> h)</span>
<span id="cb139-2018"><a href="#cb139-2018" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-2019"><a href="#cb139-2019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2020"><a href="#cb139-2020" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Predicción del modelo en el grid</span></span>
<span id="cb139-2021"><a href="#cb139-2021" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_nb, <span class="at">newdata =</span> grid)</span>
<span id="cb139-2022"><a href="#cb139-2022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2023"><a href="#cb139-2023" aria-hidden="true" tabindex="-1"></a><span class="co"># 5) Plot fondo + puntos</span></span>
<span id="cb139-2024"><a href="#cb139-2024" aria-hidden="true" tabindex="-1"></a>pal_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="st">"#FFAAAA"</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"#b3ffff"</span>)</span>
<span id="cb139-2025"><a href="#cb139-2025" aria-hidden="true" tabindex="-1"></a>pal_pts  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"No"</span> <span class="ot">=</span> <span class="st">"#FF0000"</span>, <span class="st">"Yes"</span> <span class="ot">=</span> <span class="st">"#00ffff"</span>)</span>
<span id="cb139-2026"><a href="#cb139-2026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2027"><a href="#cb139-2027" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_train, <span class="at">clase =</span> y_trainC, <span class="at">split =</span> <span class="st">"Train"</span>)</span>
<span id="cb139-2028"><a href="#cb139-2028" aria-hidden="true" tabindex="-1"></a>df_test  <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Z_test,  <span class="at">clase =</span> y_testC,  <span class="at">split =</span> <span class="st">"Test"</span>)</span>
<span id="cb139-2029"><a href="#cb139-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2030"><a href="#cb139-2030" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb139-2031"><a href="#cb139-2031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> grid, <span class="fu">aes</span>(PC1, PC2, <span class="at">fill =</span> pred), <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb139-2032"><a href="#cb139-2032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal_fill, <span class="at">name =</span> <span class="st">"Fondo"</span>) <span class="sc">+</span></span>
<span id="cb139-2033"><a href="#cb139-2033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_train, <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb139-2034"><a href="#cb139-2034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df_test,  <span class="fu">aes</span>(PC1, PC2, <span class="at">color =</span> clase), <span class="at">size =</span> <span class="fl">2.2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb139-2035"><a href="#cb139-2035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal_pts, <span class="at">name =</span> <span class="st">"Puntos"</span>) <span class="sc">+</span></span>
<span id="cb139-2036"><a href="#cb139-2036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">xlim =</span> <span class="fu">c</span>(x_min, x_max), <span class="at">ylim =</span> <span class="fu">c</span>(y_min, y_max)) <span class="sc">+</span></span>
<span id="cb139-2037"><a href="#cb139-2037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Frontera Naive Bayes (caret::nb) en plano PCA"</span>,</span>
<span id="cb139-2038"><a href="#cb139-2038" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"PC1"</span>, <span class="at">y =</span> <span class="st">"PC2"</span>) <span class="sc">+</span></span>
<span id="cb139-2039"><a href="#cb139-2039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-2040"><a href="#cb139-2040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span>
<span id="cb139-2041"><a href="#cb139-2041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2042"><a href="#cb139-2042" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-2043"><a href="#cb139-2043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2044"><a href="#cb139-2044" aria-hidden="true" tabindex="-1"></a><span class="al">![](caret.jpg)</span>{width="647" height="389"}</span>
<span id="cb139-2045"><a href="#cb139-2045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2046"><a href="#cb139-2046" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python</span></span>
<span id="cb139-2047"><a href="#cb139-2047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2050"><a href="#cb139-2050" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-2051"><a href="#cb139-2051" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: classificacion_python_nb</span></span>
<span id="cb139-2052"><a href="#cb139-2052" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-2053"><a href="#cb139-2053" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-2054"><a href="#cb139-2054" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-2055"><a href="#cb139-2055" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-2056"><a href="#cb139-2056" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-2057"><a href="#cb139-2057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2058"><a href="#cb139-2058" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb139-2059"><a href="#cb139-2059" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_testPy, test_predict))</span>
<span id="cb139-2060"><a href="#cb139-2060" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-2061"><a href="#cb139-2061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2064"><a href="#cb139-2064" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb139-2065"><a href="#cb139-2065" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico_clasificacion_python_nb</span></span>
<span id="cb139-2066"><a href="#cb139-2066" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb139-2067"><a href="#cb139-2067" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb139-2068"><a href="#cb139-2068" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb139-2069"><a href="#cb139-2069" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb139-2070"><a href="#cb139-2070" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb139-2071"><a href="#cb139-2071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2072"><a href="#cb139-2072" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb139-2073"><a href="#cb139-2073" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb139-2074"><a href="#cb139-2074" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> ListedColormap</span>
<span id="cb139-2075"><a href="#cb139-2075" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patches <span class="im">as</span> mpatches</span>
<span id="cb139-2076"><a href="#cb139-2076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2077"><a href="#cb139-2077" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelEncoder</span>
<span id="cb139-2078"><a href="#cb139-2078" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb139-2079"><a href="#cb139-2079" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> GaussianNB  <span class="co"># &lt;&lt; cambio clave</span></span>
<span id="cb139-2080"><a href="#cb139-2080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2081"><a href="#cb139-2081" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== Parámetros ====</span></span>
<span id="cb139-2082"><a href="#cb139-2082" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb139-2083"><a href="#cb139-2083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2084"><a href="#cb139-2084" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 0) Tipos correctos ====</span></span>
<span id="cb139-2085"><a href="#cb139-2085" aria-hidden="true" tabindex="-1"></a>X_trainPy <span class="op">=</span> np.asarray(X_trainPy, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb139-2086"><a href="#cb139-2086" aria-hidden="true" tabindex="-1"></a>X_testPy  <span class="op">=</span> np.asarray(X_testPy,  dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb139-2087"><a href="#cb139-2087" aria-hidden="true" tabindex="-1"></a>y_trainPy <span class="op">=</span> np.asarray(y_trainPy)</span>
<span id="cb139-2088"><a href="#cb139-2088" aria-hidden="true" tabindex="-1"></a>y_testPy  <span class="op">=</span> np.asarray(y_testPy)</span>
<span id="cb139-2089"><a href="#cb139-2089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2090"><a href="#cb139-2090" aria-hidden="true" tabindex="-1"></a><span class="co"># Codificar etiquetas (para colorear y leyendas)</span></span>
<span id="cb139-2091"><a href="#cb139-2091" aria-hidden="true" tabindex="-1"></a>le <span class="op">=</span> LabelEncoder()</span>
<span id="cb139-2092"><a href="#cb139-2092" aria-hidden="true" tabindex="-1"></a>y_train_num <span class="op">=</span> le.fit_transform(y_trainPy)</span>
<span id="cb139-2093"><a href="#cb139-2093" aria-hidden="true" tabindex="-1"></a>y_test_num  <span class="op">=</span> le.transform(y_testPy)</span>
<span id="cb139-2094"><a href="#cb139-2094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2095"><a href="#cb139-2095" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 1) Estandarizar (fit en train) + PCA (fit en train) ====</span></span>
<span id="cb139-2096"><a href="#cb139-2096" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb139-2097"><a href="#cb139-2097" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_trainPy)</span>
<span id="cb139-2098"><a href="#cb139-2098" aria-hidden="true" tabindex="-1"></a>X_test_scaled  <span class="op">=</span> scaler.transform(X_testPy)</span>
<span id="cb139-2099"><a href="#cb139-2099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2100"><a href="#cb139-2100" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb139-2101"><a href="#cb139-2101" aria-hidden="true" tabindex="-1"></a>Z_train <span class="op">=</span> pca.fit_transform(X_train_scaled).astype(<span class="bu">float</span>)</span>
<span id="cb139-2102"><a href="#cb139-2102" aria-hidden="true" tabindex="-1"></a>Z_test  <span class="op">=</span> pca.transform(X_test_scaled).astype(<span class="bu">float</span>)</span>
<span id="cb139-2103"><a href="#cb139-2103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2104"><a href="#cb139-2104" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 2) Entrenar Naive Bayes (Gaussian) en el espacio PCA ====</span></span>
<span id="cb139-2105"><a href="#cb139-2105" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> GaussianNB()</span>
<span id="cb139-2106"><a href="#cb139-2106" aria-hidden="true" tabindex="-1"></a>clf.fit(Z_train, y_train_num)</span>
<span id="cb139-2107"><a href="#cb139-2107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2108"><a href="#cb139-2108" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 3) Mallado y predicción para el fondo ====</span></span>
<span id="cb139-2109"><a href="#cb139-2109" aria-hidden="true" tabindex="-1"></a>x_min, x_max <span class="op">=</span> Z_train[:, <span class="dv">0</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, Z_train[:, <span class="dv">0</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb139-2110"><a href="#cb139-2110" aria-hidden="true" tabindex="-1"></a>y_min, y_max <span class="op">=</span> Z_train[:, <span class="dv">1</span>].<span class="bu">min</span>() <span class="op">-</span> <span class="dv">1</span>, Z_train[:, <span class="dv">1</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb139-2111"><a href="#cb139-2111" aria-hidden="true" tabindex="-1"></a>xx, yy <span class="op">=</span> np.meshgrid(np.arange(x_min, x_max, h),</span>
<span id="cb139-2112"><a href="#cb139-2112" aria-hidden="true" tabindex="-1"></a>                     np.arange(y_min, y_max, h))</span>
<span id="cb139-2113"><a href="#cb139-2113" aria-hidden="true" tabindex="-1"></a>Z_grid_pred_num <span class="op">=</span> clf.predict(np.c_[xx.ravel(), yy.ravel()]).reshape(xx.shape)</span>
<span id="cb139-2114"><a href="#cb139-2114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2115"><a href="#cb139-2115" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 4) Paletas ====</span></span>
<span id="cb139-2116"><a href="#cb139-2116" aria-hidden="true" tabindex="-1"></a>cmap_light <span class="op">=</span> ListedColormap([<span class="st">'#FFAAAA'</span>, <span class="st">'#b3ffff'</span>])</span>
<span id="cb139-2117"><a href="#cb139-2117" aria-hidden="true" tabindex="-1"></a>cmap_bold  <span class="op">=</span> ListedColormap([<span class="st">'#FF0000'</span>,  <span class="st">'#00ffff'</span>])</span>
<span id="cb139-2118"><a href="#cb139-2118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2119"><a href="#cb139-2119" aria-hidden="true" tabindex="-1"></a><span class="co"># ==== 5) Plot ====</span></span>
<span id="cb139-2120"><a href="#cb139-2120" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">5</span>))</span>
<span id="cb139-2121"><a href="#cb139-2121" aria-hidden="true" tabindex="-1"></a>plt.pcolormesh(xx, yy, Z_grid_pred_num, cmap<span class="op">=</span>cmap_light, shading<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb139-2122"><a href="#cb139-2122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2123"><a href="#cb139-2123" aria-hidden="true" tabindex="-1"></a>plt.scatter(Z_train[:, <span class="dv">0</span>], Z_train[:, <span class="dv">1</span>], c<span class="op">=</span>y_train_num, cmap<span class="op">=</span>cmap_bold,</span>
<span id="cb139-2124"><a href="#cb139-2124" aria-hidden="true" tabindex="-1"></a>            edgecolor<span class="op">=</span><span class="st">'k'</span>, s<span class="op">=</span><span class="dv">25</span>, alpha<span class="op">=</span><span class="fl">0.85</span>, label<span class="op">=</span><span class="st">'Train'</span>)</span>
<span id="cb139-2125"><a href="#cb139-2125" aria-hidden="true" tabindex="-1"></a>plt.scatter(Z_test[:, <span class="dv">0</span>],  Z_test[:, <span class="dv">1</span>],  c<span class="op">=</span>y_test_num,  cmap<span class="op">=</span>cmap_bold,</span>
<span id="cb139-2126"><a href="#cb139-2126" aria-hidden="true" tabindex="-1"></a>            edgecolor<span class="op">=</span><span class="st">'k'</span>, s<span class="op">=</span><span class="dv">35</span>, marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Test'</span>)</span>
<span id="cb139-2127"><a href="#cb139-2127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2128"><a href="#cb139-2128" aria-hidden="true" tabindex="-1"></a>plt.xlim(xx.<span class="bu">min</span>(), xx.<span class="bu">max</span>())<span class="op">;</span> plt.ylim(yy.<span class="bu">min</span>(), yy.<span class="bu">max</span>())</span>
<span id="cb139-2129"><a href="#cb139-2129" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'PC1'</span>)<span class="op">;</span> plt.ylabel(<span class="st">'PC2'</span>)</span>
<span id="cb139-2130"><a href="#cb139-2130" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Frontera Naive Bayes (Gaussian) en plano PCA"</span>)</span>
<span id="cb139-2131"><a href="#cb139-2131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2132"><a href="#cb139-2132" aria-hidden="true" tabindex="-1"></a><span class="co"># Leyenda de clases (nombres originales)</span></span>
<span id="cb139-2133"><a href="#cb139-2133" aria-hidden="true" tabindex="-1"></a>classes <span class="op">=</span> <span class="bu">list</span>(le.classes_)</span>
<span id="cb139-2134"><a href="#cb139-2134" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> [<span class="st">'#FF0000'</span>, <span class="st">'#00ffff'</span>]</span>
<span id="cb139-2135"><a href="#cb139-2135" aria-hidden="true" tabindex="-1"></a>patches <span class="op">=</span> [mpatches.Patch(color<span class="op">=</span>palette[i <span class="op">%</span> <span class="bu">len</span>(palette)], label<span class="op">=</span><span class="bu">str</span>(lbl))</span>
<span id="cb139-2136"><a href="#cb139-2136" aria-hidden="true" tabindex="-1"></a>           <span class="cf">for</span> i, lbl <span class="kw">in</span> <span class="bu">enumerate</span>(classes)]</span>
<span id="cb139-2137"><a href="#cb139-2137" aria-hidden="true" tabindex="-1"></a>legend_classes <span class="op">=</span> plt.legend(handles<span class="op">=</span>patches, title<span class="op">=</span><span class="st">"Clases"</span>,</span>
<span id="cb139-2138"><a href="#cb139-2138" aria-hidden="true" tabindex="-1"></a>                            loc<span class="op">=</span><span class="st">'upper right'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.32</span>, <span class="fl">1.0</span>))</span>
<span id="cb139-2139"><a href="#cb139-2139" aria-hidden="true" tabindex="-1"></a>plt.gca().add_artist(legend_classes)</span>
<span id="cb139-2140"><a href="#cb139-2140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2141"><a href="#cb139-2141" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'best'</span>)  <span class="co"># Train/Test</span></span>
<span id="cb139-2142"><a href="#cb139-2142" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb139-2143"><a href="#cb139-2143" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb139-2144"><a href="#cb139-2144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb139-2145"><a href="#cb139-2145" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb139-2146"><a href="#cb139-2146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2147"><a href="#cb139-2147" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bibliografia</span></span>
<span id="cb139-2148"><a href="#cb139-2148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2149"><a href="#cb139-2149" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>https://daviddalpiaz.github.io/r</span>
<span id="cb139-2150"><a href="#cb139-2150" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>